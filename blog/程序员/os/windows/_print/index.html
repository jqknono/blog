<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://blog.jqknono.com/blog/%E7%A8%8B%E5%BA%8F%E5%91%98/os/windows/><link rel=alternate type=application/rss+xml href=https://blog.jqknono.com/blog/%E7%A8%8B%E5%BA%8F%E5%91%98/os/windows/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>windows | Nono Blogs</title>
<meta name=description content="jqknono 的博客"><meta property="og:url" content="https://blog.jqknono.com/blog/%E7%A8%8B%E5%BA%8F%E5%91%98/os/windows/"><meta property="og:site_name" content="Nono Blogs"><meta property="og:title" content="windows"><meta property="og:description" content="jqknono 的博客"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="website"><meta itemprop=name content="windows"><meta itemprop=description content="jqknono 的博客"><meta itemprop=datePublished content="2024-06-28T17:16:41+08:00"><meta itemprop=dateModified content="2024-06-28T17:16:41+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="windows"><meta name=twitter:description content="jqknono 的博客"><link rel=preload href=/scss/main.min.8acecbf86e7556fec1884b2edb0c0a5fcb36544832255924728123faf38ac587.css as=style integrity="sha256-is7L+G51Vv7BiEsu2wwKX8s2VEgyJVkkcoEj+vOKxYc=" crossorigin=anonymous><link href=/scss/main.min.8acecbf86e7556fec1884b2edb0c0a5fcb36544832255924728123faf38ac587.css rel=stylesheet integrity="sha256-is7L+G51Vv7BiEsu2wwKX8s2VEgyJVkkcoEj+vOKxYc=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-F3FFTG72NE"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F3FFTG72NE")}</script></head><body class="td-section td-blog"><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Nono Blogs</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class="nav-link active" href=/blog/><i class='fas fa-cube'></i><span>Blog</span></a></li><li class=nav-item><a class=nav-link href=/docs/><i class='fas fa-book'></i><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=https://www.adguardprivate.com target=_blank rel=noopener><i class="fa-solid fa-fire"></i><span>创建私有Adguard</span><sup><i class="ps-1 fa-solid fa-up-right-from-square fa-xs" aria-hidden=true></i></sup></a></li><li class="td-light-dark-menu nav-item dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown data-bs-display=static aria-label="Toggle theme (auto)"><svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=bd-theme-text><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></li></ul></div><div class="d-none d-lg-block"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder=站内搜索… aria-label=站内搜索… autocomplete=off></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/blog/%E7%A8%8B%E5%BA%8F%E5%91%98/os/windows/>返回本页常规视图</a>.</p></div><h1 class=title>windows</h1><ul><li><a href=#pg-feed9e21730b5856a268e31d6db06c37>理解Windows网络_WFP</a></li><li><a href=#pg-021d3a093eb8786e8c11c6673103012b>理解Windows事件跟踪_ETW</a></li><li><a href=#pg-2ff6fe9b17c0d87d77c11f27a7fa527c>wireguard配置</a></li><li><a href=#pg-6fd322b95dfd6a5f84894ff330485c26>Windows阻断网络流量获取</a></li><li><a href=#pg-98219600397f17c3d5e4ac6fbfc5f707>Windows防火墙管理-netsh</a></li><li><a href=#pg-ea3b4f1af238c774fab2871e85bf40ef>Windows相关资源</a></li><li><a href=#pg-cb9613752bee2e31a2596d114cfa27f0>Windows导览</a></li><li><a href=#pg-add85b56bb4af8b5216a8122ebeea317>windows-ipv6管理</a></li><li><a href=#pg-e9e3d6173c9a65d937dabcb06bfd3085>window-message</a></li><li><a href=#pg-193faaa62417d666d3091475b953c37f>Win-to-go</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-feed9e21730b5856a268e31d6db06c37>理解Windows网络_WFP</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> 理解Windows网络_WFP</li></ul><h1 id=理解-windows-网络>理解 Windows 网络</h1><ul><li><input disabled type=checkbox> 理解 Windows 网络</li></ul><h2 id=wfp>WFP</h2><h3 id=名词解释>名词解释</h3><p><a href=https://learn.microsoft.com/en-us/windows/win32/fwp/object-model>https://learn.microsoft.com/en-us/windows/win32/fwp/object-model</a>
<a href=https://learn.microsoft.com/en-us/windows/win32/fwp/basic-operation>https://learn.microsoft.com/en-us/windows/win32/fwp/basic-operation</a>
<a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/network>https://learn.microsoft.com/en-us/windows-hardware/drivers/network</a></p><p><a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/network/callout>callout</a>: A callout provides functionality that extends the capabilities of the Windows Filtering Platform. A callout consists of a set of callout functions and a GUID key that uniquely identifies the callout.
<a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/network/callout-driver>callout driver</a>: A callout driver is a driver that registers callouts with the Windows Filtering Platform. A callout driver is a type of filter driver.
<a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/network/callout-function>callout function</a>: A callout function is a function that is called by the Windows Filtering Platform to perform a specific task. A callout function is associated with a callout.
<a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/network/filter>filter</a>: A filter is a set of functions that are called by the Windows Filtering Platform to perform filtering operations. A filter consists of a set of filter functions and a GUID key that uniquely identifies the filter.
<a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/network/filter-engine>filter engine</a>: The filter engine is the component of the Windows Filtering Platform that performs filtering operations. The filter engine is responsible for calling the filter functions that are registered with the Windows Filtering Platform.
<a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/network/filter-layer>filter layer</a>: A filter layer is a set of functions that are called by the Windows Filtering Platform to perform filtering operations. A filter layer consists of a set of filter layer functions and a GUID key that uniquely identifies the filter layer.</p><p>Dispatcher队列触发回调是尽快触发形式, 不需要等队列满, 因此可以满足实时性.
当用户回调较慢时, 阻塞的报文会尽可能插入下个队列, 队列上限256. 更多的阻塞报文则由系统缓存, 粗略的测试缓存能力是16500, 系统缓存能力可能随机器性能和配置不同存在差异.
用户回调处理报文时, 存在两份报文实体:
内核报文, 在回调处理完队列后一并释放. 因此回调较慢时, 一次回调执行会最多锁定系统256个报文的缓存能力.
回调中的拷贝, 处理完单个报文后立即释放.</p><p>在FwppNetEvent1Callback中对报文进行拷贝组装, 不会操作原始报文, 对业务没有影响.</p><p>订阅可以使用模板过滤器, 以减少需要处理的报文:</p><p><a href=https://learn.microsoft.com/en-us/windows/win32/api/fwpmtypes/ns-fwpmtypes-fwpm_net_event_enum_template0>https://learn.microsoft.com/en-us/windows/win32/api/fwpmtypes/ns-fwpmtypes-fwpm_net_event_enum_template0</a></p><p>filterCondition</p><p>An array of FWPM_FILTER_CONDITION0 structures that contain distinct filter conditions (duplicated filter conditions will generate an error). All conditions must be true for the action to be performed. In other words, the conditions are AND&rsquo;ed together. If no conditions are specified, the action is always performed.</p><p>不可使用相同的filter
所有过滤器间的关系是"与", 需要全都满足
微软文档显示支持的过滤器有八种, 实际上支持的过滤器会更多.</p><p>FWPM_CONDITION_IP_PROTOCOL</p><p>The IP protocol number, as specified in RFC 1700.
FWPM_CONDITION_IP_LOCAL_ADDRESS</p><p>The local IP address.
FWPM_CONDITION_IP_REMOTE_ADDRESS</p><p>The remote IP address.
FWPM_CONDITION_IP_LOCAL_PORT</p><p>The local transport protocol port number. For ICMP, the message type.
FWPM_CONDITION_IP_REMOTE_PORT</p><p>The remote transport protocol port number. For ICMP, the message code.
FWPM_CONDITION_SCOPE_ID</p><p>The interface IPv6 scope identifier. Reserved for internal use.
FWPM_CONDITION_ALE_APP_ID</p><p>The full path of the application.
FWPM_CONDITION_ALE_USER_ID</p><p>The identification of the local user.
枚举系统已注册的订阅发现已有两个订阅, 查看其sessionKey GUID无法确认由谁注册, 对其进行分析发现两个订阅各自实现了以下功能:</p><p>订阅了所有FWPM_NET_EVENT_TYPE_CLASSIFY_DROP的数据包, 统计了所有被丢弃的包.
订阅了所有FWPM_NET_EVENT_TYPE_CLASSIFY_ALLOW的数据包, 可以用来做流量统计
这两个订阅用到的contition filter都是FWPM_CONDITION_NET_EVENT_TYPE(206e9996-490e-40cf-b831-b38641eb6fcb), 说明可以实现过滤的filter不止微软文档中提到的8个.</p><p>更多调研发现用户态调用接口仅能捕获drop的事件, 非drop事件需要使用内核模式获取, 因此微隔离不能使用FWPM_CONDITION_NET_EVENT_TYPE获取事件.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-021d3a093eb8786e8c11c6673103012b>理解Windows事件跟踪_ETW</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> 理解Windows事件跟踪_ETW</li></ul><h1 id=理解-etw>理解 ETW</h1><p>筛除了一些不必要的信息, 完整文档参阅: <a href=https://docs.microsoft.com/en-us/windows/win32/etw/event-tracing-portal>https://docs.microsoft.com/en-us/windows/win32/etw/event-tracing-portal</a></p><h2 id=理解基础>理解基础</h2><p><a href=https://learn.microsoft.com/en-us/windows/win32/etw/about-event-tracing>https://learn.microsoft.com/en-us/windows/win32/etw/about-event-tracing</a></p><p><img alt=架构 src=https://learn.microsoft.com/en-us/windows/win32/etw/images/etdiag2.png></p><h2 id=session>Session</h2><p>存在四种 session</p><table><thead><tr><th>session 种类</th><th>使用</th><th>限制</th><th>特点</th></tr></thead><tbody><tr><td><a href=https://learn.microsoft.com/en-us/windows/win32/etw/configuring-and-starting-an-event-tracing-session>Event Tracing Session</a>(Standard ETW)</td><td>1. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/ns-evntrace-event_trace_properties>EVENT_TRACE_PROPERTIES</a>2. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-starttracea>StartTrace</a>, 创建 session3. EnableTrace 1. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-enabletrace>EnableTrace</a> for classic provider 2. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-enabletraceex>EnableTraceEx</a> for manifest-based provider4. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-controltracea>ControlTrace</a>  停止 session</td><td>- 一个 manifest-based provider 仅支持提供事件到至多 8 个 session- 一个 classic provider, 仅能服务一个 session.- session 抢占 provider 行为是后来居上.</td><td>标准 ETW.</td></tr><tr><td><a href=https://learn.microsoft.com/en-us/windows/win32/etw/configuring-and-starting-a-systemtraceprovider-session>SystemTraceProvider Session</a></td><td>1. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/ns-evntrace-event_trace_properties>EVENT_TRACE_PROPERTIES</a>-><strong>EnableFlags</strong>2. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-starttracea>StartTrace</a>3. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-controltracea>ControlTrace</a>  停止 session</td><td>- **SystemTraceProvider **是一个内核事件 provider, 提供一套<a href=https://learn.microsoft.com/en-us/windows/win32/etw/nt-kernel-logger-constants>预定义的内核事件</a>.- <strong><a href=https://learn.microsoft.com/en-us/windows/win32/etw/configuring-and-starting-the-nt-kernel-logger-session>NT Kernel Logger session</a><strong>是系统预置 session, 记录一系列系统预定义的内核事件- <strong>Win7/WinServer2008R2</strong>仅 NT Kernel Logger session 可使用 SystemTraceProvider - <strong>Win8/WinServer2012</strong>的 SystemTraceProvider 可以提供事件给</strong>8 个 logger session</strong>, 其中两个固定为 NT Kernel Logger 和 Circular Kernel Context Logger.- <strong>Win10 20348</strong>之后, 各 Systerm provider 可以被单独控制.</td><td>获取系统内核预定义事件.</td></tr><tr><td><a href=https://learn.microsoft.com/en-us/windows/win32/etw/configuring-and-starting-an-autologger-session>AutoLogger session</a></td><td>1. 修改注册表 2. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-enabletraceex>EnableTraceEx</a>3. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-controltracea>ControlTrace</a>  停止 session</td><td>- **<a href=https://learn.microsoft.com/en-us/windows/win32/etw/configuring-and-starting-the-global-logger-session>Global Logger Session</a>**是特殊独立的 session, 记录系统启动时事件.- 普通 AutoLogger 需要自行使能 provider, GlobleLogger 不需要.- AutoLogger 不支持 NT Kernel Logger 事件, 仅 GlobalLogger 支持.- 影响启动时间, 节制使用</td><td>记录操作系统启动期间事件</td></tr><tr><td><a href=https://learn.microsoft.com/en-us/windows/win32/etw/configuring-and-starting-a-private-logger-session>Private Logger Session</a></td><td>-</td><td>- User-mode ETW- 仅进程内使用- 不计入 64 session 并行限制.</td><td>进程私有</td></tr></tbody></table><h2 id=工具>工具</h2><ul><li><a href=https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/logman>logman</a></li><li><a href=https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/wevtutil>wevtutil</a><ul><li>xpath 查询实例: <code>wevtutil qe Security /c:2 /q:"*[System[EventID=5157]]" /f:text</code></li></ul></li><li><a href=https://learn.microsoft.com/zh-cn/windows-hardware/drivers/devtest/tracelog>tracelog</a><ul><li>使用 viusal studio 的<code>tracelog</code>工具, 可以在运行时动态的添加和删除 ETW Provider, 以及动态的添加和删除 ETW Session</li></ul></li><li><a href=https://learn.microsoft.com/en-us/windows/win32/wes/message-compiler--mc-exe->mc</a></li><li><a href=https://github.com/repnz/etw-providers-docs>etw-providers-docs</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-2ff6fe9b17c0d87d77c11f27a7fa527c>wireguard配置</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> wireguard配置</li></ul><h1 id=wireguard-配置>wireguard 配置</h1><h2 id=防火墙配置>防火墙配置</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>wireguard</span> <span class=p>/</span><span class=n>installtunnelservice</span> <span class=p>&lt;</span><span class=n>wg_conf_path</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>wg</span> <span class=n>show</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetConnectionProfile</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetAdapter</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetFirewallProfile</span>
</span></span><span class=line><span class=cl><span class=nb>Set-NetFirewallProfile</span> <span class=n>-Profile</span> <span class=n>domain</span><span class=p>,</span><span class=n>public</span><span class=p>,</span><span class=n>private</span> <span class=n>-DisabledInterfaceAliases</span> <span class=p>&lt;</span><span class=n>wg_config_name</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nb>Set-NetIPInterface</span> <span class=n>-ifindex</span> <span class=p>&lt;</span><span class=n>interface</span> <span class=n>index</span><span class=p>&gt;</span> <span class=n>-Forwarding</span> <span class=n>Enabled</span>
</span></span><span class=line><span class=cl><span class=nb>New-NetFirewallRule</span> <span class=n>-DisplayName</span> <span class=s2>&#34;@wg1&#34;</span> <span class=n>-Direction</span> <span class=n>Inbound</span>  <span class=n>-RemoteAddress</span> <span class=mf>10.66</span><span class=p>.</span><span class=py>66</span><span class=p>.</span><span class=mf>1</span><span class=p>/</span><span class=mf>24</span> <span class=n>-Action</span> <span class=n>Allow</span>
</span></span><span class=line><span class=cl><span class=nb>New-NetFirewallRule</span> <span class=n>-DisplayName</span> <span class=s2>&#34;@wg1&#34;</span> <span class=n>-Direction</span> <span class=n>Outbound</span> <span class=n>-RemoteAddress</span> <span class=mf>10.66</span><span class=p>.</span><span class=py>66</span><span class=p>.</span><span class=mf>1</span><span class=p>/</span><span class=mf>24</span> <span class=n>-Action</span> <span class=n>Allow</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># 定位拦截原因</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=nb>set </span><span class=p>/</span><span class=n>subcategory</span><span class=err>:</span><span class=s2>&#34;{0CCE9225-69AE-11D9-BED3-505054503030}&#34;</span> <span class=p>/</span><span class=n>success</span><span class=err>:</span><span class=n>disable</span> <span class=p>/</span><span class=n>failure</span><span class=err>:</span><span class=n>enable</span>
</span></span><span class=line><span class=cl><span class=n>wevtutil</span> <span class=n>qe</span> <span class=n>Security</span> <span class=p>/</span><span class=n>q:</span><span class=s2>&#34;*[System/EventID=5152]&#34;</span> <span class=p>/</span><span class=n>c:</span><span class=mf>5</span> <span class=p>/</span><span class=n>rd</span><span class=err>:</span><span class=n>true</span> <span class=p>/</span><span class=n>f:text</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=nb>set </span><span class=p>/</span><span class=n>subcategory</span><span class=err>:</span><span class=s2>&#34;{0CCE9225-69AE-11D9-BED3-505054503030}&#34;</span> <span class=p>/</span><span class=n>success</span><span class=err>:</span><span class=n>disable</span> <span class=p>/</span><span class=n>failure</span><span class=err>:</span><span class=n>disable</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-6fd322b95dfd6a5f84894ff330485c26>Windows阻断网络流量获取</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Windows阻断网络流量获取</li></ul><h1 id=windows-阻断网络流量获取>Windows 阻断网络流量获取</h1><ul><li><a href=/blog/2024/06/28/windows%E9%98%BB%E6%96%AD%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E8%8E%B7%E5%8F%96/#-windows-阻断网络流量获取->Windows 阻断网络流量获取</a><ul><li><a href=/blog/2024/06/28/windows%E9%98%BB%E6%96%AD%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E8%8E%B7%E5%8F%96/#-搭建测试工程->搭建测试工程</a></li><li><a href=/blog/2024/06/28/windows%E9%98%BB%E6%96%AD%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E8%8E%B7%E5%8F%96/#-通过审计获取-block-事件->通过审计获取 block 事件</a><ul><li><a href=/blog/2024/06/28/windows%E9%98%BB%E6%96%AD%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E8%8E%B7%E5%8F%96/#-获取-provider-信息->获取 provider 信息</a></li><li><a href=/blog/2024/06/28/windows%E9%98%BB%E6%96%AD%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E8%8E%B7%E5%8F%96/#-构造-block-事件->构造 block 事件</a></li></ul></li><li><a href=/blog/2024/06/28/windows%E9%98%BB%E6%96%AD%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E8%8E%B7%E5%8F%96/#-监控网络事件net_event->监控网络事件(NET_EVENT)</a></li><li><a href=/blog/2024/06/28/windows%E9%98%BB%E6%96%AD%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E8%8E%B7%E5%8F%96/#-监控网络链接netconnection->监控网络链接(NetConnection)</a></li><li><a href=/blog/2024/06/28/windows%E9%98%BB%E6%96%AD%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E8%8E%B7%E5%8F%96/#-application-layer-enforcementale介绍->Application Layer Enforcement(ALE)介绍</a></li><li><a href=/blog/2024/06/28/windows%E9%98%BB%E6%96%AD%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E8%8E%B7%E5%8F%96/#-编码->编码</a></li><li><a href=/blog/2024/06/28/windows%E9%98%BB%E6%96%AD%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E8%8E%B7%E5%8F%96/#-结论->结论</a></li><li><a href=/blog/2024/06/28/windows%E9%98%BB%E6%96%AD%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E8%8E%B7%E5%8F%96/#-附录->附录</a><ul><li><a href=/blog/2024/06/28/windows%E9%98%BB%E6%96%AD%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E8%8E%B7%E5%8F%96/#-wfp-体系结构->WFP 体系结构</a></li><li><a href=/blog/2024/06/28/windows%E9%98%BB%E6%96%AD%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E8%8E%B7%E5%8F%96/#-数据流->数据流</a></li><li><a href=/blog/2024/06/28/windows%E9%98%BB%E6%96%AD%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E8%8E%B7%E5%8F%96/#-参考链接->参考链接</a></li></ul></li></ul></li></ul><ul><li>需要识别出被阻断的流量, 被阻断的流量包括出站入站方向.</li><li>阻断的两种形式, 基于链接(connection), 和基于数据包(packet). 数据包的丢弃较为频繁常见, 需要审查丢弃原因, 基于链接的阻断更符合实际需关注的阻断场景.</li><li>许多正常处理的报文也会被 drop, 因此需要区分 drop 和 block 行为, 我们主要关注 block 的情况.</li></ul><h2 id=搭建测试工程>搭建测试工程</h2><p>WFP 主要工作在 usermode, 另一部分在 kernalmode, 能力以驱动形式体现, 搭建测试环境的方法比较复杂. 推荐的方法是测试机使用另一台物理机, 开发机编译好后, 发送至测试机远程调试.
受条件限制, 我们也可以直接在本地进行调试.</p><ul><li><a href=https://github.com/microsoft/Windows-driver-samples>Microsoft WFP Sample 工程</a><ul><li>只关注: Windows-driver-samples\network\trans\WFPSampler</li></ul></li><li><a href=https://docs.microsoft.com/zh-cn/samples/microsoft/windows-driver-samples/windows-filtering-platform-sample/>WFPSampler 工程指导</a></li></ul><p>编译问题:</p><ul><li><a href=https://github.com/microsoft/Windows-driver-samples/pull/538>缺失 api-ms-win-net-isolation-l1-1-0</a></li><li><a href=https://stackoverflow.com/questions/44837612/wfpsampler-compilation-issue-wfpcalloutsclassreg-not-found>wfpcalloutsclassreg-not-found</a></li></ul><p>其它问题:</p><ul><li><a href=https://answers.microsoft.com/en-us/protect/forum/all/your-organization-used-windows-defender/ef12b7be-41f5-4b71-a73c-e4f99ba944f7>驱动程序无法运行</a></li><li><a href=https://stackoverflow.com/questions/84847/how-do-i-create-a-self-signed-certificate-for-code-signing-on-windows>如何签名</a></li><li><a href=https://docs.microsoft.com/zh-cn/windows-hardware/drivers/develop/preparing-a-computer-for-manual-driver-deployment>准备部署的测试机</a></li></ul><h2 id=通过审计获取-block-事件>通过审计获取 block 事件</h2><ul><li><a href=https://docs.microsoft.com/en-us/windows/win32/fwp/auditing-and-logging>Auditing 文档</a></li><li><a href=https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/auditpol>auditpol 文档</a></li></ul><p>默认情况下，禁用对 WFP 的审核。</p><ul><li>可以通过组策略对象编辑器 MMC 管理单元、本地安全策略 MMC 管理单元或 auditpol.exe 命令，按类别(category)启用审核。</li><li>可以通过 auditpol.exe 命令按子类别(subcategory)启用审核。</li><li>应该使用 guid 进行设置, 否则不同语言系统有本地化的问题.</li><li>审计使用循环日志, 128KB 不用担心资源消耗</li></ul><p>类别<a href=https://docs.microsoft.com/en-us/windows/win32/secauthz/auditing-constants>https://docs.microsoft.com/en-us/windows/win32/secauthz/auditing-constants</a></p><table><thead><tr><th>Category/Subcategory</th><th>GUID</th></tr></thead><tbody><tr><td>&mldr;</td><td>&mldr;</td></tr><tr><td><strong>Object Access</strong></td><td>{6997984A-797A-11D9-BED3-505054503030}</td></tr><tr><td><strong>Policy Change</strong></td><td>{6997984D-797A-11D9-BED3-505054503030}</td></tr><tr><td>&mldr;</td><td>&mldr;</td></tr></tbody></table><p><strong>Object Access</strong> 子类和对应 GUID <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-gpac/77878370-0712-47cd-997d-b07053429f6d>https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-gpac/77878370-0712-47cd-997d-b07053429f6d</a></p><table><thead><tr><th>Object Access Subcategory</th><th>Subcategory GUID</th><th>Inclusion Setting</th></tr></thead><tbody><tr><td>&mldr;</td><td>&mldr;</td><td>&mldr;</td></tr><tr><td><strong>Filtering Platform Packet Drop</strong></td><td>{0CCE9225-69AE-11D9-BED3-505054503030}</td><td>No Auditing</td></tr><tr><td><strong>Filtering Platform Connection</strong></td><td>{0CCE9226-69AE-11D9-BED3-505054503030}</td><td>No Auditing</td></tr><tr><td><strong>Other Object Access Events</strong></td><td>{0CCE9227-69AE-11D9-BED3-505054503030}</td><td>No Auditing</td></tr><tr><td>&mldr;</td><td>&mldr;</td><td>&mldr;</td></tr></tbody></table><p><strong>Policy Change</strong> 子类和对应 GUID:</p><table><thead><tr><th>Policy Change Subcategory</th><th>Subcategory GUID</th></tr></thead><tbody><tr><td><strong>Audit Policy Change</strong></td><td>{0CCE922F-69AE-11D9-BED3-505054503030}</td></tr><tr><td>Authentication Policy Change</td><td>{0CCE9230-69AE-11D9-BED3-505054503030}</td></tr><tr><td>Authorization Policy Change</td><td>{0CCE9231-69AE-11D9-BED3-505054503030}</td></tr><tr><td>MPSSVC Rule-Level Policy Change</td><td>{0CCE9232-69AE-11D9-BED3-505054503030}</td></tr><tr><td><strong>Filtering Platform Policy Change</strong></td><td>{0CCE9233-69AE-11D9-BED3-505054503030}</td></tr><tr><td>Other Policy Change Events</td><td>{0CCE9234-69AE-11D9-BED3-505054503030}</td></tr></tbody></table><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># auditpol手册参阅: https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/auditpol</span>
</span></span><span class=line><span class=cl><span class=c># 本段主要关注 &#39;Object Access&#39; 类别</span>
</span></span><span class=line><span class=cl><span class=c># 获取可查询的字段</span>
</span></span><span class=line><span class=cl><span class=c># -v 显示GUID, -r显示csv报告</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>list</span> <span class=p>/</span><span class=n>category</span> <span class=p>/</span><span class=n>v</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>list</span> <span class=p>/</span><span class=n>subcategory</span><span class=err>:</span><span class=p>*</span> <span class=p>/</span><span class=n>v</span>
</span></span><span class=line><span class=cl><span class=c># 获取某个子类别的审计设置</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>get</span> <span class=p>/</span><span class=n>category</span><span class=err>:</span><span class=s1>&#39;Object Access&#39;</span> <span class=p>/</span><span class=nb>r </span><span class=p>|</span> <span class=nb>ConvertFrom-Csv</span><span class=p>|</span> <span class=nb>Get-Member</span>
</span></span><span class=line><span class=cl><span class=c># 查询guid</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>get</span> <span class=p>/</span><span class=n>category</span><span class=err>:</span><span class=s1>&#39;Object Access&#39;</span> <span class=p>/</span><span class=nb>r </span><span class=p>|</span> <span class=nb>ConvertFrom-Csv</span><span class=p>|</span> <span class=nb>Format-Table</span> <span class=n>Subcategory</span><span class=p>,</span><span class=s1>&#39;Subcategory GUID&#39;</span><span class=p>,</span><span class=s1>&#39;Inclusion Setting&#39;</span>
</span></span><span class=line><span class=cl><span class=c># 查找subcategory</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>list</span> <span class=p>/</span><span class=n>subcategory</span><span class=err>:</span><span class=s2>&#34;Object Access&#34;</span><span class=p>,</span><span class=s2>&#34;Policy Change&#34;</span> <span class=n>-v</span>
</span></span><span class=line><span class=cl><span class=c># 备份</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>backup</span> <span class=p>/</span><span class=n>file</span><span class=err>:</span><span class=n>d:</span><span class=p>\</span><span class=n>audit</span><span class=p>.</span><span class=py>bak</span>
</span></span><span class=line><span class=cl><span class=c># 还原</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>restore</span> <span class=p>/</span><span class=n>file</span><span class=err>:</span><span class=n>d:</span><span class=p>\</span><span class=n>audit</span><span class=p>.</span><span class=py>bak</span>
</span></span><span class=line><span class=cl><span class=c># 修改Policy</span>
</span></span><span class=line><span class=cl><span class=c># **Policy Change**    | {6997984D-797A-11D9-BED3-505054503030}</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=nb>set </span><span class=p>/</span><span class=n>category</span><span class=err>:</span><span class=s2>&#34;{6997984D-797A-11D9-BED3-505054503030}&#34;</span> <span class=p>/</span><span class=n>success</span><span class=err>:</span><span class=n>disable</span> <span class=p>/</span><span class=n>failure</span><span class=err>:</span><span class=n>disable</span>
</span></span><span class=line><span class=cl><span class=c># Filtering Platform Policy Change | {0CCE9233-69AE-11D9-BED3-505054503030}</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=nb>set </span><span class=p>/</span><span class=n>subcategory</span><span class=err>:</span><span class=s2>&#34;{0CCE9233-69AE-11D9-BED3-505054503030}&#34;</span> <span class=p>/</span><span class=n>success</span><span class=err>:</span><span class=n>enable</span> <span class=p>/</span><span class=n>failure</span><span class=err>:</span><span class=n>enable</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># **Object Access**    | {6997984A-797A-11D9-BED3-505054503030}</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>get</span> <span class=p>/</span><span class=n>category</span><span class=err>:</span><span class=s2>&#34;{6997984A-797A-11D9-BED3-505054503030}&#34;</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=nb>set </span><span class=p>/</span><span class=n>category</span><span class=err>:</span><span class=s2>&#34;{6997984A-797A-11D9-BED3-505054503030}&#34;</span> <span class=p>/</span><span class=n>success</span><span class=err>:</span><span class=n>disable</span> <span class=p>/</span><span class=n>failure</span><span class=err>:</span><span class=n>disable</span>
</span></span><span class=line><span class=cl><span class=c># Filtering Platform Packet Drop | {0CCE9225-69AE-11D9-BED3-505054503030}</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=nb>set </span><span class=p>/</span><span class=n>subcategory</span><span class=err>:</span><span class=s2>&#34;{0CCE9225-69AE-11D9-BED3-505054503030}&#34;</span> <span class=p>/</span><span class=n>success</span><span class=err>:</span><span class=n>disable</span> <span class=p>/</span><span class=n>failure</span><span class=err>:</span><span class=n>enable</span>
</span></span><span class=line><span class=cl><span class=c># Filtering Platform Connection  | {0CCE9226-69AE-11D9-BED3-505054503030}</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=nb>set </span><span class=p>/</span><span class=n>subcategory</span><span class=err>:</span><span class=s2>&#34;{0CCE9226-69AE-11D9-BED3-505054503030}&#34;</span> <span class=p>/</span><span class=n>success</span><span class=err>:</span><span class=n>disable</span> <span class=p>/</span><span class=n>failure</span><span class=err>:</span><span class=n>enable</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># 读取日志</span>
</span></span><span class=line><span class=cl><span class=nv>$Events</span> <span class=p>=</span> <span class=nb>Get-WinEvent</span> <span class=n>-LogName</span> <span class=s1>&#39;Security&#39;</span>
</span></span><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=nv>$event</span> <span class=k>in</span> <span class=nv>$Events</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>ForEach</span> <span class=p>(</span><span class=nv>$line</span> <span class=k>in</span> <span class=vm>$</span><span class=p>(</span><span class=nv>$event</span><span class=p>.</span><span class=py>Message</span> <span class=n>-split</span> <span class=s2>&#34;</span><span class=se>`r`n</span><span class=s2>&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>Write-host</span> <span class=nv>$event</span><span class=p>.</span><span class=py>RecordId</span> <span class=s1>&#39;:&#39;</span> <span class=nv>$Line</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>事件说明:</p><table><thead><tr><th>Event ID</th><th>Explanation</th></tr></thead><tbody><tr><td>5031(F)</td><td>The Windows Firewall Service <strong>blocked</strong> an application from accepting incoming connections on the network.</td></tr><tr><td>5150(-)</td><td>The Windows Filtering Platform <strong>blocked</strong> a <strong>packet</strong>.</td></tr><tr><td>5151(-)</td><td>A more restrictive Windows Filtering Platform filter has <strong>blocked</strong> a <strong>packet</strong>.</td></tr><tr><td>5152(F)</td><td>The Windows Filtering Platform <strong>blocked</strong> a <strong>packet</strong>.</td></tr><tr><td>5153(S)</td><td>A more restrictive Windows Filtering Platform filter has <strong>blocked</strong> a <strong>packet</strong>.</td></tr><tr><td>5154(S)</td><td>The Windows Filtering Platform has permitted an application or service to listen on a port for incoming connections.</td></tr><tr><td>5155(F)</td><td>The Windows Filtering Platform has <strong>blocked</strong> an application or service from listening on a port for incoming connections.</td></tr><tr><td>5156(S)</td><td>The Windows Filtering Platform has permitted a connection.</td></tr><tr><td><strong>5157(F)</strong></td><td>The Windows Filtering Platform has <strong>blocked</strong> a connection.</td></tr><tr><td>5158(S)</td><td>The Windows Filtering Platform has permitted a bind to a local port.</td></tr><tr><td>5159(F)</td><td>The Windows Filtering Platform has <strong>blocked</strong> a bind to a local port.</td></tr></tbody></table><p>关注的事件详细说明:</p><ul><li><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/audit-filtering-platform-packet-drop>Audit Filtering Platform Packet Drop</a><ul><li><p>这类事件产生量非常大，建议关注<strong>5157</strong>事件, 它记录了几乎相同的信息, 但是 5157 基于链接记录而不是基于数据包.</p></li><li><p>Failure events volume typically is very high for this subcategory and typically used for troubleshooting. If you need to monitor blocked connections, it is better to use “5157(F): The Windows Filtering Platform has blocked a connection,” because it contains almost the same information and generates per-connection, not per-packet.
<img alt=建议5157 src=https://s2.loli.net/2023/05/06/gaoLAnlNu1QT3zf.png></p></li><li><p><del><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5152>5152</a></del></p></li><li><p><del><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5153>5153</a></del></p></li></ul></li><li><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/audit-filtering-platform-connection>Audit Filtering Platform Connection</a><ul><li>建议只关注失败事件, 如被阻止的连接, 按需关注允许的链接.</li><li><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5031>5031</a><ul><li>If you don’t have any firewall rules (Allow or Deny) in Windows Firewall for specific applications, you will get this event from Windows Filtering Platform layer, because by default this layer is denying any incoming connections.</li></ul></li><li><del><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5150>5150</a></del></li><li><del><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5151>5151</a></del></li><li><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5155>5155</a></li><li><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5157>5157</a></li><li><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5159>5159</a></li></ul></li></ul><h3 id=获取-provider-信息>获取 provider 信息</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># 获取security相关的provider信息</span>
</span></span><span class=line><span class=cl><span class=nb>Get-WinEvent</span> <span class=n>-ListProvider</span> <span class=s2>&#34;*Security*&#34;</span>  <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>providername</span><span class=p>,</span><span class=n>id</span>
</span></span><span class=line><span class=cl><span class=c># Microsoft-Windows-Security-Auditing                             54849625-5478-4994-a5ba-3e3b0328c30d</span>
</span></span><span class=line><span class=cl><span class=c># 获取provider提供的task信息</span>
</span></span><span class=line><span class=cl><span class=nb>Get-WinEvent</span> <span class=n>-ListProvider</span> <span class=s2>&#34;Microsoft-Windows-Security-Auditing&#34;</span>  <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>-ExpandProperty</span> <span class=n>tasks</span>
</span></span><span class=line><span class=cl><span class=c># SE_ADT_OBJECTACCESS_FIREWALLCONNECTION       12810 Filtering Platform Connection          00000000-0000-0000-0000-000000000000</span>
</span></span></code></pre></div><table><thead><tr><th>ProviderName</th><th>Id</th></tr></thead><tbody><tr><td>Security Account Manager</td><td>00000000-0000-0000-0000-000000000000</td></tr><tr><td>Security</td><td>00000000-0000-0000-0000-000000000000</td></tr><tr><td>SecurityCenter</td><td>00000000-0000-0000-0000-000000000000</td></tr><tr><td>Microsoft-Windows-Security-SPP-UX-GenuineCenter-Logging</td><td>fb829150-cd7d-44c3-af5b-711a3c31cedc</td></tr><tr><td>Microsoft-Windows-Security-Mitigations</td><td>fae10392-f0af-4ac0-b8ff-9f4d920c3cdf</td></tr><tr><td>Microsoft-Windows-VerifyHardwareSecurity</td><td>f3f53c76-b06d-4f15-b412-61164a0d2b73</td></tr><tr><td>Microsoft-Windows-SecurityMitigationsBroker</td><td>ea8cd8a5-78ff-4418-b292-aadc6a7181df</td></tr><tr><td>Microsoft-Windows-Security-Adminless</td><td>ea216962-877b-5b73-f7c5-8aef5375959e</td></tr><tr><td>Microsoft-Windows-Security-Vault</td><td>e6c92fb8-89d7-4d1f-be46-d56e59804783</td></tr><tr><td>Microsoft-Windows-Security-Netlogon</td><td>e5ba83f6-07d0-46b1-8bc7-7e669a1d31dc</td></tr><tr><td>Microsoft-Windows-Security-SPP</td><td>e23b33b0-c8c9-472c-a5f9-f2bdfea0f156</td></tr><tr><td>Microsoft-Windows-Windows Firewall With Advanced Security</td><td>d1bc9aff-2abf-4d71-9146-ecb2a986eb85</td></tr><tr><td>Microsoft-Windows-Security-SPP-UX-Notifications</td><td>c4efc9bb-2570-4821-8923-1bad317d2d4b</td></tr><tr><td>Microsoft-Windows-Security-SPP-UX-GC</td><td>bbbdd6a3-f35e-449b-a471-4d830c8eda1f</td></tr><tr><td>Microsoft-Windows-Security-Kerberos</td><td>98e6cfcb-ee0a-41e0-a57b-622d4e1b30b1</td></tr><tr><td>Microsoft-Windows-Security-ExchangeActiveSyncProvisioning</td><td>9249d0d0-f034-402f-a29b-92fa8853d9f3</td></tr><tr><td>Microsoft-Windows-NetworkSecurity</td><td>7b702970-90bc-4584-8b20-c0799086ee5a</td></tr><tr><td>Microsoft-Windows-Security-SPP-UX</td><td>6bdadc96-673e-468c-9f5b-f382f95b2832</td></tr><tr><td>Microsoft-Windows-Security-Auditing</td><td>54849625-5478-4994-a5ba-3e3b0328c30d</td></tr><tr><td>Microsoft-Windows-Security-LessPrivilegedAppContainer</td><td>45eec9e5-4a1b-5446-7ad8-a4ab1313c437</td></tr><tr><td>Microsoft-Windows-Security-UserConsentVerifier</td><td>40783728-8921-45d0-b231-919037b4b4fd</td></tr><tr><td>Microsoft-Windows-Security-IdentityListener</td><td>3c6c422b-019b-4f48-b67b-f79a3fa8b4ed</td></tr><tr><td>Microsoft-Windows-Security-EnterpriseData-FileRevocationManager</td><td>2cd58181-0bb6-463e-828a-056ff837f966</td></tr><tr><td>Microsoft-Windows-Security-Audit-Configuration-Client</td><td>08466062-aed4-4834-8b04-cddb414504e5</td></tr><tr><td>Microsoft-Windows-Security-IdentityStore</td><td>00b7e1df-b469-4c69-9c41-53a6576e3dad</td></tr></tbody></table><h3 id=构造-block-事件>构造 block 事件</h3><p><strong>必须非常注意，在构造 block 事件时， 会影响本地其它软件的运行！</strong>
可及时使用<code>.\WFPSampler.exe -clean</code>来清理过滤器.</p><p>操作步骤:</p><ol><li><p>打开 Filtering Platform Connection 的审计开关, <code>auditpol /set /subcategory:"{0CCE9226-69AE-11D9-BED3-505054503030}" /success:enable /failure:enable</code></p></li><li><p>打开 Event Viewer, 构造一个 Custom View, 创建过滤器, 我们暂只关注 5155, 5157, 5159 三个事件.
<img alt="filter example" src=https://s2.loli.net/2023/05/06/TjfMkws8pu4NZRW.png></p></li><li><p>构造一个过滤器, 我们使用<strong>WFPSampler.exe</strong>来构造过滤器, 阻止监听本地的<strong>80</strong>端口, <code>.\WFPSampler.exe -s BASIC_ACTION_BLOCK -l FWPM_LAYER_ALE_AUTH_LISTEN_V4 -iplp 80</code></p></li><li><p>使用一个第三方(非 IIS)的 http server, 这里使用的 nginx, 默认监听 80 端口, 双击启动启动则触发 5155 事件
<img alt=触发审计事件示例 src=https://s2.loli.net/2023/05/06/V6vlyFZ4bQa5G9Y.png></p></li><li><p>还原过滤器, <code>.\WFPSampler.exe -clean</code></p></li><li><p>还原审计开关, <code>auditpol /set /category:"{0CCE9226-69AE-11D9-BED3-505054503030}" /success:disable /failure:disable</code></p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># 5155 blocked an application or service from listening on a port for incoming connections</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>WFPSampler</span><span class=p>.</span><span class=py>exe</span> <span class=n>-s</span> <span class=n>BASIC_ACTION_BLOCK</span> <span class=n>-l</span> <span class=n>FWPM_LAYER_ALE_AUTH_LISTEN_V4</span>
</span></span><span class=line><span class=cl><span class=c># 5157 blocked a connection</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>WFPSampler</span><span class=p>.</span><span class=py>exe</span> <span class=n>-s</span> <span class=n>BASIC_ACTION_BLOCK</span> <span class=n>-l</span> <span class=n>FWPM_LAYER_ALE_AUTH_RECV_ACCEPT_V4</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>WFPSampler</span><span class=p>.</span><span class=py>exe</span> <span class=n>-s</span> <span class=n>BASIC_ACTION_BLOCK</span> <span class=n>-l</span> <span class=n>FWPM_LAYER_ALE_AUTH_CONNECT_V4</span>
</span></span><span class=line><span class=cl><span class=c># 5159, blocked a bind to a local port</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>WFPSampler</span><span class=p>.</span><span class=py>exe</span> <span class=n>-s</span> <span class=n>BASIC_ACTION_BLOCK</span> <span class=n>-l</span> <span class=n>FWPM_LAYER_ALE_RESOURCE_ASSIGNMENT_V4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Other</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>WFPSampler</span><span class=p>.</span><span class=py>exe</span> <span class=n>-s</span> <span class=n>BASIC_ACTION_BLOCK</span> <span class=n>-l</span> <span class=n>FWPM_LAYER_ALE_RESOURCE_ASSIGNMENT_V4_DISCARD</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>WFPSampler</span><span class=p>.</span><span class=py>exe</span> <span class=n>-s</span> <span class=n>BASIC_ACTION_BLOCK</span> <span class=n>-l</span> <span class=n>FWPM_LAYER_ALE_AUTH_RECV_ACCEPT_V4_DISCARD</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>WFPSampler</span><span class=p>.</span><span class=py>exe</span> <span class=n>-s</span> <span class=n>BASIC_ACTION_BLOCK</span> <span class=n>-l</span> <span class=n>FWPM_LAYER_ALE_AUTH_CONNECT_V4_DISCARD</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># To find a specific Windows Filtering Platform filter by ID, run the following command:</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>wfp</span> <span class=n>show</span> <span class=kd>filter</span><span class=nb>s</span>
</span></span><span class=line><span class=cl><span class=c># To find a specific Windows Filtering Platform layer ID, you need to execute the following command:</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>wfp</span> <span class=n>show</span> <span class=n>state</span>
</span></span></code></pre></div><h2 id=监控网络事件net_event>监控网络事件(NET_EVENT)</h2><ul><li>网络事件支持枚举查找, 支持订阅.</li><li>枚举方式支持定制过滤条件, 获取一段时间内的网络事件.</li><li>订阅方式可以注入一个 callback 函数, 实时反馈.</li></ul><p>支持的事件种类:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>typedef</span> <span class=k>enum</span> <span class=n>FWPM_NET_EVENT_TYPE_</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_IKEEXT_MM_FAILURE</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_IKEEXT_QM_FAILURE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_IKEEXT_EM_FAILURE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_CLASSIFY_DROP</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_IPSEC_KERNEL_DROP</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_IPSEC_DOSP_DROP</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_CLASSIFY_ALLOW</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_CAPABILITY_DROP</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_CAPABILITY_ALLOW</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_CLASSIFY_DROP_MAC</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_LPM_PACKET_ARRIVAL</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_MAX</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=n>FWPM_NET_EVENT_TYPE</span><span class=p>;</span>
</span></span></code></pre></div><p>支持的过滤条件(FWPM_NET_EVENT_ENUM_TEMPLATE):</p><table><thead><tr><th>Value</th><th>Meaning</th></tr></thead><tbody><tr><td>FWPM_CONDITION_IP_PROTOCOL</td><td>The IP protocol number, as specified in RFC 1700.</td></tr><tr><td>FWPM_CONDITION_IP_LOCAL_ADDRESS</td><td>The local IP address.</td></tr><tr><td>FWPM_CONDITION_IP_REMOTE_ADDRESS</td><td>The remote IP address.</td></tr><tr><td>FWPM_CONDITION_IP_LOCAL_PORT</td><td>The local transport protocol port number. For ICMP, the message type.</td></tr><tr><td>FWPM_CONDITION_IP_REMOTE_PORT</td><td>The remote transport protocol port number. For ICMP, the message code.</td></tr><tr><td>FWPM_CONDITION_SCOPE_ID</td><td>The interface IPv6 scope identifier. Reserved for internal use.</td></tr><tr><td>FWPM_CONDITION_ALE_APP_ID</td><td>The full path of the application.</td></tr><tr><td>FWPM_CONDITION_ALE_USER_ID</td><td>The identification of the local user.</td></tr></tbody></table><p>非 driver 调用的方式只能获得普通的 drop 事件.</p><h2 id=监控网络链接netconnection>监控网络链接(NetConnection)</h2><p>相较监控网络事件, 监控链接需要更高权限.
<a href=https://docs.microsoft.com/en-us/windows/win32/api/fwpmu/nf-fwpmu-fwpmconnectionsubscribe0>callback 方式</a></p><blockquote><p>The caller needs FWPM_ACTRL_ENUM access to the connection objects&rsquo; containers and FWPM_ACTRL_READ access to the connection objects. See Access Control for more information.</p></blockquote><p><strong>暂未能成功监控网络链接.</strong></p><p>查到同样问题, <a href=https://stackoverflow.com/questions/63038046/receiving-in-out-traffic-stats-using-wfp-user-mode-api>Receiving in/out traffic stats using WFP user-mode API</a>, 和我调研中遇到的现象一样, 订阅函数收不到任何上报, 得不到任何事件, 没有报错. 开审计, 提权都没有成功. 有人提示非内核模式只能得到 drop 事件的上报, 这不能满足获取阻断事件的需求.</p><p>添加 security descriptor 示例: <a href=https://docs.microsoft.com/en-us/windows/win32/fwp/reserving-ports>https://docs.microsoft.com/en-us/windows/win32/fwp/reserving-ports</a></p><h2 id=application-layer-enforcementale介绍>Application Layer Enforcement(ALE)介绍</h2><ul><li>ALE 包含一系列在内核模式下的过滤器, 支持状态过滤.</li><li>ALE 层的过滤器可授权链接的创建, 端口分配, 套接字管理, 原始套接字创建, 和混杂模式接收.</li><li>ALE 层过滤器的分类基于链接(connection), 或基于套接字(socket), 其它层的过滤器只能基于数据包(packet)进行分类.</li><li>ALE 过滤器参考 <a href=https://docs.microsoft.com/en-us/windows/win32/fwp/ale-layers>ale-layers</a><ul><li>更多过滤器参考 <a href=https://docs.microsoft.com/en-us/windows/win32/fwp/management-filtering-layer-identifiers->filtering-layer-identifiers</a></li></ul></li></ul><h2 id=编码>编码</h2><p>大多数 WFP 函数都可以从用户模式或内核模式调用。 但是，用户模式函数返回表示 Win32 错误代码的 DWORD 值，而内核模式函数返回表示 NT 状态代码的 NTSTATUS 值。 因此，函数名称和语义在用户模式和内核模式之间是相同的，但函数签名则不同。 这需要函数原型的单独用户模式和内核模式特定标头。 用户模式头文件名以"u"结尾，内核模式头文件名以"k"结尾。</p><h2 id=结论>结论</h2><p>需求仅需要知道事件发生, 不需要即时处理事件, 另外开发驱动会带来更大的风险, 因此决定使用事件审计, 监控日志生成事件的方式来获得阻断事件.<br>新开一个线程来使用<a href=https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-notifychangeeventlog>NotifyChangeEventLog</a>来监控日志记录事件.</p><h2 id=附录>附录</h2><h3 id=wfp-体系结构>WFP 体系结构</h3><p>WFP(Windows Filter Platform) <img alt="Windows 筛选平台的基本体系结构" src=https://docs.microsoft.com/en-us/windows/win32/fwp/images/wfp-architecture.png></p><h3 id=数据流>数据流</h3><p>Data flow:</p><ol><li>A packet comes into the network stack.</li><li>The network stack finds and calls a shim.</li><li>The shim invokes the classification process at a particular layer.</li><li>During classification, filters are matched and the resultant action is taken. (See Filter Arbitration.)</li><li>If any callout filters are matched during the classification process, the corresponding callouts are invoked.</li><li>The shim acts on the final filtering decision (for example, drop the packet).</li></ol><h3 id=参考链接>参考链接</h3><ul><li><a href=https://docs.microsoft.com/en-us/windows/win32/fwp/management-filtering-layer-identifiers->过滤器种类</a></li><li><a href=https://docs.microsoft.com/en-us/windows/win32/fwp/filtering-conditions-available-at-each-filtering-layer>过滤器的附加条件</a></li><li><a href=https://docs.microsoft.com/en-us/windows/win32/debug/system-error-codes--0-499->error code</a></li><li><a href=https://docs.microsoft.com/en-us/windows/win32/fwp/wfp-error-codes>WFP error code</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-98219600397f17c3d5e4ac6fbfc5f707>Windows防火墙管理-netsh</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Windows防火墙管理-netsh</li></ul><h1 id=windows-防火墙管理-netsh>Windows 防火墙管理-netsh</h1><h2 id=管理工具>管理工具</h2><h2 id=netsh-advfirewall>netsh advfirewall</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># 导出防火墙规则</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=n>export</span> <span class=n>advfirewallpolicy</span><span class=p>.</span><span class=py>wfw</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 导入防火墙规则</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=n>import</span> <span class=n>advfirewallpolicy</span><span class=p>.</span><span class=py>wfw</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 查看防火墙状态</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=n>show</span> <span class=n>allprofiles</span> <span class=n>state</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 查看防火墙默认规则</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=n>show</span> <span class=n>allprofiles</span> <span class=n>firewallpolicy</span>
</span></span><span class=line><span class=cl><span class=c># netsh advfirewall set allprofiles firewallpolicy blockinbound,allowoutbound</span>
</span></span><span class=line><span class=cl><span class=c># netsh advfirewall set allprofiles firewallpolicy blockinbound,blockoutbound</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 查看防火墙设置</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=n>show</span> <span class=n>allprofiles</span> <span class=n>settings</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 启用防火墙</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=nb>set </span><span class=n>allprofiles</span> <span class=n>state</span> <span class=n>on</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 禁用防火墙</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=nb>set </span><span class=n>allprofiles</span> <span class=n>state</span> <span class=n>off</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 查看防火墙规则</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=n>firewall</span> <span class=n>show</span> <span class=n>rule</span> <span class=n>name</span><span class=p>=</span><span class=n>all</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 查看防火墙状态</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=n>monitor</span> <span class=n>show</span> <span class=n>firewall</span>
</span></span></code></pre></div><h2 id=netsh-firewalldeprecated>netsh firewall(deprecated)</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># 查看防火墙状态</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>firewall</span> <span class=n>show</span> <span class=n>state</span>
</span></span></code></pre></div><h2 id=netsh-mbnmobile-broadband-network>netsh mbn(Mobile Broadband network)</h2><h2 id=netsh-wfp>netsh wfp</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># 查看防火墙状态</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>wfp</span> <span class=n>show</span> <span class=n>state</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 查看防火墙规则</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>wfp</span> <span class=n>show</span> <span class=kd>filter</span><span class=nb>s</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-ea3b4f1af238c774fab2871e85bf40ef>Windows相关资源</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Windows相关资源</li></ul><h1 id=windows-资源整理>Windows 资源整理</h1><ul><li><a href=/blog/2024/06/28/windows%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90/#windows-资源整理>Windows 资源整理</a><ul><li><a href=/blog/2024/06/28/windows%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90/#工具篇>工具篇</a><ul><li><a href=/blog/2024/06/28/windows%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90/#监控分析>监控&分析</a></li><li><a href=/blog/2024/06/28/windows%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90/#antirootkit-工具>AntiRootkit 工具</a></li><li><a href=/blog/2024/06/28/windows%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90/#pe-工具>PE 工具</a></li><li><a href=/blog/2024/06/28/windows%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90/#逆向调试>逆向&调试</a></li><li><a href=/blog/2024/06/28/windows%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90/#注入工具>注入工具</a></li><li><a href=/blog/2024/06/28/windows%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90/#网络>网络</a></li><li><a href=/blog/2024/06/28/windows%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90/#压测工具>压测工具</a></li><li><a href=/blog/2024/06/28/windows%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90/#其他>其他</a></li></ul></li><li><a href=/blog/2024/06/28/windows%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90/#代码篇>代码篇</a><ul><li><a href=/blog/2024/06/28/windows%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90/#操作系统>操作系统</a></li><li><a href=/blog/2024/06/28/windows%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90/#内核封装>内核封装</a></li><li><a href=/blog/2024/06/28/windows%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90/#vt-技术>VT 技术</a></li><li><a href=/blog/2024/06/28/windows%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90/#其他-1>其他</a></li></ul></li><li><a href=/blog/2024/06/28/windows%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90/#ctf-资源>CTF 资源</a></li><li><a href=/blog/2024/06/28/windows%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90/#渗透相关>渗透相关</a></li><li><a href=/blog/2024/06/28/windows%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90/#专利免费查询>专利免费查询</a></li></ul></li></ul><p>这里只列举了一些 Windows 上调试，排查问题以及测试的一些常用工具，其他的加壳脱壳，加密解密，文件编辑器以及编程工具不进行整理了。</p><h2 id=工具篇>工具篇</h2><h3 id=监控分析>监控&分析</h3><table><thead><tr><th style=text-align:left>工具名</th><th style=text-align:left>下载地址</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><strong>DebugView</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/zh-cn/sysinternals/downloads/debugview>https://docs.microsoft.com/zh-cn/sysinternals/downloads/debugview</a></td><td style=text-align:left>sysinternals 里面的工具，可用来查看、控制内核及用户态调式输出</td></tr><tr><td style=text-align:left><strong>Process Monitor</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/zh-cn/sysinternals/downloads/procmon>https://docs.microsoft.com/zh-cn/sysinternals/downloads/procmon</a></td><td style=text-align:left>sysinternals 里面的工具，实时监视文件系统，注册表，进程，线程以及 DLL 的活动，方便排查问题</td></tr><tr><td style=text-align:left><strong>Process Explorer</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/zh-cn/sysinternals/downloads/process-explorer>https://docs.microsoft.com/zh-cn/sysinternals/downloads/process-explorer</a></td><td style=text-align:left>sysinternals 里面的工具，进程查看器，可以浏览加载的 DLL，调用堆栈以及查找文件被哪些进程打开</td></tr><tr><td style=text-align:left><strong>WinObj</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/zh-cn/sysinternals/downloads/winobj>https://docs.microsoft.com/zh-cn/sysinternals/downloads/winobj</a></td><td style=text-align:left>sysinternals 里面的工具，对象管理器命名空间的查看利器，没有加载驱动而是使用系统 API 实现,可参考 GitHub 中的 WinObjEx64</td></tr><tr><td style=text-align:left><strong>WinObjEx64</strong></td><td style=text-align:left><a href=https://github.com/hfiref0x/WinObjEx64>https://github.com/hfiref0x/WinObjEx64</a></td><td style=text-align:left>对象管理器命名空间的查看利器，开源的</td></tr><tr><td style=text-align:left><strong>Handle</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/zh-cn/sysinternals/downloads/handle>https://docs.microsoft.com/zh-cn/sysinternals/downloads/handle</a></td><td style=text-align:left>sysinternals 里面的工具，查看特定的文件或者目录被哪个应用程序占用</td></tr><tr><td style=text-align:left><strong>sysinternals</strong></td><td style=text-align:left><a href=https://live.sysinternals.com/>https://live.sysinternals.com/</a></td><td style=text-align:left>sysinternals 里面还有很多工具，一般用不着，暂时不进行罗列，上面几个是常用的工具</td></tr><tr><td style=text-align:left><strong>CPU-Z</strong></td><td style=text-align:left><a href=https://www.cpuid.com/softwares/cpu-z.html>https://www.cpuid.com/softwares/cpu-z.html</a></td><td style=text-align:left>CPU 实时监测工具</td></tr><tr><td style=text-align:left><strong>ProcMonX</strong></td><td style=text-align:left><a href=https://github.com/zodiacon/ProcMonX>https://github.com/zodiacon/ProcMonX</a></td><td style=text-align:left>使用 ETW 实现的类似于 Process Monitor 功能的工具，开源 C#语言编写</td></tr><tr><td style=text-align:left><strong>ProcMonXv2</strong></td><td style=text-align:left><a href=https://github.com/zodiacon/ProcMonXv2>https://github.com/zodiacon/ProcMonXv2</a></td><td style=text-align:left>使用 ETW 实现的类似于 Process Monitor 功能的工具，开源 C#语言编写,第二版</td></tr><tr><td style=text-align:left><strong>processhacker</strong></td><td style=text-align:left><a href=https://github.com/processhacker/processhacker>https://github.com/processhacker/processhacker</a></td><td style=text-align:left>开源的类似于 Process Explorer 的工具，支持 GPU 相关的信息显示</td></tr><tr><td style=text-align:left><strong>API Monitor</strong></td><td style=text-align:left><a href=http://www.rohitab.com/apimonitor>http://www.rohitab.com/apimonitor</a></td><td style=text-align:left>通过跟踪 API 的调用，用来查看应用程序和服务的工作方式或跟踪应用程序中存在的问题，可修改 API 的入参及出参</td></tr><tr><td style=text-align:left><strong>Dependency Walker</strong></td><td style=text-align:left><a href=http://www.dependencywalker.com/>http://www.dependencywalker.com/</a></td><td style=text-align:left>扫描任何 32 位或 64 位 Windows 模块,列出了该模块导出的所有功能等</td></tr><tr><td style=text-align:left><strong>DeviceTree</strong></td><td style=text-align:left><a href="http://www.osronline.com/article.cfm%5earticle=97.htm">http://www.osronline.com/article.cfm%5earticle=97.htm</a></td><td style=text-align:left>显示系统的所有驱动对象以及相关设备栈信息</td></tr><tr><td style=text-align:left><strong>Unlocker</strong></td><td style=text-align:left><a href=https://www.softpedia.com/get/System/System-Miscellaneous/Unlocker.shtml>https://www.softpedia.com/get/System/System-Miscellaneous/Unlocker.shtml</a></td><td style=text-align:left>解锁占用文件的，很多类似的工具以及开源代码</td></tr><tr><td style=text-align:left><strong>RpcView</strong></td><td style=text-align:left><a href=https://github.com/silverf0x/RpcView>https://github.com/silverf0x/RpcView</a></td><td style=text-align:left>显示以及反编译当前系统的 RPC 接口等信息，分析 RPC 的情况下可以借以辅助</td></tr><tr><td style=text-align:left><strong>RequestTrace</strong></td><td style=text-align:left><a href=https://the-sz.com/products/rt/>https://the-sz.com/products/rt/</a></td><td style=text-align:left>可以查看 WINDOWS 上 IRP、SRB、URB 的详细信息，包含数据缓存等，一般也不会使用，因为 WINDBG 调试就可以分析数据，不调试的情况可以使用它来辅助</td></tr><tr><td style=text-align:left><strong>IRPMon</strong></td><td style=text-align:left><a href=https://github.com/MartinDrab/IRPMon>https://github.com/MartinDrab/IRPMon</a></td><td style=text-align:left>通过挂钩驱动对象，实现类似于 RequestTrace、IrpTracker 的功能，监控驱动对象的所有 IRP 等形式的请求</td></tr><tr><td style=text-align:left><strong>IRPTrace</strong></td><td style=text-align:left><a href=https://github.com/haidragon/drivertools>https://github.com/haidragon/drivertools</a></td><td style=text-align:left>里面有一些其他工具</td></tr></tbody></table><h3 id=antirootkit-工具>AntiRootkit 工具</h3><table><thead><tr><th style=text-align:left>工具名</th><th style=text-align:left>下载地址</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><strong>PcHunter</strong></td><td style=text-align:left><a href=https://www.anxinsec.com/view/antirootkit/>https://www.anxinsec.com/view/antirootkit/</a></td><td style=text-align:left>安全分析工具，为了对抗 Rootkit，使用穿透技术进行文件，网络，注册表等的操作，并提供线程、进程以及内核模块的各种详细信息</td></tr><tr><td style=text-align:left><strong>Windows-Kernel-Explorer</strong></td><td style=text-align:left><a href=https://github.com/AxtMueller/Windows-Kernel-Explorer>https://github.com/AxtMueller/Windows-Kernel-Explorer</a></td><td style=text-align:left>类似于 Pchunter，不开源，如果 PcHunter 没有支持最新系统，可以尝试这个软件</td></tr><tr><td style=text-align:left><strong>PowerTool</strong></td><td style=text-align:left></td><td style=text-align:left>目前没咋更新，朋友公司的同事开发的，据说代码很乱。。。</td></tr><tr><td style=text-align:left><strong>py</strong></td><td style=text-align:left><a href=https://github.com/antiwar3/py>https://github.com/antiwar3/py</a></td><td style=text-align:left>飘云 ark</td></tr></tbody></table><h3 id=pe-工具>PE 工具</h3><table><thead><tr><th style=text-align:left>工具名</th><th style=text-align:left>下载地址</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><strong>CFF Explorer</strong></td><td style=text-align:left><a href="https://ntcore.com/?page_id=388">https://ntcore.com/?page_id=388</a></td><td style=text-align:left>还不错的</td></tr><tr><td style=text-align:left><strong>ExeinfoPe</strong></td><td style=text-align:left><a href=http://www.exeinfo.xn.pl/>http://www.exeinfo.xn.pl/</a></td><td style=text-align:left></td></tr></tbody></table><h3 id=逆向调试>逆向&调试</h3><table><thead><tr><th style=text-align:left>工具名</th><th style=text-align:left>下载地址</th><th style=text-align:left>说明</th><th></th></tr></thead><tbody><tr><td style=text-align:left><strong>Ghidra</strong></td><td style=text-align:left><a href=https://www.nsa.gov/resources/everyone/ghidra/>https://www.nsa.gov/resources/everyone/ghidra/</a></td><td style=text-align:left>由美国国家安全局（NSA）研究部门开发的软件逆向工程（SRE）套件，用于支持网络安全任务</td><td></td></tr><tr><td style=text-align:left><strong>IDA</strong></td><td style=text-align:left><a href=https://down.52pojie.cn/>https://down.52pojie.cn/</a></td><td style=text-align:left>最新的破解版吧好像是 7.5，可在吾爱破解论坛查找下载地址</td><td></td></tr><tr><td style=text-align:left><strong>dnSpy</strong></td><td style=text-align:left><a href=https://github.com/dnSpy/dnSpy>https://github.com/dnSpy/dnSpy</a></td><td style=text-align:left>.NET 程序的逆向工具，对于不混淆不加密的.NET 程序相当于看源代码了，前提是了解.NET 框架</td><td></td></tr><tr><td style=text-align:left><strong>OllyDbg</strong></td><td style=text-align:left><a href=https://down.52pojie.cn/Tools/Debuggers//>https://down.52pojie.cn/Tools/Debuggers//</a></td><td style=text-align:left>用于逆向分析应用程序，插件丰富，但是不开源也不支持 x64 程序</td><td></td></tr><tr><td style=text-align:left><strong>x64DBG</strong></td><td style=text-align:left><a href=https://x64dbg.com/>https://x64dbg.com/</a></td><td style=text-align:left>用于逆向分析应用程序，开源，支持 x64 程序，相对于 windbg 来说操作更方便点，和 OD 比较建议选择 x64dbg</td><td></td></tr><tr><td style=text-align:left><strong>CheatEngine</strong></td><td style=text-align:left><a href=https://www.cheatengine.org/>https://www.cheatengine.org/</a></td><td style=text-align:left>逆向破解的神器，支持各种内存搜索、修改以及一些其他的高级逆向功能</td><td></td></tr><tr><td style=text-align:left><strong>VirtualKD-Redux</strong></td><td style=text-align:left><a href=https://github.com/4d61726b/VirtualKD-Redux/releases>https://github.com/4d61726b/VirtualKD-Redux/releases</a></td><td style=text-align:left>Windbg 虚拟机调试的全自动化辅助工具，不再需要设置一堆环境变量，支持最新 VMWare</td><td></td></tr><tr><td style=text-align:left><strong>Driver Loader</strong></td><td style=text-align:left><a href="http://www.osronline.com/article.cfm%5Earticle=157.htm">http://www.osronline.com/article.cfm%5Earticle=157.htm</a></td><td style=text-align:left>OSR 提供的工具，进行驱动的安装，加载以及卸载</td><td> </td></tr><tr><td style=text-align:left>reverse-engineering</td><td style=text-align:left><a href=https://github.com/wtsxDev/reverse-engineering>https://github.com/wtsxDev/reverse-engineering</a></td><td style=text-align:left>基本上逆向需要得工具都可以在这里找到</td><td></td></tr></tbody></table><h3 id=注入工具>注入工具</h3><table><thead><tr><th style=text-align:left>工具名</th><th style=text-align:left>下载地址</th><th style=text-align:left>说明</th><th></th></tr></thead><tbody><tr><td style=text-align:left><strong>yapi</strong></td><td style=text-align:left><a href=https://github.com/ez8-co/yapi>https://github.com/ez8-co/yapi</a></td><td style=text-align:left>一个程序注入 x64/x86 进程</td><td>开源，使用少，可重点查看源码，支持 32 位程序向 64 位程序注入</td></tr><tr><td style=text-align:left><strong>Xenos</strong></td><td style=text-align:left><a href=https://github.com/DarthTon/Xenos>https://github.com/DarthTon/Xenos</a></td><td style=text-align:left>开源，而且使用了鼎鼎大名的黑古工程，支持内核注入</td><td></td></tr><tr><td style=text-align:left><strong>ExtremeInjector</strong></td><td style=text-align:left><a href=https://github.com/master131/ExtremeInjector>https://github.com/master131/ExtremeInjector</a></td><td style=text-align:left>应用层注入工具，支持 32 位程序向 64 位程序注入</td><td></td></tr></tbody></table><h3 id=网络>网络</h3><table><thead><tr><th style=text-align:left>工具名</th><th style=text-align:left>下载地址</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><strong>Fiddler</strong></td><td style=text-align:left><a href=https://www.telerik.com/fiddler>https://www.telerik.com/fiddler</a></td><td style=text-align:left>可直接中间人劫持，不需要手动添加证书等，支持脚本进行流量劫持,同事也提供了 SDK 进行编码</td></tr><tr><td style=text-align:left><strong>Wireshark</strong></td><td style=text-align:left><a href=https://www.wireshark.org/download.html>https://www.wireshark.org/download.html</a></td><td style=text-align:left>这个就不多介绍了</td></tr><tr><td style=text-align:left><strong>Burp Suite</strong></td><td style=text-align:left><a href=https://portswigger.net/burp>https://portswigger.net/burp</a></td><td style=text-align:left>渗透的好像都偏爱这个抓包工具，依赖 JDK，可在吾爱下载破解版</td></tr></tbody></table><h3 id=压测工具>压测工具</h3><table><thead><tr><th style=text-align:left>工具名</th><th style=text-align:left>下载地址</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><strong>Driver Verifier</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/driver-verifier>https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/driver-verifier</a></td><td style=text-align:left>系统自带，驱动稳定性测试工具</td></tr><tr><td style=text-align:left><strong>Application Verifier</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/application-verifier>https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/application-verifier</a></td><td style=text-align:left>系统自带，应用层的压测工具</td></tr><tr><td style=text-align:left><strong>CPUStress</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/en-us/sysinternals/downloads/cpustres>https://docs.microsoft.com/en-us/sysinternals/downloads/cpustres</a></td><td style=text-align:left>让 CPU 负荷工作，测试极端情况下软件的稳定性以及响应度等</td></tr></tbody></table><h3 id=其他>其他</h3><table><thead><tr><th style=text-align:left>工具名</th><th style=text-align:left>下载地址</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><strong>game-hacking</strong></td><td style=text-align:left><a href=https://github.com/dsasmblr/game-hacking>https://github.com/dsasmblr/game-hacking</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>awesome-malware-analysis</strong></td><td style=text-align:left><a href=https://github.com/rootkiter/awesome-malware-analysis>https://github.com/rootkiter/awesome-malware-analysis</a></td><td style=text-align:left>病毒分析工具集合</td></tr><tr><td style=text-align:left><strong>drawio</strong></td><td style=text-align:left><a href=https://github.com/jgraph/drawio-desktop>https://github.com/jgraph/drawio-desktop</a></td><td style=text-align:left>绘图神器</td></tr><tr><td style=text-align:left>RazorSQL</td><td style=text-align:left><a href=https://www.razorsql.com/>https://www.razorsql.com/</a></td><td style=text-align:left>SQLite3 数据库 GUI 工具</td></tr><tr><td style=text-align:left>Git 学习笔记</td><td style=text-align:left><a href=https://github.com/No-Github/1earn/blob/master/1earn/Develop/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/Git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.md>https://github.com/No-Github/1earn/blob/master/1earn/Develop/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/Git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.md</a></td><td style=text-align:left>Git 版本管理知识</td></tr><tr><td style=text-align:left>Markdown 语法学习</td><td style=text-align:left><a href=https://github.com/No-Github/1earn/blob/master/1earn/Develop/%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80/Markdown/Markdown%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0.md>https://github.com/No-Github/1earn/blob/master/1earn/Develop/%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80/Markdown/Markdown%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0.md</a></td><td style=text-align:left>Markdown 语法学习</td></tr></tbody></table><h2 id=代码篇>代码篇</h2><h3 id=操作系统>操作系统</h3><table><thead><tr><th style=text-align:left>工具名</th><th style=text-align:left>下载地址</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><strong>ReactOS</strong></td><td style=text-align:left><a href=https://github.com/reactos/reactos>https://github.com/reactos/reactos</a></td><td style=text-align:left>好像是逆向 windows 2000 的开源系统，可以替换 win 2000 的内核程序</td></tr><tr><td style=text-align:left><strong>wrk-v1.2</strong></td><td style=text-align:left><a href=https://github.com/jmcjmmcjc/wrk-v1.2>https://github.com/jmcjmmcjc/wrk-v1.2</a></td><td style=text-align:left>Windows NT 5.2 Partial Source Code</td></tr><tr><td style=text-align:left><strong>WinNT4</strong></td><td style=text-align:left><a href=https://github.com/ZoloZiak/WinNT4>https://github.com/ZoloZiak/WinNT4</a></td><td style=text-align:left>Windows NT4 Kernel Source code</td></tr><tr><td style=text-align:left>whids</td><td style=text-align:left><a href=https://github.com/0xrawsec/whids/tree/a826d87e0d035daac10bfa96b530c5deff6b9915>https://github.com/0xrawsec/whids/tree/a826d87e0d035daac10bfa96b530c5deff6b9915</a></td><td style=text-align:left>Open Source EDR for Windows</td></tr></tbody></table><h3 id=内核封装>内核封装</h3><table><thead><tr><th style=text-align:left>工具名</th><th style=text-align:left>下载地址</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><strong>CPPHelper</strong></td><td style=text-align:left><a href=https://github.com/Chuyu-Team/CPPHelper>https://github.com/Chuyu-Team/CPPHelper</a></td><td style=text-align:left>C++基础辅助类库</td></tr><tr><td style=text-align:left><strong>cpp_component</strong></td><td style=text-align:left><a href=https://github.com/skyformat99/cpp_component>https://github.com/skyformat99/cpp_component</a></td><td style=text-align:left>对 cpp 一些常用的功能进行封装</td></tr><tr><td style=text-align:left><strong>WinToolsLib</strong></td><td style=text-align:left><a href=https://github.com/deeonis-ru/WinToolsLib>https://github.com/deeonis-ru/WinToolsLib</a></td><td style=text-align:left>Suite of classes for Windows programming</td></tr><tr><td style=text-align:left><strong>KDU</strong></td><td style=text-align:left><a href=https://github.com/hfiref0x/KDU>https://github.com/hfiref0x/KDU</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>KTL</strong></td><td style=text-align:left><a href=https://github.com/MeeSong/KTL>https://github.com/MeeSong/KTL</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>Kernel-Bridge</strong></td><td style=text-align:left><a href=https://github.com/HoShiMin/Kernel-Bridge>https://github.com/HoShiMin/Kernel-Bridge</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>KernelForge</strong></td><td style=text-align:left><a href=https://github.com/killvxk/KernelForge>https://github.com/killvxk/KernelForge</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>ExecutiveCallbackObjects</strong></td><td style=text-align:left><a href=https://github.com/0xcpu/ExecutiveCallbackObjects>https://github.com/0xcpu/ExecutiveCallbackObjects</a></td><td style=text-align:left>内核下的各种回调研究</td></tr><tr><td style=text-align:left><strong>SyscallHook</strong></td><td style=text-align:left><a href=https://github.com/AnzeLesnik/SyscallHook>https://github.com/AnzeLesnik/SyscallHook</a></td><td style=text-align:left>System call hook for Windows 10 20H1</td></tr><tr><td style=text-align:left><strong>Antivirus_R3_bypass_demo</strong></td><td style=text-align:left><a href=https://github.com/huoji120/Antivirus_R3_bypass_demo>https://github.com/huoji120/Antivirus_R3_bypass_demo</a></td><td style=text-align:left>分别用 R3 的 0day 与 R0 的 0day 来干掉杀毒软件</td></tr><tr><td style=text-align:left><strong>KernelHiddenExecute</strong></td><td style=text-align:left><a href=https://github.com/zouxianyu/KernelHiddenExecute>https://github.com/zouxianyu/KernelHiddenExecute</a></td><td style=text-align:left>在内核地址空间中隐藏代码/数据</td></tr><tr><td style=text-align:left><strong>DriverInjectDll</strong></td><td style=text-align:left><a href=https://github.com/strivexjun/DriverInjectDll>https://github.com/strivexjun/DriverInjectDll</a></td><td style=text-align:left>内核模式下全局注入，内存注入，支持 WIN7-WIN10</td></tr><tr><td style=text-align:left><strong>zwhawk</strong></td><td style=text-align:left><a href=https://github.com/eLoopWoo/zwhawk>https://github.com/eLoopWoo/zwhawk</a></td><td style=text-align:left>Windows 远程命令和控制界面的内核 rootkit</td></tr><tr><td style=text-align:left><strong>ZeroBank-ring0-bundle</strong></td><td style=text-align:left><a href=https://github.com/Trietptm-on-Coding-Algorithms/ZeroBank-ring0-bundle>https://github.com/Trietptm-on-Coding-Algorithms/ZeroBank-ring0-bundle</a></td><td style=text-align:left>连接到远程服务器以发送和接收命令的内核模式 rootkit</td></tr><tr><td style=text-align:left><strong>kdmapper</strong></td><td style=text-align:left><a href=https://github.com/z175/kdmapper>https://github.com/z175/kdmapper</a></td><td style=text-align:left>About driver manual mapper (outdated/for educational purposes)</td></tr><tr><td style=text-align:left><strong>antispy</strong></td><td style=text-align:left><a href=https://github.com/mohuihui/antispy>https://github.com/mohuihui/antispy</a></td><td style=text-align:left>a free but powerful anti virus and rootkits toolkit</td></tr><tr><td style=text-align:left><strong>windows_kernel_resources</strong></td><td style=text-align:left><a href=https://github.com/sam-b/windows_kernel_resources>https://github.com/sam-b/windows_kernel_resources</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>HookLib</strong></td><td style=text-align:left><a href=https://github.com/HoShiMin/HookLib>https://github.com/HoShiMin/HookLib</a></td><td style=text-align:left>UserMode and KernelMode support</td></tr><tr><td style=text-align:left><strong>Kernel-Whisperer</strong></td><td style=text-align:left><a href=https://github.com/BrunoMCBraga/Kernel-Whisperer>https://github.com/BrunoMCBraga/Kernel-Whisperer</a></td><td style=text-align:left>内核模块封装</td></tr><tr><td style=text-align:left>SQLiteCpp</td><td style=text-align:left><a href=https://github.com/SRombauts/SQLiteCpp>https://github.com/SRombauts/SQLiteCpp</a></td><td style=text-align:left>a smart and easy to use C++ SQLite3 wrapper</td></tr><tr><td style=text-align:left>awesome-windows-kernel-security-development</td><td style=text-align:left><a href=https://github.com/ExpLife0011/awesome-windows-kernel-security-development>https://github.com/ExpLife0011/awesome-windows-kernel-security-development</a></td><td style=text-align:left>各种内核技术得代码合集</td></tr></tbody></table><h3 id=vt-技术>VT 技术</h3><table><thead><tr><th style=text-align:left>工具名</th><th style=text-align:left>下载地址</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><strong>hvpp</strong></td><td style=text-align:left><a href=https://github.com/wbenny/hvpp>https://github.com/wbenny/hvpp</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>HyperBone</strong></td><td style=text-align:left><a href=https://github.com/DarthTon/HyperBone>https://github.com/DarthTon/HyperBone</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>HyperWin</strong></td><td style=text-align:left><a href=https://github.com/amiryeshurun/HyperWin>https://github.com/amiryeshurun/HyperWin</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>Hypervisor</strong></td><td style=text-align:left><a href=https://github.com/Bareflank/hypervisor>https://github.com/Bareflank/hypervisor</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>HyperPlatform</strong></td><td style=text-align:left><a href=https://github.com/tandasat/HyperPlatform>https://github.com/tandasat/HyperPlatform</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>Hyper-V-Internals</strong></td><td style=text-align:left><a href=https://github.com/gerhart01/Hyper-V-Internals>https://github.com/gerhart01/Hyper-V-Internals</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>Hypervisor-From-Scratch</strong></td><td style=text-align:left><a href=https://github.com/SinaKarvandi/Hypervisor-From-Scratch>https://github.com/SinaKarvandi/Hypervisor-From-Scratch</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>KasperskyHook</strong></td><td style=text-align:left><a href=https://github.com/iPower/KasperskyHook>https://github.com/iPower/KasperskyHook</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>awesome-virtualization</strong></td><td style=text-align:left><a href=https://github.com/Wenzel/awesome-virtualization>https://github.com/Wenzel/awesome-virtualization</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>ransomware_begone</strong></td><td style=text-align:left><a href=https://github.com/ofercas/ransomware_begone>https://github.com/ofercas/ransomware_begone</a></td><td style=text-align:left></td></tr></tbody></table><h3 id=其他-1>其他</h3><table><thead><tr><th style=text-align:left>工具名</th><th style=text-align:left>下载地址</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><strong>Divert</strong></td><td style=text-align:left><a href=https://github.com/basil00/Divert>https://github.com/basil00/Divert</a></td><td style=text-align:left>将数据流量转发给应用程序，可以修改，丢弃等操作网络流量</td></tr><tr><td style=text-align:left><strong>Blackbone</strong></td><td style=text-align:left><a href=https://github.com/DarthTon/Blackbone>https://github.com/DarthTon/Blackbone</a></td><td style=text-align:left>内核模式下的几种注入方式，包括了内核模式下的内存注入</td></tr><tr><td style=text-align:left><strong>NetWatch</strong></td><td style=text-align:left><a href=https://github.com/huoji120/NetWatch>https://github.com/huoji120/NetWatch</a></td><td style=text-align:left>威胁流量检测系统，可以做虚拟内存补丁</td></tr><tr><td style=text-align:left><strong>x64_AOB_Search</strong></td><td style=text-align:left><a href=https://github.com/wanttobeno/x64_AOB_Search>https://github.com/wanttobeno/x64_AOB_Search</a></td><td style=text-align:left>快速内存搜索算法，商用级别,支持通配符</td></tr><tr><td style=text-align:left><strong>DuckMemoryScan</strong></td><td style=text-align:left><a href=https://github.com/huoji120/DuckMemoryScan>https://github.com/huoji120/DuckMemoryScan</a></td><td style=text-align:left>检测绝大部分所谓的内存免杀马</td></tr><tr><td style=text-align:left><strong>FSDefender</strong></td><td style=text-align:left><a href=https://github.com/Randomize163/FSDefender>https://github.com/Randomize163/FSDefender</a></td><td style=text-align:left>文件驱动监控 + 云备份方案</td></tr><tr><td style=text-align:left><strong>AntiRansomware</strong></td><td style=text-align:left><a href=https://github.com/clavis0x/AntiRansomware>https://github.com/clavis0x/AntiRansomware</a></td><td style=text-align:left>防勒索方案，不让覆盖，写就进行扫描</td></tr><tr><td style=text-align:left><strong>Lazy</strong></td><td style=text-align:left><a href=https://github.com/moonAgirl/Lazy>https://github.com/moonAgirl/Lazy</a></td><td style=text-align:left>(恶意)勒索软件终结者</td></tr><tr><td style=text-align:left>awesome-cheatsheets</td><td style=text-align:left><a href=https://github.com/skywind3000/awesome-cheatsheets/blob/master/tools/git.txt>https://github.com/skywind3000/awesome-cheatsheets/blob/master/tools/git.txt</a></td><td style=text-align:left>各种 python,git 速查表</td></tr></tbody></table><h2 id=ctf-资源>CTF 资源</h2><table><thead><tr><th style=text-align:left>仓库名</th><th style=text-align:left>仓库地址</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><strong>CTF-All-In-One</strong></td><td style=text-align:left><a href=https://github.com/firmianay/CTF-All-In-One>https://github.com/firmianay/CTF-All-In-One</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>ctf-book</strong></td><td style=text-align:left><a href=https://github.com/firmianay/ctf-book>https://github.com/firmianay/ctf-book</a></td><td style=text-align:left>CTF 竞赛权威指南(Pwn 篇) 相关资源</td></tr></tbody></table><h2 id=渗透相关>渗透相关</h2><table><thead><tr><th style=text-align:left>仓库名</th><th style=text-align:left>仓库地址</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><strong>Web-Security-Learning</strong></td><td style=text-align:left><a href=https://github.com/CHYbeta/Web-Security-Learning>https://github.com/CHYbeta/Web-Security-Learning</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>pentest</strong></td><td style=text-align:left><a href=https://github.com/r0eXpeR/pentest>https://github.com/r0eXpeR/pentest</a></td><td style=text-align:left>内网渗透中的一些工具及项目资料</td></tr><tr><td style=text-align:left><strong>K8tools</strong></td><td style=text-align:left><a href=http://k8gege.org/p/72f1fea6.html>http://k8gege.org/p/72f1fea6.html</a></td><td style=text-align:left>K8tools 工具合集</td></tr><tr><td style=text-align:left><strong>Awesome-Red-Teaming</strong></td><td style=text-align:left><a href=https://github.com/yeyintminthuhtut/Awesome-Red-Teaming>https://github.com/yeyintminthuhtut/Awesome-Red-Teaming</a></td><td style=text-align:left>List of Awesome Red Teaming Resources</td></tr><tr><td style=text-align:left><strong>Awesome-Hacking</strong></td><td style=text-align:left><a href=https://github.com/Hack-with-Github/Awesome-Hacking>https://github.com/Hack-with-Github/Awesome-Hacking</a></td><td style=text-align:left>A collection of various awesome lists for hackers</td></tr><tr><td style=text-align:left>awesome-web-hacking</td><td style=text-align:left><a href=https://github.com/infoslack/awesome-web-hacking>https://github.com/infoslack/awesome-web-hacking</a></td><td style=text-align:left>渗透知识</td></tr></tbody></table><h2 id=专利免费查询>专利免费查询</h2><table><thead><tr><th style=text-align:left>仓库名</th><th style=text-align:left>仓库地址</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left><strong>专利信息服务平台</strong></td><td style=text-align:left><a href=http://search.cnipr.com/>http://search.cnipr.com/</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>patents</strong></td><td style=text-align:left>&lt;www.google.com/patents></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>incopat</strong></td><td style=text-align:left>&lt;www.incopat.com></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>佰腾</strong></td><td style=text-align:left><a href=https://www.baiten.cn/>https://www.baiten.cn/</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>rainpat</strong></td><td style=text-align:left><a href=https://www.rainpat.com/>https://www.rainpat.com/</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>度衍</strong></td><td style=text-align:left><a href=https://www.uyanip.com/>https://www.uyanip.com/</a></td><td style=text-align:left></td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-cb9613752bee2e31a2596d114cfa27f0>Windows导览</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Windows 导览</li></ul><h1 id=windows>Windows</h1><ul><li>[<a href=/blog/2024/06/28/win-to-go/ title=Win-to-go>Win-to-go</a>]</li><li>[<a href=%E7%90%86%E8%A7%A3Windows%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F title=理解Windows文件系统>理解Windows文件系统</a>]</li><li>[<a href=%E7%90%86%E8%A7%A3Windows%E8%BF%9B%E7%A8%8B title=理解Windows进程>理解Windows进程</a>]</li><li>[<a href=/blog/2024/06/28/windows%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90/ title=Windows相关资源>Windows相关资源</a>]</li><li>[<a href=Windows%E7%AE%A1%E7%90%86%E8%BF%9B%E9%98%B6 title=Windows管理进阶>Windows管理进阶</a>]</li><li>[<a href=/blog/2024/06/28/windows%E9%98%B2%E7%81%AB%E5%A2%99%E7%AE%A1%E7%90%86-netsh/ title=Windows防火墙管理-netsh>Windows防火墙管理-netsh</a>]</li><li>[<a href=/blog/2024/06/28/windows%E9%98%BB%E6%96%AD%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E8%8E%B7%E5%8F%96/ title=Windows阻断网络流量获取>Windows阻断网络流量获取</a>]</li><li>[<a href=../../../%E7%96%91%E9%9A%BE%E6%9D%82%E7%97%87/Windows%E9%BA%BB%E7%83%A6%E9%97%AE%E9%A2%98 title=Windows麻烦问题>Windows麻烦问题</a>]</li><li>[<a href=/blog/2024/06/28/%E7%90%86%E8%A7%A3windows%E4%BA%8B%E4%BB%B6%E8%B7%9F%E8%B8%AA_etw/ title=理解Windows事件跟踪_ETW>理解Windows事件跟踪_ETW</a>]</li><li>[<a href=/blog/2024/06/28/%E7%90%86%E8%A7%A3windows%E7%BD%91%E7%BB%9C_wfp/ title=理解Windows网络_WFP>理解Windows网络_WFP</a>]</li><li>[<a href=/blog/2024/06/28/windows-ipv6%E7%AE%A1%E7%90%86/ title=windows-ipv6管理>windows-ipv6管理</a>]</li><li>[<a href=/blog/2023/05/06/windows%E6%A1%A5%E6%8E%A5%E6%97%B6%E7%9A%84ipv6%E9%97%AE%E9%A2%98/ title=Windows桥接时的IPv6问题>Windows桥接时的IPv6问题</a>]</li><li>[<a href=/blog/2024/06/28/wireguard%E9%85%8D%E7%BD%AE/ title=wireguard配置>wireguard配置</a>]</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-add85b56bb4af8b5216a8122ebeea317>windows-ipv6管理</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> windows-ipv6管理</li></ul><h1 id=windows-ipv6-管理>windows-ipv6 管理</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># 查看ipv6地址, 过滤locallink地址, 过滤Loopback地址</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetIPAddress</span> <span class=n>-AddressFamily</span> <span class=n>IPv6</span> <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span><span class=nv>$_</span><span class=p>.</span><span class=py>IPAddress</span> <span class=o>-notlike</span> <span class=s2>&#34;fe80*&#34;</span> <span class=o>-and</span> <span class=nv>$_</span><span class=p>.</span><span class=py>IPAddress</span> <span class=o>-notlike</span> <span class=s2>&#34;::1&#34;</span><span class=p>}</span> <span class=p>|</span> <span class=nb>Format-Table</span> <span class=n>-AutoSize</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 查看ipv6路由</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetRoute</span> <span class=n>-AddressFamily</span> <span class=n>IPv6</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 查看ipv6邻居</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetNeighbor</span> <span class=n>-AddressFamily</span> <span class=n>IPv6</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 查看interface</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetAdapter</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 使能临时ipv6地址</span>
</span></span><span class=line><span class=cl><span class=nb>Set-NetIPv6Protocol</span> <span class=n>-UseTemporaryAddress</span> <span class=n>Enabled</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 获取interface 信息</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetIPInterface</span> <span class=n>-AddressFamily</span> <span class=n>IPv6</span> <span class=n>-ifAlias</span> <span class=n>Ethernet</span> <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>-Property</span> <span class=p>*</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetIPv6Protocol</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 设置interface 信息, 解决Windows IPv6地址不更新的问题</span>
</span></span><span class=line><span class=cl><span class=nb>Set-NetIPInterface</span> <span class=n>-AddressFamily</span> <span class=n>IPv6</span> <span class=n>-ifAlias</span> <span class=n>Ethernet</span> <span class=n>-Dhcp</span> <span class=n>Disabled</span>
</span></span><span class=line><span class=cl><span class=nb>Set-NetIPInterface</span> <span class=n>-AddressFamily</span> <span class=n>IPv6</span> <span class=n>-ifAlias</span> <span class=n>Ethernet</span> <span class=n>-AdvertiseDefaultRoute</span> <span class=n>Disabled</span>
</span></span><span class=line><span class=cl><span class=nb>Set-NetIPInterface</span> <span class=n>-AddressFamily</span> <span class=n>IPv6</span> <span class=n>-ifAlias</span> <span class=n>Ethernet</span> <span class=n>-IgnoreDefaultRoutes</span> <span class=n>Enabled</span>
</span></span><span class=line><span class=cl><span class=c># 手动恢复ipv6访问</span>
</span></span><span class=line><span class=cl><span class=c># Set-NetIPInterface -AddressFamily IPv6 -ifAlias Ethernet -RouterDiscovery Disabled</span>
</span></span><span class=line><span class=cl><span class=c># Set-NetIPInterface -AddressFamily IPv6 -ifAlias Ethernet -RouterDiscovery Enabled</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Set-NetIPv6Protocol</span> <span class=n>-DhcpMediaSense</span> <span class=n>Disabled</span>
</span></span><span class=line><span class=cl><span class=nb>Set-NetIPv6Protocol</span> <span class=n>-RandomizeIdentifiers</span> <span class=n>Disabled</span>
</span></span><span class=line><span class=cl><span class=nb>Set-NetIPv6Protocol</span> <span class=n>-UseTemporaryAddresses</span> <span class=n>Disabled</span>
</span></span><span class=line><span class=cl><span class=nb>Set-NetIPv6Protocol</span> <span class=n>-MaxTemporaryDesyncTime</span> <span class=mf>0</span><span class=err>:</span><span class=mf>3</span><span class=err>:</span><span class=mf>0</span>
</span></span><span class=line><span class=cl><span class=nb>Set-NetIPv6Protocol</span> <span class=n>-MaxTemporaryPreferredLifetime</span> <span class=mf>0</span><span class=err>:</span><span class=mf>10</span><span class=err>:</span><span class=mf>0</span>
</span></span><span class=line><span class=cl><span class=nb>Set-NetIPv6Protocol</span> <span class=n>-MaxTemporaryValidLifetime</span> <span class=mf>0</span><span class=err>:</span><span class=mf>30</span><span class=err>:</span><span class=mf>0</span>
</span></span><span class=line><span class=cl><span class=nb>Set-NetIPv6Protocol</span> <span class=n>-TemporaryRegenerateTime</span> <span class=mf>0</span><span class=err>:</span><span class=mf>0</span><span class=err>:</span><span class=mf>30</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-e9e3d6173c9a65d937dabcb06bfd3085>window-message</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> window-message</li></ul><h1 id=windows-message>windows-message</h1><ul><li><a href=https://gist.github.com/amgine/2395987>All windows messages as C# enum (github.com)</a></li><li><a href=https://wiki.winehq.org/List_Of_Windows_Messages>List Of Windows Messages - WineHQ Wiki</a></li><li><a href=http://www.pinvoke.net/default.aspx/Constants/WM.html>pinvoke.net: WM (Constants)</a></li><li><a href=http://pinvoke.net/default.aspx/Enums.WindowsMessages>pinvoke.net: WindowsMessages (Enums)</a></li><li><a href=https://learn.microsoft.com/en-us/windows/win32/winmsg/window-notifications>Window Notifications</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-193faaa62417d666d3091475b953c37f>Win-to-go</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><p>===</p><p>Windows To Go 的优点在于移动便携性, 缺点在于经典 Windows系统的数个功能受到限制.</p><ul><li><a href=/blog/2024/06/28/win-to-go/#前言>前言</a></li><li><a href=/blog/2024/06/28/win-to-go/#windows-to-go-overview>Windows To Go Overview</a></li><li><a href=/blog/2024/06/28/win-to-go/#windows-to-go-和传统-windows-安装方式的区别>Windows To Go 和传统 Windows 安装方式的区别</a></li><li><a href=/blog/2024/06/28/win-to-go/#使用-windows-to-go-来移动工作>使用 Windows To Go 来移动工作</a></li><li><a href=/blog/2024/06/28/win-to-go/#准备安装-windows-to-go>准备安装 Windows To Go</a></li><li><a href=/blog/2024/06/28/win-to-go/#硬件要求>硬件要求</a></li><li><a href=/blog/2024/06/28/win-to-go/#usb-硬盘或-u盘>USB 硬盘或 U盘</a></li><li><a href=/blog/2024/06/28/win-to-go/#载体机器host-computer>载体机器(Host computer)</a></li><li><a href=/blog/2024/06/28/win-to-go/#检查载体-pc-和-windows-to-go-盘的架构兼容性>检查载体 PC 和 Windows To Go 盘的架构兼容性</a></li><li><a href=/blog/2024/06/28/win-to-go/#windows-to-go-的常见问题>Windows To Go 的常见问题</a></li></ul><h2 id=前言>前言</h2><p>Windows To Go出现很多年了, 可是百度到的中文文档却如此少, 不禁为国内IT技术的发展而担忧.作者J参加工作时间不长, 能力有限, 但工作中接触大量英文开发文档, 因此仍希望能做一点基础的铺路工作, 方便后来者查阅, 有不当之处也请读者不吝指出. Windows To Go有详尽的官方文档, 有英文阅读能力的可以直接跳转到微软官方文档. 链接如下:</p><ul><li><a href=https://docs.microsoft.com/zh-cn/windows/deployment/planning/windows-to-go-overview>Windows To Go Overview</a></li><li><a href=https://docs.microsoft.com/zh-cn/windows/deployment/planning/best-practice-recommendations-for-windows-to-go>Best practice recommendations for Windows To Go</a></li><li><a href=https://docs.microsoft.com/zh-cn/windows/deployment/planning/deployment-considerations-for-windows-to-go>Deployment considerations for Windows To Go</a></li><li><a href=https://docs.microsoft.com/zh-cn/windows/deployment/planning/prepare-your-organization-for-windows-to-go>Prepare your organization for Windows To Go</a></li><li><a href=https://docs.microsoft.com/zh-cn/windows/deployment/planning/security-and-data-protection-considerations-for-windows-to-go>Security and data protection considerations for Windows To Go</a></li><li><a href=https://docs.microsoft.com/zh-cn/windows/deployment/planning/windows-to-go-frequently-asked-questions>Windows To Go: frequently asked questions</a></li></ul><p>本文主要会介绍 Overview, 和一些常见问题, 大部分内容为翻译, 少量作者的提醒以[J]来标注直至句号结束, 以确保不误导读者.</p><h2 id=windows-to-go-overview>Windows To Go Overview</h2><p>Windows To Go 是 Windows 企业版和教育版上的功能, 大多数家庭用户使用的家庭版没有此功能. 它使我们能创建从U盘或硬盘启动的便携Windows系统. Windows To Go 并不是创造出来取代传统工作工具的. 它的主要目的是为了使具有经常切换工作空间需求的人更有效率. 在开始使用 Windows To Go 之前, 使用者必须了解以下注意事项:</p><ul><li>Windows To Go 和传统 Windows 安装方式的区别;</li><li>使用 Windows To Go 来移动工作;</li><li>准备安装 Windows To Go;</li><li>硬件要求.</li></ul><h2 id=windows-to-go-和传统-windows-安装方式的区别>Windows To Go 和传统 Windows 安装方式的区别</h2><p>Windows To Go 的工作环境和传统 Windows 几乎一样, 只有以下几点不同:</p><ul><li>除了使用中的U盘, 机器的其它硬盘默认为离线状态. 即在文件管理器里不可见, 这是为了保护数据的安全. [J]但你仍然有方法可以使其它硬盘出现, 并修改里边的文件.</li><li>TPM 信任平台模块不可用. TPM 模块会绑定到特定某台电脑, 以保护商业数据. [J]多数民用电脑没有TPM模块, 但如果你的商用电脑已经加入了公司的域, 最好不要尝试在该电脑上使用 Windows To Go, 否则建议您先准备好下份工作的简历.</li><li>Windows To Go的休眠默认被禁用, 但仍可以通过组策略来打开. [J]很多机器在休眠会断开和USB设备的连接, 导致不能从休眠中恢复, 这很好理解, 微软已经替我们考虑到了这点, 所以没必要去修改这个设置.</li><li>Windows 的恢复(Restore)功能被禁用. 如果系统出现问题, 只能重装Windows了.</li><li>恢复到出厂设置不可用, 重置Windows不可用.</li><li>升级不可用. Windows 只能停留在安装时的版本, 不能从Windows 7 升到8, 也不能从 Windows 10 Red Stone 1 升级到 Red Stone 2.</li></ul><h2 id=使用-windows-to-go-来移动工作>使用 Windows To Go 来移动工作</h2><p>Windows To Go 可以在多台机器之间切换, 系统会自动决定设备启动需要的驱动程序. 有一些和系统硬件强关联的应用可能无法运行. [J]比如Thinkpad触控板的设置程序, 指纹识别设置程序等.</p><h2 id=准备安装-windows-to-go>准备安装 Windows To Go</h2><p>可以使用 <strong>System Center Configuration Manager</strong>, 或者 Windows 的标准部署工具, 例如 <strong>DiskPart</strong>, <strong>Deployment Image Servicing and Management (DISM)</strong>. 需要注意以下问题:</p><ul><li>是否有需要注入到 Windows To Go 镜像的驱动?</li><li>在不同机器上移动工作时时, 怎样合适的存储及同步数据?</li><li>32位还是64位? [J]新的机器都支持64位, 64位处理器的机器也能运行32位系统, 32位处理器不能运行64位的系统, 64位系统运行时占用更大的硬盘空间和内存空间. 如果你需要迁移使用的机器处理器架构有只支持32位的处理器, 或者机器内存少于4G, 建议你使用32位系统.</li><li>从协作网络以外的网络远程连接时的分辨率应该设为多少?</li></ul><h2 id=硬件要求>硬件要求</h2><h3 id=usb-硬盘或-u盘>USB 硬盘或 U盘</h3><p>Windows To Go针对以下列出的设备已做出了特别优化来满足需求, 包括</p><ul><li>优化USB设备的高随机读写, 以使日常操作更流畅.</li><li>在已认证的设备上可以启动Windows 7及后续系统.</li><li>即使运行Windows To Go, USB设备也享受原厂保修支持. [J]没说插U盘的电脑会享受保修.</li></ul><p>没有通过认证的 USB 设备, 不支持使用 Windows To Go. [J]能不能使用试试就知道了, 不行也知道是为什么. [J]同时网上有修改 U 盘厂商和型号来达到强制支持的另类方法, 不做赘述.</p><h3 id=载体机器host-computer>载体机器(Host computer)</h3><ul><li>认证支持Windows 7及后续系统.</li><li>运行Windows RT系统的电脑不受支持.</li><li>苹果Mac电脑不受支持. [J]尽管网络上遍布谈Windows To Go在Mac上运行的体验, 但官方文档明确说了, 不支持Mac的使用场景.</li></ul><p>以下列出载体电脑的最低配置.</p><table><thead><tr><th>Item</th><th>Requirement</th></tr></thead><tbody><tr><td>启动方式</td><td>可以USB启动</td></tr><tr><td>固件</td><td>从USB启动的设置打开</td></tr><tr><td>处理器架构</td><td>必须支持Windows To Go</td></tr><tr><td>外置USB Hub</td><td>不支持. Windows To Go 设备必须直接接在载体电脑上</td></tr><tr><td>处理器</td><td>1GHz以上</td></tr><tr><td>RAM</td><td>2 GB以上</td></tr><tr><td>显卡</td><td>有WDDM1.2的DirectX 9及以上</td></tr><tr><td>USB端口</td><td>USB 2.0及以上</td></tr></tbody></table><h3 id=检查载体-pc-和-windows-to-go-盘的架构兼容性>检查载体 PC 和 Windows To Go 盘的架构兼容性</h3><table><thead><tr><th>Host PC Firmware Type</th><th>Host PC Processor Architecture</th><th>Compatible Windows To Go Image Architecture</th></tr></thead><tbody><tr><td>Legacy BIOS</td><td>32-bit</td><td>32-bit only</td></tr><tr><td>Legacy BIOS</td><td>64-bit</td><td>32-bit and 64-bit</td></tr><tr><td>UEFI BIOS</td><td>32-bit</td><td>32-bit only</td></tr><tr><td>UEFI BIOS</td><td>64-bit</td><td>64-bit only</td></tr></tbody></table><h2 id=windows-to-go-的常见问题>Windows To Go 的常见问题</h2><p><a href=https://docs.microsoft.com/zh-cn/windows/deployment/planning/windows-to-go-frequently-asked-questions>Windows To Go: frequently asked questions</a></p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="User mailing list" aria-label="User mailing list"><a target=_blank rel=noopener href=https://groups.google.com/forum/#!forum/jqknono aria-label="User mailing list"><i class=envelope></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/jqknono aria-label=Telegram><i class="fab fa-telegram"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/jqknono aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="User mailing list" aria-label="User mailing list"><a target=_blank rel=noopener href=https://groups.google.com/forum/#!forum/jqknono aria-label="User mailing list"><i class=envelope></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2015&ndash;2024
<span class=td-footer__authors>jqknono</span></span><span class=td-footer__all_rights_reserved>保留所有权利</span></div></div></div></footer></div><style>.markmap>svg{width:100%;height:300px}</style><script>window.markmap={autoLoader:{manual:!0,onReady(){const{autoLoader:e,builtInPlugins:t}=window.markmap;e.transformPlugins=t.filter(e=>e.name!=="prism")}}}</script><script src=https://cdn.jsdelivr.net/npm/markmap-autoloader></script><script src=/js/deflate.js></script><script src=/js/main.min.e5bf9790270b64e45f5b1b8bc98f9afd914460c3cefe6f98bf8c2010180f7de9.js integrity="sha256-5b+XkCcLZORfWxuLyY+a/ZFEYMPO/m+Yv4wgEBgPfek=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>