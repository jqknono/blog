<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://blog.jqknono.com/blog/%E5%B7%A5%E5%85%B7/><link rel=alternate type=application/rss+xml href=https://blog.jqknono.com/blog/%E5%B7%A5%E5%85%B7/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>工具 | Nono Blogs</title>
<meta name=description content="jqknono 的博客"><meta property="og:url" content="https://blog.jqknono.com/blog/%E5%B7%A5%E5%85%B7/"><meta property="og:site_name" content="Nono Blogs"><meta property="og:title" content="工具"><meta property="og:description" content="jqknono 的博客"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="website"><meta itemprop=name content="工具"><meta itemprop=description content="jqknono 的博客"><meta itemprop=datePublished content="2024-06-28T16:11:32+08:00"><meta itemprop=dateModified content="2024-06-28T16:11:32+08:00"><meta itemprop=keywords content="工具"><meta name=twitter:card content="summary"><meta name=twitter:title content="工具"><meta name=twitter:description content="jqknono 的博客"><link rel=preload href=/scss/main.min.8acecbf86e7556fec1884b2edb0c0a5fcb36544832255924728123faf38ac587.css as=style integrity="sha256-is7L+G51Vv7BiEsu2wwKX8s2VEgyJVkkcoEj+vOKxYc=" crossorigin=anonymous><link href=/scss/main.min.8acecbf86e7556fec1884b2edb0c0a5fcb36544832255924728123faf38ac587.css rel=stylesheet integrity="sha256-is7L+G51Vv7BiEsu2wwKX8s2VEgyJVkkcoEj+vOKxYc=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-F3FFTG72NE"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F3FFTG72NE")}</script></head><body class="td-section td-blog"><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Nono Blogs</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class="nav-link active" href=/blog/><i class='fas fa-cube'></i><span>Blog</span></a></li><li class=nav-item><a class=nav-link href=/docs/><i class='fas fa-book'></i><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=https://www.adguardprivate.com target=_blank rel=noopener><i class="fa-solid fa-fire"></i><span>创建私有Adguard</span><sup><i class="ps-1 fa-solid fa-up-right-from-square fa-xs" aria-hidden=true></i></sup></a></li><li class="td-light-dark-menu nav-item dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown data-bs-display=static aria-label="Toggle theme (auto)"><svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=bd-theme-text><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></li></ul></div><div class="d-none d-lg-block"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder=站内搜索… aria-label=站内搜索… autocomplete=off></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/blog/%E5%B7%A5%E5%85%B7/>返回本页常规视图</a>.</p></div><h1 class=title>工具</h1><ul><li><a href=#pg-4cd6a10e21675523168830d47f64e54b>微信读书体验分享</a></li><ul><li><a href=#pg-f95bd6f91140012a6a60bbc48e45342d>微信读书自动打卡刷时长</a></li></ul><li><a href=#pg-e6e054e8e2f3990091a8b4a8213d3e0c>关闭独显以省电</a></li><li><a href=#pg-08ea908b2ff7344d90a1bf1548cd3f62>docker</a></li><ul><li><a href=#pg-c38cd28aba24ac15282cf3e31ed892e4>docker介绍</a></li></ul><li><a href=#pg-6c1874984d9baf6e4d151ae8d2d66c8e>adguard</a></li><ul><li><a href=#pg-59e4cc5a694f247cd0d535c6af2c1745>利用DNS服务平滑切换网络服务</a></li></ul><li><a href=#pg-cd243ff5456a6d9d85c89b2ebbd970d5>测试工具</a></li><ul><li><a href=#pg-42145e1849133da1bffe65d5ed26f5f5>简易server-client代码</a></li></ul><li><a href=#pg-66ec6e435a0d6143639b3a41c8ca7bd9>AI</a></li><ul><li><a href=#pg-252aa5b5694af19740a738128bf07d27>Copilot系列</a></li><ul></ul></ul></ul><div class=content></div></div><div class=td-content><h1 id=pg-4cd6a10e21675523168830d47f64e54b>微信读书体验分享</h1><div class="td-byline mb-4"><time datetime=2024-12-24 class=text-body-secondary>Tuesday, December 24, 2024</time></div><p>免费读书方案有很多, 但是微信读书的确是体验做的较好的一个. 希望免费读书的可以看 zlibrary.</p><p>这里主要分享微信读书的使用体验, 以及一些辅助工具, 如有任何侵权, 请联系我删除: <code>weread-challenge@techfetch.dev</code></p></div><div class=td-content style=page-break-before:always><h1 id=pg-f95bd6f91140012a6a60bbc48e45342d>微信读书自动打卡刷时长</h1><div class="td-byline mb-4"><time datetime=2024-12-05 class=text-body-secondary>Thursday, December 05, 2024</time></div><p>只为便宜一点买微信读书会员.</p><p><img alt=只为便宜一点买微信读书会员 src=https://img1.techfetch.dev/blog/202412261741639.gif></p><h2 id=微信读书规则>微信读书规则</h2><ul><li>离线阅读计入总时长, 但需要联网上报</li><li>网页版, 墨水屏, 小程序, 听书, 有声书收听<strong>都计入总时长</strong></li><li>对单次自动阅读或收听时长过长的行为, 平台将结合用户行为特征判断, <strong>过长部分不计入总时长</strong></li><li>当日阅读超过<strong>5 分钟</strong>才算作有效阅读天数</li><li>付费 5 元立即获得 2 天会员, 后续 30 日内打卡 29 天, 读书时长超过 30 小时, 可获得 30 天会员和 30 书币</li><li>付费 50 元立即获得 30 天会员, 后续 365 日内打卡 360 天, 读书时长超过 300 小时, 可获得 365 天会员和 500 书币</li></ul><p>根据实际操作, 还有如下未明确说明的特点:</p><ul><li>第 29 日打卡后立即获得读书会员奖励, 并可立即开始下一轮挑战会员打卡, 无需等待第 31 日开始下一轮挑战, 第 29 日的打卡既算上一轮的打卡, 也算下一轮的打卡.</li><li>除第一轮需 29 日外, 后续每 28 日即可获得 32 日会员, 1+28*13=365, 一年可完成 13 轮, 花费 65 元, 获得 32*13=416 天会员和 390 书币.</li><li>更划算的仍然是年卡挑战会员, 但周期更长, 风险更大.</li></ul><h2 id=工具特性>工具特性</h2><ul><li>使用有头浏览器</li><li>支持本地浏览器和远程浏览器</li><li>随机浏览器宽度和高度</li><li>支持等待登录</li><li>支持登录二维码刷新</li><li>支持保存 cookies</li><li>支持加载 cookies</li><li>支持选择最近阅读的第 X 本书开始阅读</li><li>默认随机选择一本书开始阅读</li><li>支持自动阅读</li><li>支持跳到下一章</li><li>支持读完跳回第一章继续阅读</li><li>随机单页阅读时间</li><li>随机翻页时间</li><li>每分钟截图当前界面</li><li>支持日志</li><li>支持定时任务</li><li>支持设置阅读时间</li><li>支持邮件通知</li><li>多平台支持: <code>linux | windows | macos</code></li><li>多架构支持: <code>amd64 | arm64</code></li><li>支持浏览器: <code>chrome | MicrosoftEdge | firefox | safari</code></li><li>支持多用户</li><li>异常时强制刷新</li><li>使用统计</li></ul><h2 id=linux>Linux</h2><h3 id=直接运行>直接运行</h3><p>下载链接: <a href=https://storage1.techfetch.dev/weread-challenge/weread-challenge.js>weread-challenge.js</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 安装nodejs</span>
</span></span><span class=line><span class=cl>sudo apt install nodejs
</span></span><span class=line><span class=cl><span class=c1># 老旧版本的 nodejs 需要安装 npm</span>
</span></span><span class=line><span class=cl>sudo apt install npm
</span></span><span class=line><span class=cl><span class=c1># 创建运行文件夹</span>
</span></span><span class=line><span class=cl>mkdir -p <span class=nv>$HOME</span>/weread-challenge
</span></span><span class=line><span class=cl><span class=nb>cd</span> <span class=nv>$HOME</span>/weread-challenge
</span></span><span class=line><span class=cl><span class=c1># 安装依赖</span>
</span></span><span class=line><span class=cl>npm install selenium-webdriver
</span></span><span class=line><span class=cl><span class=c1># 通过环境变量设置运行参数</span>
</span></span><span class=line><span class=cl><span class=nv>WEREAD_BROWSER</span><span class=o>=</span><span class=s2>&#34;chrome&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># 运行</span>
</span></span><span class=line><span class=cl>node weread-challenge.js
</span></span></code></pre></div><p>如需邮件通知, 需安装 <em>nodemailer</em>:
<code>npm install nodemailer</code></p><h3 id=docker-compose-运行>Docker Compose 运行</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>app</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>jqknono/weread-challenge:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pull_policy</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>WEREAD_REMOTE_BROWSER=http://selenium:4444</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>WEREAD_DURATION=68</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./data:/app/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>selenium</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=l>service_healthy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selenium</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>selenium/standalone-chrome:4.26</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pull_policy</span><span class=p>:</span><span class=w> </span><span class=l>if_not_present</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>shm_size</span><span class=p>:</span><span class=w> </span><span class=l>2gb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/var/run/docker.sock:/var/run/docker.sock</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>SE_ENABLE_TRACING=false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>SE_BIND_HOST=false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>SE_JAVA_DISABLE_HOSTNAME_VERIFICATION=false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>healthcheck</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;CMD&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;curl&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;-f&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;http://localhost:4444/wd/hub/status&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>5s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>60s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span></code></pre></div><p>保存为 <code>docker-compose.yml</code>, 运行 <code>docker compose up -d</code>.</p><h3 id=docker-运行>Docker 运行</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># run selenium standalone</span>
</span></span><span class=line><span class=cl>docker run --restart always -d --name selenium-live <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -v /var/run/docker.sock:/var/run/docker.sock <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --shm-size<span class=o>=</span><span class=s2>&#34;2g&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -p 4444:4444 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -p 7900:7900 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>SE_ENABLE_TRACING</span><span class=o>=</span><span class=nb>false</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>SE_BIND_HOST</span><span class=o>=</span><span class=nb>false</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>SE_JAVA_DISABLE_HOSTNAME_VERIFICATION</span><span class=o>=</span><span class=nb>false</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>SE_NODE_MAX_INSTANCES</span><span class=o>=</span><span class=m>10</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>SE_NODE_MAX_SESSIONS</span><span class=o>=</span><span class=m>10</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>SE_NODE_OVERRIDE_MAX_SESSIONS</span><span class=o>=</span><span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  selenium/standalone-chrome:4.26
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># run weread-challenge</span>
</span></span><span class=line><span class=cl>docker run --rm --name user-read <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -v <span class=nv>$HOME</span>/weread-challenge/user/data:/app/data <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>WEREAD_REMOTE_BROWSER</span><span class=o>=</span>http://172.17.0.2:4444 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>WEREAD_DURATION</span><span class=o>=</span><span class=m>68</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  weread-challenge:beta
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># add another user</span>
</span></span><span class=line><span class=cl>docker run --rm --name user2-read <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -v <span class=nv>$HOME</span>/weread-challenge/user2/data:/app/data <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>WEREAD_REMOTE_BROWSER</span><span class=o>=</span>http://172.17.0.2:4444 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>WEREAD_DURATION</span><span class=o>=</span><span class=m>68</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  weread-challenge:latest
</span></span></code></pre></div><h3 id=创建定时任务>创建定时任务</h3><h4 id=docker-compose>docker-compose</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>WORKDIR</span><span class=o>=</span><span class=nv>$HOME</span>/weread-challenge
</span></span><span class=line><span class=cl>mkdir -p <span class=nv>$WORKDIR</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> <span class=nv>$WORKDIR</span>
</span></span><span class=line><span class=cl>cat &gt; <span class=nv>$WORKDIR</span>/docker-compose.yml <span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>services:
</span></span></span><span class=line><span class=cl><span class=s>  app:
</span></span></span><span class=line><span class=cl><span class=s>    image: jqknono/weread-challenge:latest
</span></span></span><span class=line><span class=cl><span class=s>    pull_policy: always
</span></span></span><span class=line><span class=cl><span class=s>    environment:
</span></span></span><span class=line><span class=cl><span class=s>      - WEREAD_REMOTE_BROWSER=http://selenium:4444
</span></span></span><span class=line><span class=cl><span class=s>      - WEREAD_DURATION=68
</span></span></span><span class=line><span class=cl><span class=s>    volumes:
</span></span></span><span class=line><span class=cl><span class=s>      - ./data:/app/data
</span></span></span><span class=line><span class=cl><span class=s>    depends_on:
</span></span></span><span class=line><span class=cl><span class=s>      selenium:
</span></span></span><span class=line><span class=cl><span class=s>        condition: service_healthy
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>  selenium:
</span></span></span><span class=line><span class=cl><span class=s>    image: selenium/standalone-chrome:4.26
</span></span></span><span class=line><span class=cl><span class=s>    pull_policy: if_not_present
</span></span></span><span class=line><span class=cl><span class=s>    shm_size: 2gb
</span></span></span><span class=line><span class=cl><span class=s>    volumes:
</span></span></span><span class=line><span class=cl><span class=s>      - /var/run/docker.sock:/var/run/docker.sock
</span></span></span><span class=line><span class=cl><span class=s>    environment:
</span></span></span><span class=line><span class=cl><span class=s>      - SE_ENABLE_TRACING=false
</span></span></span><span class=line><span class=cl><span class=s>      - SE_BIND_HOST=false
</span></span></span><span class=line><span class=cl><span class=s>      - SE_JAVA_DISABLE_HOSTNAME_VERIFICATION=false
</span></span></span><span class=line><span class=cl><span class=s>    healthcheck:
</span></span></span><span class=line><span class=cl><span class=s>      test: [&#34;CMD&#34;, &#34;curl&#34;, &#34;-f&#34;, &#34;http://localhost:4444/wd/hub/status&#34;]
</span></span></span><span class=line><span class=cl><span class=s>      interval: 5s
</span></span></span><span class=line><span class=cl><span class=s>      timeout: 60s
</span></span></span><span class=line><span class=cl><span class=s>      retries: 10
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl><span class=c1># 首次启动后, 需微信扫描二维码登录, 二维码保存在 $HOME/weread-challenge/data/login.png</span>
</span></span><span class=line><span class=cl><span class=c1># 每天早上 7 点启动, 阅读68分钟</span>
</span></span><span class=line><span class=cl><span class=o>(</span>crontab -l 2&gt;/dev/null<span class=p>;</span> <span class=nb>echo</span> <span class=s2>&#34;00 07 * * *  cd </span><span class=nv>$WORKDIR</span><span class=s2> &amp;&amp; docker compose up -d&#34;</span><span class=o>)</span> <span class=p>|</span> crontab -
</span></span></code></pre></div><h4 id=docker>docker</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 启动浏览器</span>
</span></span><span class=line><span class=cl>docker run --restart always -d --name selenium-live <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -v /var/run/docker.sock:/var/run/docker.sock <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --shm-size<span class=o>=</span><span class=s2>&#34;2g&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -p 4444:4444 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -p 7900:7900 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>SE_ENABLE_TRACING</span><span class=o>=</span><span class=nb>false</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>SE_BIND_HOST</span><span class=o>=</span><span class=nb>false</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>SE_JAVA_DISABLE_HOSTNAME_VERIFICATION</span><span class=o>=</span><span class=nb>false</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>SE_NODE_MAX_INSTANCES</span><span class=o>=</span><span class=m>3</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>SE_NODE_MAX_SESSIONS</span><span class=o>=</span><span class=m>3</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>SE_NODE_OVERRIDE_MAX_SESSIONS</span><span class=o>=</span><span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>SE_SESSION_REQUEST_TIMEOUT</span><span class=o>=</span><span class=m>10</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>SE_SESSION_RETRY_INTERVAL</span><span class=o>=</span><span class=m>3</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  selenium/standalone-chrome:4.26
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>WEREAD_USER</span><span class=o>=</span><span class=s2>&#34;user&#34;</span>
</span></span><span class=line><span class=cl>mkdir -p <span class=nv>$HOME</span>/weread-challenge/<span class=nv>$WEREAD_USER</span>/data
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Get container IP</span>
</span></span><span class=line><span class=cl><span class=nv>Selenium_IP</span><span class=o>=</span><span class=k>$(</span>docker inspect -f <span class=s1>&#39;{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}&#39;</span> selenium-live<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 首次启动后, 需微信扫描二维码登录, 二维码保存在 $HOME/weread-challenge/$WEREAD_USER/data/login.png</span>
</span></span><span class=line><span class=cl><span class=c1># 每天早上 7 点启动, 阅读68分钟</span>
</span></span><span class=line><span class=cl><span class=o>(</span>crontab -l 2&gt;/dev/null<span class=p>;</span> <span class=nb>echo</span> <span class=s2>&#34;00 07 * * * docker run --rm --name </span><span class=si>${</span><span class=nv>WEREAD_USER</span><span class=si>}</span><span class=s2>-read -v </span><span class=nv>$HOME</span><span class=s2>/weread-challenge/</span><span class=si>${</span><span class=nv>WEREAD_USER</span><span class=si>}</span><span class=s2>/data:/app/data -e WEREAD_REMOTE_BROWSER=http://</span><span class=si>${</span><span class=nv>Selenium_IP</span><span class=si>}</span><span class=s2>:4444 -e WEREAD_DURATION=68 -e WEREAD_USER=</span><span class=si>${</span><span class=nv>WEREAD_USER</span><span class=si>}</span><span class=s2> jqknono/weread-challenge:latest&#34;</span><span class=o>)</span> <span class=p>|</span> crontab -
</span></span></code></pre></div><h2 id=windows>Windows</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># 安装nodejs</span>
</span></span><span class=line><span class=cl><span class=n>winget</span> <span class=n>install</span> <span class=n>-e</span> <span class=p>-</span><span class=n>-id</span> <span class=n>Node</span><span class=p>.</span><span class=py>js</span><span class=p>.</span><span class=py>Node</span><span class=p>.</span><span class=py>js</span>
</span></span><span class=line><span class=cl><span class=c># 创建运行文件夹</span>
</span></span><span class=line><span class=cl><span class=n>mkdir</span> <span class=n>-p</span> <span class=nv>$HOME</span><span class=p>/</span><span class=nb>weread-challenge</span>
</span></span><span class=line><span class=cl><span class=nb>cd </span><span class=nv>$HOME</span><span class=p>/</span><span class=nb>weread-challenge</span>
</span></span><span class=line><span class=cl><span class=c># 安装依赖</span>
</span></span><span class=line><span class=cl><span class=n>npm</span> <span class=n>install</span> <span class=nb>selenium-webdriver</span>
</span></span><span class=line><span class=cl><span class=c># 通过环境变量设置运行参数</span>
</span></span><span class=line><span class=cl><span class=nv>$WEREAD_BROWSER</span><span class=p>=</span><span class=s2>&#34;MicrosoftEdge&#34;</span>
</span></span><span class=line><span class=cl><span class=c># 运行</span>
</span></span><span class=line><span class=cl><span class=n>node</span> <span class=nb>weread-challenge</span><span class=p>.</span><span class=py>js</span>
</span></span></code></pre></div><p>Docker 运行同 Linux.</p><h2 id=macos>MacOS</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl><span class=c1># 安装nodejs</span>
</span></span><span class=line><span class=cl>brew install node
</span></span><span class=line><span class=cl><span class=c1># 创建运行文件夹</span>
</span></span><span class=line><span class=cl>mkdir -p <span class=nv>$HOME</span>/weread-challenge
</span></span><span class=line><span class=cl><span class=c1># 安装依赖</span>
</span></span><span class=line><span class=cl>npm install selenium-webdriver
</span></span><span class=line><span class=cl><span class=c1># 通过环境变量设置运行参数</span>
</span></span><span class=line><span class=cl><span class=nv>WEREAD_BROWSER</span><span class=o>=</span><span class=s2>&#34;safari&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># 运行</span>
</span></span><span class=line><span class=cl>node weread-challenge.js
</span></span></code></pre></div><p>Docker 运行同 Linux.</p><h2 id=多用户支持>多用户支持</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 启动浏览器</span>
</span></span><span class=line><span class=cl>docker run --restart always -d --name selenium-live <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -v /var/run/docker.sock:/var/run/docker.sock <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --shm-size<span class=o>=</span><span class=s2>&#34;2g&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -p 4444:4444 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -p 7900:7900 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>SE_ENABLE_TRACING</span><span class=o>=</span><span class=nb>false</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>SE_BIND_HOST</span><span class=o>=</span><span class=nb>false</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>SE_JAVA_DISABLE_HOSTNAME_VERIFICATION</span><span class=o>=</span><span class=nb>false</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>SE_NODE_MAX_INSTANCES</span><span class=o>=</span><span class=m>10</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>SE_NODE_MAX_SESSIONS</span><span class=o>=</span><span class=m>10</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -e <span class=nv>SE_NODE_OVERRIDE_MAX_SESSIONS</span><span class=o>=</span><span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  selenium/standalone-chrome:4.26
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>WEREAD_USER1</span><span class=o>=</span><span class=s2>&#34;user1&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>WEREAD_USER2</span><span class=o>=</span><span class=s2>&#34;user2&#34;</span>
</span></span><span class=line><span class=cl>mkdir -p <span class=nv>$HOME</span>/weread-challenge/<span class=nv>$WEREAD_USER1</span>/data
</span></span><span class=line><span class=cl>mkdir -p <span class=nv>$HOME</span>/weread-challenge/<span class=nv>$WEREAD_USER2</span>/data
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Get container IP</span>
</span></span><span class=line><span class=cl><span class=nv>Selenium_IP</span><span class=o>=</span><span class=k>$(</span>docker inspect -f <span class=s1>&#39;{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}&#39;</span> selenium-live<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 首次启动后, 需微信扫描二维码登录, 二维码保存在:</span>
</span></span><span class=line><span class=cl><span class=c1># /$HOME/weread-challenge/${WEREAD_USER1}/data/login.png</span>
</span></span><span class=line><span class=cl><span class=c1># /$HOME/weread-challenge/${WEREAD_USER2}/data/login.png</span>
</span></span><span class=line><span class=cl><span class=c1># 每天早上 7 点启动, 阅读68分钟</span>
</span></span><span class=line><span class=cl><span class=o>(</span>crontab -l 2&gt;/dev/null<span class=p>;</span> <span class=nb>echo</span> <span class=s2>&#34;00 07 * * * docker run --rm --name </span><span class=si>${</span><span class=nv>WEREAD_USER1</span><span class=si>}</span><span class=s2>-read -v </span><span class=nv>$HOME</span><span class=s2>/weread-challenge/</span><span class=si>${</span><span class=nv>WEREAD_USER1</span><span class=si>}</span><span class=s2>/data:/app/data -e WEREAD_REMOTE_BROWSER=http://</span><span class=si>${</span><span class=nv>Selenium_IP</span><span class=si>}</span><span class=s2>:4444 -e WEREAD_DURATION=68 -e WEREAD_USER=</span><span class=si>${</span><span class=nv>WEREAD_USER1</span><span class=si>}</span><span class=s2> jqknono/weread-challenge:latest&#34;</span><span class=o>)</span> <span class=p>|</span> crontab -
</span></span><span class=line><span class=cl><span class=o>(</span>crontab -l 2&gt;/dev/null<span class=p>;</span> <span class=nb>echo</span> <span class=s2>&#34;00 07 * * * docker run --rm --name </span><span class=si>${</span><span class=nv>WEREAD_USER2</span><span class=si>}</span><span class=s2>-read -v </span><span class=nv>$HOME</span><span class=s2>/weread-challenge/</span><span class=si>${</span><span class=nv>WEREAD_USER2</span><span class=si>}</span><span class=s2>/data:/app/data -e WEREAD_REMOTE_BROWSER=http://</span><span class=si>${</span><span class=nv>Selenium_IP</span><span class=si>}</span><span class=s2>:4444 -e WEREAD_DURATION=68 -e WEREAD_USER=</span><span class=si>${</span><span class=nv>WEREAD_USER2</span><span class=si>}</span><span class=s2> jqknono/weread-challenge:latest&#34;</span><span class=o>)</span> <span class=p>|</span> crontab -
</span></span></code></pre></div><h2 id=可配置项>可配置项</h2><table><thead><tr><th>环境变量</th><th>默认值</th><th>可选值</th><th>说明</th></tr></thead><tbody><tr><td><code>WEREAD_USER</code></td><td><code>weread-default</code></td><td>-</td><td>用户标识</td></tr><tr><td><code>WEREAD_REMOTE_BROWSER</code></td><td>""</td><td>-</td><td>远程浏览器地址</td></tr><tr><td><code>WEREAD_DURATION</code></td><td><code>10</code></td><td>-</td><td>阅读时长</td></tr><tr><td><code>WEREAD_SELECTION</code></td><td><code>random</code></td><td>[0-4]</td><td>选择阅读的书籍</td></tr><tr><td><code>WEREAD_BROWSER</code></td><td><code>chrome</code></td><td><code>chrome,MicrosoftEdge,firefox,safari</code></td><td>浏览器</td></tr><tr><td><code>ENABLE_EMAIL</code></td><td><code>false</code></td><td><code>true,false</code></td><td>邮件通知</td></tr><tr><td><code>EMAIL_SMTP</code></td><td>""</td><td>-</td><td>邮箱 SMTP 服务器</td></tr><tr><td><code>EMAIL_USER</code></td><td>""</td><td>-</td><td>邮箱用户名</td></tr><tr><td><code>EMAIL_PASS</code></td><td>""</td><td>-</td><td>邮箱密码</td></tr><tr><td><code>EMAIL_TO</code></td><td>""</td><td>-</td><td>收件人</td></tr><tr><td><code>WEREAD_AGREE_TERMS</code></td><td><code>true</code></td><td><code>true,false</code></td><td>隐私同意条款</td></tr></tbody></table><h2 id=容器多架构支持>容器多架构支持</h2><p>支持 linux/amd64,linux/arm64, 支持树莓派等开发板.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker buildx create --name weread-challenge
</span></span><span class=line><span class=cl>docker buildx use weread-challenge
</span></span><span class=line><span class=cl>docker buildx inspect --bootstrap
</span></span><span class=line><span class=cl>docker buildx build --platform linux/amd64,linux/arm64 -t jqknono/weread-challenge:base -f Dockerfile.base --push .
</span></span><span class=line><span class=cl>docker buildx build --platform linux/amd64,linux/arm64 -t jqknono/weread-challenge:latest -f Dockerfile.quick --push .
</span></span></code></pre></div><h2 id=注意事项>注意事项</h2><ul><li>28 日刷满 30 小时, 需每日至少 65 分钟, 而不是每日 60 分钟.</li><li>微信读书统计可能会漏数分钟, 期望每日获得 65 分钟, 建议调整阅读时长到 68 分钟</li><li>网页扫码登录 cookies 有效期为 30 天, 30 天后需重新扫码登录, 适合月挑战会员</li><li>邮件通知可能被识别为垃圾邮件, 建议在收件方添加白名单</li><li>本项目仅供学习交流使用, 请勿用于商业用途, 请勿用于违法用途</li><li>如存在可能的侵权, 请联系 <code>weread-challenge@techfetch.dev</code>, 本项目会立即删除</li></ul><h2 id=隐私政策>隐私政策</h2><ul><li>隐私获取<ul><li>本项目搜集使用者的 <code>cookies</code> 部分信息, 以用于使用者统计和展示.</li><li>搜集使用者的使用信息, 包含: <code>用户名称 | 首次使用时间 | 最近使用时间 | 总使用次数 | 浏览器类型 | 操作系统类别 | 阅读时长设置 | 异常退出原因</code></li><li>如不希望被搜集任何信息, 可设置启动参数<code>WEREAD_AGREE_TERMS=false</code></li></ul></li><li>风险提示<ul><li><code>cookies</code> 可用于微信读书网页登录, 登录后可以执行书架操作, 但<strong>本工具不会使用搜集的信息进行登录操作</strong>.</li><li>腾讯保护机制确保异常登录时, 手机客户端将收到风险提示, 可在手机客户端<code>设置</code>-><code>登录设备</code>中确认登录设备.</li><li>本工具纯 js 实现, 容易反混淆和扩展, 第三方可以继续开发. 即使信任本工具, 也应在使用自动化工具时, 经常确认登录设备, 避免书架被恶意操作.</li></ul></li></ul><h2 id=参考>参考</h2><ul><li>脚本下载链接: <a href=https://storage1.techfetch.dev/weread-challenge/weread-challenge.js>weread-challenge.js</a></li><li>文章来源: <a href=https://blog.techfetch.dev>https://blog.techfetch.dev</a></li><li>展示: <a href=https://weread-challenge.techfetch.dev>https://weread-challenge.techfetch.dev</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-e6e054e8e2f3990091a8b4a8213d3e0c>关闭独显以省电</h1><div class="td-byline mb-4"><time datetime=2024-11-18 class=text-body-secondary>Monday, November 18, 2024</time></div><p>这篇文分享给台式机很少关机, 经常远程回家中的台式机上工作的朋友.</p><p>我的主力工作机和游戏机是同一台机器, 显示屏是 4K 144Hz, 日常都是开着独显, 普通操作显示都会更顺滑一些, 但是功耗也是明显更大.</p><p><em>以下截图里的功率同时带着一个 J4125 小主机, 日常功耗在 18w 上下, 因此结论可能有不准确的地方</em></p><p>不开游戏, 在桌面快速滑动鼠标的峰值功率可以到<em>192w</em></p><p><img src=https://img1.techfetch.dev/blog/202411181057492.jpg></p><p>关闭独显后, 刷新率降到 60Hz, 峰值功率降到<em>120w</em>上下.</p><p><img src=https://img1.techfetch.dev/blog/202411181103084.jpg></p><p>在外隧道回家工作是使用的腾讯的一个入门主机, 带宽较小, 远端刷新率只有 30hz, 这种情况用独显是没有意义, 可以考虑切换到集显.</p><p>多数时候, 我不直接使用远程桌面, 而是使用 vscode 的远程开发, 优势是隐蔽, 占用带宽小, 几乎是本地开发的体验.</p><p><img src=https://img1.techfetch.dev/blog/202411181116237.png></p><p>普通代码编辑时, 约 72w, 与关闭独显前的 120w 相比, 有一定的节能效果.</p><p><img src=https://img1.techfetch.dev/blog/202411221112020.jpg></p><p>使用<code>remote ssh</code>进行远程开发时, 可以用使用脚本关闭独显.</p><p>脚本保存为<code>switch_dedicate_graphic_cards.ps1</code>, 使用方法为<code>switch_dedicate_graphic_cards.ps1 off</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># Usage: switch_dedicate_graphic_cards.ps1 on|off</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Get parameters</span>
</span></span><span class=line><span class=cl><span class=nv>$switch</span> <span class=p>=</span> <span class=nv>$args</span><span class=p>[</span><span class=mf>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># exit if no parameter is passed</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$switch</span> <span class=o>-eq</span> <span class=vm>$null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Host</span> <span class=s2>&#34;Usage: switch_dedicate_graphic_cards.ps1 on|off&#34;</span> <span class=n>-ForegroundColor</span> <span class=n>Yellow</span>
</span></span><span class=line><span class=cl>    <span class=n>exit</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Get display devices</span>
</span></span><span class=line><span class=cl><span class=nv>$displayDevices</span> <span class=p>=</span>  <span class=nb>Get-CimInstance</span> <span class=n>-Namespace</span> <span class=n>root</span><span class=p>\</span><span class=n>cimv2</span> <span class=n>-ClassName</span> <span class=n>Win32_VideoController</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># If there is no display device or only one display device, exit</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$displayDevices</span><span class=p>.</span><span class=py>Count</span> <span class=o>-le</span> <span class=mf>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Host</span> <span class=s2>&#34;No display device found.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>exit</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Get dedicated graphic cards</span>
</span></span><span class=line><span class=cl><span class=nv>$dedicatedGraphicCards</span> <span class=p>=</span> <span class=nv>$displayDevices</span> <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span> <span class=nv>$_</span><span class=p>.</span><span class=py>Description</span> <span class=o>-like</span> <span class=s2>&#34;*NVIDIA*&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># If there is no dedicated graphic card, exit</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$dedicatedGraphicCards</span><span class=p>.</span><span class=py>Count</span> <span class=o>-eq</span> <span class=mf>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Host</span> <span class=s2>&#34;No dedicated graphic card found.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>exit</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># turn dedicated graphic cards on or off</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$switch</span> <span class=o>-eq</span> <span class=s2>&#34;on&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$dedicatedGraphicCards</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span> <span class=n>pnputil</span> <span class=p>/</span><span class=nb>enable-device</span> <span class=nv>$_</span><span class=p>.</span><span class=py>PNPDeviceID</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Host</span> <span class=s2>&#34;Dedicated graphic cards are turned on.&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>elseif</span> <span class=p>(</span><span class=nv>$switch</span> <span class=o>-eq</span> <span class=s2>&#34;off&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$dedicatedGraphicCards</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span> <span class=n>pnputil</span> <span class=p>/</span><span class=nb>disable-device</span> <span class=nv>$_</span><span class=p>.</span><span class=py>PNPDeviceID</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Host</span> <span class=s2>&#34;Dedicated graphic cards are turned off.&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Host</span> <span class=s2>&#34;Invalid parameter.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Host</span> <span class=s2>&#34;Usage: switch_dedicate_graphic_cards.ps1 on|off&#34;</span> <span class=n>-ForegroundColor</span> <span class=n>Yellow</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-08ea908b2ff7344d90a1bf1548cd3f62>docker</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><h1 id=k8s-和-docker>k8s 和 docker</h1><ul><li>[<a href=/blog/2024/06/28/docker%E4%BB%8B%E7%BB%8D/ title=docker介绍>docker介绍</a>]<ul><li>[<a href=Windows%E5%AE%B9%E5%99%A8 title=Windows容器>Windows容器</a>]</li><li>[<a href=docker%E7%BD%91%E7%BB%9C title=docker网络>docker网络</a>]</li><li>[<a href=docker%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90 title=docker网络分析>docker网络分析</a>]</li></ul></li></ul></div><div class=td-content><h1 id=pg-c38cd28aba24ac15282cf3e31ed892e4>docker介绍</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> docker介绍</li></ul><h1 id=docker-介绍>docker 介绍</h1><ul><li>docker 是一个应用容器引擎, 可以打包应用及其依赖包到一个可移植的容器中, 然后发布到任何流行的 Linux 或 Windows 机器上, 也可以实现虚拟化.</li><li>为什么会有 docker, 因为开发和运维经常遇到一类问题, 那就是应用在开发人员的环境上运行没有任何问题, 但在实际生产环境中却 bug 百出.<ul><li>程序的运行从硬件架构到操作系统, 再到应用程序, 这些都是不同的层次, 但是开发人员往往只关注应用程序的开发, 而忽略了其他层次的问题.</li><li>docker 的出现就是为了解决这个问题, 它将应用程序及其依赖, 打包在一个容器中, 这样就不用担心环境的问题了.</li></ul></li><li>同步开发和生产环境, 使开发人员可以在本地开发, 测试, 部署应用程序, 而不用担心环境的问题. 显著提升了开发和运维的效率, 代价是一点点资源的浪费.</li></ul><p>我极力建议所有开发者都学会使用容器进行开发和部署, 它以相对很低的代价, 为你的应用程序提供一个稳定的运行环境, 从而提高开发和运维的效率.</p><p>使用一些通俗的语言来描述使用 docker 的一种工作流:</p><ol><li>从零创建一个开发的环境, 包含了操作系统, 应用程序, 依赖包, 配置文件等等.<ul><li>环境可以在任何地方运行, 也可以在任何地方创建.</li><li>环境对源码编译的结果稳定且可预测, 行为完全一致.</li><li>环境中程序的运行不会产生任何歧义.</li><li>最好是可以使用声明式的方式来创建环境(docker-compose), 进一步减少环境的隐藏差异, 环境的一切都已在声明里展示.</li></ul></li><li>创建一个 commit, 创建镜像, 这相当于一个快照, 保存当前的环境, 以便以后使用.</li><li>分享镜像给其它开发和运维, 大家基于相同语境同步展开工作.</li><li>随着业务的发展需求, 修改镜像, 重新创建 commit, 重新创建镜像, 重新分发.</li></ol><h2 id=docker-的基本架构>docker 的基本架构</h2><ul><li>[<a href=docker%E7%BD%91%E7%BB%9C title=docker网络>docker网络</a>]</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-6c1874984d9baf6e4d151ae8d2d66c8e>adguard</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div></div><div class=td-content><h1 id=pg-59e4cc5a694f247cd0d535c6af2c1745>利用DNS服务平滑切换网络服务</h1><div class="td-byline mb-4"><time datetime=2024-06-12 class=text-body-secondary>Wednesday, June 12, 2024</time></div><p>假设服务域名为<code>example.domain</code>, 原服务器 IP 地址为<code>A</code>, 由于服务器迁移或 IP 更换, 新服务器 IP 地址为<code>B</code>, 为了保证用户无感知, 可以通过 DNS 服务平滑切换网络服务.</p><ol><li>原服务状态, <code>example.domain</code> 解析到 IP 地址<code>A</code></li><li>过渡状态, <code>example.domain</code> 解析到 IP 地址<code>A</code> 和<code>B</code></li><li>新服务状态, <code>example.domain</code> 解析到 IP 地址<code>B</code>, 移除 IP 地址<code>A</code></li></ol><p>说明: 当用户获得两个解析地址时, 客户端会选择其中一个地址进行连接, 当连接失败时, 会尝试其它地址, 以此保证服务的可用性.</p><p>由于 DNS 解析存在缓存, 为了保证平滑切换, 需要在过渡状态保持一段时间, 以确保所有缓存失效.</p><p>我这里需要迁移的是 dns 服务, 可以在过渡状态中设置<code>DNS重写</code>, 加快迁移过程.</p><p>A 服务重写规则:</p><p><img alt=A服务重写 src=https://s2.loli.net/2024/06/12/xRFMB1PTIcvUQHr.png></p><p>B 服务重写规则:</p><p><img alt=B服务重写 src=https://s2.loli.net/2024/06/12/DILEi9jJoVYeuT2.png></p><p>原迁移过程拓展为:</p><ol><li>原服务状态, <code>example.domain</code> 解析到 IP 地址<code>A</code></li><li>过渡状态, <code>example.domain</code> 在<code>dns A</code>服务中重写到<code>A</code>和<code>B</code>, 在<code>dns B</code>服务中重写到<code>B</code></li><li>新服务状态, <code>example.domain</code> 解析到 IP 地址<code>B</code>, 移除 IP 地址<code>A</code></li></ol><p>当用户仍在使用<code>dns A</code>服务时, 可以获得两个地址, 有一半的概率会选择<code>dns A</code>服务.<br>另外一半的概率会切换到<code>dns B</code>服务, <code>dns B</code>服务故障时切换回<code>dns A</code>. <code>dns B</code>服务未故障时, 将只会获得一个地址, 因而用户会停留在<code>dns B</code>服务中.<br>这样我们可以逐步的减少<code>dns A</code>服务的资源消耗, 而不是直接停止, 实现更平滑的迁移.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-cd243ff5456a6d9d85c89b2ebbd970d5>测试工具</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> 测试工具</li></ul><h1 id=测试工具>测试工具</h1><ul><li>[<a href=%E7%B2%BE%E7%A1%AE%E5%8F%91%E5%8C%85-hping3 title=精确发包-hping3>精确发包-hping3</a>]</li><li>[<a href=/blog/2024/06/28/%E7%AE%80%E6%98%93server-client%E4%BB%A3%E7%A0%81/ title=简易server-client代码>简易server-client代码</a>]</li></ul></div><div class=td-content><h1 id=pg-42145e1849133da1bffe65d5ed26f5f5>简易server-client代码</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> 简易server-client代码</li></ul><h1 id=简易-server-client-代码-windows>简易 server-client 代码 windows</h1><h2 id=windows>Windows</h2><p><a href=https://docs.microsoft.com/en-us/windows/win32/winsock/complete-client-code>Complete Winsock Client Code</a>
<a href=https://docs.microsoft.com/en-us/windows/win32/winsock/complete-server-code>Complete Winsock Server Code</a></p><h2 id=linux>Linux</h2><p><a href=https://www.geeksforgeeks.org/socket-programming-cc/>Linux Socket Programming</a>
<a href=https://www.geeksforgeeks.org/simple-client-server-application-in-c/>Simple client/server application in C</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-66ec6e435a0d6143639b3a41c8ca7bd9>AI</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div></div><div class=td-content><h1 id=pg-252aa5b5694af19740a738128bf07d27>Copilot系列</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Copilot系列</li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="User mailing list" aria-label="User mailing list"><a target=_blank rel=noopener href=https://groups.google.com/forum/#!forum/jqknono aria-label="User mailing list"><i class=envelope></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/jqknono aria-label=Telegram><i class="fab fa-telegram"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/jqknono aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="User mailing list" aria-label="User mailing list"><a target=_blank rel=noopener href=https://groups.google.com/forum/#!forum/jqknono aria-label="User mailing list"><i class=envelope></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2015&ndash;2024
<span class=td-footer__authors>jqknono</span></span><span class=td-footer__all_rights_reserved>保留所有权利</span></div></div></div></footer></div><style>.markmap>svg{width:100%;height:300px}</style><script>window.markmap={autoLoader:{manual:!0,onReady(){const{autoLoader:e,builtInPlugins:t}=window.markmap;e.transformPlugins=t.filter(e=>e.name!=="prism")}}}</script><script src=https://cdn.jsdelivr.net/npm/markmap-autoloader></script><script src=/js/deflate.js></script><script src=/js/main.min.e5bf9790270b64e45f5b1b8bc98f9afd914460c3cefe6f98bf8c2010180f7de9.js integrity="sha256-5b+XkCcLZORfWxuLyY+a/ZFEYMPO/m+Yv4wgEBgPfek=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>