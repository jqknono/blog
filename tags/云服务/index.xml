<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>云服务 on Nono Blogs</title><link>https://blog.jqknono.com/tags/%E4%BA%91%E6%9C%8D%E5%8A%A1/</link><description>Recent content in 云服务 on Nono Blogs</description><generator>Hugo</generator><language>zh-cn</language><lastBuildDate>Fri, 25 Apr 2025 19:25:01 +0800</lastBuildDate><atom:link href="https://blog.jqknono.com/tags/%E4%BA%91%E6%9C%8D%E5%8A%A1/index.xml" rel="self" type="application/rss+xml"/><item><title>CNAME与TXT冲突导致证书申请问题</title><link>https://blog.jqknono.com/blog/2025/04/25/cname%E4%B8%8Etxt%E5%86%B2%E7%AA%81%E5%AF%BC%E8%87%B4%E8%AF%81%E4%B9%A6%E7%94%B3%E8%AF%B7%E9%97%AE%E9%A2%98/</link><pubDate>Fri, 25 Apr 2025 19:25:01 +0800</pubDate><guid>https://blog.jqknono.com/blog/2025/04/25/cname%E4%B8%8Etxt%E5%86%B2%E7%AA%81%E5%AF%BC%E8%87%B4%E8%AF%81%E4%B9%A6%E7%94%B3%E8%AF%B7%E9%97%AE%E9%A2%98/</guid><description>&lt;h2 id="相同前缀的-cname-与-txt-不能共存"&gt;相同前缀的 CNAME 与 TXT 不能共存&lt;/h2&gt;
&lt;p&gt;折腾过域名的可能知道(A,AAAA)记录不能与 CNAME 共存, 但未必碰到过 TXT 与 CNAME 冲突的情况.&lt;/p&gt;
&lt;p&gt;什么情况下 TXT 会与 CNAME 同时使用一个前缀?&lt;/p&gt;
&lt;p&gt;有一种场景, 就是在 LetsEncrypt 证书申请, 使用 &lt;em&gt;DNS-01&lt;/em&gt; 挑战来验证域名所有权时.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Certbot 会使用 ackey 和 acsecret 或者 token, 创建一条&lt;code&gt;_acme-challenge.example.com&lt;/code&gt; 的&lt;strong&gt;TXT 记录&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Letsencrypt 会查询 &lt;strong&gt;TXT 记录&lt;/strong&gt;, 确认申请方有权创建 DNS 记录, 证明有域名所有权.&lt;/li&gt;
&lt;li&gt;Letsencrypt 签发证书&lt;/li&gt;
&lt;li&gt;Certbot 清理&lt;code&gt;_acme-challenge.example.com&lt;/code&gt; 的&lt;strong&gt;TXT 记录&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;倘若创建&lt;strong&gt;TXT 记录&lt;/strong&gt;时, 已经有一条&lt;code&gt;_acme-challenge.example.com&lt;/code&gt; 的&lt;strong&gt;CNAME&lt;/strong&gt;记录, 则&lt;strong&gt;TXT&lt;/strong&gt;记录可能会创建失败, 导致域名挑战验证失败.&lt;/p&gt;
&lt;p&gt;为什么会出现&lt;code&gt;_acme-challenge&lt;/code&gt;.example.com 的&lt;strong&gt;CNAME&lt;/strong&gt;记录?&lt;/p&gt;
&lt;p&gt;阿里云新推出的 &lt;strong&gt;ESA&lt;/strong&gt; 边缘安全加速, 类似 cloudflare, 是原 DCDN 全站加速的改名增强版. 在早期使用时, 不支持自助申请泛域名, 我是使用脚本周期性将自己申请的泛域名证书传上去, 管理起来稍有不便. 后来出了&lt;strong&gt;托管 DCV&lt;/strong&gt;, 可以自助申请更新泛域名证书, 按照说明操作, 的确可以自助管理泛域名证书. 但埋下的隐患隔了数月才发现. 这个 CNAME 记录持续存在, 会导致不能创建相同前缀的 TXT 记录, 导致我不能在别处证明域名所有权.&lt;/p&gt;</description></item><item><title>释放vps的保留内存</title><link>https://blog.jqknono.com/blog/2024/12/31/%E9%87%8A%E6%94%BEvps%E7%9A%84%E4%BF%9D%E7%95%99%E5%86%85%E5%AD%98/</link><pubDate>Tue, 31 Dec 2024 16:07:11 +0800</pubDate><guid>https://blog.jqknono.com/blog/2024/12/31/%E9%87%8A%E6%94%BEvps%E7%9A%84%E4%BF%9D%E7%95%99%E5%86%85%E5%AD%98/</guid><description>&lt;p&gt;Linux 系统默认会保留一块内存用于&lt;code&gt;kdump&lt;/code&gt;，这块内存的大小可以通过&lt;code&gt;crashkernel&lt;/code&gt;参数来设置，许多应用开发者一般不会触发内核崩溃，可以通过修改&lt;code&gt;/etc/default/grub&lt;/code&gt;文件来释放出这块内存。&lt;/p&gt;
&lt;p&gt;如果不需要&lt;code&gt;kdump&lt;/code&gt;，可以将&lt;code&gt;crashkernel&lt;/code&gt;参数设置为&lt;code&gt;0M-1G:0M,1G-4G:0M,4G-128G:0M,128G-:512M&lt;/code&gt;，这样就可以释放出一块内存。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;查看方式&lt;/strong&gt;: &lt;code&gt;cat /etc/default/grub&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;默认值如下:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;GRUB_CMDLINE_LINUX=&amp;quot; vga=792 console=tty0 console=ttyS0,115200n8 net.ifnames=0 noibrs nvme_core.io_timeout=4294967295 nvme_core.admin_timeout=4294967295 iommu=pt crashkernel=0M-1G:0M,1G-4G:192M,4G-128G:384M,128G-:512M crash_kexec_post_notifiers=1&amp;quot;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;解释下&lt;code&gt;crashkernel&lt;/code&gt;字段其含义是, &lt;code&gt;0-1G&lt;/code&gt;内存的主机保留&lt;code&gt;0M&lt;/code&gt;内存, &lt;code&gt;1-4G&lt;/code&gt;内存的主机保留&lt;code&gt;192M&lt;/code&gt;内存, &lt;code&gt;4-128G&lt;/code&gt;内存的主机保留&lt;code&gt;384M&lt;/code&gt;内存, &lt;code&gt;128G&lt;/code&gt;以上的主机保留&lt;code&gt;512M&lt;/code&gt;内存.&lt;/p&gt;
&lt;p&gt;1G 内存的主机会向上划分到&lt;code&gt;1-4G&lt;/code&gt;档, 保留 &lt;code&gt;192MB&lt;/code&gt; 内存用于 kdump. 4G 内存的主机会向上划分到&lt;code&gt;4-128G&lt;/code&gt;档, 保留 &lt;code&gt;384MB&lt;/code&gt; 内存用于 kdump.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;修改方式&lt;/strong&gt;: &lt;code&gt;sudo sed -i 's/crashkernel=0M-1G:0M,1G-4G:192M,4G-128G:384M,128G-:512M/crashkernel=0M-1G:0M,1G-4G:0M,4G-128G:0M,128G-:512M/' /etc/default/grub&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;重启生效: &lt;code&gt;sudo update-grub &amp;amp;&amp;amp; sudo reboot&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;以新手学习常用的 2C1G 的 vps 为例，一个干净系统修改前后的内存空间如下, 可以看到 366MB 和 562MB 的区别还是挺大的.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# 修改前&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;root@iZj6c0otki9ho421eewyczZ:~# free
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; total used free shared buff/cache available
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Mem: &lt;span class="m"&gt;707180&lt;/span&gt; &lt;span class="m"&gt;340772&lt;/span&gt; &lt;span class="m"&gt;123400&lt;/span&gt; &lt;span class="m"&gt;2624&lt;/span&gt; &lt;span class="m"&gt;358872&lt;/span&gt; &lt;span class="m"&gt;366408&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Swap: &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# 修改后&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;root@iZj6c0otki9ho421eewyczZ:~# free
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; total used free shared buff/cache available
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Mem: &lt;span class="m"&gt;903788&lt;/span&gt; &lt;span class="m"&gt;341656&lt;/span&gt; &lt;span class="m"&gt;451380&lt;/span&gt; &lt;span class="m"&gt;2616&lt;/span&gt; &lt;span class="m"&gt;251032&lt;/span&gt; &lt;span class="m"&gt;562132&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;Swap: &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;2C4G 的 vps 修改前后的内存空间如下, 3.1GB 和 3.5GB 的区别.&lt;/p&gt;</description></item></channel></rss>