<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>云服务 on Nono Blogs</title><link>https://blog.jqknono.com/tags/%E4%BA%91%E6%9C%8D%E5%8A%A1/</link><description>Recent content in 云服务 on Nono Blogs</description><generator>Hugo</generator><language>zh-cn</language><lastBuildDate>Tue, 31 Dec 2024 16:07:11 +0800</lastBuildDate><atom:link href="https://blog.jqknono.com/tags/%E4%BA%91%E6%9C%8D%E5%8A%A1/index.xml" rel="self" type="application/rss+xml"/><item><title>释放vps的保留内存</title><link>https://blog.jqknono.com/blog/2024/12/31/%E9%87%8A%E6%94%BEvps%E7%9A%84%E4%BF%9D%E7%95%99%E5%86%85%E5%AD%98/</link><pubDate>Tue, 31 Dec 2024 16:07:11 +0800</pubDate><guid>https://blog.jqknono.com/blog/2024/12/31/%E9%87%8A%E6%94%BEvps%E7%9A%84%E4%BF%9D%E7%95%99%E5%86%85%E5%AD%98/</guid><description>&lt;p>Linux 系统默认会保留一块内存用于&lt;code>kdump&lt;/code>，这块内存的大小可以通过&lt;code>crashkernel&lt;/code>参数来设置，许多应用开发者一般不会触发内核崩溃，可以通过修改&lt;code>/etc/default/grub&lt;/code>文件来释放出这块内存。&lt;/p>
&lt;p>如果不需要&lt;code>kdump&lt;/code>，可以将&lt;code>crashkernel&lt;/code>参数设置为&lt;code>0M-1G:0M,1G-4G:0M,4G-128G:0M,128G-:512M&lt;/code>，这样就可以释放出一块内存。&lt;/p>
&lt;p>&lt;strong>查看方式&lt;/strong>: &lt;code>cat /etc/default/grub&lt;/code>&lt;/p>
&lt;p>默认值如下:&lt;/p>
&lt;blockquote>
&lt;p>GRUB_CMDLINE_LINUX=&amp;quot; vga=792 console=tty0 console=ttyS0,115200n8 net.ifnames=0 noibrs nvme_core.io_timeout=4294967295 nvme_core.admin_timeout=4294967295 iommu=pt crashkernel=0M-1G:0M,1G-4G:192M,4G-128G:384M,128G-:512M crash_kexec_post_notifiers=1&amp;quot;&lt;/p>
&lt;/blockquote>
&lt;p>解释下&lt;code>crashkernel&lt;/code>字段其含义是, &lt;code>0-1G&lt;/code>内存的主机保留&lt;code>0M&lt;/code>内存, &lt;code>1-4G&lt;/code>内存的主机保留&lt;code>192M&lt;/code>内存, &lt;code>4-128G&lt;/code>内存的主机保留&lt;code>384M&lt;/code>内存, &lt;code>128G&lt;/code>以上的主机保留&lt;code>512M&lt;/code>内存.&lt;/p>
&lt;p>1G 内存的主机会向上划分到&lt;code>1-4G&lt;/code>档, 保留 &lt;code>192MB&lt;/code> 内存用于 kdump. 4G 内存的主机会向上划分到&lt;code>4-128G&lt;/code>档, 保留 &lt;code>384MB&lt;/code> 内存用于 kdump.&lt;/p>
&lt;p>&lt;strong>修改方式&lt;/strong>: &lt;code>sudo sed -i 's/crashkernel=0M-1G:0M,1G-4G:192M,4G-128G:384M,128G-:512M/crashkernel=0M-1G:0M,1G-4G:0M,4G-128G:0M,128G-:512M/' /etc/default/grub&lt;/code>&lt;/p>
&lt;p>重启生效: &lt;code>sudo update-grub &amp;amp;&amp;amp; sudo reboot&lt;/code>&lt;/p>
&lt;p>以新手学习常用的 2C1G 的 vps 为例，一个干净系统修改前后的内存空间如下, 可以看到 366MB 和 562MB 的区别还是挺大的.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 修改前&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@iZj6c0otki9ho421eewyczZ:~# free
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> total used free shared buff/cache available
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Mem: &lt;span class="m">707180&lt;/span> &lt;span class="m">340772&lt;/span> &lt;span class="m">123400&lt;/span> &lt;span class="m">2624&lt;/span> &lt;span class="m">358872&lt;/span> &lt;span class="m">366408&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Swap: &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 修改后&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@iZj6c0otki9ho421eewyczZ:~# free
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> total used free shared buff/cache available
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Mem: &lt;span class="m">903788&lt;/span> &lt;span class="m">341656&lt;/span> &lt;span class="m">451380&lt;/span> &lt;span class="m">2616&lt;/span> &lt;span class="m">251032&lt;/span> &lt;span class="m">562132&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Swap: &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>2C4G 的 vps 修改前后的内存空间如下, 3.1GB 和 3.5GB 的区别.&lt;/p></description></item></channel></rss>