<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=ar-sa class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>jqknono Blogs</title><meta name=description content="--- layout: blog title: كيفية الاحتفاظ بعنوان IP المصدر للطلب بعد توازن الحمل في مجموعة K8s categories: الشبكات tags: [الشبكات, blog] date: 2024-05-27 11:52:22 +0800 draft: false toc: false comments: true --- المقدمة نشر التطبيقات ليس دائمًا مجرد التثبيت والتشغيل البسيطين، بل أحيانًا يتطلب أيضًا النظر في مشكلات الشبكة. سيقدم هذا المقال كيفية جعل الخدمة في مجموعة k8s قادرة على الحصول على عنوان IP المصدر للطلب.
تعتمد الخدمات التي تقدمها التطبيقات عادةً على معلومات الإدخال، وإذا لم تعتمد معلومات الإدخال على الخماسي (IP المصدر، المنفذ المصدر، IP الوجهة، منفذ الوجهة، البروتوكول)، فإن هذه الخدمة تكون منخفضة الاقتران بالشبكة، ولا تحتاج إلى الاهتمام بتفاصيل الشبكة."><meta property="og:url" content="https://blog.jqknono.com/ar-sa/blog/1/01/01/"><meta property="og:site_name" content="jqknono Blogs"><meta property="og:title" content="jqknono Blogs"><meta property="og:description" content="--- layout: blog title: كيفية الاحتفاظ بعنوان IP المصدر للطلب بعد توازن الحمل في مجموعة K8s categories: الشبكات tags: [الشبكات, blog] date: 2024-05-27 11:52:22 +0800 draft: false toc: false comments: true --- المقدمة نشر التطبيقات ليس دائمًا مجرد التثبيت والتشغيل البسيطين، بل أحيانًا يتطلب أيضًا النظر في مشكلات الشبكة. سيقدم هذا المقال كيفية جعل الخدمة في مجموعة k8s قادرة على الحصول على عنوان IP المصدر للطلب.
تعتمد الخدمات التي تقدمها التطبيقات عادةً على معلومات الإدخال، وإذا لم تعتمد معلومات الإدخال على الخماسي (IP المصدر، المنفذ المصدر، IP الوجهة، منفذ الوجهة، البروتوكول)، فإن هذه الخدمة تكون منخفضة الاقتران بالشبكة، ولا تحتاج إلى الاهتمام بتفاصيل الشبكة."><meta property="og:locale" content="ar_sa"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta itemprop=name content="jqknono Blogs"><meta itemprop=description content="--- layout: blog title: كيفية الاحتفاظ بعنوان IP المصدر للطلب بعد توازن الحمل في مجموعة K8s categories: الشبكات tags: [الشبكات, blog] date: 2024-05-27 11:52:22 +0800 draft: false toc: false comments: true --- المقدمة نشر التطبيقات ليس دائمًا مجرد التثبيت والتشغيل البسيطين، بل أحيانًا يتطلب أيضًا النظر في مشكلات الشبكة. سيقدم هذا المقال كيفية جعل الخدمة في مجموعة k8s قادرة على الحصول على عنوان IP المصدر للطلب.
تعتمد الخدمات التي تقدمها التطبيقات عادةً على معلومات الإدخال، وإذا لم تعتمد معلومات الإدخال على الخماسي (IP المصدر، المنفذ المصدر، IP الوجهة، منفذ الوجهة، البروتوكول)، فإن هذه الخدمة تكون منخفضة الاقتران بالشبكة، ولا تحتاج إلى الاهتمام بتفاصيل الشبكة."><meta itemprop=wordCount content="1550"><meta name=twitter:card content="summary"><meta name=twitter:title content="jqknono Blogs"><meta name=twitter:description content="--- layout: blog title: كيفية الاحتفاظ بعنوان IP المصدر للطلب بعد توازن الحمل في مجموعة K8s categories: الشبكات tags: [الشبكات, blog] date: 2024-05-27 11:52:22 +0800 draft: false toc: false comments: true --- المقدمة نشر التطبيقات ليس دائمًا مجرد التثبيت والتشغيل البسيطين، بل أحيانًا يتطلب أيضًا النظر في مشكلات الشبكة. سيقدم هذا المقال كيفية جعل الخدمة في مجموعة k8s قادرة على الحصول على عنوان IP المصدر للطلب.
تعتمد الخدمات التي تقدمها التطبيقات عادةً على معلومات الإدخال، وإذا لم تعتمد معلومات الإدخال على الخماسي (IP المصدر، المنفذ المصدر، IP الوجهة، منفذ الوجهة، البروتوكول)، فإن هذه الخدمة تكون منخفضة الاقتران بالشبكة، ولا تحتاج إلى الاهتمام بتفاصيل الشبكة."><link rel=preload href=/scss/main.min.60df7671ee6b2972895a8681f1472cd10b162590a6365c232c909547e1d5e027.css as=style integrity="sha256-YN92ce5rKXKJWoaB8Ucs0QsWJZCmNlwjLJCVR+HV4Cc=" crossorigin=anonymous><link href=/scss/main.min.60df7671ee6b2972895a8681f1472cd10b162590a6365c232c909547e1d5e027.css rel=stylesheet integrity="sha256-YN92ce5rKXKJWoaB8Ucs0QsWJZCmNlwjLJCVR+HV4Cc=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-F3FFTG72NE"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F3FFTG72NE")}</script></head><body class="td-page td-blog"><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/ar-sa/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>jqknono Blogs</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://jqknono.com target=_blank rel=noopener><span>About</span><sup><i class="ps-1 fa-solid fa-up-right-from-square fa-xs" aria-hidden=true></i></sup></a></li><li class=nav-item><a class=nav-link href=https://github.com/jqknono target=_blank rel=noopener><i class="fab fa-github" aria-hidden=true></i><span>GitHub</span><sup><i class="ps-1 fa-solid fa-up-right-from-square fa-xs" aria-hidden=true></i></sup></a></li><li class="nav-item td-navbar__lang-menu"><div class="td-lang-menu dropdown"><a class="nav-link dropdown-toggle td-lang-menu__title" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><span class=td-lang-menu__title-text>العربية</span>
<span class=td-lang-menu__title-code>AR-SA</span></a><ul class=dropdown-menu><li><a class=dropdown-item href=/blog/2024/05/27/how-to-preserve-the-source-ip-of-requests-after-load-balancing-in-a-k8s-cluster/>English</a></li><li><a class=dropdown-item href=/zh-tw/blog/2024/05/27/k8s%E5%8F%A2%E9%9B%86%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BF%9D%E7%95%99%E8%B2%A0%E8%BC%89%E5%9D%87%E8%A1%A1%E5%BE%8C%E7%9A%84%E8%AB%8B%E6%B1%82%E6%BA%90ip/>繁體中文</a></li><li><a class=dropdown-item href=/ja-jp/blog/1/01/01/>日本語</a></li><li><a class=dropdown-item href=/ko-kr/blog/2024/05/27/k8s-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0%EC%97%90%EC%84%9C-%EB%A1%9C%EB%93%9C-%EB%B0%B8%EB%9F%B0%EC%8B%B1-%ED%9B%84-%EC%9A%94%EC%B2%AD-%EC%9B%90%EB%B3%B8-ip%EB%A5%BC-%EB%B3%B4%EC%A1%B4%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95/>한국어</a></li><li><span class="dropdown-item active">العربية</span></li><li><a class=dropdown-item href=/de-de/blog/2024/05/27/wie-beh%C3%A4lt-man-in-einem-k8s-cluster-die-quell-ip-der-anfragen-nach-der-lastverteilung-bei/>Deutsch</a></li><li><a class=dropdown-item href=/fr-fr/blog/2024/05/27/comment-conserver-lip-source-des-requ%C3%AAtes-apr%C3%A8s-%C3%A9quilibrage-de-charge-dans-un-cluster-k8s/>Français</a></li><li><a class=dropdown-item href=/hi-in/blog/2024/05/27/k8s-%E0%A4%95%E0%A5%8D%E0%A4%B2%E0%A4%B8%E0%A5%8D%E0%A4%9F%E0%A4%B0-%E0%A4%AE%E0%A5%87%E0%A4%82-%E0%A4%B2%E0%A5%8B%E0%A4%A1-%E0%A4%AC%E0%A5%88%E0%A4%B2%E0%A5%87%E0%A4%82%E0%A4%B8%E0%A4%B0-%E0%A4%95%E0%A5%87-%E0%A4%AC%E0%A4%BE%E0%A4%A6-%E0%A4%95%E0%A5%87-%E0%A4%85%E0%A4%A8%E0%A5%81%E0%A4%B0%E0%A5%8B%E0%A4%A7-%E0%A4%B8%E0%A5%8D%E0%A4%B0%E0%A5%8B%E0%A4%A4-ip-%E0%A4%95%E0%A5%8B-%E0%A4%95%E0%A5%88%E0%A4%B8%E0%A5%87-%E0%A4%AC%E0%A4%A8%E0%A4%BE%E0%A4%8F-%E0%A4%B0%E0%A4%96%E0%A5%87%E0%A4%82/>हिंदी</a></li><li><a class=dropdown-item href=/es-es/blog/2024/05/27/c%C3%B3mo-conservar-la-ip-de-origen-de-las-solicitudes-despu%C3%A9s-de-la-equilibraci%C3%B3n-de-carga-en-un-cl%C3%BAster-de-k8s/>Español</a></li><li><a class=dropdown-item href=/pt-br/blog/2024/05/27/como-preservar-o-ip-de-origem-da-solicita%C3%A7%C3%A3o-ap%C3%B3s-o-balanceamento-de-carga-em-um-cluster-k8s/>Português</a></li><li><a class=dropdown-item href=/ru-ru/blog/2024/05/27/%D0%BA%D0%B0%D0%BA-%D1%81%D0%BE%D1%85%D1%80%D0%B0%D0%BD%D0%B8%D1%82%D1%8C-%D0%B8%D1%81%D1%85%D0%BE%D0%B4%D0%BD%D1%8B%D0%B9-ip-%D0%B0%D0%B4%D1%80%D0%B5%D1%81-%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81%D0%B0-%D0%BF%D0%BE%D1%81%D0%BB%D0%B5-%D0%B1%D0%B0%D0%BB%D0%B0%D0%BD%D1%81%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B8-%D0%B2-%D0%BA%D0%BB%D0%B0%D1%81%D1%82%D0%B5%D1%80%D0%B5-k8s/>Русский</a></li><li><a class=dropdown-item href=/it-it/blog/2024/05/27/come-preservare-lip-sorgente-delle-richieste-dopo-il-bilanciamento-del-carico-in-un-cluster-k8s/>Italiano</a></li><li><span class="dropdown-item disabled">Bahasa Indonesia</span></li><li><a class=dropdown-item href=/tr-tr/blog/2024/05/27/k8s-k%C3%BCmesinde-y%C3%BCk-dengeleme-sonras%C4%B1-istek-kaynak-ipsini-nas%C4%B1l-koruyabiliriz/>Türkçe</a></li><li><a class=dropdown-item href=/nl-nl/blog/2024/05/27/hoe-behoud-je-het-bron-ip-van-verzoeken-na-load-balancing-in-een-k8s-cluster/>Nederlands</a></li><li><a class=dropdown-item href=/pl-pl/blog/2024/05/27/jak-zachowa%C4%87-oryginalny-ip-%C5%BAr%C3%B3d%C5%82a-%C5%BC%C4%85dania-po-r%C3%B3wnowa%C5%BCeniu-obci%C4%85%C5%BCenia-w-klastrze-k8s/>Polski</a></li><li><a class=dropdown-item href=/ar-ae/blog/1/01/01/>العربية</a></li><li><a class=dropdown-item href=/zh-cn/blog/2024/05/27/k8s%E9%9B%86%E7%BE%A4%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BF%9D%E7%95%99%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%90%8E%E7%9A%84%E8%AF%B7%E6%B1%82%E6%BA%90ip/>简体中文</a></li></ul></div></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="ابحث في هذا الموقع…" aria-label="ابحث في هذا الموقع…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.600675b7c98def8c056bf61c0c50f4f5.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main data-bs-spy=scroll data-bs-target=.td-toc data-bs-root-margin="0px 0px -10%"><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="ابحث في هذا الموقع…" aria-label="ابحث في هذا الموقع…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.600675b7c98def8c056bf61c0c50f4f5.json data-offline-search-base-href=/ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="td-sidebar-nav collapse td-sidebar-nav--search-disabled foldable-nav" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-ar-sablog-li><a href=/ar-sa/blog/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-ar-sablog><span>Blogs</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-ar-sablog20230506d985d8b4d983d984d8a9-ipv6-d8a3d8abd986d8a7d8a1-d8a7d984d8acd8b3d8b1-d981d98a-windows-li><input type=checkbox id=m-ar-sablog20230506d985d8b4d983d984d8a9-ipv6-d8a3d8abd986d8a7d8a1-d8a7d984d8acd8b3d8b1-d981d98a-windows-check>
<label for=m-ar-sablog20230506d985d8b4d983d984d8a9-ipv6-d8a3d8abd986d8a7d8a1-d8a7d984d8acd8b3d8b1-d981d98a-windows-check><a href=/ar-sa/blog/2023/05/06/%D9%85%D8%B4%D9%83%D9%84%D8%A9-ipv6-%D8%A3%D8%AB%D9%86%D8%A7%D8%A1-%D8%A7%D9%84%D8%AC%D8%B3%D8%B1-%D9%81%D9%8A-windows/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-ar-sablog20230506d985d8b4d983d984d8a9-ipv6-d8a3d8abd986d8a7d8a1-d8a7d984d8acd8b3d8b1-d981d98a-windows><span>مشكلة IPv6 أثناء الجسر في Windows</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-ar-sablog20240527instalasi-dan-aktivasi-sistem-windows-li><input type=checkbox id=m-ar-sablog20240527instalasi-dan-aktivasi-sistem-windows-check>
<label for=m-ar-sablog20240527instalasi-dan-aktivasi-sistem-windows-check><a href=/ar-sa/blog/2024/05/27/instalasi-dan-aktivasi-sistem-windows/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-ar-sablog20240527instalasi-dan-aktivasi-sistem-windows><span>Instalasi dan Aktivasi Sistem Windows</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-ar-sablog20240520d8aad982d8b1d98ad8b1-d8acd8afd98ad8af-d984d984d985d8a8d8aad8afd8a6d98ad986-d981d98a-d8a7d984d8a3d982d984d98ad8a9-li><input type=checkbox id=m-ar-sablog20240520d8aad982d8b1d98ad8b1-d8acd8afd98ad8af-d984d984d985d8a8d8aad8afd8a6d98ad986-d981d98a-d8a7d984d8a3d982d984d98ad8a9-check>
<label for=m-ar-sablog20240520d8aad982d8b1d98ad8b1-d8acd8afd98ad8af-d984d984d985d8a8d8aad8afd8a6d98ad986-d981d98a-d8a7d984d8a3d982d984d98ad8a9-check><a href=/ar-sa/blog/2024/05/20/%D8%AA%D9%82%D8%B1%D9%8A%D8%B1-%D8%AC%D8%AF%D9%8A%D8%AF-%D9%84%D9%84%D9%85%D8%A8%D8%AA%D8%AF%D8%A6%D9%8A%D9%86-%D9%81%D9%8A-%D8%A7%D9%84%D8%A3%D9%82%D9%84%D9%8A%D8%A9/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-ar-sablog20240520d8aad982d8b1d98ad8b1-d8acd8afd98ad8af-d984d984d985d8a8d8aad8afd8a6d98ad986-d981d98a-d8a7d984d8a3d982d984d98ad8a9><span>تقرير جديد للمبتدئين في الأقلية</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-ar-sablog20240509d8a7d984d8aad988d8b5d98ad8a7d8aa-d8a7d984d8b4d8aed8b5d98ad8a9-d8a3d8afd8a7d8a9-d8aad8b3d987d98ad984-d8a3d985-d981d8ae-d985d8b9d8b1d981d98a-li><input type=checkbox id=m-ar-sablog20240509d8a7d984d8aad988d8b5d98ad8a7d8aa-d8a7d984d8b4d8aed8b5d98ad8a9-d8a3d8afd8a7d8a9-d8aad8b3d987d98ad984-d8a3d985-d981d8ae-d985d8b9d8b1d981d98a-check>
<label for=m-ar-sablog20240509d8a7d984d8aad988d8b5d98ad8a7d8aa-d8a7d984d8b4d8aed8b5d98ad8a9-d8a3d8afd8a7d8a9-d8aad8b3d987d98ad984-d8a3d985-d981d8ae-d985d8b9d8b1d981d98a-check><a href=/ar-sa/blog/2024/05/09/%D8%A7%D9%84%D8%AA%D9%88%D8%B5%D9%8A%D8%A7%D8%AA-%D8%A7%D9%84%D8%B4%D8%AE%D8%B5%D9%8A%D8%A9-%D8%A3%D8%AF%D8%A7%D8%A9-%D8%AA%D8%B3%D9%87%D9%8A%D9%84-%D8%A3%D9%85-%D9%81%D8%AE-%D9%85%D8%B9%D8%B1%D9%81%D9%8A/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-ar-sablog20240509d8a7d984d8aad988d8b5d98ad8a7d8aa-d8a7d984d8b4d8aed8b5d98ad8a9-d8a3d8afd8a7d8a9-d8aad8b3d987d98ad984-d8a3d985-d981d8ae-d985d8b9d8b1d981d98a><span>التوصيات الشخصية: أداة تسهيل أم فخ معرفي؟</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-ar-sablog20240509d8aad8acd8b1d8a8d8a9-d8a7d984d983d8aad8a7d8a8d8a9-d981d98a-d985d8acd8aad985d8b9-d985d8b7d988d8b1d98a-d8aad98ad986d8b3d986d8aa-d983d984d8a7d988d8af-li><input type=checkbox id=m-ar-sablog20240509d8aad8acd8b1d8a8d8a9-d8a7d984d983d8aad8a7d8a8d8a9-d981d98a-d985d8acd8aad985d8b9-d985d8b7d988d8b1d98a-d8aad98ad986d8b3d986d8aa-d983d984d8a7d988d8af-check>
<label for=m-ar-sablog20240509d8aad8acd8b1d8a8d8a9-d8a7d984d983d8aad8a7d8a8d8a9-d981d98a-d985d8acd8aad985d8b9-d985d8b7d988d8b1d98a-d8aad98ad986d8b3d986d8aa-d983d984d8a7d988d8af-check><a href=/ar-sa/blog/2024/05/09/%D8%AA%D8%AC%D8%B1%D8%A8%D8%A9-%D8%A7%D9%84%D9%83%D8%AA%D8%A7%D8%A8%D8%A9-%D9%81%D9%8A-%D9%85%D8%AC%D8%AA%D9%85%D8%B9-%D9%85%D8%B7%D9%88%D8%B1%D9%8A-%D8%AA%D9%8A%D9%86%D8%B3%D9%86%D8%AA-%D9%83%D9%84%D8%A7%D9%88%D8%AF/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-ar-sablog20240509d8aad8acd8b1d8a8d8a9-d8a7d984d983d8aad8a7d8a8d8a9-d981d98a-d985d8acd8aad985d8b9-d985d8b7d988d8b1d98a-d8aad98ad986d8b3d986d8aa-d983d984d8a7d988d8af><span>تجربة الكتابة في مجتمع مطوري تينسنت كلاود</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-ar-sablog10101-li><input type=checkbox id=m-ar-sablog10101-check checked>
<label for=m-ar-sablog10101-check><a href=/ar-sa/blog/1/01/01/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-ar-sablog10101><span class=td-sidebar-nav-active-item></span></a></label></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"></div><div class=td-toc data-proofer-ignore><div class=td-toc-title><span class=td-toc-title__text></span>
<a class=td-toc-title__link title href=#></a></div><nav id=TableOfContents><ul><li><a href=#المقدمة>المقدمة</a></li><li><a href=#لماذا-تفقد-معلومات-ip-المصدر>لماذا تفقد معلومات IP المصدر؟</a></li><li><a href=#كيفية-الاحتفاظ-بـ-ip-المصدر>كيفية الاحتفاظ بـ IP المصدر؟</a></li><li><a href=#دليل-عمليات-k8s>دليل عمليات K8S</a><ul><li><a href=#إنشاء-deployment>إنشاء Deployment</a></li><li><a href=#إنشاء-service>إنشاء Service</a></li><li><a href=#إنشاء-ingress>إنشاء Ingress</a></li></ul></li><li><a href=#الخلاصة>الخلاصة</a></li><li><a href=#المراجع>المراجع</a></li></ul></nav></div><div class="taxonomy taxonomy-terms-cloud taxo-tags"><h5 class=taxonomy-title>Taxonomy Cloud</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://blog.jqknono.com/ar-sa/tags/blog/ data-taxonomy-term=blog><span class=taxonomy-label>Blog</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/ar-sa/tags/tidak-dikategorikan/ data-taxonomy-term=tidak-dikategorikan><span class=taxonomy-label>Tidak Dikategorikan</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/ar-sa/tags/%D8%A7%D9%84%D9%85%D9%86%D8%A7%D9%81%D8%B3%D8%A9/ data-taxonomy-term=%D8%A7%D9%84%D9%85%D9%86%D8%A7%D9%81%D8%B3%D8%A9><span class=taxonomy-label>المنافسة</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/ar-sa/tags/%D8%AA%D9%82%D9%8A%D9%8A%D9%85/ data-taxonomy-term=%D8%AA%D9%82%D9%8A%D9%8A%D9%85><span class=taxonomy-label>تقييم</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/ar-sa/tags/%D8%AF%D8%B1%D9%88%D8%B3/ data-taxonomy-term=%D8%AF%D8%B1%D9%88%D8%B3><span class=taxonomy-label>دروس</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/ar-sa/tags/%D8%BA%D9%8A%D8%B1-%D9%85%D8%B5%D9%86%D9%81/ data-taxonomy-term=%D8%BA%D9%8A%D8%B1-%D9%85%D8%B5%D9%86%D9%81><span class=taxonomy-label>غير مصنف</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/ar-sa/tags/%D9%85%D8%B4%D9%83%D9%84%D8%A7%D8%AA-%D9%85%D8%B9%D9%82%D8%AF%D8%A9-%D9%85%D8%AA%D9%86%D9%88%D8%B9%D8%A9/ data-taxonomy-term=%D9%85%D8%B4%D9%83%D9%84%D8%A7%D8%AA-%D9%85%D8%B9%D9%82%D8%AF%D8%A9-%D9%85%D8%AA%D9%86%D9%88%D8%B9%D8%A9><span class=taxonomy-label>مشكلات معقدة متنوعة</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/ar-sa/tags/%D9%85%D9%86%D8%B5%D8%A9-%D8%A7%D9%84%D9%85%D9%86%D8%B4%D8%A6%D9%8A%D9%86/ data-taxonomy-term=%D9%85%D9%86%D8%B5%D8%A9-%D8%A7%D9%84%D9%85%D9%86%D8%B4%D8%A6%D9%8A%D9%86><span class=taxonomy-label>منصة المنشئين</span><span class=taxonomy-count>1</span></a></li></ul></div><div class="taxonomy taxonomy-terms-cloud taxo-categories"><h5 class=taxonomy-title>Categories</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://blog.jqknono.com/ar-sa/categories/tidak-dikategorikan/ data-taxonomy-term=tidak-dikategorikan><span class=taxonomy-label>Tidak Dikategorikan</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/ar-sa/categories/%D8%A7%D9%84%D9%85%D9%86%D8%A7%D9%81%D8%B3%D8%A9/ data-taxonomy-term=%D8%A7%D9%84%D9%85%D9%86%D8%A7%D9%81%D8%B3%D8%A9><span class=taxonomy-label>المنافسة</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/ar-sa/categories/%D8%AA%D9%82%D9%8A%D9%8A%D9%85/ data-taxonomy-term=%D8%AA%D9%82%D9%8A%D9%8A%D9%85><span class=taxonomy-label>تقييم</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/ar-sa/categories/%D8%AF%D8%B1%D9%88%D8%B3/ data-taxonomy-term=%D8%AF%D8%B1%D9%88%D8%B3><span class=taxonomy-label>دروس</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/ar-sa/categories/%D8%BA%D9%8A%D8%B1-%D9%85%D8%B5%D9%86%D9%81/ data-taxonomy-term=%D8%BA%D9%8A%D8%B1-%D9%85%D8%B5%D9%86%D9%81><span class=taxonomy-label>غير مصنف</span><span class=taxonomy-count>1</span></a></li></ul></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><a class=td-rss-button title=RSS href=/ar-sa/blog/index.xml target=_blank rel=noopener><i class="fa-solid fa-rss" aria-hidden=true></i></a><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/ar-sa/blog/>Blogs</a></li><li class="breadcrumb-item active" aria-current=page></li></ol></nav><div class=td-content><h1></h1><div class="td-byline mb-4"><time datetime=0001-01-01 class=text-body-secondary>Monday, January 01, 0001</time></div><header class=article-meta></header><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>layout</span><span class=p>:</span><span class=w> </span><span class=l>blog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>title</span><span class=p>:</span><span class=w> </span><span class=l>كيفية الاحتفاظ بعنوان IP المصدر للطلب بعد توازن الحمل في مجموعة K8s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>categories</span><span class=p>:</span><span class=w> </span><span class=l>الشبكات</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>الشبكات, blog]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>date</span><span class=p>:</span><span class=w> </span><span class=ld>2024-05-27 11:52:22 +0800</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>draft</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>toc</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>comments</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span></code></pre></div><h2 id=المقدمة>المقدمة</h2><p><strong>نشر التطبيقات</strong> ليس دائمًا مجرد <strong>التثبيت</strong> و<strong>التشغيل</strong> البسيطين، بل أحيانًا يتطلب أيضًا النظر في <strong>مشكلات الشبكة</strong>. سيقدم هذا المقال كيفية جعل الخدمة في <strong>مجموعة k8s</strong> قادرة على الحصول على <strong>عنوان IP المصدر</strong> للطلب.</p><p>تعتمد الخدمات التي تقدمها التطبيقات عادةً على معلومات الإدخال، وإذا لم تعتمد معلومات الإدخال على <strong>الخماسي</strong> (IP المصدر، المنفذ المصدر، IP الوجهة، منفذ الوجهة، البروتوكول)، فإن هذه الخدمة تكون <strong>منخفضة الاقتران بالشبكة</strong>، ولا تحتاج إلى الاهتمام بتفاصيل الشبكة.</p><p>لذلك، بالنسبة لمعظم الناس، لا حاجة لقراءة هذا المقال، إذا كنت مهتمًا بالشبكة، أو ترغب في توسيع آفاقك قليلاً، يمكنك الاستمرار في القراءة لفهم المزيد من سيناريوهات الخدمة.</p><p>يستند هذا المقال إلى k8s <code>v1.29.4</code>، ويختلط جزء من الوصف بين pod وendpoint، وفي سيناريو هذا المقال يمكن اعتبارهما متساويين.</p><p><strong>إذا كان هناك خطأ، مرحبًا بالتصحيح، وسأقوم بالتصحيح في أقرب وقت.</strong></p><h2 id=لماذا-تفقد-معلومات-ip-المصدر>لماذا تفقد معلومات IP المصدر؟</h2><p>نحدد أولاً ما هو IP المصدر، عندما يرسل A طلبًا إلى B، ويقوم B بتوجيه الطلب إلى C، على الرغم من أن IP المصدر الذي يراه C في بروتوكول IP هو IP الخاص بـ B، إلا أن هذا المقال يعتبر <strong>IP الخاص بـ A</strong> كـ IP المصدر.</p><p>هناك سلوكيان رئيسيان يؤديان إلى فقدان معلومات المصدر:</p><ol><li><strong>ترجمة عنوان الشبكة (NAT)</strong>، الغرض منه توفير IPv4 العامة، توازن الحمل إلخ. سيؤدي ذلك إلى رؤية الخادم لـ IP المصدر كـ <strong>IP جهاز NAT</strong>، وليس IP المصدر الحقيقي.</li><li><strong>الوكيل (Proxy)</strong>، <strong>الوكيل العكسي</strong> (RP، Reverse Proxy) و<strong>توازن الحمل</strong> (LB، Load Balancer) كلها تنتمي إلى هذه الفئة، ويُشار إليها جميعًا أدناه بـ <strong>خوادم الوكيل</strong>. هذه الخدمات الوكيل ستُعيد توجيه الطلب إلى الخدمة الخلفية، لكنها ستستبدل IP المصدر بـ IP الخاص بها.</li></ol><ul><li>NAT ببساطة هو <strong>استبدال مساحة المنافذ بمساحة IP</strong>، عناوين IPv4 محدودة، يمكن لعنوان IP واحد رسم 65535 منفذًا، وفي معظم الحالات لا تُستخدم هذه المنافذ بالكامل، لذا يمكن لعدة عناوين IP للشبكات الفرعية مشاركة عنوان IP عام واحد، وتمييز الخدمات المختلفة عبر المنافذ. شكل استخدامه: <code>public IP:public port -> private IP_1:private port</code>، للمزيد من المحتوى يرجى الرجوع إلى <a href="https://www.google.com/search?q=%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2">ترجمة عنوان الشبكة</a></li><li>خدمات الوكيل هي لأغراض <strong>الإخفاء أو التعريض</strong>، ستُعيد خدمات الوكيل توجيه الطلب إلى الخدمة الخلفية، وفي الوقت نفسه تستبدل IP المصدر بـ IP الخاص بها، لإخفاء IP الحقيقي للخدمة الخلفية، وحماية أمان الخدمة الخلفية. شكل استخدام خدمات الوكيل: <code>client IP -> proxy IP -> server IP</code>، للمزيد من المحتوى يرجى الرجوع إلى <a href="https://www.google.com/search?q=%E4%BB%A3%E7%90%86">الوكيل</a></li></ul><p><strong>NAT</strong> و<strong>خوادم الوكيل</strong> شائعة جدًا، ومعظم الخدمات لا تستطيع الحصول على IP المصدر للطلب.</p><p><em>هذان الطريقان الشائعان لتعديل IP المصدر، إذا كان هناك آخرى مرحبًا بالإضافة.</em></p><h2 id=كيفية-الاحتفاظ-بـ-ip-المصدر>كيفية الاحتفاظ بـ IP المصدر؟</h2><p>فيما يلي مثال على <code>طلب HTTP</code>:</p><table><thead><tr><th>الحقل</th><th>الطول (بايت)</th><th>إزاحة البت</th><th>الوصف</th></tr></thead><tbody><tr><td><strong>رأس IP</strong></td><td></td><td></td><td></td></tr><tr><td><code>IP المصدر</code></td><td>4</td><td>0-31</td><td>عنوان IP للمرسل</td></tr><tr><td>IP الوجهة</td><td>4</td><td>32-63</td><td>عنوان IP للمستقبل</td></tr><tr><td><strong>رأس TCP</strong></td><td></td><td></td><td></td></tr><tr><td>المنفذ المصدر</td><td>2</td><td>0-15</td><td>رقم المنفذ المرسل</td></tr><tr><td>منفذ الوجهة</td><td>2</td><td>16-31</td><td>رقم منفذ الوجهة</td></tr><tr><td>رقم التسلسل</td><td>4</td><td>32-63</td><td>لتحديد تدفق البايتات المرسلة من المرسل</td></tr><tr><td>رقم التأكيد</td><td>4</td><td>64-95</td><td>إذا تم تعيين علامة ACK، فهو رقم التسلسل المتوقع التالي</td></tr><tr><td>إزاحة البيانات</td><td>4</td><td>96-103</td><td>عدد البايتات لموقع بداية البيانات بالنسبة لرأس TCP</td></tr><tr><td>المحفوظ</td><td>4</td><td>104-111</td><td>حقل محفوظ، غير مستخدم، يُعيَّن إلى 0</td></tr><tr><td>علامات التحكم</td><td>2</td><td>112-127</td><td>علامات التحكم المختلفة مثل SYN، ACK، FIN إلخ</td></tr><tr><td>حجم النافذة</td><td>2</td><td>128-143</td><td>كمية البيانات التي يمكن للمستقبل استقبالها</td></tr><tr><td>مجموع التحقق</td><td>2</td><td>144-159</td><td>للكشف عن أخطاء في البيانات أثناء النقل</td></tr><tr><td>مؤشر الطوارئ</td><td>2</td><td>160-175</td><td>موقع بيانات الطوارئ التي يرغب المرسل في معالجتها بسرعة من قبل المستقبل</td></tr><tr><td>الخيارات</td><td>متغير</td><td>176-&mldr;</td><td>قد تشمل طوابع الوقت، أقصى طول الرسالة إلخ</td></tr><tr><td><strong>رأس HTTP</strong></td><td></td><td></td><td></td></tr><tr><td>سطر الطلب</td><td>متغير</td><td>&mldr;-&mldr;</td><td>يشمل طريقة الطلب، URI وإصدار HTTP</td></tr><tr><td><code>حقول الرأس</code></td><td>متغير</td><td>&mldr;-&mldr;</td><td>تحتوي على حقول الرأس المختلفة مثل Host، User-Agent إلخ</td></tr><tr><td>السطر الفارغ</td><td>2</td><td>&mldr;-&mldr;</td><td>لفصل الرأس عن الجسم</td></tr><tr><td>الجسم</td><td>متغير</td><td>&mldr;-&mldr;</td><td>نص الطلب أو الرد اختياري</td></tr></tbody></table><p>عند تصفح هيكل طلب HTTP أعلاه، يمكن ملاحظة أن <strong>خيارات TCP</strong>، <strong>سطر الطلب</strong>، <strong>حقول الرأس</strong>، <strong>الجسم</strong> قابلة للتغيير، حيث <strong>مساحة خيارات TCP</strong> محدودة، ولا تُستخدم عادة لنقل IP المصدر، <strong>سطر الطلب</strong> يحمل معلومات ثابتة غير قابلة للتوسعة، <strong>جسم HTTP</strong> لا يمكن تعديله بعد التشفير، لذا <code>حقول رأس HTTP</code> هي الأنسب للتوسعة لنقل IP المصدر.</p><p>يمكن إضافة حقل <code>X-REAL-IP</code> في رأس HTTP لنقل IP المصدر، ويتم هذا العمل عادة على خادم الوكيل، ثم <strong>يرسل خادم الوكيل</strong> الطلب إلى الخدمة الخلفية، والتي يمكنها الحصول على معلومات IP المصدر عبر هذا الحقل.</p><p>لاحظ، يجب ضمان أن <strong>خادم الوكيل</strong> قبل <strong>جهاز NAT</strong>، حتى يتمكن من الحصول على IP المصدر الحقيقي للطلب whoami. يمكننا رؤية منتج <a href=https://slb.console.aliyun.com/overview><strong>موزع الحمل</strong></a> كفئة منفصلة في منتجات علي بابا كلاود، موقعه في الشبكة مختلف عن خوادم التطبيقات العادية.</p><h2 id=دليل-عمليات-k8s>دليل عمليات K8S</h2><p>باستخدام مشروع <a href=https://github.com/traefik/whoami>whoami</a> كمثال للنشر.</p><h3 id=إنشاء-deployment>إنشاء Deployment</h3><p>أولاً، إنشاء الخدمة:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>whoami-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>whoami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>whoami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>whoami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>docker.io/traefik/whoami:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span></code></pre></div><p>هذه الخطوة ستنشئ <strong>Deployment</strong>، يحتوي على 3 <strong>Pod</strong>، كل pod يحتوي على حاوية واحدة، تقوم الحاوية بتشغيل خدمة <strong>whoami</strong>.</p><h3 id=إنشاء-service>إنشاء Service</h3><p>يمكن إنشاء خدمة من نوع <strong>NodePort</strong> أو <strong>LoadBalancer</strong> لدعم الوصول الخارجي، أو إنشاء خدمة من نوع <strong>ClusterIP</strong> للوصول الداخلي فقط للمجموعة، ثم إضافة خدمة <strong>Ingress</strong>، وتعريض الوصول الخارجي عبر <strong>Ingress</strong>.</p><p><strong>NodePort</strong> يمكن الوصول إليه عبر <strong>NodeIP:NodePort</strong>، أو عبر خدمة <strong>Ingress</strong>، مناسب للاختبار، ويستخدم هذا القسم خدمة <strong>NodePort</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>whoami-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>NodePort</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>whoami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class=m>30002</span><span class=w>
</span></span></span></code></pre></div><p>بعد إنشاء الخدمة، استخدم <code>curl whoami.example.com:30002</code> للوصول، سترى أن IP المُعاد هو <strong>NodeIP</strong>، وليس IP المصدر للطلب whoami.</p><blockquote><p>يرجى الانتباه، هذا ليس IP العميل الصحيح، إنها IP داخلية للمجموعة. هذا ما يحدث:</p><ul><li>يرسل العميل حزمة بيانات إلى node2:nodePort</li><li>يستبدل node2 عنوان IP المصدر في الحزمة بعنوان IP الخاص به (SNAT)</li><li>يستبدل node2 عنوان IP الوجهة في الحزمة بـ Pod IP</li><li>تُوجه الحزمة إلى node1، ثم إلى النقطة النهائية</li><li>يُوجه الرد من Pod إلى node2</li><li>يُرسل رد Pod إلى العميل</li></ul></blockquote><p>عرض بالرسم البياني:</p><p><img src=https://s2.loli.net/2024/05/27/fDg2tBx5FIcGMZN.png alt></p><h4 id=تكوين-externaltrafficpolicy-local>تكوين externalTrafficPolicy: Local</h4><blockquote><p>لتجنب هذا الوضع، لدى Kubernetes ميزة للاحتفاظ بـ IP المصدر للعميل. إذا قُمْتَ بتعيين service.spec.externalTrafficPolicy إلى Local، فإن kube-proxy سيقوم فقط بتوجيه الطلبات إلى النقاط النهائية المحلية، ولن يُعيد توجيه ال流量 إلى عقد أخرى.</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>whoami-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>NodePort</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>externalTrafficPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Local</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>whoami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class=m>30002</span><span class=w>
</span></span></span></code></pre></div><p>استخدم <code>curl whoami.example.com:30002</code> للاختبار، عندما يُخطط <strong>whoami.example.com</strong> إلى IP لعدة عقد في المجموعة، هناك نسبة معينة من الاحتمال لعدم الوصول. يجب التأكد من أن سجلات النطاق تحتوي فقط على IP للعقدة (العقدة) حيث يوجد endpoint (pod).</p><p>هذا التكوين <strong>له تكلفته</strong>، وهي فقدان قدرة توازن الحمل داخل المجموعة، حيث يحصل العميل على رد فقط عند الوصول إلى العقدة التي يُنشر عليها endpoint.</p><p><img src=https://s2.loli.net/2024/05/27/PCgiTLF28XE4RKx.png alt="قيود مسار الوصول"></p><p>عندما يصل العميل إلى العقدة 2، لن يكون هناك رد.</p><h3 id=إنشاء-ingress>إنشاء Ingress</h3><p>معظم الخدمات التي تُقدم للمستخدمين تستخدم <strong>http/https</strong>، شكل <strong>https://ip:port</strong> قد يبدو غريبًا للمستخدمين. عادةً، يُستخدم <strong>Ingress</strong> لتحميل خدمة <strong>NodePort</strong> المُنشأة أعلاه إلى منفذ <strong>80/443</strong> لنطاق.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>networking.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Ingress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>whoami-ingress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ingressClassName</span><span class=p>:</span><span class=w> </span><span class=l>external-lb-default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>whoami.example.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>pathType</span><span class=p>:</span><span class=w> </span><span class=l>Prefix</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>backend</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>whoami-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>port</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>number</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></div><p>بعد التطبيق، استخدم <code>curl whoami.example.com</code> لاختبار الوصول، سترى أن ClientIP دائمًا IP لـ Pod الخاص بـ <code>Ingress Controller</code> على عقدة endpoint.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@client:~# curl whoami.example.com
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>RemoteAddr: 10.42.1.10:56482
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@worker:~# kubectl get -n ingress-nginx pod -o wide
</span></span><span class=line><span class=cl>NAME                                       READY   STATUS    RESTARTS   AGE    IP           NODE          NOMINATED NODE   READINESS GATES
</span></span><span class=line><span class=cl>ingress-nginx-controller-c8f499cfc-xdrg7   1/1     Running   <span class=m>0</span>          3d2h   10.42.1.10   k3s-agent-1   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><p>استخدام <strong>Ingress</strong> كوكيل عكسي لخدمة <strong>NodePort</strong>، أي وضع طبقة إضافية من service أمام endpoint، يُظهر الرسم أدناه الفرق بينهما.</p><pre class=mermaid>graph LR
    A[Client] --&gt;|whoami.example.com:80| B(Ingress)
    B --&gt;|10.43.38.129:32123| C[Service]
    C --&gt;|10.42.1.1:8080| D[Endpoint]</pre><pre class=mermaid>graph LR
    A[Client] --&gt;|whoami.example.com:30001| B(Service)
    B --&gt;|10.42.1.1:8080| C[Endpoint]</pre><p>في المسار 1، عند الوصول الخارجي إلى Ingress، يصل ال流量 أولاً إلى endpoint وهو <code>Ingress Controller</code>، ثم إلى endpoint <strong>whoami</strong>.<br>أما <strong>Ingress Controller</strong> فهو في الأساس خدمة <strong>LoadBalancer</strong>،</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl -n ingress-nginx get svc
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAMESPACE   NAME             CLASS   HOSTS                       ADDRESS                                              PORTS   AGE
</span></span><span class=line><span class=cl>default     echoip-ingress   nginx   ip.example.com       172.16.0.57,2408:4005:3de:8500:4da1:169e:dc47:1707   <span class=m>80</span>      18h
</span></span><span class=line><span class=cl>default     whoami-ingress   nginx   whoami.example.com   172.16.0.57,2408:4005:3de:8500:4da1:169e:dc47:1707   <span class=m>80</span>      16h
</span></span></code></pre></div><p>لذلك، يمكن تعيين <code>externalTrafficPolicy</code> المذكور أعلاه إلى Ingress Controller للاحتفاظ بـ IP المصدر.</p><p>كما يجب تعيين <code>use-forwarded-headers</code> في <code>configmap</code> الخاص بـ <code>ingress-nginx-controller</code> إلى <code>true</code>، حتى يتمكن <strong>Ingress Controller</strong> من التعرف على حقول <code>X-Forwarded-For</code> أو <code>X-REAL-IP</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>allow-snippet-annotations</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;false&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>compute-full-forwarded-for</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>use-forwarded-headers</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enable-real-ip</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>forwarded-for-header</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;X-Real-IP&#34;</span><span class=w> </span><span class=c># X-Real-IP or X-Forwarded-For</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app.kubernetes.io/component</span><span class=p>:</span><span class=w> </span><span class=l>controller</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app.kubernetes.io/instance</span><span class=p>:</span><span class=w> </span><span class=l>ingress-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class=l>ingress-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class=l>ingress-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app.kubernetes.io/version</span><span class=p>:</span><span class=w> </span><span class=m>1.10.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ingress-nginx-controller</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ingress-nginx</span><span class=w>
</span></span></span></code></pre></div><p>الفرق الرئيسي بين خدمة <strong>NodePort</strong> وخدمة <strong>ingress-nginx-controller</strong> هو أن الخلفية لـ <strong>NodePort</strong> عادةً لا تُنشر على كل عقدة، بينما خلفية <strong>ingress-nginx-controller</strong> عادةً تُنشر على كل عقدة مُعرَّضة خارجيًا.</p><p>على عكس تعيين <code>externalTrafficPolicy</code> في خدمة <strong>NodePort</strong> الذي يؤدي إلى عدم رد الطلبات عبر العقد، يمكن لـ <strong>Ingress</strong> تعيين HEADER أولاً ثم إعادة التوجيه، مما يحقق <strong>الاحتفاظ بـ IP المصدر</strong> و<strong>توازن الحمل</strong> معًا.</p><h2 id=الخلاصة>الخلاصة</h2><ul><li><strong>ترجمة العنوان (NAT)</strong>، <strong>الوكيل (Proxy)</strong>، <strong>الوكيل العكسي (Reverse Proxy)</strong>، <strong>توازن الحمل (Load Balance)</strong> تؤدي إلى فقدان IP المصدر.</li><li>لمنع فقدان IP المصدر، يمكن لخادم الوكيل تعيين IP الحقيقي في حقل رأس HTTP <code>X-REAL-IP</code> أثناء إعادة التوجيه، وتمريره عبر خدمة الوكيل. إذا كان هناك وكلاء متعددون، يمكن استخدام حقل <code>X-Forwarded-For</code>، الذي يسجل قائمة <strong>IP</strong> لـ IP المصدر ومسار الوكيل بشكل <strong>مكدس</strong>.</li><li>تعيين <code>externalTrafficPolicy: Local</code> لخدمة <strong>NodePort</strong> في المجموعة يحتفظ بـ IP المصدر، لكنه يفقد قدرة توازن الحمل.</li><li>تحت افتراض نشر <strong>ingress-nginx-controller</strong> بشكل <strong>daemonset</strong> على جميع عقد <strong>loadbalancer</strong>، تعيين <code>externalTrafficPolicy: Local</code> يحتفظ بـ IP المصدر، مع الحفاظ على قدرة توازن الحمل.</li></ul><h2 id=المراجع>المراجع</h2><ul><li><a href=https://kubernetes.io/zh-cn/docs/tutorials/services/source-ip/>Kubernetes استخدام IP المصدر</a></li><li><a href=https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/configmap/>Ingress-Nginx Controller:ConfigMap</a></li><li><a href=https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress-controllers/>Ingress Controller</a></li></ul><br><script src=https://giscus.app/client.js data-repo=jqknono/blog data-repo-id=R_kgDONOhENQ data-category=Announcements data-category-id=DIC_kwDONOhENc4CkQDB data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script><br><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a class="btn btn-primary disabled"><span class=me-1>←</span>السابق</a></li><li><a href=/ar-sa/blog/2024/05/09/%D8%AA%D8%AC%D8%B1%D8%A8%D8%A9-%D8%A7%D9%84%D9%83%D8%AA%D8%A7%D8%A8%D8%A9-%D9%81%D9%8A-%D9%85%D8%AC%D8%AA%D9%85%D8%B9-%D9%85%D8%B7%D9%88%D8%B1%D9%8A-%D8%AA%D9%8A%D9%86%D8%B3%D9%86%D8%AA-%D9%83%D9%84%D8%A7%D9%88%D8%AF/ aria-label="التالي - تجربة الكتابة في مجتمع مطوري تينسنت كلاود" class="btn btn-primary">التالي<span class=ms-1>→</span></a></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="User mailing list" aria-label="User mailing list"><a target=_blank rel=noopener href=https://groups.google.com/forum/#!forum/jqknono aria-label="User mailing list"><i class=envelope></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/jqknono aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="User mailing list" aria-label="User mailing list"><a target=_blank rel=noopener href=https://groups.google.com/forum/#!forum/jqknono aria-label="User mailing list"><i class=envelope></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2015&ndash;2025
<span class=td-footer__authors>jqknono</span></span><span class=td-footer__all_rights_reserved>جميع الحقوق محفوظة</span></div></div></div></footer></div><script type=module async>
  import mermaid from "https:\/\/cdn.jsdelivr.net\/npm\/mermaid@latest\/dist\/mermaid.esm.min.mjs";

  (function ($) {
    if ($('.mermaid').length == 0) {
      mermaid.initialize({ startOnLoad: false });
      return;
    }

    var params = {"theme":"default","version":"latest"};

    
    
    var norm = function (defaultConfig, params) {
      var result = {};
      for (const key in defaultConfig) {
        const keyLower = key.toLowerCase();
        if (defaultConfig.hasOwnProperty(key) && params.hasOwnProperty(keyLower)) {
          if (typeof defaultConfig[key] === "object") {
            result[key] = norm(defaultConfig[key], params[keyLower]);
          } else {
            result[key] = params[keyLower];
          }
        }
      }
      return result;
    };

    var settings = norm(mermaid.mermaidAPI.defaultConfig, params);
    settings.startOnLoad = true;
    if ($('html[data-bs-theme="dark"]').length) {
      settings.theme = 'dark';
    }
    mermaid.initialize(settings);

    
    const lightDarkModeThemeChangeHandler = function (mutationsList, observer) {
      for (const mutation of mutationsList) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'data-bs-theme') {
          
          
          
          location.reload();
        }
      }
    };

    const observer = new MutationObserver(lightDarkModeThemeChangeHandler);
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['data-bs-theme']
    });
    

  })(jQuery);
</script><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>