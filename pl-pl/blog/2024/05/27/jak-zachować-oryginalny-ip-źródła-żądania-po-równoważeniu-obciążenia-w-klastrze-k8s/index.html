<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=pl-pl class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Jak zachować oryginalny IP źródła żądania po równoważeniu obciążenia w klastrze K8s | jqknono Blogs</title><meta name=description content="Wstęp Wdrożenie aplikacji nie zawsze polega na prostym instalowaniu i uruchamianiu, czasami trzeba też rozważyć problemy sieciowe. Niniejszy artykuł opisuje, jak w klastrze k8s sprawić, aby usługa mogła uzyskać źródłowy IP żądania.
Aplikacje świadczące usługi zazwyczaj zależą od informacji wejściowych. Jeśli informacje wejściowe nie zależą od pięciokrotki (źródłowy IP, źródłowy port, docelowy IP, docelowy port, protokół), to taka usługa ma niskie powiązanie z siecią i nie musi przejmować się szczegółami sieciowymi."><meta property="og:url" content="https://blog.jqknono.com/pl-pl/blog/2024/05/27/jak-zachowa%C4%87-oryginalny-ip-%C5%BAr%C3%B3d%C5%82a-%C5%BC%C4%85dania-po-r%C3%B3wnowa%C5%BCeniu-obci%C4%85%C5%BCenia-w-klastrze-k8s/"><meta property="og:site_name" content="jqknono Blogs"><meta property="og:title" content="Jak zachować oryginalny IP źródła żądania po równoważeniu obciążenia w klastrze K8s"><meta property="og:description" content="Wstęp Wdrożenie aplikacji nie zawsze polega na prostym instalowaniu i uruchamianiu, czasami trzeba też rozważyć problemy sieciowe. Niniejszy artykuł opisuje, jak w klastrze k8s sprawić, aby usługa mogła uzyskać źródłowy IP żądania.
Aplikacje świadczące usługi zazwyczaj zależą od informacji wejściowych. Jeśli informacje wejściowe nie zależą od pięciokrotki (źródłowy IP, źródłowy port, docelowy IP, docelowy port, protokół), to taka usługa ma niskie powiązanie z siecią i nie musi przejmować się szczegółami sieciowymi."><meta property="og:locale" content="pl_pl"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-05-27T11:52:22+08:00"><meta property="article:modified_time" content="2024-05-27T11:52:22+08:00"><meta property="article:tag" content="Sieć"><meta property="article:tag" content="Blog"><meta itemprop=name content="Jak zachować oryginalny IP źródła żądania po równoważeniu obciążenia w klastrze K8s"><meta itemprop=description content="Wstęp Wdrożenie aplikacji nie zawsze polega na prostym instalowaniu i uruchamianiu, czasami trzeba też rozważyć problemy sieciowe. Niniejszy artykuł opisuje, jak w klastrze k8s sprawić, aby usługa mogła uzyskać źródłowy IP żądania.
Aplikacje świadczące usługi zazwyczaj zależą od informacji wejściowych. Jeśli informacje wejściowe nie zależą od pięciokrotki (źródłowy IP, źródłowy port, docelowy IP, docelowy port, protokół), to taka usługa ma niskie powiązanie z siecią i nie musi przejmować się szczegółami sieciowymi."><meta itemprop=datePublished content="2024-05-27T11:52:22+08:00"><meta itemprop=dateModified content="2024-05-27T11:52:22+08:00"><meta itemprop=wordCount content="1466"><meta itemprop=keywords content="Sieć,Blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="Jak zachować oryginalny IP źródła żądania po równoważeniu obciążenia w klastrze K8s"><meta name=twitter:description content="Wstęp Wdrożenie aplikacji nie zawsze polega na prostym instalowaniu i uruchamianiu, czasami trzeba też rozważyć problemy sieciowe. Niniejszy artykuł opisuje, jak w klastrze k8s sprawić, aby usługa mogła uzyskać źródłowy IP żądania.
Aplikacje świadczące usługi zazwyczaj zależą od informacji wejściowych. Jeśli informacje wejściowe nie zależą od pięciokrotki (źródłowy IP, źródłowy port, docelowy IP, docelowy port, protokół), to taka usługa ma niskie powiązanie z siecią i nie musi przejmować się szczegółami sieciowymi."><link rel=preload href=/scss/main.min.19deb9bb49a16bab1391617801cf2d75f58ded83cae46516f211ba8fc3e9f6f9.css as=style integrity="sha256-Gd65u0mha6sTkWF4Ac8tdfWN7YPK5GUW8hG6j8Pp9vk=" crossorigin=anonymous><link href=/scss/main.min.19deb9bb49a16bab1391617801cf2d75f58ded83cae46516f211ba8fc3e9f6f9.css rel=stylesheet integrity="sha256-Gd65u0mha6sTkWF4Ac8tdfWN7YPK5GUW8hG6j8Pp9vk=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-F3FFTG72NE"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F3FFTG72NE")}</script></head><body class="td-page td-blog"><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/pl-pl/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>jqknono Blogs</span></a><div class="td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://jqknono.com target=_blank rel=noopener><span>About</span><sup><i class="ps-1 fa-solid fa-up-right-from-square fa-xs" aria-hidden=true></i></sup></a></li><li class=nav-item><a class=nav-link href=https://github.com/jqknono target=_blank rel=noopener><i class="fab fa-github" aria-hidden=true></i><span>GitHub</span><sup><i class="ps-1 fa-solid fa-up-right-from-square fa-xs" aria-hidden=true></i></sup></a></li><li class="nav-item td-navbar__lang-menu"><div class="td-lang-menu dropdown"><a class="nav-link dropdown-toggle td-lang-menu__title" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><span class=td-lang-menu__title-text>Polski</span>
<span class=td-lang-menu__title-code>PL-PL</span></a><ul class=dropdown-menu><li><a class=dropdown-item href=/blog/2024/05/27/how-to-preserve-the-source-ip-of-requests-after-load-balancing-in-a-k8s-cluster/>English</a></li><li><a class=dropdown-item href=/zh-tw/blog/2024/05/27/k8s%E5%8F%A2%E9%9B%86%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BF%9D%E7%95%99%E8%B2%A0%E8%BC%89%E5%9D%87%E8%A1%A1%E5%BE%8C%E7%9A%84%E8%AB%8B%E6%B1%82%E6%BA%90ip/>繁體中文</a></li><li><a class=dropdown-item href=/ja-jp/blog/1/01/01/>日本語</a></li><li><a class=dropdown-item href=/ko-kr/blog/2024/05/27/k8s-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0%EC%97%90%EC%84%9C-%EB%A1%9C%EB%93%9C-%EB%B0%B8%EB%9F%B0%EC%8B%B1-%ED%9B%84-%EC%9A%94%EC%B2%AD-%EC%9B%90%EB%B3%B8-ip%EB%A5%BC-%EB%B3%B4%EC%A1%B4%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95/>한국어</a></li><li><a class=dropdown-item href=/ar-sa/blog/1/01/01/>العربية</a></li><li><a class=dropdown-item href=/de-de/blog/2024/05/27/wie-beh%C3%A4lt-man-in-einem-k8s-cluster-die-quell-ip-der-anfragen-nach-der-lastverteilung-bei/>Deutsch</a></li><li><a class=dropdown-item href=/fr-fr/blog/2024/05/27/comment-conserver-lip-source-des-requ%C3%AAtes-apr%C3%A8s-%C3%A9quilibrage-de-charge-dans-un-cluster-k8s/>Français</a></li><li><a class=dropdown-item href=/hi-in/blog/2024/05/27/k8s-%E0%A4%95%E0%A5%8D%E0%A4%B2%E0%A4%B8%E0%A5%8D%E0%A4%9F%E0%A4%B0-%E0%A4%AE%E0%A5%87%E0%A4%82-%E0%A4%B2%E0%A5%8B%E0%A4%A1-%E0%A4%AC%E0%A5%88%E0%A4%B2%E0%A5%87%E0%A4%82%E0%A4%B8%E0%A4%B0-%E0%A4%95%E0%A5%87-%E0%A4%AC%E0%A4%BE%E0%A4%A6-%E0%A4%95%E0%A5%87-%E0%A4%85%E0%A4%A8%E0%A5%81%E0%A4%B0%E0%A5%8B%E0%A4%A7-%E0%A4%B8%E0%A5%8D%E0%A4%B0%E0%A5%8B%E0%A4%A4-ip-%E0%A4%95%E0%A5%8B-%E0%A4%95%E0%A5%88%E0%A4%B8%E0%A5%87-%E0%A4%AC%E0%A4%A8%E0%A4%BE%E0%A4%8F-%E0%A4%B0%E0%A4%96%E0%A5%87%E0%A4%82/>हिंदी</a></li><li><a class=dropdown-item href=/es-es/blog/2024/05/27/c%C3%B3mo-conservar-la-ip-de-origen-de-las-solicitudes-despu%C3%A9s-de-la-equilibraci%C3%B3n-de-carga-en-un-cl%C3%BAster-de-k8s/>Español</a></li><li><a class=dropdown-item href=/pt-br/blog/2024/05/27/como-preservar-o-ip-de-origem-da-solicita%C3%A7%C3%A3o-ap%C3%B3s-o-balanceamento-de-carga-em-um-cluster-k8s/>Português</a></li><li><a class=dropdown-item href=/ru-ru/blog/2024/05/27/%D0%BA%D0%B0%D0%BA-%D1%81%D0%BE%D1%85%D1%80%D0%B0%D0%BD%D0%B8%D1%82%D1%8C-%D0%B8%D1%81%D1%85%D0%BE%D0%B4%D0%BD%D1%8B%D0%B9-ip-%D0%B0%D0%B4%D1%80%D0%B5%D1%81-%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81%D0%B0-%D0%BF%D0%BE%D1%81%D0%BB%D0%B5-%D0%B1%D0%B0%D0%BB%D0%B0%D0%BD%D1%81%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BD%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B8-%D0%B2-%D0%BA%D0%BB%D0%B0%D1%81%D1%82%D0%B5%D1%80%D0%B5-k8s/>Русский</a></li><li><a class=dropdown-item href=/it-it/blog/2024/05/27/come-preservare-lip-sorgente-delle-richieste-dopo-il-bilanciamento-del-carico-in-un-cluster-k8s/>Italiano</a></li><li><span class="dropdown-item disabled">Bahasa Indonesia</span></li><li><a class=dropdown-item href=/tr-tr/blog/2024/05/27/k8s-k%C3%BCmesinde-y%C3%BCk-dengeleme-sonras%C4%B1-istek-kaynak-ipsini-nas%C4%B1l-koruyabiliriz/>Türkçe</a></li><li><a class=dropdown-item href=/nl-nl/blog/2024/05/27/hoe-behoud-je-het-bron-ip-van-verzoeken-na-load-balancing-in-een-k8s-cluster/>Nederlands</a></li><li><span class="dropdown-item active">Polski</span></li><li><a class=dropdown-item href=/ar-ae/blog/1/01/01/>العربية</a></li><li><a class=dropdown-item href=/zh-cn/blog/2024/05/27/k8s%E9%9B%86%E7%BE%A4%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BF%9D%E7%95%99%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%90%8E%E7%9A%84%E8%AF%B7%E6%B1%82%E6%BA%90ip/>简体中文</a></li></ul></div></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="d-none d-lg-block td-navbar__search"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Wyszukaj na tej stronie…" aria-label="Wyszukaj na tej stronie…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.321c42609f2819a595ec79e206244e21.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main data-bs-spy=scroll data-bs-target=.td-toc data-bs-root-margin="0px 0px -10%"><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Wyszukaj na tej stronie…" aria-label="Wyszukaj na tej stronie…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.321c42609f2819a595ec79e206244e21.json data-offline-search-base-href=/ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="td-sidebar-nav collapse td-sidebar-nav--search-disabled foldable-nav" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-pl-plblog-li><a href=/pl-pl/blog/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-pl-plblog><span>Blogs</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-pl-plblog20251203zalecam-nie-korzystac487-z-funkcji-esa_page-aliyun-na-razie-li><input type=checkbox id=m-pl-plblog20251203zalecam-nie-korzystac487-z-funkcji-esa_page-aliyun-na-razie-check>
<label for=m-pl-plblog20251203zalecam-nie-korzystac487-z-funkcji-esa_page-aliyun-na-razie-check><a href=/pl-pl/blog/2025/12/03/zalecam-nie-korzysta%C4%87-z-funkcji-esa_page-aliyun-na-razie/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-pl-plblog20251203zalecam-nie-korzystac487-z-funkcji-esa_page-aliyun-na-razie><span>Zalecam nie korzystać z funkcji ESA_page Aliyun na razie</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-pl-plblog20251202puc582apki-alibaby-esa-i-oss-li><input type=checkbox id=m-pl-plblog20251202puc582apki-alibaby-esa-i-oss-check>
<label for=m-pl-plblog20251202puc582apki-alibaby-esa-i-oss-check><a href=/pl-pl/blog/2025/12/02/pu%C5%82apki-alibaby-esa-i-oss/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-pl-plblog20251202puc582apki-alibaby-esa-i-oss><span>Pułapki Alibaby ESA i OSS</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-pl-plblog20251202czy-cloudflare-jest-calkowicie-godny-zaufania-li><input type=checkbox id=m-pl-plblog20251202czy-cloudflare-jest-calkowicie-godny-zaufania-check>
<label for=m-pl-plblog20251202czy-cloudflare-jest-calkowicie-godny-zaufania-check><a href=/pl-pl/blog/2025/12/02/czy-cloudflare-jest-calkowicie-godny-zaufania/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-pl-plblog20251202czy-cloudflare-jest-calkowicie-godny-zaufania><span>Czy Cloudflare jest całkowicie godny zaufania</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-pl-plblog20251201zagadka-poprawy-wzroku-li><input type=checkbox id=m-pl-plblog20251201zagadka-poprawy-wzroku-check>
<label for=m-pl-plblog20251201zagadka-poprawy-wzroku-check><a href=/pl-pl/blog/2025/12/01/zagadka-poprawy-wzroku/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-pl-plblog20251201zagadka-poprawy-wzroku><span>Zagadka poprawy wzroku</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-pl-plblog20251127darmowe-rzeczy-ktc3b3re-moc5bcesz-zdobyc487-posiadajc485c-domenc499-li><input type=checkbox id=m-pl-plblog20251127darmowe-rzeczy-ktc3b3re-moc5bcesz-zdobyc487-posiadajc485c-domenc499-check>
<label for=m-pl-plblog20251127darmowe-rzeczy-ktc3b3re-moc5bcesz-zdobyc487-posiadajc485c-domenc499-check><a href=/pl-pl/blog/2025/11/27/darmowe-rzeczy-kt%C3%B3re-mo%C5%BCesz-zdoby%C4%87-posiadaj%C4%85c-domen%C4%99/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-pl-plblog20251127darmowe-rzeczy-ktc3b3re-moc5bcesz-zdobyc487-posiadajc485c-domenc499><span>darmowe rzeczy, które możesz zdobyć, posiadając domenę</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-pl-plblog20230506problem-z-ipv6-podczas-mostkowania-w-windows-li><input type=checkbox id=m-pl-plblog20230506problem-z-ipv6-podczas-mostkowania-w-windows-check>
<label for=m-pl-plblog20230506problem-z-ipv6-podczas-mostkowania-w-windows-check><a href=/pl-pl/blog/2023/05/06/problem-z-ipv6-podczas-mostkowania-w-windows/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-pl-plblog20230506problem-z-ipv6-podczas-mostkowania-w-windows><span>Problem z IPv6 podczas mostkowania w Windows</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-pl-plblog20240527instalacja-i-aktywacja-systemu-windows-li><input type=checkbox id=m-pl-plblog20240527instalacja-i-aktywacja-systemu-windows-check>
<label for=m-pl-plblog20240527instalacja-i-aktywacja-systemu-windows-check><a href=/pl-pl/blog/2024/05/27/instalacja-i-aktywacja-systemu-windows/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-pl-plblog20240527instalacja-i-aktywacja-systemu-windows><span>Instalacja i aktywacja systemu Windows</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-pl-plblog20240527jak-zachowac487-oryginalny-ip-c5barc3b3dc582a-c5bcc485dania-po-rc3b3wnowac5bceniu-obcic485c5bcenia-w-klastrze-k8s-li><input type=checkbox id=m-pl-plblog20240527jak-zachowac487-oryginalny-ip-c5barc3b3dc582a-c5bcc485dania-po-rc3b3wnowac5bceniu-obcic485c5bcenia-w-klastrze-k8s-check checked>
<label for=m-pl-plblog20240527jak-zachowac487-oryginalny-ip-c5barc3b3dc582a-c5bcc485dania-po-rc3b3wnowac5bceniu-obcic485c5bcenia-w-klastrze-k8s-check><a href=/pl-pl/blog/2024/05/27/jak-zachowa%C4%87-oryginalny-ip-%C5%BAr%C3%B3d%C5%82a-%C5%BC%C4%85dania-po-r%C3%B3wnowa%C5%BCeniu-obci%C4%85%C5%BCenia-w-klastrze-k8s/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-pl-plblog20240527jak-zachowac487-oryginalny-ip-c5barc3b3dc582a-c5bcc485dania-po-rc3b3wnowac5bceniu-obcic485c5bcenia-w-klastrze-k8s><span class=td-sidebar-nav-active-item>Jak zachować oryginalny IP źródła żądania po równoważeniu obciążenia w klastrze K8s</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-pl-plblog20240521pec582ne-rozwic485zanie-wireguard-do-walki-z-limitem-qos-udp-operatora-li><input type=checkbox id=m-pl-plblog20240521pec582ne-rozwic485zanie-wireguard-do-walki-z-limitem-qos-udp-operatora-check>
<label for=m-pl-plblog20240521pec582ne-rozwic485zanie-wireguard-do-walki-z-limitem-qos-udp-operatora-check><a href=/pl-pl/blog/2024/05/21/pe%C5%82ne-rozwi%C4%85zanie-wireguard-do-walki-z-limitem-qos-udp-operatora/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-pl-plblog20240521pec582ne-rozwic485zanie-wireguard-do-walki-z-limitem-qos-udp-operatora><span>Pełne rozwiązanie WireGuard do walki z limitem QoS UDP operatora</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-pl-plblog20240520raport-nowicjusza-z-mniejszoc59bci-li><input type=checkbox id=m-pl-plblog20240520raport-nowicjusza-z-mniejszoc59bci-check>
<label for=m-pl-plblog20240520raport-nowicjusza-z-mniejszoc59bci-check><a href=/pl-pl/blog/2024/05/20/raport-nowicjusza-z-mniejszo%C5%9Bci/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-pl-plblog20240520raport-nowicjusza-z-mniejszoc59bci><span>Raport nowicjusza z Mniejszości</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-pl-plblog20240509personalizacja-rekomendacji-czy-to-cudowne-narzc499dzie-wygody-czy-puc582apka-poznawcza-li><input type=checkbox id=m-pl-plblog20240509personalizacja-rekomendacji-czy-to-cudowne-narzc499dzie-wygody-czy-puc582apka-poznawcza-check>
<label for=m-pl-plblog20240509personalizacja-rekomendacji-czy-to-cudowne-narzc499dzie-wygody-czy-puc582apka-poznawcza-check><a href=/pl-pl/blog/2024/05/09/personalizacja-rekomendacji-czy-to-cudowne-narz%C4%99dzie-wygody-czy-pu%C5%82apka-poznawcza/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-pl-plblog20240509personalizacja-rekomendacji-czy-to-cudowne-narzc499dzie-wygody-czy-puc582apka-poznawcza><span>Personalizacja rekomendacji: czy to cudowne narzędzie wygody, czy pułapka poznawcza?</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-pl-plblog20240509doc59bwiadczenia-z-tworzenia-w-spoc582ecznoc59bci-deweloperc3b3w-tencent-cloud-li><input type=checkbox id=m-pl-plblog20240509doc59bwiadczenia-z-tworzenia-w-spoc582ecznoc59bci-deweloperc3b3w-tencent-cloud-check>
<label for=m-pl-plblog20240509doc59bwiadczenia-z-tworzenia-w-spoc582ecznoc59bci-deweloperc3b3w-tencent-cloud-check><a href=/pl-pl/blog/2024/05/09/do%C5%9Bwiadczenia-z-tworzenia-w-spo%C5%82eczno%C5%9Bci-deweloper%C3%B3w-tencent-cloud/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-pl-plblog20240509doc59bwiadczenia-z-tworzenia-w-spoc582ecznoc59bci-deweloperc3b3w-tencent-cloud><span>Doświadczenia z tworzenia w społeczności deweloperów Tencent Cloud</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-pl-plblog10101-li><input type=checkbox id=m-pl-plblog10101-check>
<label for=m-pl-plblog10101-check><a href=/pl-pl/blog/1/01/01/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-pl-plblog10101><span></span></a></label></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"></div><div class=td-toc data-proofer-ignore><div class=td-toc-title><span class=td-toc-title__text></span>
<a class=td-toc-title__link title href=#></a></div><nav id=TableOfContents><ul><li><a href=#wstęp>Wstęp</a></li><li><a href=#dlaczego-informacje-o-źródłowym-ip-są-tracone>Dlaczego informacje o źródłowym IP są tracone?</a></li><li><a href=#jak-zachować-źródłowy-ip>Jak zachować źródłowy IP?</a></li><li><a href=#instrukcja操作-k8s>Instrukcja操作 K8S</a><ul><li><a href=#tworzenie-deployment>Tworzenie Deployment</a></li><li><a href=#tworzenie-service>Tworzenie Service</a></li><li><a href=#tworzenie-ingress>Tworzenie Ingress</a></li></ul></li><li><a href=#podsumowanie>Podsumowanie</a></li><li><a href=#referencje>Referencje</a></li></ul></nav></div><div class="taxonomy taxonomy-terms-cloud taxo-tags"><h5 class=taxonomy-title>Taxonomy Cloud</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/tags/2025/ data-taxonomy-term=2025><span class=taxonomy-label>2025</span><span class=taxonomy-count>5</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/tags/administracja/ data-taxonomy-term=administracja><span class=taxonomy-label>Administracja</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/tags/blog/ data-taxonomy-term=blog><span class=taxonomy-label>Blog</span><span class=taxonomy-count>4</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/tags/eseje/ data-taxonomy-term=eseje><span class=taxonomy-label>Eseje</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/tags/instrukcja/ data-taxonomy-term=instrukcja><span class=taxonomy-label>Instrukcja</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/tags/nieklasyfikowane/ data-taxonomy-term=nieklasyfikowane><span class=taxonomy-label>Nieklasyfikowane</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/tags/nieskategoryzowane/ data-taxonomy-term=nieskategoryzowane><span class=taxonomy-label>Nieskategoryzowane</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/tags/operacje/ data-taxonomy-term=operacje><span class=taxonomy-label>Operacje</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/tags/optymalizacja-sieci/ data-taxonomy-term=optymalizacja-sieci><span class=taxonomy-label>Optymalizacja Sieci</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/tags/platforma-dla-tw%C3%B3rc%C3%B3w/ data-taxonomy-term=platforma-dla-tw%C3%B3rc%C3%B3w><span class=taxonomy-label>Platforma Dla Twórców</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/tags/poradnik/ data-taxonomy-term=poradnik><span class=taxonomy-label>Poradnik</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/tags/problemy-i-triki/ data-taxonomy-term=problemy-i-triki><span class=taxonomy-label>Problemy I Triki</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/tags/recenzja/ data-taxonomy-term=recenzja><span class=taxonomy-label>Recenzja</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/tags/sieci/ data-taxonomy-term=sieci><span class=taxonomy-label>Sieci</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/tags/sie%C4%87/ data-taxonomy-term=sie%C4%87><span class=taxonomy-label>Sieć</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/tags/teoria-gier/ data-taxonomy-term=teoria-gier><span class=taxonomy-label>Teoria Gier</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/tags/udp-qos/ data-taxonomy-term=udp-qos><span class=taxonomy-label>UDP QoS</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/tags/vpn/ data-taxonomy-term=vpn><span class=taxonomy-label>VPN</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/tags/wireguard/ data-taxonomy-term=wireguard><span class=taxonomy-label>WireGuard</span><span class=taxonomy-count>1</span></a></li></ul></div><div class="taxonomy taxonomy-terms-cloud taxo-categories"><h5 class=taxonomy-title>Categories</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/categories/administracja/ data-taxonomy-term=administracja><span class=taxonomy-label>Administracja</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/categories/eseje/ data-taxonomy-term=eseje><span class=taxonomy-label>Eseje</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/categories/instrukcja/ data-taxonomy-term=instrukcja><span class=taxonomy-label>Instrukcja</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/categories/nieklasyfikowane/ data-taxonomy-term=nieklasyfikowane><span class=taxonomy-label>Nieklasyfikowane</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/categories/nieskategoryzowane/ data-taxonomy-term=nieskategoryzowane><span class=taxonomy-label>Nieskategoryzowane</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/categories/operacje/ data-taxonomy-term=operacje><span class=taxonomy-label>Operacje</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/categories/poradnik/ data-taxonomy-term=poradnik><span class=taxonomy-label>Poradnik</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/categories/recenzja/ data-taxonomy-term=recenzja><span class=taxonomy-label>Recenzja</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/categories/sieci/ data-taxonomy-term=sieci><span class=taxonomy-label>Sieci</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/categories/sie%C4%87/ data-taxonomy-term=sie%C4%87><span class=taxonomy-label>Sieć</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/categories/technologia-sieciowa/ data-taxonomy-term=technologia-sieciowa><span class=taxonomy-label>Technologia Sieciowa</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/categories/teoria-gier/ data-taxonomy-term=teoria-gier><span class=taxonomy-label>Teoria Gier</span><span class=taxonomy-count>1</span></a></li></ul></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><a class=td-rss-button title=RSS href=/pl-pl/blog/index.xml target=_blank rel=noopener><i class="fa-solid fa-rss" aria-hidden=true></i></a><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/pl-pl/blog/>Blogs</a></li><li class="breadcrumb-item active" aria-current=page>Jak zachować oryginalny IP źródła żądania po równoważeniu obciążenia w klastrze K8s</li></ol></nav><div class=td-content><h1>Jak zachować oryginalny IP źródła żądania po równoważeniu obciążenia w klastrze K8s</h1><div class="td-byline mb-4"><time datetime=2024-05-27 class=text-body-secondary>Monday, May 27, 2024</time></div><header class=article-meta><div class="taxonomy taxonomy-terms-article taxo-tags"><h5 class=taxonomy-title>Tags:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/tags/sie%C4%87/ data-taxonomy-term=sie%C4%87><span class=taxonomy-label>Sieć</span></a></li><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/tags/blog/ data-taxonomy-term=blog><span class=taxonomy-label>Blog</span></a></li></ul></div><div class="taxonomy taxonomy-terms-article taxo-categories"><h5 class=taxonomy-title>Categories:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://blog.jqknono.com/pl-pl/categories/sie%C4%87/ data-taxonomy-term=sie%C4%87><span class=taxonomy-label>Sieć</span></a></li></ul></div></header><h2 id=wstęp>Wstęp</h2><p><strong>Wdrożenie aplikacji</strong> nie zawsze polega na prostym <strong>instalowaniu</strong> i <strong>uruchamianiu</strong>, czasami trzeba też rozważyć problemy <strong>sieciowe</strong>. Niniejszy artykuł opisuje, jak w <strong>klastrze k8s</strong> sprawić, aby usługa mogła uzyskać <strong>źródłowy IP</strong> żądania.</p><p>Aplikacje świadczące usługi zazwyczaj zależą od informacji wejściowych. Jeśli informacje wejściowe nie zależą od <strong>pięciokrotki</strong> (źródłowy IP, źródłowy port, docelowy IP, docelowy port, protokół), to taka usługa ma <strong>niskie powiązanie z siecią</strong> i nie musi przejmować się szczegółami sieciowymi.</p><p>Dlatego dla większości osób nie ma potrzeby czytania tego artykułu. Jeśli interesujesz się sieciami lub chcesz poszerzyć horyzonty, możesz kontynuować czytanie, aby dowiedzieć się więcej o scenariuszach usług.</p><p>Artykuł oparty na k8s <code>v1.29.4</code>. W niektórych opisach mieszam pojęcia pod i endpoint – w kontekście tego artykułu można je traktować jako równoważne.</p><p><strong>Jeśli zauważysz błędy, chętnie przyjmę poprawki, poprawię je niezwłocznie.</strong></p><h2 id=dlaczego-informacje-o-źródłowym-ip-są-tracone>Dlaczego informacje o źródłowym IP są tracone?</h2><p>Najpierw wyjaśnijmy, czym jest źródłowy IP. Gdy A wysyła żądanie do B, a B przekazuje je do C, to chociaż C widzi źródłowy IP protokołu IP jako IP B, w tym artykule <strong>IP A</strong> traktujemy jako źródłowy IP.</p><p>Głównie dwie klasy zachowań powodują utratę informacji o źródle:</p><ol><li><strong>Translacja adresów sieciowych (NAT)</strong>, w celu oszczędzania publicznych IPv4, równoważenia obciążenia itp. Powoduje, że serwer widzi źródłowy IP jako IP urządzenia <strong>NAT</strong>, a nie prawdziwy źródłowy IP.</li><li><strong>Proxy</strong>, <strong>odwrotne proxy</strong> (RP, Reverse Proxy) i <strong>równoważenie obciążenia</strong> (LB, Load Balancer) należą do tej klasy, poniżej określane zbiorczo jako <strong>serwery proxy</strong>. Te serwery proxy przekazują żądania do usług backendowych, ale zastępują źródłowy IP swoim własnym IP.</li></ol><ul><li>NAT to w skrócie <strong>wymiana przestrzeni portów na przestrzeń IP</strong>. Adresy IPv4 są ograniczone, jeden adres IP może mapować 65535 portów. W większości przypadków te porty nie są w pełni wykorzystane, więc wiele podsieci IP może współdzielić jeden publiczny IP, rozróżniając usługi po portach. Forma użycia: <code>publiczny IP:publiczny port -> prywatny IP_1:prywatny port</code>. Więcej informacji znajdziesz w <a href="https://www.google.com/search?q=%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2">Translacja adresów sieciowych</a>.</li><li>Serwery proxy służą do <strong>ukrywania lub eksponowania</strong>. Przekazują żądania do usług backendowych, jednocześnie zastępując źródłowy IP swoim własnym IP, co ukrywa prawdziwy IP usług backendowych i chroni ich bezpieczeństwo. Forma użycia: <code>IP klienta -> IP proxy -> IP serwera</code>. Więcej informacji znajdziesz w <a href="https://www.google.com/search?q=%E4%BB%A3%E7%90%86">Proxy</a>.</li></ul><p><strong>NAT</strong> i <strong>serwery proxy</strong> są bardzo powszechne, większość usług nie może uzyskać źródłowego IP żądania.</p><p><em>To dwie powszechne metody modyfikacji źródłowego IP. Inne sugestie mile widziane.</em></p><h2 id=jak-zachować-źródłowy-ip>Jak zachować źródłowy IP?</h2><p>Oto przykład <code>żądania HTTP</code>:</p><table><thead><tr><th>Pole</th><th>Długość (bajty)</th><th>Przesunięcie bitowe</th><th>Opis</th></tr></thead><tbody><tr><td><strong>Nagłówek IP</strong></td><td></td><td></td><td></td></tr><tr><td><code>Źródłowy IP</code></td><td>4</td><td>0-31</td><td>Adres IP nadawcy</td></tr><tr><td>Docelowy IP</td><td>4</td><td>32-63</td><td>Adres IP odbiorcy</td></tr><tr><td><strong>Nagłówek TCP</strong></td><td></td><td></td><td></td></tr><tr><td>Źródłowy port</td><td>2</td><td>0-15</td><td>Numer portu nadawcy</td></tr><tr><td>Docelowy port</td><td>2</td><td>16-31</td><td>Numer portu odbiorcy</td></tr><tr><td>Numer sekwencyjny</td><td>4</td><td>32-63</td><td>Służy do identyfikacji strumienia bajtów danych wysyłanych przez nadawcę</td></tr><tr><td>Numer potwierdzenia</td><td>4</td><td>64-95</td><td>Jeśli ustawiona flaga ACK, to następny oczekiwany numer sekwencyjny</td></tr><tr><td>Przesunięcie danych</td><td>4</td><td>96-103</td><td>Liczba bajtów od początku nagłówka TCP do danych</td></tr><tr><td>Zarezerwowane</td><td>4</td><td>104-111</td><td>Pole zarezerwowane, nieużywane, ustawione na 0</td></tr><tr><td>Flagi</td><td>2</td><td>112-127</td><td>Różne flagi kontrolne, takie jak SYN, ACK, FIN itp.</td></tr><tr><td>Rozmiar okna</td><td>2</td><td>128-143</td><td>Ilość danych, jaką odbiorca może przyjąć</td></tr><tr><td>Suma kontrolna</td><td>2</td><td>144-159</td><td>Służy do wykrywania błędów w transmisji danych</td></tr><tr><td>Wskaźnik pilny</td><td>2</td><td>160-175</td><td>Pozycja pilnych danych, które nadawca chce, aby odbiorca przetworzył jak najszybciej</td></tr><tr><td>Opcje</td><td>Zmienne</td><td>176-&mldr;</td><td>Może zawierać znaczniki czasu, maksymalny rozmiar segmentu itp.</td></tr><tr><td><strong>Nagłówek HTTP</strong></td><td></td><td></td><td></td></tr><tr><td>Wiersz żądania</td><td>Zmienne</td><td>&mldr;-&mldr;</td><td>Zawiera metodę żądania, URI i wersję HTTP</td></tr><tr><td><code>Pola nagłówka</code></td><td>Zmienne</td><td>&mldr;-&mldr;</td><td>Zawiera różne pola nagłówka, takie jak Host, User-Agent itp.</td></tr><tr><td>Pusta linia</td><td>2</td><td>&mldr;-&mldr;</td><td>Służy do oddzielenia nagłówka od ciała</td></tr><tr><td>Ciało</td><td>Zmienne</td><td>&mldr;-&mldr;</td><td>Opcjonalne ciało żądania lub odpowiedzi</td></tr></tbody></table><p>Przeglądając powyższą strukturę żądania HTTP, widać, że <strong>opcje TCP</strong>, <strong>wiersz żądania</strong>, <strong>pola nagłówka</strong>, <strong>ciało</strong> są zmienne. Przestrzeń <strong>opcji TCP</strong> jest ograniczona i generalnie nie służy do przekazywania źródłowego IP. <strong>Wiersz żądania</strong> ma stałą informację i nie można go rozszerzać. <strong>Ciało HTTP</strong> po zaszyfrowaniu nie można modyfikować. Tylko <code>pola nagłówka HTTP</code> nadają się do rozszerzenia w celu przekazania źródłowego IP.</p><p>W nagłówku HTTP można dodać pole <code>X-REAL-IP</code>, aby przekazać źródłowy IP. Ta operacja jest zazwyczaj wykonywana na serwerze proxy, a następnie <strong>serwer proxy</strong> przekazuje żądanie do usługi backendowej, która może uzyskać źródłowy IP z tego pola.</p><p>Uwaga: Należy zapewnić, że <strong>serwer proxy</strong> znajduje się przed urządzeniem <strong>NAT</strong>, aby uzyskać prawdziwy źródłowy IP żądania whoami. W produktach Alibaba Cloud widzimy kategorię towaru <a href=https://slb.console.aliyun.com/overview><strong>Load Balancer</strong></a>, której pozycja w sieci różni się od zwykłych serwerów aplikacji.</p><h2 id=instrukcja操作-k8s>Instrukcja操作 K8S</h2><p>Przykład wdrożenia z projektem <a href=https://github.com/traefik/whoami>whoami</a>.</p><h3 id=tworzenie-deployment>Tworzenie Deployment</h3><p>Najpierw utwórz usługę:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>whoami-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>whoami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>whoami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>whoami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>docker.io/traefik/whoami:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span></code></pre></div><p>To utworzy <strong>Deployment</strong> zawierający 3 <strong>Pody</strong>, każdy pod zawiera jeden kontener uruchamiający usługę <strong>whoami</strong>.</p><h3 id=tworzenie-service>Tworzenie Service</h3><p>Możesz utworzyć usługę typu <strong>NodePort</strong> lub <strong>LoadBalancer</strong> dla dostępu zewnętrznego lub usługę typu <strong>ClusterIP</strong> tylko dla dostępu wewnętrznego w klastrze, a następnie dodać usługę <strong>Ingress</strong> do ekspozycji dostępu zewnętrznego.</p><p><strong>NodePort</strong> można uzyskać zarówno przez <strong>NodeIP:NodePort</strong>, jak i przez usługę <strong>Ingress</strong>, co ułatwia testowanie. W tej sekcji używamy usługi <strong>NodePort</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>whoami-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>NodePort</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>whoami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class=m>30002</span><span class=w>
</span></span></span></code></pre></div><p>Po utworzeniu usługi, dostęp <code>curl whoami.example.com:30002</code> pokaże IP jako <strong>NodeIP</strong>, a nie źródłowy IP żądania whoami.</p><blockquote><p>Uwaga: To nie jest poprawny IP klienta, to wewnętrzne IP klastra. Oto co się dzieje:</p><ul><li>Klient wysyła pakiet do node2:nodePort</li><li>node2 zastępuje źródłowy IP pakietu swoim własnym adresem IP (SNAT)</li><li>node2 zastępuje docelowy IP pakietu IP Pod</li><li>Pakiet jest routowany do node1, potem do endpointu</li><li>Odpowiedź Pod jest routowana z powrotem do node2</li><li>Odpowiedź Pod jest wysyłana z powrotem do klienta</li></ul></blockquote><p>Ilustracja graficzna:</p><p><img src=https://s2.loli.net/2024/05/27/fDg2tBx5FIcGMZN.png alt></p><h4 id=konfiguracja-externaltrafficpolicy-local>Konfiguracja externalTrafficPolicy: Local</h4><blockquote><p>Aby uniknąć tej sytuacji, Kubernetes ma funkcję zachowującą źródłowy IP klienta. Jeśli ustawisz service.spec.externalTrafficPolicy na Local, kube-proxy będzie proxyować żądania tylko do lokalnych endpointów, bez przekazywania ruchu do innych węzłów.</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>whoami-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>NodePort</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>externalTrafficPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Local</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>whoami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class=m>30002</span><span class=w>
</span></span></span></code></pre></div><p>Testuj za pomocą <code>curl whoami.example.com:30002</code>. Gdy <strong>whoami.example.com</strong> mapuje się na IP wielu węzłów klastra, istnieje pewna szansa na brak dostępu. Upewnij się, że rekord DNS zawiera tylko IP węzła z endpointem (podem).</p><p>Ta konfiguracja <strong>ma swoją cenę</strong>: traci się zdolność równoważenia obciążenia w klastrze. Klient uzyska odpowiedź tylko po dostępie do węzła z wdrożonym endpointem.</p><p><img src=https://s2.loli.net/2024/05/27/PCgiTLF28XE4RKx.png alt="Ograniczenie ścieżki dostępu"></p><p>Gdy klient uzyska dostęp do Node 2, nie będzie odpowiedzi.</p><h3 id=tworzenie-ingress>Tworzenie Ingress</h3><p>Większość usług oferowanych użytkownikom używa <strong>http/https</strong>, forma <strong>https://ip:port</strong> może być obca dla użytkowników. Zazwyczaj używa się <strong>Ingress</strong>, aby załadować usługę <strong>NodePort</strong> utworzoną powyżej na port <strong>80/443</strong> domeny.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>networking.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Ingress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>whoami-ingress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ingressClassName</span><span class=p>:</span><span class=w> </span><span class=l>external-lb-default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>whoami.example.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>pathType</span><span class=p>:</span><span class=w> </span><span class=l>Prefix</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>backend</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>whoami-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>port</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>number</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></div><p>Po zastosowaniu, testuj dostęp <code>curl whoami.example.com</code>. ClientIP zawsze będzie IP Poda <code>Ingress Controller</code> na węźle endpointu.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@client:~# curl whoami.example.com
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>RemoteAddr: 10.42.1.10:56482
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@worker:~# kubectl get -n ingress-nginx pod -o wide
</span></span><span class=line><span class=cl>NAME                                       READY   STATUS    RESTARTS   AGE    IP           NODE          NOMINATED NODE   READINESS GATES
</span></span><span class=line><span class=cl>ingress-nginx-controller-c8f499cfc-xdrg7   1/1     Running   <span class=m>0</span>          3d2h   10.42.1.10   k3s-agent-1   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><p>Użycie <strong>Ingress</strong> jako odwrotnego proxy dla usługi <strong>NodePort</strong> oznacza dwie warstwy service przed endpointem. Poniższy rysunek pokazuje różnicę.</p><pre class=mermaid>graph LR
    A[Client] --&gt;|whoami.example.com:80| B(Ingress)
    B --&gt;|10.43.38.129:32123| C[Service]
    C --&gt;|10.42.1.1:8080| D[Endpoint]</pre><pre class=mermaid>graph LR
    A[Client] --&gt;|whoami.example.com:30001| B(Service)
    B --&gt;|10.42.1.1:8080| C[Endpoint]</pre><p>W ścieżce 1, przy dostępie zewnętrznym do Ingress, pierwszym endpointem jest <code>Ingress Controller</code>, potem endpoint <strong>whoami</strong>.<br><strong>Ingress Controller</strong> to w istocie usługa <strong>LoadBalancer</strong>,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl -n ingress-nginx get svc
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAMESPACE   NAME             CLASS   HOSTS                       ADDRESS                                              PORTS   AGE
</span></span><span class=line><span class=cl>default     echoip-ingress   nginx   ip.example.com       172.16.0.57,2408:4005:3de:8500:4da1:169e:dc47:1707   <span class=m>80</span>      18h
</span></span><span class=line><span class=cl>default     whoami-ingress   nginx   whoami.example.com   172.16.0.57,2408:4005:3de:8500:4da1:169e:dc47:1707   <span class=m>80</span>      16h
</span></span></code></pre></div><p>Dlatego można ustawić wspomniane wcześniej <code>externalTrafficPolicy</code> w Ingress Controller, aby zachować źródłowy IP.</p><p>Jednocześnie należy ustawić <code>use-forwarded-headers</code> na <code>true</code> w <code>configmap</code> <code>ingress-nginx-controller</code>, aby <strong>Ingress Controller</strong> mógł rozpoznać pola <code>X-Forwarded-For</code> lub <code>X-REAL-IP</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>allow-snippet-annotations</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;false&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>compute-full-forwarded-for</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>use-forwarded-headers</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enable-real-ip</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>forwarded-for-header</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;X-Real-IP&#34;</span><span class=w> </span><span class=c># X-Real-IP or X-Forwarded-For</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app.kubernetes.io/component</span><span class=p>:</span><span class=w> </span><span class=l>controller</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app.kubernetes.io/instance</span><span class=p>:</span><span class=w> </span><span class=l>ingress-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app.kubernetes.io/name</span><span class=p>:</span><span class=w> </span><span class=l>ingress-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class=l>ingress-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app.kubernetes.io/version</span><span class=p>:</span><span class=w> </span><span class=m>1.10.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ingress-nginx-controller</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ingress-nginx</span><span class=w>
</span></span></span></code></pre></div><p>Różnica między usługą <strong>NodePort</strong> a <strong>ingress-nginx-controller</strong> polega na tym, że backend <strong>NodePort</strong> zazwyczaj nie jest wdrażany na każdym węźle, podczas gdy backend <strong>ingress-nginx-controller</strong> zazwyczaj jest wdrażany na każdym węźle eksponowanym na zewnątrz.</p><p>W przeciwieństwie do usługi <strong>NodePort</strong>, gdzie ustawienie <code>externalTrafficPolicy</code> powoduje brak odpowiedzi dla żądań między węzłami, <strong>Ingress</strong> może najpierw ustawić nagłówek, a potem przekazać żądanie, realizując zarówno <strong>zachowanie źródłowego IP</strong>, jak i <strong>równoważenie obciążenia</strong>.</p><h2 id=podsumowanie>Podsumowanie</h2><ul><li><strong>Translacja adresów (NAT)</strong>, <strong>Proxy</strong>, <strong>odwrotne proxy (Reverse Proxy)</strong>, <strong>równoważenie obciążenia (Load Balance)</strong> powodują utratę źródłowego IP.</li><li>Aby zapobiec utracie źródłowego IP, serwer proxy może ustawić prawdziwy IP w polu nagłówka HTTP <code>X-REAL-IP</code> podczas przekazywania. Przy wielu warstwach proxy używa się pola <code>X-Forwarded-For</code>, które w formie <strong>stosu</strong> rejestruje źródłowy IP i listę IP ścieżki proxy.</li><li>Ustawienie <code>externalTrafficPolicy: Local</code> w usłudze <strong>NodePort</strong> klastra zachowuje źródłowy IP, ale traci zdolność równoważenia obciążenia.</li><li><strong>ingress-nginx-controller</strong> wdrożony w formie <strong>daemonset</strong> na wszystkich węzłach roli <strong>loadbalancer</strong>, z ustawieniem <code>externalTrafficPolicy: Local</code>, zachowuje źródłowy IP i zdolność równoważenia obciążenia.</li></ul><h2 id=referencje>Referencje</h2><ul><li><a href=https://kubernetes.io/zh-cn/docs/tutorials/services/source-ip/>Kubernetes używanie źródłowego IP</a></li><li><a href=https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/configmap/>Ingress-Nginx Controller:ConfigMap</a></li><li><a href=https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress-controllers/>Ingress Controller</a></li></ul><br><script src=https://giscus.app/client.js data-repo=jqknono/blog data-repo-id=R_kgDONOhENQ data-category=Announcements data-category-id=DIC_kwDONOhENc4CkQDB data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script><br><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/pl-pl/blog/2024/05/21/pe%C5%82ne-rozwi%C4%85zanie-wireguard-do-walki-z-limitem-qos-udp-operatora/ aria-label="Poprzednia - Pełne rozwiązanie WireGuard do walki z limitem QoS UDP operatora" class="btn btn-primary"><span class=me-1>←</span>Poprzednia</a></li><li><a href=/pl-pl/blog/2024/05/27/instalacja-i-aktywacja-systemu-windows/ aria-label="Następna - Instalacja i aktywacja systemu Windows" class="btn btn-primary">Następna<span class=ms-1>→</span></a></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="User mailing list" aria-label="User mailing list"><a target=_blank rel=noopener href=https://groups.google.com/forum/#!forum/jqknono aria-label="User mailing list"><i class=envelope></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/jqknono aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="User mailing list" aria-label="User mailing list"><a target=_blank rel=noopener href=https://groups.google.com/forum/#!forum/jqknono aria-label="User mailing list"><i class=envelope></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2015&ndash;2025
<span class=td-footer__authors>jqknono</span></span><span class=td-footer__all_rights_reserved>Wszelkie prawa zastrzeżone</span></div></div></div></footer></div><script type=module async>
  import mermaid from "https:\/\/cdn.jsdelivr.net\/npm\/mermaid@latest\/dist\/mermaid.esm.min.mjs";

  (function ($) {
    if ($('.mermaid').length == 0) {
      mermaid.initialize({ startOnLoad: false });
      return;
    }

    var params = {"theme":"default","version":"latest"};

    
    
    var norm = function (defaultConfig, params) {
      var result = {};
      for (const key in defaultConfig) {
        const keyLower = key.toLowerCase();
        if (defaultConfig.hasOwnProperty(key) && params.hasOwnProperty(keyLower)) {
          if (typeof defaultConfig[key] === "object") {
            result[key] = norm(defaultConfig[key], params[keyLower]);
          } else {
            result[key] = params[keyLower];
          }
        }
      }
      return result;
    };

    var settings = norm(mermaid.mermaidAPI.defaultConfig, params);
    settings.startOnLoad = true;
    if ($('html[data-bs-theme="dark"]').length) {
      settings.theme = 'dark';
    }
    mermaid.initialize(settings);

    
    const lightDarkModeThemeChangeHandler = function (mutationsList, observer) {
      for (const mutation of mutationsList) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'data-bs-theme') {
          
          
          
          location.reload();
        }
      }
    };

    const observer = new MutationObserver(lightDarkModeThemeChangeHandler);
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['data-bs-theme']
    });
    

  })(jQuery);
</script><script src=/js/main.min.d20e761d6aa4d2ace0488e45da0e775a8b17300a8430f32fbcfa016e6c9e6eb6.js integrity="sha256-0g52HWqk0qzgSI5F2g53WosXMAqEMPMvvPoBbmyebrY=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>