<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en-us class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://blog.jqknono.com/en-us/blog/programmer/><link rel=alternate type=application/rss+xml href=https://blog.jqknono.com/en-us/blog/programmer/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Programmers | Nono Blogs</title><meta name=description content="jqknono's Blogs"><meta property="og:url" content="https://blog.jqknono.com/en-us/blog/programmer/"><meta property="og:site_name" content="Nono Blogs"><meta property="og:title" content="Programmers"><meta property="og:description" content="jqknono's Blogs"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta itemprop=name content="Programmers"><meta itemprop=description content="jqknono's Blogs"><meta itemprop=datePublished content="2024-06-28T18:29:45+08:00"><meta itemprop=dateModified content="2024-06-28T18:29:45+08:00"><meta itemprop=keywords content="Tutorial,Developer"><meta name=twitter:card content="summary"><meta name=twitter:title content="Programmers"><meta name=twitter:description content="jqknono's Blogs"><link rel=preload href=/scss/main.min.0f2fa9571091c9ef7d3c35d7a3f7d09da4f49c5c7013a6ea9a0a80d216151751.css as=style integrity="sha256-Dy+pVxCRye99PDXXo/fQnaT0nFxwE6bqmgqA0hYVF1E=" crossorigin=anonymous><link href=/scss/main.min.0f2fa9571091c9ef7d3c35d7a3f7d09da4f49c5c7013a6ea9a0a80d216151751.css rel=stylesheet integrity="sha256-Dy+pVxCRye99PDXXo/fQnaT0nFxwE6bqmgqA0hYVF1E=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-F3FFTG72NE"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F3FFTG72NE")}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9457787069079604" crossorigin=anonymous></script></head><body class="td-section td-blog"><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/en-us/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Nono Blogs</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/en-us/docs/><i class='fas fa-book'></i><span>Docs</span></a></li><li class=nav-item><div class="td-lang-menu dropdown"><a class="nav-link dropdown-toggle td-lang-menu__title" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><span class=td-lang-menu__title-text>English</span>
<span class=td-lang-menu__title-code>EN-US</span></a><ul class=dropdown-menu><li><span class="dropdown-item active">English</span></li><li><a class=dropdown-item href=/blog/programmer/>简体中文</a></li><li><span class="dropdown-item disabled">繁體中文</span></li><li><span class="dropdown-item disabled">日本語</span></li><li><span class="dropdown-item disabled">한국어</span></li><li><span class="dropdown-item disabled">العربية</span></li><li><span class="dropdown-item disabled">العربية</span></li><li><span class="dropdown-item disabled">Deutsch</span></li><li><span class="dropdown-item disabled">Español</span></li><li><span class="dropdown-item disabled">Français</span></li><li><span class="dropdown-item disabled">हिंदी</span></li><li><span class="dropdown-item disabled">Bahasa Indonesia</span></li><li><span class="dropdown-item disabled">Italiano</span></li><li><span class="dropdown-item disabled">Nederlands</span></li><li><span class="dropdown-item disabled">Polski</span></li><li><span class="dropdown-item disabled">Português</span></li><li><span class="dropdown-item disabled">Русский</span></li><li><span class="dropdown-item disabled">Türkçe</span></li></ul></div></li><li class=nav-item><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.5f8ffa01e3c71cde1a5cd3dba1f560f6.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/en-us/blog/programmer/>Return to the regular view of this page</a>.</p></div><h1 class=title>Programmers</h1><ul><li><a href=#pg-7c8c934841f8148d53940d8b9bc2a25c>Learning Architecture via Prompts</a></li><ul><li><a href=#pg-b339e76ccfa4191e675fdafc18b3e566>Android Development</a></li></ul><li><a href=#pg-69213d25de3eb5d09bef22acc5b6f46c>AI-assisted programming</a></li><ul><li><a href=#pg-b2f74753199c5b7c655b00a6d9fbebaa>Why Has GitHub Copilot Become Dumber?</a></li><li><a href=#pg-5050d4046ee4d804fe5f8cbb930f35d3>The AI Assistant Is Way Smarter Than Me</a></li></ul><li><a href=#pg-516d1e92844a4d59cfc9d8dd3a7d916d>Network</a></li><ul><li><a href=#pg-20c5c67efd6f1c5330fc1fdaaa2d3511>A Few Ways to Safely Use Public IPv6</a></li><li><a href=#pg-d0c8bf9a84e7bd53f54d296a8bba5216>Using Common DDNS Subdomains May Cause China Telecom Broadband Service Degradation</a></li><li><a href=#pg-7b073c189bd96532e8ec1745b2035366>Compliance Discussion of Reverse Proxy in Home Networks</a></li><li><a href=#pg-9f33db10d188dabb121b57e8f553b6ce>Some Characteristics of China Telecom IPv6</a></li><li><a href=#pg-dc89a1e4586849dfad4414cb230f7db4>Why we should not think of UDP in terms of TCP</a></li><li><a href=#pg-ff3ca18908624a0efa9c7071237da99a>Troubleshooting Linux Network Issues</a></li><li><a href=#pg-6147d5368d4d001498e0b3ce634999ea>How to Improve Network Experience with a Self-Hosted DNS Service</a></li><li><a href=#pg-875f5a75893e4ebbdef3ca88aa5b5475>Bypassing ChatGPT VPN Detection</a></li></ul><li><a href=#pg-70e10d2259bbe582e015568a08904584>Chat</a></li><ul><li><a href=#pg-4715580aecd7f99d5f1d2596741fe673>Which Languages Are Best for Multilingual Projects</a></li><li><a href=#pg-b76987c1f943229523ed1e7b190953ce>Third-party Library Pitfalls</a></li><li><a href=#pg-b2075f5d67b31c9121400493c38d52c0>Design Specification Template</a></li><li><a href=#pg-9a83f3cf008d3b474647c108ce516035>Command Line Syntax Conventions</a></li><li><a href=#pg-0c87579cd7a3ba25ef5e14bf05e1c7e6>Meanings of brackets in man pages</a></li><li><a href=#pg-7ae20abfa23cd10f15a2834efe0cd517>Huawei C++ Coding Standards</a></li></ul><li><a href=#pg-a9284f6fd72fa5034776c7b98a6b84ea>linux</a></li><ul><li><a href=#pg-1d923d50335234cf99ddbb9a6fc7c721>linux tour</a></li></ul><li><a href=#pg-b2a9b4dd4fed13596e54bf7b1ac65d82>Troubleshooting</a></li><ul></ul><li><a href=#pg-89cbb2dd0a0a96dbbd79a9ac9a894761>windows</a></li><ul><li><a href=#pg-e026196632c59be506a0151d656504b5>Windows SSH Remote Login</a></li><li><a href=#pg-195482425345048d2f23cc6e5a3f36fa>Understanding Windows Networking_WFP</a></li><li><a href=#pg-63cc6d36463add07c363c19e9d6357d2>Understanding Windows Event Tracing (ETW)</a></li><li><a href=#pg-a3673aba36ec41cb0458b4256f8be612>wireguard configuration</a></li><li><a href=#pg-7b6314989d253d9fadbc558b8fb75b3d>Windows Blocking Network Traffic Capture</a></li><li><a href=#pg-a7f54bb02ebc7bbb8cc0b4a2de5f0784>Windows Firewall Management – netsh</a></li><li><a href=#pg-7154e5da447955abfe28de976ea980e6>Windows Resources</a></li><li><a href=#pg-dc08d8c63151ed8a0f9692c0720a0e3c>Windows Guide</a></li><li><a href=#pg-61abe4532313c2fd9d4e7585b6edf0d9>window-message</a></li><li><a href=#pg-6c9144bf4bbbb75884f99fcddaa67574>Win-to-go</a></li></ul><li><a href=#pg-fdca4b70fcac0969d3f6f11c73bd982f>environment</a></li><ul><li><a href=#pg-c3eced6fd7bfa18bd259b226e3eaae74>Windows Subsystem Linux(WSL)</a></li><ul><li><a href=#pg-0d5ef95054bbbb5dee5b9075089dd8c0>WSL Mirrored Network Mode Configuration Guide</a></li><li><a href=#pg-8c275cc52eb0aeccde59940d54b04590>wsl</a></li></ul><li><a href=#pg-9aae4a903852faf9a0f472a446cdffc6>Virtual Memory Disk Setup</a></li><li><a href=#pg-0bfa54d6f8df04d6a03555efc9df6b4b>vs-remote-debug</a></li></ul><li><a href=#pg-483d9b8533f77c210a385fd1ae507e54>How Many Principles of Design Patterns Are There?</a></li><li><a href=#pg-3127fe4f549e713432b986a2279f07a3>Cross-Platform Content Publishing Tool — A Review of "蚁小二"</a></li><li><a href=#pg-175e4c3dd63eb7bb326bb484aea4a3d6>Jianshu Writing Experience</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-7c8c934841f8148d53940d8b9bc2a25c>Learning Architecture via Prompts</h1><div class="td-byline mb-4"><time datetime=2025-05-24 class=text-body-secondary>Saturday, May 24, 2025</time></div><ul><li>[<a href=Android%E5%BC%80%E5%8F%91 title="Android Development">Android Development</a>]</li></ul></div><div class=td-content><h1 id=pg-b339e76ccfa4191e675fdafc18b3e566>Android Development</h1><div class="td-byline mb-4"><time datetime=2025-05-24 class=text-body-secondary>Saturday, May 24, 2025</time></div><blockquote><p>Preface: You might find this prompt somewhat abstract at first, but a little patience goes a long way—knowledge must first be memorized, then understood.
A few exceptional minds grasp concepts instantly without practice, but for most of us, hands-on experience is essential. Through concrete implementation we generalize ideas, turning knowledge into second nature.
Try committing these prompts to memory for now; they can guide everyday work, where you’ll gradually absorb their distilled wisdom.
Feel free to share any thoughts you have.</p></blockquote><h2 id=cursor-rule>Cursor Rule</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>// Android Jetpack Compose .cursorrules
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// Flexibility Notice
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// Note: This is a recommended project structure—stay flexible and adapt to the existing project layout.
</span></span><span class=line><span class=cl>// If the project follows a different organisation style, do not force these structural patterns.
</span></span><span class=line><span class=cl>// While applying Jetpack Compose best practices, prioritise maintaining harmony with the current architecture.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// Project Architecture <span class=err>&amp;</span> Best Practices
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>const androidJetpackComposeBestPractices = [
</span></span><span class=line><span class=cl>&#34;Adapt to the existing architecture while upholding clean code principles&#34;,
</span></span><span class=line><span class=cl>&#34;Follow Material Design 3 guidelines and components&#34;,
</span></span><span class=line><span class=cl>&#34;Implement clean architecture with domain, data, and presentation layers&#34;,
</span></span><span class=line><span class=cl>&#34;Use Kotlin coroutines and Flow for asynchronous operations&#34;,
</span></span><span class=line><span class=cl>&#34;Use Hilt for dependency injection&#34;,
</span></span><span class=line><span class=cl>&#34;Adhere to unidirectional data flow with ViewModel and UI State&#34;,
</span></span><span class=line><span class=cl>&#34;Use Compose Navigation for screens management&#34;,
</span></span><span class=line><span class=cl>&#34;Implement proper state hoisting and composition&#34;,
</span></span><span class=line><span class=cl>];
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// Folder Structure
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// Note: This is a reference structure—adapt it to your project’s existing organisation
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>const projectStructure = <span class=sb>`app/
</span></span></span><span class=line><span class=cl><span class=sb>  src/
</span></span></span><span class=line><span class=cl><span class=sb>    main/
</span></span></span><span class=line><span class=cl><span class=sb>      java/com/package/
</span></span></span><span class=line><span class=cl><span class=sb>        data/
</span></span></span><span class=line><span class=cl><span class=sb>          repository/
</span></span></span><span class=line><span class=cl><span class=sb>          datasource/
</span></span></span><span class=line><span class=cl><span class=sb>          models/
</span></span></span><span class=line><span class=cl><span class=sb>        domain/
</span></span></span><span class=line><span class=cl><span class=sb>          usecases/
</span></span></span><span class=line><span class=cl><span class=sb>          models/
</span></span></span><span class=line><span class=cl><span class=sb>          repository/
</span></span></span><span class=line><span class=cl><span class=sb>        presentation/
</span></span></span><span class=line><span class=cl><span class=sb>          screens/
</span></span></span><span class=line><span class=cl><span class=sb>          components/
</span></span></span><span class=line><span class=cl><span class=sb>          theme/
</span></span></span><span class=line><span class=cl><span class=sb>          viewmodels/
</span></span></span><span class=line><span class=cl><span class=sb>        di/
</span></span></span><span class=line><span class=cl><span class=sb>        utils/
</span></span></span><span class=line><span class=cl><span class=sb>      res/
</span></span></span><span class=line><span class=cl><span class=sb>        values/
</span></span></span><span class=line><span class=cl><span class=sb>        drawable/
</span></span></span><span class=line><span class=cl><span class=sb>        mipmap/
</span></span></span><span class=line><span class=cl><span class=sb>    test/
</span></span></span><span class=line><span class=cl><span class=sb>    androidTest/`</span>;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// Compose UI Guidelines
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>const composeGuidelines = <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>1. Use remember and derivedStateOf appropriately
</span></span></span><span class=line><span class=cl><span class=sb>2. Implement proper recomposition optimisation
</span></span></span><span class=line><span class=cl><span class=sb>3. Apply the correct order of Compose modifiers
</span></span></span><span class=line><span class=cl><span class=sb>4. Follow naming conventions for composable functions
</span></span></span><span class=line><span class=cl><span class=sb>5. Implement proper preview annotations
</span></span></span><span class=line><span class=cl><span class=sb>6. Use MutableState for correct state management
</span></span></span><span class=line><span class=cl><span class=sb>7. Implement proper error handling and loading states
</span></span></span><span class=line><span class=cl><span class=sb>8. Leverage MaterialTheme for proper theming
</span></span></span><span class=line><span class=cl><span class=sb>9. Follow accessibility guidelines
</span></span></span><span class=line><span class=cl><span class=sb>10. Apply proper animation patterns
</span></span></span><span class=line><span class=cl><span class=sb>    `</span>;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// Testing Guidelines
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>const testingGuidelines = <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>1. Write unit tests for ViewModels and UseCases
</span></span></span><span class=line><span class=cl><span class=sb>2. Implement UI tests using the Compose testing framework
</span></span></span><span class=line><span class=cl><span class=sb>3. Use fake repositories for testing
</span></span></span><span class=line><span class=cl><span class=sb>4. Achieve adequate test coverage
</span></span></span><span class=line><span class=cl><span class=sb>5. Use proper test coroutine dispatchers
</span></span></span><span class=line><span class=cl><span class=sb>   `</span>;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// Performance Guidelines
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>const performanceGuidelines = <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>
</span></span></span><span class=line><span class=cl><span class=sb>1. Minimise recompositions with proper keys
</span></span></span><span class=line><span class=cl><span class=sb>2. Use LazyColumn and LazyRow for efficient lazy loading
</span></span></span><span class=line><span class=cl><span class=sb>3. Implement efficient image loading
</span></span></span><span class=line><span class=cl><span class=sb>4. Prevent unnecessary updates with proper state management
</span></span></span><span class=line><span class=cl><span class=sb>5. Follow correct lifecycle awareness
</span></span></span><span class=line><span class=cl><span class=sb>6. Implement proper memory management
</span></span></span><span class=line><span class=cl><span class=sb>7. Use adequate background processing
</span></span></span><span class=line><span class=cl><span class=sb>   `</span>;
</span></span></code></pre></div><h2 id=references>References</h2><ul><li><a href=https://github.com/Project-Translation/awesome-cursorrules>https://github.com/Project-Translation/awesome-cursorrules</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-69213d25de3eb5d09bef22acc5b6f46c>AI-assisted programming</h1><div class="td-byline mb-4"><time datetime=2025-03-17 class=text-body-secondary>Monday, March 17, 2025</time></div><p>Embrace change.</p></div><div class=td-content><h1 id=pg-b2f74753199c5b7c655b00a6d9fbebaa>Why Has GitHub Copilot Become Dumber?</h1><div class="td-byline mb-4"><time datetime=2025-05-28 class=text-body-secondary>Wednesday, May 28, 2025</time></div><style>.column-container{display:flex;gap:2rem;margin:2rem 0}.column{flex:1;padding:1rem;background-color:#f8f9fa;border-radius:8px;overflow-y:auto;max-height:80vh}.column h2{color:#1a73e8;border-bottom:2px solid #e0e0e0;padding-bottom:.5rem;margin-top:0}</style><div class=column-container><div class=column><h2>Article Title One</h2><p>Paste the full content of the first article here...</p></div><div class=column><h2>Article Title Two</h2><p>Paste the full content of the second article here...</p></div></div></div><div class=td-content style=page-break-before:always><h1 id=pg-5050d4046ee4d804fe5f8cbb930f35d3>The AI Assistant Is Way Smarter Than Me</h1><div class="td-byline mb-4"><time datetime=2025-03-17 class=text-body-secondary>Monday, March 17, 2025</time></div><p>For a middle-aged man who has been coding for ten years, once went abroad for a gilded stint, and still cares about saving face, admitting that AI is better than me is downright embarrassing.</p><p>The total monthly cost of all the AI tools I use doesn’t exceed 200 RMB, yet my boss pays me far more than that.</p><p>I fully expect earfuls of ridicule:</p><blockquote><p>“That’s only you.”</p></blockquote><blockquote><p>“That’s what junior devs say.”</p></blockquote><blockquote><p>“It only handles the easy stuff.”</p></blockquote><blockquote><p>“It can’t do real engineering.”</p></blockquote><blockquote><p>“Its hallucinations are severe.”</p></blockquote><blockquote><p>“It’s not fit for production.”</p></blockquote><p>My experience with AI tools has been robust enough to let me shrug off such mockery. This article won’t promote any specific tool; its main purpose is to create an echo in your thoughts, since I learn so much from each comment thread.</p><p>I was among the first users of GitHub Copilot; I started in the beta and, once it ended, renewed for a year without hesitation—and I’m still using it today. I no longer get excited when I solve a thorny problem on my own, nor do I take pride in “elegant code.” The only thing that thrills me now is when the AI accurately understands what I am trying to express, when my AI assistant fulfills my request—and exceeds my expectations.</p><p>Of the experience I accumulated over the past decade, what turns out to be most useful with AI tools is:</p><ul><li>Logic</li><li>Design patterns</li><li>Regular expressions</li><li>Markdown</li><li>Mermaid</li><li>Code style</li><li>Data structures and algorithms</li></ul><p>More specifically:</p><ul><li>A major premise, a minor premise, and a suitable relation between them.</li><li>Create dependencies cautiously and strictly prevent circular ones.</li><li>Do not add relations unless necessary; do not broaden the scope of relations unless necessary.</li><li>Strictly control the size of logic blocks.</li><li>Use regex-based searches and, following naming conventions, generate code that lends itself to such searches.</li><li>Generate Mermaid diagrams, review and fine-tune them, then use Mermaid diagrams to guide code generation.</li><li>Use the <em>names</em> of data structures and algorithms to steer code generation.</li></ul><p>I have spent a lot of time contributing to various open-source projects—some in familiar domains, others not. It’s experience that lets me ramp up quickly. You’ll notice that great projects all look alike, while lousy projects are lousy in their own distinct ways.</p><p>If my memory gradually deteriorates and I start forgetting all the knowledge I once accumulated, yet still have to keep programming to put food on the table, and if I could write only the briefest reminder to myself on a sticky note, I would jot: <code>Google "How-To-Ask-Questions"</code></p><blockquote><p>Are humans smarter than AI? Or are only some humans smarter than some AI?</p></blockquote><p>I have to be honest: puffing up my own ego brings no real benefit. As the title says, this article tears off the façade and exposes what I truly feel inside—that AI is better than me, far better. Whenever doubts about AI creep in, I’ll remind myself:</p><blockquote><p>Is AI dumber than humans? Or are only some humans dumber than some AI? Maybe I need to ask the question differently?</p></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-516d1e92844a4d59cfc9d8dd3a7d916d>Network</h1><div class="td-byline mb-4"><time datetime=2024-11-13 class=text-body-secondary>Wednesday, November 13, 2024</time></div><ul><li><input disabled type=checkbox> Network</li></ul><h1 id=network>Network</h1><ul><li>Bypass firewall<ul><li>[<a href=wireguard%E5%AF%B9%E6%8A%97%E8%BF%90%E8%90%A5%E5%95%86 title=wireguard对抗运营商>wireguard对抗运营商</a>]</li></ul></li><li>Network troubleshooting<ul><li>[<a href=linux%E7%BD%91%E7%BB%9C%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D title=linux网络问题定位>linux网络问题定位</a>]</li><li>[<a href=windows%E7%BD%91%E7%BB%9C%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D title=windows网络问题定位>windows网络问题定位</a>]</li></ul></li></ul></div><div class=td-content><h1 id=pg-20c5c67efd6f1c5330fc1fdaaa2d3511>A Few Ways to Safely Use Public IPv6</h1><div class="td-byline mb-4"><time datetime=2025-02-28 class=text-body-secondary>Friday, February 28, 2025</time></div><p>Some people need to “go home” via public IPv6. Unlike Tailscale/Zerotier et al., which rely on NAT traversal to create direct tunnels, native IPv6 offers a straight-through connection. Cellular networks almost always hand out global IPv6 addresses, so “going home” is extremely convenient.</p><p>I previously posted <a href=https://www.v2ex.com/t/1112630>Using Common DDNS Sub-domains on Home Broadband May Downgrade Telecom Service</a> describing a pitfall with IPv6: domains get crawled. Exposing your domain is basically the same as exposing your IPv6 address. Once scanners find open services and inbound sessions pile up, the ISP may silently throttle or downgrade your line.</p><p>That thread mentioned domain scanning but not <em>cyberspace scanning</em>—which ignores whatever breadcrumbs you leave and just brute-forces entire address blocks. This is much harder to defend against.</p><p><em>Cyberspace scanning</em> usually includes the following steps:</p><ul><li><strong>Host-alive detection</strong> using ARP, ICMP, or TCP to list responsive IPs.</li><li><strong>Port / service discovery</strong> to enumerate open ports and identify service names, versions, and OS signatures.</li><li><strong>Operating-system fingerprinting</strong> by analyzing packet replies.</li><li><strong>Traffic collection</strong> to spot anomalies or attack patterns.</li><li><strong>Alias resolution</strong> mapping multiple IPs to the same router.</li><li><strong>DNS recon</strong> reverse-resolving IPs to domain names.</li></ul><p>Below are a few methods to stay off those scanners:</p><ol><li>Have your internal DNS server never return AAAA records.</li><li>Allow internal services to be reached only via domain names, never by raw IP.</li><li>Use a private DNS service such as <a href=https://www.adguardprivate.com>AdGuardPrivate</a>.</li></ol><h2 id=prevent-aaaa-records-on-the-internal-dns>Prevent AAAA Records on the Internal DNS</h2><p>When you browse the web, every outbound connection can leak your source IPv6. If a firewall isn’t in place, that address enters the scanners’ high-priority IP pools.</p><p>Even scanning only the last 16 bits of a <code>/56</code> prefix becomes a smaller task once the prefix is leaked.</p><p>After years of IPv6 use, I have seen no practical difference between IPv6 and IPv4 for day-to-day browsing. So we can sacrifice IPv6 for outbound traffic and reserve it solely for “go home” access.</p><h3 id=how-to-block-aaaa-records>How to block AAAA records</h3><p>Configure your internal DNS resolver to drop all AAAA answers.</p><p>Most home setups run AdGuard Home—see the screenshot:</p><p><img src=https://img1.techfetch.dev/blog/202502281307671.png alt="Disable IPv6"></p><p>Once applied, local devices reach the outside world over IPv4 only.</p><h2 id=never-expose-services-by-ip>Never Expose Services by IP</h2><p>Exposing a service on a naked port makes discovery trivial. When you start a service, avoid binding to <code>0.0.0.0</code> and <code>::</code>; almost every tutorial defaults to <code>127.0.0.1</code> plus <code>::1</code> for good reason—listening on public addresses is risky.</p><h3 id=reverse-proxy-only-by-domain-name>Reverse-proxy only by domain name</h3><h4 id=nginx-example>nginx example</h4><p>Set <code>server_name</code> to an actual hostname instead of <code>_</code> or an IP.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span> <span class=s>yourdomain.com</span><span class=p>;</span> <span class=c1># replace with your real domain
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1># 403 for anything not the correct hostname
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>if</span> <span class=s>(</span><span class=nv>$host</span> <span class=s>!=</span> <span class=s>&#39;yourdomain.com&#39;)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>return</span> <span class=mi>403</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>root</span> <span class=s>/path/to/your/web/root</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>index</span> <span class=s>index.html</span> <span class=s>index.htm</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># additional config...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h4 id=iis-example>IIS example</h4><p>Remember to specify the exact hostname—never leave the host field blank.</p><p><img src=https://img1.techfetch.dev/blog/202502281323570.png alt="IIS demo"></p><h3 id=use-a-private-dns-service>Use a private DNS service</h3><p>Create spoofed hostnames that resolve only inside your own DNS.</p><p><img src=https://img1.techfetch.dev/blog/202502281330658.png alt="DNS rewrites"></p><p>Benefits:</p><ul><li>Hostnames can be <em>anything</em>—no need to buy a public domain.</li><li>If a fake hostname leaks, the attacker still has to point their DNS resolver at your private server.</li><li>Scanning the IP alone is useless: one must also (a) know the fake name, (b) set their resolver to <em>your</em> DNS, (c) include that name in each request’s Host header. All steps have to succeed.</li></ul><pre class=mermaid>sequenceDiagram
  participant Scanner as Scanner
  participant DNS as Private DNS
  participant Service as Internal Service

  Scanner-&gt;&gt;DNS: 1. Find private DNS address
  Scanner-&gt;&gt;DNS: 2. Query fake hostname
  DNS--&gt;&gt;Scanner: 3. Return internal IP
  Scanner-&gt;&gt;Service: 4. Construct Host header
  Note right of Service: Denied if Host ≠ fake hostname
  alt Correct Host
    Service--&gt;&gt;Scanner: 5a. Response
  else Wrong Host
    Service--&gt;&gt;Scanner: 5b. 403
  end</pre><p>This significantly increases the scanning cost.</p><p>You can deploy AdGuardPrivate (almost a labeled AdGuard Home) or Tencent’s dnspod purely for custom records. Functionality differs, so evaluate accordingly.</p><h2 id=summary>Summary</h2><ol><li><p>Prevent the internal DNS from returning AAAA records</p><ul><li>Pre-reqs<ul><li>Public IPv6 prefix</li><li>Internal DNS resolver</li></ul></li><li>Steps<ul><li>Drop AAAA answers</li></ul></li></ul></li><li><p>Reach internal services only via domain names</p><ul><li>Pre-reqs<ul><li>You own a domain</li><li>Registrar supports DDNS</li><li>Local reverse proxy already running</li></ul></li><li>Steps<ul><li>Enable DDNS task</li><li>Host-based access only</li></ul></li></ul></li><li><p>Spin up a private DNS</p><ul><li>Pre-reqs<ul><li>Private DNS service with custom records and DDNS</li></ul></li><li>Steps<ul><li>Enable DDNS task</li><li>Map fake hostnames to internal services</li></ul></li></ul></li></ol><p>Finally:</p><ul><li>Tailscale/Zerotier that successfully punch through are still the simplest and safest way to go home.</li><li>Don’t hop on random Wi-Fi—you’ll give everything away in one shot. Grab a big-data SIM and keep your faith with the carrier for now. (Cheap high-traffic SIM? DM me. Not really.)</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-d0c8bf9a84e7bd53f54d296a8bba5216>Using Common DDNS Subdomains May Cause China Telecom Broadband Service Degradation</h1><div class="td-byline mb-4"><time datetime=2025-02-19 class=text-body-secondary>Wednesday, February 19, 2025</time></div><p>I have been troubleshooting IPv6 disconnections and hole-punching failures for over three months. I’ve finally identified the root cause; here’s the story.</p><h2 id=my-first-post-asking-for-helpipv6-disconnections>My First Post Asking for Help—IPv6 Disconnections</h2><p>IPv6 had been working perfectly. Without touching any settings, and even though every device had its own IPv6, it suddenly lost IPv6 connectivity entirely.</p><p><code>curl 6.ipw.cn</code> returned nothing, and both <code>ping6</code> and <code>traceroute6 2400:3200::1</code> failed.</p><p>My ONT was bridged to the router, and I could still obtain the router’s own IPv6—one that could still reach the IPv6 Internet.</p><p>I received a <code>/56</code> prefix, and all downstream devices received addresses within <code>240e:36f:15c3:3200::/56</code>, yet none could reach any IPv6 site.</p><p>I suspected the ISP had no route for <code>240e:36f:15c3:3200::</code>, but I couldn’t prove it.</p><p>Someone suggested excessive PCDN upload traffic was the culprit, but upload volume was minimal and PCDN wasn’t enabled.</p><p>Another possibility was that using Cloudflare and Aliyun ESA reverse proxies had caused it.</p><h2 id=my-second-postfinding-a-direct-cause>My Second Post—Finding a Direct Cause</h2><p>I confirmed that at least some regions of China Telecom will downswitch service when they see many inbound IPv6 HTTP/HTTPS connections, manifesting as:</p><ul><li><em>Fake IPv6</em>: You still get a <code>/56</code>, every device keeps its IPv6, but traceroute lacks a route, so IPv6 is de-facto unusable.</li><li><em>Fake hole- punch</em>: Tailscale reports its connection is direct, yet latency is extreme and speed is terrible.</li></ul><p>Every time I disabled Cloudflare/Aliyun ESA proxying and rebooted the router a few times, both real IPv6 connectivity and true direct Tailscale worked again.</p><h2 id=still-disconnects-after-disabling-reverse-proxy>Still Disconnects After Disabling Reverse Proxy</h2><p>Even with proxy/CDN disabled—complete direct origin access—I still had occasional outages lasting hours.</p><p>Perhaps my domain had leaked, or bots were scanning popular subdomains with a steady HTTP attack.</p><p>When I disabled DNS resolution for the DDNS hostname outright, IPv6 came back after a while, and Tailscale hole-punching was again direct and stable.</p><p>Since then those disconnections never returned.</p><h2 id=my-final-recommendation>My Final Recommendation</h2><p>Avoid using commonplace DDNS subdomains, such as:</p><ul><li>home.example.com</li><li>nas.example.com</li><li>router.example.com</li><li>ddns.example.com</li><li>cloud.example.com</li><li>dev.example.com</li><li>test.example.com</li><li>webdav.example.com</li></ul><p>I had used several of these; it seems they are continuously scanned by bots. The resulting flood of requests triggered China Telecom’s degradation policy, making my IPv6 unusable and blocking hole-punching.</p><p>As you already know, hiding your IP matters in network security; the same goes for protecting the domain you use for DDNS—that domain exposes your IP as well.</p><p>If you still need public services, you have two practical choices:</p><ol><li><strong>Proxy/Front-end relay</strong>—traffic hits a VPS first, then your home server. Latency and bandwidth suffer because traffic takes a detour.</li><li><strong>DDNS direct</strong>—everything connects straight to you. Performance is much better; this is what I recommend. For personal use the number of connections rarely hits the limit, but once the domain becomes public the bots will ramp it up quickly.</li></ol><h3 id=proxy-relay-reverse-proxy>Proxy Relay (Reverse Proxy)</h3><h4 id=cloudflare-tunnel>Cloudflare Tunnel</h4><p>Use Cloudflare’s Tunnel so you won’t see the dozens or hundreds of IPs typical of ordinary reverse proxies.</p><h4 id=tailscale-or-zerotier>Tailscale or ZeroTier</h4><p>Build your own VPN, put a VPS in front, and reach your LAN services through the VPN. This avoids excessive simultaneous connections.</p><h3 id=ddns-direct-scheme>DDNS Direct Scheme</h3><h4 id=public-dns>Public DNS</h4><p>Generate a random string—like a GUID—and use it as your DDNS hostname. It’s impossible to remember, but for personal use that’s acceptable. Judge for yourself.</p><h4 id=private-dns>Private DNS</h4><p>Run your own DNS service, e.g.:</p><ul><li><a href=https://www.adguardprivate.com>AdguardPrivate</a></li><li><a href=https://dot.pub>dot.pub</a></li></ul><p>Configure it to serve your DDNS records; only people who can query your private DNS will resolve the custom IP.</p><p>In this model you <em>can</em> use common DDNS names, but take care never to expose the address of your private DNS server.</p><h2 id=afterthought>Afterthought</h2><p>Rumor has it that naming a subdomain <strong>speedtest</strong> might provide a mysterious boost.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-7b073c189bd96532e8ec1745b2035366>Compliance Discussion of Reverse Proxy in Home Networks</h1><div class=lead>Exploring potential compliance issues and solutions when using reverse-proxy services on home broadband</div><div class="td-byline mb-4"><time datetime=2025-02-17 class=text-body-secondary>Monday, February 17, 2025</time></div><h1 id=background>Background</h1><p>About 90 days ago, I encountered an IPv6 connectivity issue with China Telecom Hubei. After long-term observation and analysis, here are the findings.</p><h1 id=problem-analysis>Problem Analysis</h1><p>Two initial suspected causes:</p><ol><li><p>PCDN usage detection</p><ul><li>No active use of PCDN</li><li>Only a small amount of BitTorrent downloads</li><li>Upload throttling has been applied, yet the problem persists</li></ul></li><li><p>Home server acting as blog origin</p><ul><li>Uses Cloudflare origin rules specifying a port</li><li>May be deemed “commercial behavior” by the ISP</li></ul></li></ol><p>After three months of validation, the issue is more likely triggered by exposing HTTP/HTTPS service ports to the public Internet.</p><h1 id=specific-symptoms>Specific Symptoms</h1><ol><li><p>IPv6 anomalies:</p><ul><li>/56 prefix is assigned</li><li>Devices receive global IPv6 addresses</li><li>Yet external network access fails</li><li>Only the router in bridge mode behind the optical modem retains normal IPv6</li></ul></li><li><p>Tailscale connection anomalies:</p><ul><li>The source server reports direct connectivity but with excessive latency (~400 ms)</li><li>Other devices go through relays and obtain lower latency (~80 ms)</li></ul></li></ol><h1 id=isp-policy-analysis>ISP Policy Analysis</h1><p>Telecom carriers in certain regions apply service degradation to inbound-heavy HTTP/HTTPS connections:</p><ol><li><p>IPv6 service downgrade</p><ul><li>Addresses are still assigned</li><li>Routing tables are missing</li><li>Effective Internet access is blocked</li></ul></li><li><p>P2P connection throttling</p><ul><li>Tailscale shows direct connections</li><li>Actual latency is abnormally high</li><li>Bandwidth is restricted</li></ul></li></ol><h1 id=solutions>Solutions</h1><ol><li><p>Disable reverse-proxy services:</p><ul><li>Deactivate Cloudflare/Alibaba Cloud ESA reverse proxies</li><li>After multiple router reboots, connectivity returns to normal</li></ul></li><li><p>Prevent domain scanning:
Avoid these common sub-domains:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>- home.example.com
</span></span><span class=line><span class=cl>- ddns.example.com
</span></span><span class=line><span class=cl>- dev.example.com
</span></span><span class=line><span class=cl>- test.example.com
</span></span></code></pre></div></li><li><p>Best practices:</p><ul><li>Use a GUID to generate random sub-domains</li><li>Refrain from predictable or common sub-domain naming</li><li>Rotate domains periodically to reduce scanning risk</li></ul></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-9f33db10d188dabb121b57e8f553b6ce>Some Characteristics of China Telecom IPv6</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><p><input disabled type=checkbox> Some Characteristics of China Telecom IPv6</p></li><li><p><input disabled type=checkbox> Some Characteristics of China Telecom IPv6</p></li></ul><p>IPv6 has been fully rolled out nationwide; the IPv6 address pool is large enough for each of every individual’s devices to obtain its own IPv6 address.<br>To actually use IPv6 at home, the entire stack of devices must all support IPv6. Because the rollout has been underway for many years, virtually every device bought after 2016 already supports IPv6.</p><p>The full stack includes: metro equipment → community router → home router (ONT/router) → end device (phones, PCs, smart TVs, etc.)</p><p>This article does not discuss the standard IPv6 protocol itself; it focuses only on certain characteristics of China Telecom’s IPv6.</p><h2 id=address-allocation>Address Allocation</h2><p>First, the methods of address assignment. IPv6 offers three ways to obtain an address: static assignment, SLAAC, and DHCPv6.<br>Hubei Telecom uses SLAAC, meaning the IPv6 address is automatically assigned by the device. Because the carrier’s IPv6 pool is enormous, address conflicts are impossible.</p><p>Telecom IPv6 addresses are assigned at random and recycled every 24 h. If you need inbound access, you must use a DDNS service.</p><h2 id=firewall>Firewall</h2><p>At present it can be observed that common ports such as <code>80</code>, <code>139</code>, <code>445</code> are blocked—mirroring the carrier’s IPv4 firewall. This is easy to understand: operator-level firewalls do protect ordinary users who lack security awareness. In 2020, China Telecom IPv6 was fully open, but now certain common ports have been blocked.</p><p>Port <code>443</code> is occasionally accessible within the China Telecom network but blocked for China Mobile and China Unicom. Developers must keep this in mind. A service that works fine in your dev environment—or that your phone on the China Telecom network can reach—may be unreachable from a phone on a different carrier.</p><p>Based on simple firewall testing, developers are strongly advised not to trust operator firewalls. Serve your application on a <strong>five-digit</strong> port.</p><p>Furthermore, China Telecom’s firewall does not block port <code>22</code>, and Windows Remote Desktop port <code>3389</code> is likewise open.<br>Consequently, remote login is possible—introducing obvious risks.</p><p>Once attackers obtain the IP or DDNS hostname, they can start targeted attacks; brute-force password cracking can grant control of the device. The domain name can also reveal personal information—name, address, etc.—and attackers may use social-engineering tactics to gather even more clues to speed up their intrusion.</p><p>It is recommended to disable password authentication for <code>ssh</code> and rely only on key-based login, or to use a VPN, or to employ a jump host for remote access.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-dc89a1e4586849dfad4414cb230f7db4>Why we should not think of UDP in terms of TCP</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Why we should not think of UDP in terms of TCP</li></ul><h1 id=why-we-should-not-think-of-udp-in-terms-of-tcp>Why we should not think of UDP in terms of TCP?</h1><h2 id=structural-differences>Structural Differences</h2><p><img src=https://s2.loli.net/2023/06/30/ndPGpzMRX1L4Q6D.png alt="TCP header"><br><img src=https://s2.loli.net/2023/06/30/ofdBYKb6iqaICA9.png alt="UDP header"></p><p>TCP has many concepts: connection establishment, resource usage, data transfer, reliable delivery, retransmission based on cumulative ACK-SACK, timeout retransmission, checksum, flow control, congestion control, MSS, selective acknowledgements, TCP window scale, TCP timestamps, PSH flag, connection termination.</p><p>UDP has virtually none of these facilities; it is only slightly more capable than the link layer in distinguishing applications. Because UDP is extremely simple, it is extremely flexible.</p><h2 id=if-it-can-happen-it-will>If it can happen, it will</h2><p>Murphy’s law:</p><blockquote><p>If anything can go wrong, it will.</p></blockquote><p>Conventional wisdom suggests that UDP suits games, voice, and video because a few corrupt packets rarely matter. The reason UDP is chosen for these use-cases is not that it is the perfect match, but that there are unsolved problems for TCP that force services to pick the less-featured UDP. Saying “a few corrupt packets do not disturb the service” actually means that TCP worries about packet correctness while UDP does not; UDP cares more about timeliness and continuity. UDP’s defining trait is its indifference to everything TCP considers important—factors that harm real-time performance.</p><p>In code, UDP only needs one socket bound to a port to begin sending and receiving. Usually the socket lifetime matches the port lifetime.</p><p>Therefore, I can use UDP like this:</p><ol><li>Send random datagrams to any IP’s any port and see who replies.</li><li>Alice sends a request from port A to port B of Bob, Bob responds from port C to Alice’s port D.</li><li>Alice same as above, but Bob asks Charlie to answer from port C to Alice’s port D.</li><li>Alice sends a request from port A to port B, but spoofs the source address to Charlie’s address; Bob will reply to Charlie.</li><li>Both sides agree to open ten UDP ports and send as well as receive on each one concurrently.</li></ol><p>Of course none of these patterns can exist in TCP, but in UDP, because they are possible, sooner or later someone will adopt them. Expecting UDP to behave like TCP is therefore idealistic; reality cannot be fully enumerated.</p><p>UDP datagrams are extremely lightweight and highly flexible; the idea of a “connection” does not exist at the protocol level, so you must invent your own notion of a UDP connection. Different definitions were tried, yet none could always unambiguously describe direction from a single datagram; we must accept ambiguity. After all, no official “UDP connection” standard exists—when parties hold different definitions, mismatched behaviours are inevitable.</p><h2 id=udp-from-the-clients-viewpoint>UDP from the client’s viewpoint</h2><p>Voice or video can suffer packet loss, but the loss pattern has very different effects on user experience. For example, losing 30 % of packets evenly or losing 30 % all within half a second produces drastically different experiences; the former is obviously preferable. However, UDP has no built-in flow control to deliberately throttle traffic. Although UDP is often described as “best-effort”, the details of that effort still determine the outcome.</p><h2 id=udp-from-the-providers-viewpoint>UDP from the provider’s viewpoint</h2><p>For TCP attacks, the client must invest computational resources to create and maintain connections—attackers thus incur costs. With UDP, the attacker’s overhead is much lower; if the goal is just to burn server bandwidth, UDP is perfect. Suppose the service buys 100 GB of unmetered traffic but only processes 10 MB/s while accepting 1 GB/s—90 % of the arriving traffic is junk, yet it is still billable. Providers should avoid such situations.</p><h2 id=udp-from-the-isps-viewpoint>UDP from the ISP’s viewpoint</h2><p>End-to-end communication comprises multiple endpoints and transit paths. We usually focus only on client and server viewpoints, but the ISP’s perspective matters too. Under DDoS, we pay attention to server capacity, ignoring the ISP’s own finite resources. The server may ignore useless requests, yet the ISP has already paid to carry them. When we perform stress tests we often report “packet loss”, overlooking that the number reflects loss along the entire path—not just at the server. ISPs drop packets as well. From the ISP’s view, the service purchased 1 MB/s, but the client send rate is 1 GB/s; they both pay nothing for the wasted bandwidth—the ISP bears the cost. To avoid that, ISPs implement UDP QoS. Compared to TCP’s congestion control, ISPs can just drop UDP. In practice the blunt approach is to block traffic on long-lived UDP ports. Field tests of WeChat calls show that each call uses multiple ports with one UDP port talking to six different UDP ports on the same server—likely a countermeasure to ISP port blocks.</p><h2 id=summary>Summary</h2><p>UDP’s flexibility usually means there are several legitimate methods to reach a goal; as long as the program eventually communicates stably, however bizarre it may appear compared with TCP, it is “the way it is”. We therefore cannot force TCP concepts onto UDP. Even when we invent a new “UDP connection” for product design, we must expect and gracefully accept errors—the ability to tolerate errors is UDP’s core feature, an advantage deliberately chosen by the service, not a flaw we have to live with.</p><h2 id=further-reading>Further reading</h2><ul><li><a href=https://cloud.tencent.com/developer/article/1708535>Learning the principles of QoS in 20 000 words</a></li><li><a href=https://en.wikipedia.org/wiki/Transmission_Control_Protocol>Transmission Control Protocol</a></li><li><a href=https://en.wikipedia.org/wiki/User_Datagram_Protocol>User Datagram Protocol</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-ff3ca18908624a0efa9c7071237da99a>Troubleshooting Linux Network Issues</h1><div class="td-byline mb-4"><time datetime=2024-05-28 class=text-body-secondary>Tuesday, May 28, 2024</time></div><h2 id=troubleshooting-tools>Troubleshooting Tools</h2><table><thead><tr><th>Tool</th><th>Description</th><th>Usage</th><th>Note</th></tr></thead><tbody><tr><td>ping</td><td>Test network connectivity</td><td>ping baidu.com</td><td></td></tr><tr><td>traceroute</td><td>Route tracing</td><td>traceroute ip</td><td></td></tr><tr><td>route</td><td>Routing table</td><td>route -n</td><td></td></tr><tr><td>netstat</td><td>Network connections</td><td>netstat -ano</td><td></td></tr><tr><td>nslookup</td><td>DNS resolution</td><td>nslookup baidu.com</td><td></td></tr><tr><td>ifconfig</td><td>Network configuration</td><td>ifconfig</td><td></td></tr><tr><td>arp</td><td>ARP cache</td><td>arp -a</td><td></td></tr><tr><td>nbtstat</td><td>NetBIOS</td><td>nbtstat -n</td><td></td></tr><tr><td>netsh</td><td>Network configuration</td><td>netsh</td><td></td></tr><tr><td>net</td><td>Network configuration</td><td>net</td><td></td></tr><tr><td>tcpdump</td><td>Packet capture</td><td>tcpdump</td><td></td></tr><tr><td>wireshark</td><td>Packet capture</td><td>wireshark</td><td></td></tr><tr><td>ip</td><td>Network configuration</td><td>ip addr show</td><td></td></tr><tr><td>ss</td><td>Network connections</td><td>ss -tunlp</td><td></td></tr><tr><td>netstat</td><td>View network connection state</td><td>netstat -anp</td><td></td></tr><tr><td>tcpdump</td><td>Packet-capture utility</td><td>tcpdump -i eth0 -nn -s 0 -c 1000 -w /tmp/tcpdump.pcap</td><td></td></tr><tr><td>iptables</td><td>Firewall</td><td>iptables -L -n -v -t nat -t mangle -t filter</td><td></td></tr><tr><td>ss</td><td>netstat replacement</td><td>ss -anp</td><td></td></tr><tr><td>ifconfig</td><td>View NIC information</td><td>ifconfig eth0</td><td></td></tr><tr><td>ip</td><td>View NIC information</td><td>ip addr show eth0</td><td></td></tr><tr><td>route</td><td>View routing table</td><td>route -n</td><td></td></tr><tr><td>traceroute</td><td>View routing hops</td><td>traceroute <a href=https://www.baidu.com>www.baidu.com</a></td><td></td></tr><tr><td>ping</td><td>Test network connectivity</td><td>ping <a href=https://www.baidu.com>www.baidu.com</a></td><td></td></tr><tr><td>telnet</td><td>Test port connectivity</td><td>telnet <a href=https://www.baidu.com>www.baidu.com</a> 80</td><td></td></tr><tr><td>nslookup</td><td>Domain resolution</td><td>nslookup <a href=https://www.baidu.com>www.baidu.com</a></td><td></td></tr><tr><td>dig</td><td>Domain resolution</td><td>dig <a href=https://www.baidu.com>www.baidu.com</a></td><td></td></tr><tr><td>arp</td><td>View ARP cache</td><td>arp -a</td><td></td></tr><tr><td>netcat</td><td>Network debugging tool</td><td>nc -l 1234</td><td></td></tr><tr><td>nmap</td><td>Port-scanning tool</td><td>nmap -sT -p 80 <a href=https://www.baidu.com>www.baidu.com</a></td><td></td></tr><tr><td>mtr</td><td>Network connectivity tester</td><td>mtr <a href=https://www.baidu.com>www.baidu.com</a></td><td></td></tr><tr><td>iperf</td><td>Network performance tester</td><td>iperf -s -p 1234</td><td></td></tr><tr><td>iptraf</td><td>Network traffic monitor</td><td>iptraf -i eth0</td><td></td></tr><tr><td>ipcalc</td><td>IP address calculator</td><td>ipcalc</td><td></td></tr><tr><td>iftop</td><td>Network traffic monitor</td><td>iftop -i eth0</td><td></td></tr><tr><td>iostat</td><td>Disk I/O monitor</td><td>iostat -x 1 10</td><td></td></tr><tr><td>vmstat</td><td>Virtual memory monitor</td><td>vmstat 1 10</td><td></td></tr><tr><td>sar</td><td>System performance monitor</td><td>sar -n DEV 1 10</td><td></td></tr><tr><td>lsof</td><td>Show open file usage</td><td>lsof -i:80</td><td></td></tr><tr><td>strace</td><td>Trace system calls</td><td>strace -p 1234</td><td></td></tr><tr><td>tcpflow</td><td>Packet-capture tool</td><td>tcpflow -i eth0 -c -C -p -o /tmp/tcpflow</td><td></td></tr><tr><td>tcpick</td><td>Packet-capture tool</td><td>tcpick -i eth0 -C -p -o /tmp/tcpick</td><td></td></tr><tr><td>tcptrace</td><td>Packet-capture tool</td><td>tcptrace -i eth0 -C -p -o /tmp/tcptrace</td><td></td></tr><tr><td>tcpslice</td><td>Packet-capture tool</td><td>tcpslice -i eth0 -C -p -o /tmp/tcpslice</td><td></td></tr><tr><td>tcpstat</td><td>Packet-capture tool</td><td>tcpstat -i eth0 -C -p -o /tmp/tcpstat</td><td></td></tr><tr><td>tcpdump</td><td>Packet-capture tool</td><td>tcpdump -i eth0 -C -p -o /tmp/tcpdump</td><td></td></tr><tr><td>tshark</td><td>Packet-capture tool</td><td>tshark -i eth0 -C -p -o /tmp/tshark</td><td></td></tr><tr><td>wireshark</td><td>Packet-capture tool</td><td>wireshark -i eth0 -C -p -o /tmp/wireshark</td><td></td></tr><tr><td>socat</td><td>Network debugging tool</td><td>socat -d -d TCP-LISTEN:1234,fork TCP:www.baidu.com:80</td><td></td></tr><tr><td>ncat</td><td>Network debugging tool</td><td>ncat -l 1234 -c &rsquo;ncat <a href=https://www.baidu.com>www.baidu.com</a> 80'</td><td></td></tr><tr><td>netperf</td><td>Network performance tester</td><td>netperf -H <a href=https://www.baidu.com>www.baidu.com</a> -l 60 -t TCP_STREAM</td><td></td></tr><tr><td>netcat</td><td>Network debugging tool</td><td>netcat -l 1234</td><td></td></tr><tr><td>nc</td><td>Network debugging tool</td><td>nc -l 1234</td><td></td></tr><tr><td>netpipe</td><td>Network performance tester</td><td>netpipe -l 1234</td><td></td></tr><tr><td>netkit</td><td>Network debugging tool</td><td>netkit -l 1234</td><td></td></tr><tr><td>bridge</td><td>Bridge tool</td><td>bridge -s</td><td></td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-6147d5368d4d001498e0b3ce634999ea>How to Improve Network Experience with a Self-Hosted DNS Service</h1><div class="td-byline mb-4"><time datetime=2024-05-18 class=text-body-secondary>Saturday, May 18, 2024</time></div><h2 id=network-quality-vs-network-experience>Network Quality vs. Network Experience</h2><blockquote><p>Do nothing, and you’ll already enjoy the best network experience.</p></blockquote><p>First, note that “network quality” and “network experience” are two different concepts. Communication is a process involving many devices. The upload/download performance of a <strong>single device</strong> can be termed <strong>network quality</strong>, while the end-to-end behavior of the entire communication path is what we call <strong>network experience</strong>.</p><h2 id=measuring-network-quality>Measuring Network Quality</h2><p>Evaluating network quality usually involves several metrics and methods. Common ones include:</p><ol><li><strong>Bandwidth</strong> – the capacity to transfer data, conventionally expressed in bits-per-second. Higher bandwidth generally indicates better quality.</li><li><strong>Latency</strong> – the time a packet takes to travel from sender to receiver. Lower latency means faster response.</li><li><strong>Packet-loss rate</strong> – the proportion of packets lost en route. A lower rate suggests higher quality.</li><li><strong>Jitter</strong> – variability in packet arrival times. Smaller jitter means a more stable network.</li><li><strong>Throughput</strong> – the actual data volume successfully transported in a given period.</li><li><strong>Network topology</strong> – the physical or logical arrangement of network nodes; good design improves quality.</li><li><strong>Quality-of-Service (QoS)</strong> – techniques such as traffic shaping and priority queues that ensure acceptable service levels.</li><li><strong>Protocol analysis</strong> – examining traffic with tools like Wireshark to diagnose bottlenecks or errors.</li></ol><p>Combined, these indicators give a complete picture of network performance and improvement opportunities. Carriers need these details, but ordinary users often need only a decently priced modern router—today’s devices auto-tune most of these knobs.</p><h2 id=measuring-network-experience>Measuring Network Experience</h2><p>The first factor is <strong>reachability</strong>—being able to connect at all. A DNS service must therefore be:</p><ul><li>Comprehensive: its upstream resolvers should be authoritative and able to resolve the largest possible set of names.</li><li>Accurate: results must be correct and free from hijacking or pollution returning advertisement pages.</li><li>Timely: when an IP changes, the resolver must return the fresh address, not a stale record.</li></ul><p>Next comes the <strong>network quality</strong> of the resolved IP itself.</p><p>Because service quality <strong>varies strongly with region</strong>, servers geographically closer to the client often offer better performance.</p><p>Most paid DNS providers support Geo-aware records. For example, Alibaba Cloud allows:</p><blockquote><p>(1) Carrier lines: Unicom, Telecom, Mobile, CERNet, Great Wall Broadband, Cable WAN—down to province level.<br>(2) Overseas regions: down to continent and country.<br>(3) Alibaba cloud lines: down to individual regions.<br>(4) Custom lines: define any IP range for smart resolution.</p></blockquote><p>“(distribution-map-placeholder)”</p><p>By resolving IPs based on location, distant users reach nearby servers automatically—boosting experience without them lifting a finger.</p><p>In practice, service providers optimize UX based on the client’s real address. <strong>For most users, doing nothing gives the best network experience.</strong></p><h2 id=choosing-upstream-resolvers-for-self-hosted-dns>Choosing Upstream Resolvers for Self-Hosted DNS</h2><p>Nearly every Chinese-language guide tells you to pick large authoritative resolvers—Alibaba, Tencent, Cloudflare, Google—because they score high on reachability (comprehensive, accurate, timely). Yet they <strong>do not guarantee</strong> you the nearest server.</p><p>There’s historical context: Chinese ISPs once hijacked DNS plus plaintext HTTP to inject ads. Today, with HTTPS prevalent, this is far less common, though some last-mile ISPs may still try it. Simply switching resolvers to random IPs won’t save you from hijacks directed at UDP 53.</p><p>Another user niche cares about content filtering; some providers return bogus IPs for “special” sites. Authoritative resolvers rarely exhibit this behavior.</p><p>So three problems arise:</p><ol><li>IP contamination</li><li>DNS hijacking</li><li>Optimal service experience</li></ol><p>Authoritative resolvers fix (1); encrypted transports (DoT/DoH/QUIC) mitigate (2).</p><p><strong>For (3) you must go back to your carrier’s default DNS.</strong> As we said: <em>“Do nothing, and you’ll already enjoy the best network experience.”</em></p><p>But if you’re a perfectionist or a special user, the sections below show how to configure <strong>AdGuard Home</strong> and <strong>Clash</strong> to satisfy all three concerns at once.</p><h2 id=authoritative-yet-smart-dns>Authoritative yet “Smart” DNS</h2><h3 id=adguard-home-configuration>AdGuard Home Configuration</h3><p><a href=https://github.com/AdguardTeam/AdGuardHome>AdGuard Home</a> (ADG) is an ad-blocking, privacy-centric DNS server. It supports custom upstream resolvers and custom rules.</p><p>ADG’s default mode is <strong>load-balancing</strong>: you list several upstreams; ADG weights them by historical response speed and chooses the fastest. In simple terms, it will favor the quickest upstream more often.</p><p>Pick the third option instead: <strong>“Fastest IP address”</strong>.</p><p>“(ui-screenshot-placeholder)”</p><p>Result: ADG tests the IPs returned by each upstream and replies with whichever has the lowest latency. Below are ordinary results for <strong>bilibili.com</strong>:</p><p>“(ordinary-results-screenshot-placeholder)”</p><p>Without this option, ADG would hand every IP back to the client: some apps pick the first, others the last, others pick at random—possibly far from optimal.</p><p>With <strong>“Fastest IP address”</strong> enabled:</p><p>“(optimized-results-screenshot-placeholder)”</p><p>That alone improves network experience.</p><p><strong>Why isn’t “Fastest IP address” the default?</strong><br>Because waiting for <em>all</em> upstream answers means query time equals the <strong>slowest</strong> upstream. If you mix a 50 ms Ali server with a 500 ms Google one, your upstream delay becomes ~500 ms.</p><p>So users must balance quality vs. quantity. I suggest keeping <strong>two</strong> upstreams only: one authoritative (<code>https://dns.alidns.com/dns-query</code>) plus your local carrier’s DNS.</p><p>Carrier DNS IPs differ by city; look yours up <a href=https://ipw.cn/doc/else/dns.html>here</a> or read them from your router’s status page:</p><p>“(router-dns-screenshot-placeholder)”</p><h3 id=clash-configuration>Clash Configuration</h3><p>Users with special needs who still want optimal routing can delegate DNS handling to Clash’s <code>dns</code> section.</p><p><code>nameserver-policy</code> lets you assign different domains to different resolvers. Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>default-nameserver</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>tls://223.5.5.5:853</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>tls://1.12.12.12:853</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>https://dns.alidns.com/dns-query</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>https://one.one.one.one/dns-query</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>https://dns.google/dns-query</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver-policy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;geosite:cn,private,apple&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>202.103.24.68</span><span class=w> </span><span class=c># your local carrier DNS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>https://dns.alidns.com/dns-query</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;geosite:geolocation-!cn&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>https://one.one.one.one/dns-query</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>https://dns.google/dns-query</span><span class=w>
</span></span></span></code></pre></div><p>Meaning:</p><ul><li><code>default-nameserver</code> – used solely to resolve hostnames of DNS services in the <code>nameserver</code> list.</li><li><code>nameserver</code> – standard resolvers for ordinary queries.</li><li><code>nameserver-policy</code> – overrides above resolvers for specific groups of domains.</li></ul><h2 id=thanks-for-reading>Thanks for Reading</h2><p>If this post helped you, consider giving it a thumbs-up. Comments and discussion are always welcome!</p></div><div class=td-content style=page-break-before:always><h1 id=pg-875f5a75893e4ebbdef3ca88aa5b5475>Bypassing ChatGPT VPN Detection</h1><div class="td-byline mb-4"><time datetime=2024-05-09 class=text-body-secondary>Thursday, May 09, 2024</time></div><p>How to handle the ChatGPT error messages<br>“Unable to load site”<br>“Please try again later; if you are using a VPN, try turning it off.”<br>“Check the status page for information on outages.”</p><h2 id=foreword>Foreword</h2><p><img src=https://s2.loli.net/2024/05/09/dT4xi1mwFgYRKhq.png alt></p><p>ChatGPT is still the best chatbot in terms of user experience, but in mainland China its use is restricted by the network environment, so we need a proxy (literally a “ladder”) to reach it. ChatGPT is, however, quite strict in detecting proxies, and if it finds one it will simply refuse service. This article explains a way around that detection.</p><p>Some people suggest switching IPs to evade a block, yet the geolocations we can get from our providers already belong to supported regions, so this is not necessarily the real reason for denial of service.</p><p>Others argue that popular shared proxies are too easy to fingerprint and advise buying more expensive “uncrowded” ones, yet this is hardly a solid argument—IPv4 addresses are scarce, so even overseas ISPs often allocate ports via NAT. Blocking one address would hit a huge community, something that a service as widely used as ChatGPT surely would not design for.</p><p>For a public service, checking source-IP consistency makes more sense. Paid proxy plans typically impose data or speed limits, so most users adopt split-routing: they proxy only when the destination is firewalled, letting non-filtered traffic travel directly. This choice of paths can result in inconsistent source IPs. For example, Service A needs to talk to Domains X and Y, yet only X is firewalled; the proxy will be used for X but not Y, so A sees the same request coming from two different IPs.</p><p><strong>Solving this source-IP inconsistency will bypass ChatGPT’s “ladder” identification.</strong></p><p>Proxy rules usually include <code>domain rules</code>, <code>IP rules</code>, and so on.</p><p>Remember that the result of a <code>domain resolution</code> varies by region—if you are in place A you get a nearby server, and in place B you may get another. Therefore, DNS selection matters.</p><h2 id=dns-selection>DNS Selection</h2><p>Today there are many DNS protocols; <code>UDP:53</code> is so outdated and insecure that China lists DNS servers as a top-level requirement for companies. Such rules arose from decades of carriers employing <code>DNS hijacking</code> plus <code>HTTP</code> redirection to insert advertisements, deceiving many non-tech-savvy users and leading to countless complaints. Although today Chrome/Edge automatically upgrade to <code>HTTPS</code> and mark plain <code>HTTP</code> as insecure, many small neighbourhood ISPs and repackaged old Chromium versions persist, so DNS and HTTP hijacking still occur.</p><p>Hence we need a safe DNS protocol to avoid hijacking. In my experience Alibaba’s public <code>223.5.5.5</code> works well. Of course, when I mention <code>223.5.5.5</code> I do not mean plain UDP but <code>DoH</code> or <code>DoT</code>. Configure with <code>tls://223.5.5.5</code> or <code>https://dns.alidns.com/dns-query</code>.</p><p>Alidns rarely gets poisoned—only during certain sensitive periods. You can also use my long-term self-hosted resolver <code>tls://dns.jqknono.com</code>, upstreaming <code>8.8.8.8</code> and <code>1.1.1.1</code>, with cache acceleration.</p><h2 id=domain-rules>Domain Rules</h2><p>The detection page first visited runs probing logic, sending requests to several <em>domains</em> to check the source IP, so domain routing must remain consistent.</p><p>Besides its own, ChatGPT relies on third-party domains such as <code>auth0</code>, <code>cloudflare</code>, etc.</p><p>Add the following rules by hand:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># openai</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,chatgpt.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,openai.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,openai.org,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,auth0.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,cloudflare.com,PROXY</span><span class=w>
</span></span></span></code></pre></div><h3 id=how-to-test-domain-rules>How to test domain rules</h3><p>The domains above may evolve as ChatGPT’s services change; here is how to discover them yourself.</p><ol><li>Open a private/Incognito window to avoid caches/cookies.</li><li>Press <code>F12</code> to open DevTools, switch to the <code>Network</code> tab.</li><li>Visit <code>chat.openai.com</code> or <code>chatgpt.com</code>.</li><li>The following screenshot shows the domains used at the time of writing:</li></ol><p><img src=https://s2.loli.net/2024/05/09/SOtMedp8KrGyfzi.png alt=ChatGPT域名></p><p>Adding just those domains may still be insufficient. Inspect each aborted request: the <strong>challenge</strong> response’s <strong>Content-Security-Policy</strong> lists many domains. Add every one to the proxy policy.</p><p><img src=https://s2.loli.net/2024/05/09/aYseB9Df3xQqWRz.png alt=Content-Security-Policy中的域名></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># openai</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,chatgpt.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,openai.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,openai.org,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,auth0.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,cloudflare.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># additional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,oaistatic.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,oaiusercontent.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,intercomcdn.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,intercom.io,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,mixpanel.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,statsigapi.net,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,featuregates.org,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,stripe.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,browser-intake-datadoghq.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,sentry.io,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,live.net,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,live.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,windows.net,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,onedrive.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,microsoft.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,azure.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,sharepoint.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,gstatic.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,google.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,googleapis.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>DOMAIN-SUFFIX,googleusercontent.com,PROXY</span><span class=w>
</span></span></span></code></pre></div><h2 id=ip-rules>IP Rules</h2><p>If the site still refuses to load after the steps above, IP-based detection may also be in play. Below are some IPs I intercepted; they may not fit every region, so test on your own.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># openai</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>IP-CIDR6,2606:4700:4400::6812:231c/96,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>IP-CIDR,17.253.84.253/24,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>IP-CIDR,172.64.152.228/24,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>IP-CIDR,104.18.35.28/16,PROXY</span><span class=w>
</span></span></span></code></pre></div><h3 id=how-to-test-ip-rules>How to test IP rules</h3><p>Know your proxy tool. Open its connection log, watch the new connections as you reproduce the steps, then add the IPs you see.</p><p>A quick guide:</p><ol><li>Open a private/Incognito window.</li><li>Visit <code>chat.openai.com</code> or <code>chatgpt.com</code>.</li><li>Monitor the new connections in your proxy client and copy their IPs into rules.</li></ol><h2 id=protocol-rules>Protocol Rules</h2><p><code>QUIC</code> is an encrypted UDP protocol, and ChatGPT makes heavy use of <em>QUIC</em> traffic. Therefore both client and server must support UDP forwarding; many do not. Even with support, you must explicitly enable it—some clients default to not proxy UDP traffic. If unsure about UDP, either block QUIC in the proxy client or disable it in the browser; the browser will automatically fall back to HTTP/2 over TCP. QUIC provides smoother performance; feel free to experiment.</p><p><img src=https://s2.loli.net/2024/05/09/UAzbdgQT1y5J63w.png alt></p><h2 id=the-simplest-config--whitelist-mode>The simplest config – whitelist mode</h2><p>Set direct connections only for Chinese IPs and proxy everything else. This grants reliable ChatGPT access and also covers other foreign services.</p><p>The downside is higher data consumption and dependency on your proxy’s quality. If you trust your proxy’s network, give this a shot.</p><p>Of course, do remember to enable <code>UDP</code> forwarding.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-70e10d2259bbe582e015568a08904584>Chat</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> _index</li></ul></div><div class=td-content><h1 id=pg-4715580aecd7f99d5f1d2596741fe673>Which Languages Are Best for Multilingual Projects</h1><div class="td-byline mb-4"><time datetime=2025-07-10 class=text-body-secondary>Thursday, July 10, 2025</time></div><p>Below are 15 countries/regions—selected based on population size, economic output, and international influence—together with their language codes (shortcodes) and brief rationales, intended as a reference for multilingual translation:</p><table><thead><tr><th>Country / Region</th><th>Shortcode</th><th>Brief Rationale</th></tr></thead><tbody><tr><td>United States</td><td>en-US</td><td>English is the global lingua franca; the U.S. has the world’s largest GDP (population: 333 million) and is a core market for international business and technology.</td></tr><tr><td>China</td><td>zh-CN</td><td>Most populous country (1.41 billion); 2nd-largest GDP; Chinese is a UN official language; Chinese market consumption potential is enormous.</td></tr><tr><td>Japan</td><td>ja-JP</td><td>Japanese is the official language of the world’s 5th-largest economy; leading in technology and manufacturing; population: 125 million with strong purchasing power.</td></tr><tr><td>Germany</td><td>de-DE</td><td>Core of the Eurozone economy; largest GDP in Europe; German wields significant influence within the EU; population: 83.2 million with a robust industrial base.</td></tr><tr><td>France</td><td>fr-FR</td><td>French is a UN official language; France has the 7th-largest GDP globally; population: 67.81 million; widely used in Africa and international organizations.</td></tr><tr><td>India</td><td>hi-IN</td><td>Hindi is one of India’s official languages; India’s population (1.4 billion) is the world’s 2nd-largest; 6th-largest GDP and among the fastest-growing major economies.</td></tr><tr><td>Spain</td><td>es-ES</td><td>Spanish has the 2nd-largest number of native speakers worldwide (548 million); Spain’s GDP is 4th in Europe, and Spanish is common throughout Latin America.</td></tr><tr><td>Brazil</td><td>pt-BR</td><td>Portuguese is the native language of Brazil (population: 214 million); Brazil is South America’s largest economy with the 9th-largest GDP globally.</td></tr><tr><td>South Korea</td><td>ko-KR</td><td>Korean corresponds to South Korea (population: 51.74 million); 10th-largest GDP globally; powerful in technology and cultural industries such as K-pop.</td></tr><tr><td>Russia</td><td>ru-RU</td><td>Russian is a UN official language; population: 146 million; GDP ranks 11th globally; widely spoken in Central Asia and Eastern Europe.</td></tr><tr><td>Italy</td><td>it-IT</td><td>Italy’s GDP is 3rd in Europe; population: 59.06 million; strong in tourism and luxury goods; Italian is an important EU language.</td></tr><tr><td>Indonesia</td><td>id-ID</td><td>Indonesian is the official language of the world’s largest archipelagic nation (population: 276 million) and the largest GDP in Southeast Asia, presenting a high market potential.</td></tr><tr><td>Turkey</td><td>tr-TR</td><td>Turkish is spoken by 85 million people; Turkey’s strategic position bridging Europe and Asia; GDP ranks 19th globally and exerts cultural influence in the Middle East and Central Asia.</td></tr><tr><td>Netherlands</td><td>nl-NL</td><td>Dutch is spoken in the Netherlands (population: 17.5 million); GDP ranks 17th globally; leading in trade and shipping; although English penetration is high, the local market still requires the native language.</td></tr><tr><td>United Arab Emirates</td><td>ar-AE</td><td>Arabic is central to the Middle East; the UAE is a Gulf economic hub (population: 9.5 million, 88 % expatriates) with well-developed oil and finance sectors, radiating influence across the Arab world.</td></tr></tbody></table><p>Notes:
Language codes follow the ISO 639-1 (language) + ISO 3166-1 (country) standards, facilitating adaptation to localization tools.<br>Priority has been given to countries with populations over 100 million, GDPs in the world’s top 20, and those with notable regional influence, balancing international applicability and market value.<br>For particular domains (e.g., the Latin American market can add es-MX (Mexico), Southeast Asia can add vi-VN (Vietnam)), the list can be further refined as needed.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b76987c1f943229523ed1e7b190953ce>Third-party Library Pitfalls</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Third-party library pitfalls</li></ul><p>Today we talked about a vulnerability in a recently released third-party logging library that can be exploited with minimal effort to execute remote commands. A logging library and remote command execution seem completely unrelated, yet over-engineered third-party libraries are everywhere.</p><p>The more code I read, the more I feel that a lot of open-source code is of very poor quality—regardless of how many k-stars it has. Stars represent needs, not engineering skill.</p><p>The advantage of open source is that more people contribute, allowing features to grow quickly, bugs to get fixed, and code to be reviewed. But skill levels vary wildly.</p><p>Without strong commit constraints, code quality is hard to guarantee.</p><p>The more code you add, the larger the attack surface.</p><p>Although reinventing the wheel is usually bad, product requirements are like a stroller wheel: a plastic wheel that never breaks. Attaching an airplane tire to it just adds attack surface and maintenance costs. So if all you need is a stroller wheel, don’t over-engineer.</p><p>Maintenance is expensive. Third-party libraries require dedicated processes and people to maintain them. Huawei once forked a test framework, and when we upgraded the compiler the test cases failed. Upgrading the test framework clashed with the compiler upgrade, so we burned ridiculous time making further invasive changes. As one of the people involved, I deeply felt the pain of forking third-party libraries. If the modifications were feature-worthy they could be upstreamed, but tailoring them to our own needs through intrusive customization makes future maintenance nearly impossible.</p><p>Huawei created a whole series of processes for third-party libraries—one could say the friction was enormous.</p><p>The bar is set very high: adding a library requires review by a level-18 expert and approval from a level-20 director. Only longtime, well-known libraries even have a chance.</p><p>All third-party libraries live under a thirdparty folder. A full build compares them byte-for-byte with the upstream repo; any invasive change is strictly forbidden.</p><p>Dedicated tooling tracks every library’s version, managed by outsourced staff. If a developer wants to upgrade a library, they must submit a formal request—and the director has to sign off.</p><p>Getting a director to handle something like that is hard. When a process is deliberately convoluted, its real message is “please don’t do this.”</p><p>Approach third-party libraries with skepticism—trust code written by your own team.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b2075f5d67b31c9121400493c38d52c0>Design Specification Template</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Design Specification Template</li></ul><h1 id=detailed-design-of-xxx-system--sub-system>Detailed Design of XXX System / Sub-system</h1><table><thead><tr><th>System Name</th><th>XXX System</th></tr></thead><tbody><tr><td>Author</td><td>XXX</td></tr><tr><td>&mdash;</td><td>&mdash;</td></tr><tr><td>Submission Date</td><td>2021-06-30</td></tr></tbody></table><h2 id=revision-history>Revision History</h2><table><thead><tr><th>Revised Version</th><th>Change Description</th><th>Date of Change</th><th>Author</th></tr></thead><tbody><tr><td>v1.0</td><td>XXXXXXX</td><td>2021-06-30</td><td>XXX</td></tr><tr><td>&mdash;</td><td>&mdash;</td><td>&mdash;</td><td>&mdash;</td></tr></tbody></table><h2 id=technical-review-comments>Technical Review Comments</h2><table><thead><tr><th>No.</th><th>Reviewer</th><th>Review Comment (Pass/Fail/Pending, comments allowed)</th><th>Review Time</th></tr></thead><tbody><tr><td>1</td><td>XXX</td><td>Pass</td><td>2022.1.1</td></tr></tbody></table><h2 id=background>Background</h2><h2 id=glossary>Glossary</h2><ul><li>SIP: Session Initiation Protocol</li><li>RTP: Real-time Transport Protocol</li></ul><h2 id=design-objectives>Design Objectives</h2><h3 id=functional-requirements>Functional Requirements</h3><h3 id=non-functional-requirements-mandatory>Non-Functional Requirements (mandatory)</h3><h2 id=environment>Environment</h2><h3 id=related-software--hardware-optional>Related Software & Hardware (optional)</h3><h3 id=system-constraints>System Constraints</h3><h3 id=estimated-data-scale-mandatory>Estimated Data Scale (mandatory)</h3><h2 id=existing-solutions>Existing Solutions</h2><h2 id=design-ideas--trade-offs>Design Ideas & Trade-offs</h2><h3 id=assumptions--dependencies--relationships-with-other-systems>Assumptions & Dependencies / Relationships with Other Systems</h3><h2 id=system-design>System Design</h2><h3 id=overview>Overview</h3><h3 id=architecture-diagram--explanation>Architecture Diagram & Explanation</h3><h3 id=system-flow--explanation-optional>System Flow & Explanation (optional)</h3><h3 id=interfaces-with-external-systems>Interfaces with External Systems</h3><h3 id=global-data-structure-descriptions>Global Data-Structure Descriptions</h3><h3 id=brief-description-of-module-xxx1>Brief Description of Module XXX1</h3><h4 id=functionality-of-module-xxx1>Functionality of Module XXX1</h4><h4 id=interfaces-with-other-modules>Interfaces with Other Modules</h4><h3 id=brief-description-of-module-xxx2>Brief Description of Module XXX2</h3><h4 id=functionality-of-module-xxx2>Functionality of Module XXX2</h4><h4 id=interfaces-with-other-modules-1>Interfaces with Other Modules</h4><h2 id=threat-modeling>Threat Modeling</h2><h2 id=upgrade-impact-mandatory>Upgrade Impact (mandatory)</h2><h2 id=risk-assessment--impact-on-other-systems-optional>Risk Assessment & Impact on Other Systems (optional)</h2><h3 id=known-or-foreseeable-risks>Known or Foreseeable Risks</h3><h3 id=potential-impact-with-other-systemsmodules>Potential Impact with Other Systems/Modules</h3><h2 id=innovation-points-optional>Innovation Points (optional)</h2><h2 id=attachments--references>Attachments & References</h2></div><div class=td-content style=page-break-before:always><h1 id=pg-9a83f3cf008d3b474647c108ce516035>Command Line Syntax Conventions</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Command line syntax conventions</li></ul><h2 id=references>References</h2><ul><li><a href="https://www.ibm.com/docs/en/iotdm/11.3?topic=interface-command-line-syntax">https://www.ibm.com/docs/en/iotdm/11.3?topic=interface-command-line-syntax</a></li><li><a href=https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/command-line-syntax-key>https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/command-line-syntax-key</a></li><li><a href=https://developers.google.com/style/code-syntax>https://developers.google.com/style/code-syntax</a></li><li><a href=https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap12.html#tag_12_01>https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap12.html#tag_12_01</a></li><li><a href=https://ftpdocs.broadcom.com/cadocs/0/CA%20ARCserve%20%20Backup%20r16-CHS/Bookshelf_Files/HTML/cmndline/cl_cmd_line_syntax_char.htm>https://ftpdocs.broadcom.com/cadocs/0/CA%20ARCserve%20%20Backup%20r16-CHS/Bookshelf_Files/HTML/cmndline/cl_cmd_line_syntax_char.htm</a></li></ul><p>e.g.</p><table><thead><tr><th>Notation</th><th>Description</th></tr></thead><tbody><tr><td>Text without brackets or braces</td><td>Items you must type as shown.</td></tr><tr><td><code>&lt;</code>Text inside angle brackets<code>></code></td><td>Placeholder for which you must supply a value.</td></tr><tr><td><code>[</code>Text inside square brackets<code>]</code></td><td>Optional items.</td></tr><tr><td><code>{</code>Text inside braces<code>}</code></td><td>Set of required items. You must choose one.</td></tr><tr><td>Vertical bar ( <code>|</code> )</td><td>Separator for mutually exclusive items. You must choose one.</td></tr><tr><td>Ellipsis (<code>…</code>)</td><td>Items that can be repeated and used multiple times.</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-0c87579cd7a3ba25ef5e14bf05e1c7e6>Meanings of brackets in man pages</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Meanings of brackets in man pages</li></ul><h1 id=meanings-of-brackets-in-man-pages>Meanings of brackets in man pages</h1><p>In command-line help, different types of brackets generally carry the following meanings:</p><ol><li>Angle brackets <code>&lt;></code>:<ul><li>Angle brackets denote required arguments—values you must provide when running the command. They’re typically used to express the core syntax and parameters of a command.</li><li>Example: <code>command &lt;filename></code> means you must supply a filename as a required argument, e.g., <code>command file.txt</code>.</li></ul></li><li>Square brackets <code>[]</code>:<ul><li>Square brackets indicate optional arguments—values you may or may not provide when running the command. They’re commonly used to mark optional parameters and options.</li><li>Example: <code>command [option]</code> means you can choose to provide an option, e.g., <code>command -v</code> or simply <code>command</code>.</li></ul></li><li>Curly braces <code>{}</code>:<ul><li>Curly braces usually represent a set of choices, indicating that you must select one. These are also called “choice parameter groups.”</li><li>Example: <code>command {option1 | option2 | option3}</code> means you must pick one of the given options, e.g., <code>command option2</code>.</li></ul></li><li>Parentheses <code>()</code>:<ul><li>Parentheses are generally used to group arguments, clarifying structure and precedence in a command’s syntax.</li><li>Example: <code>command (option1 | option2) filename</code> means you must choose either <code>option1</code> or <code>option2</code> and supply a filename as an argument, e.g., <code>command option1 file.txt</code>.</li></ul></li></ol><p>These bracket conventions are intended to help users understand command syntax and parameter choices so they can use command-line tools correctly. When reading man pages or help text, paying close attention to the meaning and purpose of each bracket type is crucial—it prevents incorrect commands and achieves the desired results.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-7ae20abfa23cd10f15a2834efe0cd517>Huawei C++ Coding Standards</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Huawei C++ Coding Standards</li></ul><h1 id=c-language-coding-standards>C++ Language Coding Standards</h1><h2 id=purpose><a name=c0-1></a>Purpose</h2><p>Rules are not perfect; by prohibiting features useful in specific situations, they may impact code implementation. However, the purpose of establishing rules is “to benefit the majority of developers.” If, during team collaboration, a rule is deemed unenforceable, we hope to improve it together.</p><p>Before referencing this standard, it is assumed that you already possess the corresponding basic C++ language capabilities; do not rely on this document to learn the C++ language.</p><ol><li>Understand the C++ language ISO standard;</li><li>Be familiar with basic C++ language features, including those related to C++ 03/11/14/17;</li><li>Understand the C++ standard library;</li></ol><h2 id=general-principles><a name=c0-2></a>General Principles</h2><p>Code must, while ensuring functional correctness, meet the feature requirements of <strong>readability, maintainability, safety, reliability, testability, efficiency, and portability</strong>.</p><h2 id=key-focus-areas><a name=c0-2></a>Key Focus Areas</h2><ol><li>Define the C++ coding style, such as naming, formatting, etc.</li><li>C++ modular design—how to design header files, classes, interfaces, and functions.</li><li>Best practices for C++ language features, such as constants, type casting, resource management, templates, etc.</li><li>Modern C++ best practices, including conventions in C++11/14/17 that can improve maintainability and reliability.</li><li>This standard is primarily applicable to C++17.</li></ol><h2 id=conventions><a name=c0-3></a>Conventions</h2><p><strong>Rule</strong>: A convention that <strong>must</strong> be followed during programming (must).<br><strong>Recommendation</strong>: A convention that <strong>should</strong> be followed during programming (should).</p><p>This standard applies to common C++ standards; when no specific standard version is noted, it applies to all versions (C++03/11/14/17).</p><h2 id=exceptions><a name=c0-4></a>Exceptions</h2><p>Regardless of ‘Rule’ or ‘Recommendation’, you must understand the reasons behind each item and strive to follow them.<br>However, there may be exceptions to some rules and recommendations.</p><p>If it does not violate the general principles and, after thorough consideration, there are sufficient reasons, it is acceptable to deviate from the conventions in the specification.<br>Exceptions break code consistency—please avoid them. Exceptions to a ‘Rule’ should be extremely rare.</p><p>In the following situations, stylistic consistency should take priority:<br><strong>When modifying external open-source code or third-party code, follow the existing code style to maintain uniformity.</strong></p><h1 id=2-naming><a name=c2></a>2 Naming</h1><h2 id=general-naming><a name=c2-1></a>General Naming</h2><p><strong>CamelCase</strong><br>Mixed case letters with words connected. Words are separated by capitalizing the first letter of each word.<br>Depending on whether the first letter after concatenation is capitalized, it is further divided into UpperCamelCase and lowerCamelCase.</p><table><thead><tr><th>Type</th><th>Naming Style</th></tr></thead><tbody><tr><td>Type definitions such as classes, structs, enums, and unions, as well as scope names</td><td>UpperCamelCase</td></tr><tr><td>Functions (including global, scoped, and member functions)</td><td>UpperCamelCase</td></tr><tr><td>Global variables (including global and namespace-scoped variables, class static variables), local variables, function parameters, member variables of classes, structs, and unions</td><td>lowerCamelCase</td></tr><tr><td>Macros, constants (const), enum values, goto labels</td><td>ALL CAPS, underscore separator</td></tr></tbody></table><p>Notes:<br>The <strong>constant</strong> in the above table refers to variables at global scope, namespace scope, or static member scope that are basic data types, enums, or string types qualified with const or constexpr; arrays and other types of variables are excluded.<br>The <strong>variable</strong> in the above table refers to all variables other than the constant definition above, which should all use the lowerCamelCase style.</p><h2 id=file-naming><a name=c2-2></a>File Naming</h2><h3 id=rule-221-c-implementation-files-end-with-cpp-header-files-end-with-h><a name=r2-2-1></a>Rule 2.2.1 C++ implementation files end with .cpp, header files end with .h</h3><p>We recommend using .h as the header suffix so header files can be directly compatible with both C and C++.<br>We recommend using .cpp as the implementation file suffix to clearly distinguish C++ code from C code.</p><p>Some other suffixes used in the industry:</p><ul><li>Header files: .hh, .hpp, .hxx</li><li>cpp files: .cc, .cxx, .c</li></ul><p>If your project team already uses a specific suffix, you can continue using it, but please maintain stylistic consistency.<br>For this document, we default to .h and .cpp as suffixes.</p><h3 id=rule-222-c-file-names-correspond-to-the-class-name><a name=r2-2-2></a>Rule 2.2.2 C++ file names correspond to the class name</h3><p>C++ header and cpp file names should correspond to the class names in lowercase with underscores.</p><p>If a class is named DatabaseConnection, then the corresponding filenames should be:</p><ul><li>database_connection.h</li><li>database_connection.cpp</li></ul><p>File naming for structs, namespaces, enums, etc., follows a similar pattern.</p><h2 id=function-naming><a name=c2-3></a>Function Naming</h2><p>Function names use the UpperCamelCase style, usually a verb or verb-object structure.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>List</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=n>AddElement</span><span class=p>(</span><span class=k>const</span> <span class=n>Element</span><span class=o>&amp;</span> <span class=n>element</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Element</span> <span class=nf>GetElement</span><span class=p>(</span><span class=k>const</span> <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>index</span><span class=p>)</span> <span class=k>const</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>bool</span> <span class=nf>IsEmpty</span><span class=p>()</span> <span class=k>const</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>Utils</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>DeleteUser</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=type-naming><a name=c2-4></a>Type Naming</h2><p>Type names use the UpperCamelCase style.<br>All type names—classes, structs, unions, type aliases (typedef), and enums—use the same convention, e.g.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// classes, structs and unions
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>UrlTable</span> <span class=p>{</span> <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UrlTableTester</span> <span class=p>{</span> <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>UrlTableProperties</span> <span class=p>{</span> <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=k>union</span> <span class=nc>Packet</span> <span class=p>{</span> <span class=p>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// typedefs
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>typedef</span> <span class=n>std</span><span class=o>::</span><span class=n>map</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>,</span> <span class=n>UrlTableProperties</span><span class=o>*&gt;</span> <span class=n>PropertiesMap</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// enums
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>enum</span> <span class=nc>UrlTableErrors</span> <span class=p>{</span> <span class=p>...</span>
</span></span></code></pre></div><p>For namespaces, UpperCamelCase is recommended:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// namespace
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>namespace</span> <span class=n>OsUtils</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>FileUtils</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>     
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=recommendation-241-avoid-misusing-typedef-or-define-to-alias-basic-types><a name=a2-4-1></a>Recommendation 2.4.1 Avoid misusing typedef or #define to alias basic types</h3><p>Do not redefine basic data types with typedef/#define unless there is a clear necessity.<br>Prefer using basic types from the <code>&lt;cstdint></code> header:</p><table><thead><tr><th>Signed Type</th><th>Unsigned Type</th><th>Description</th></tr></thead><tbody><tr><td>int8_t</td><td>uint8_t</td><td>Exactly 8-bit signed/unsigned integer</td></tr><tr><td>int16_t</td><td>uint16_t</td><td>Exactly 16-bit signed/unsigned integer</td></tr><tr><td>int32_t</td><td>uint32_t</td><td>Exactly 32-bit signed/unsigned integer</td></tr><tr><td>int64_t</td><td>uint64_t</td><td>Exactly 64-bit signed/unsigned integer</td></tr><tr><td>intptr_t</td><td>uintptr_t</td><td>Signed/unsigned integer to hold a pointer</td></tr></tbody></table><h2 id=variable-naming><a name=c2-5></a>Variable Naming</h2><p>General variables use lowerCamelCase, covering global variables, function parameters, local variables, and member variables.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>tableName</span><span class=p>;</span>  <span class=c1>// Good: recommended
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>tablename</span><span class=p>;</span>  <span class=c1>// Bad: prohibited
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>path</span><span class=p>;</span>       <span class=c1>// Good: single-word lowercase per lowerCamelCase
</span></span></span></code></pre></div><h3 id=rule-251-global-variables-must-have-a-g_-prefix-static-variables-need-no-special-prefix><a name=r2-5-1></a>Rule 2.5.1 Global variables must have a &lsquo;g_&rsquo; prefix; static variables need no special prefix</h3><p>Global variables should be used sparingly; adding the prefix visually reminds developers to use them carefully.</p><ul><li>Static global variables share the same naming as global variables.</li><li>Function-local static variables share normal local variable naming.</li><li>Class static member variables share normal member variable naming.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=n>g_activeConnectCount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>Func</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=kt>int</span> <span class=n>packetCount</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=rule-252-class-member-variables-are-named-in-lowercamelcase-followed-by-a-trailing-underscore><a name=r2-5-2></a>Rule 2.5.2 Class member variables are named in lowerCamelCase followed by a trailing underscore</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>fileName_</span><span class=p>;</span>   <span class=c1>// trailing _ suffix, similar to K&amp;R style
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span></code></pre></div><p>For struct/union member variables, use lowerCamelCase without suffix, consistent with local variables.</p><h2 id=macro-constant-and-enum-naming><a name=c2-6></a>Macro, Constant, and Enum Naming</h2><p>Macros and enum values use ALL CAPS, underscore-connected format.<br>Global-scope or named/anonymous-namespace const constants, as well as class static member constants, use ALL CAPS, underscore-connected; function-local const constants and ordinary const member variables use lowerCamelCase.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#define MAX(a, b)   (((a) &lt; (b)) ? (b) : (a)) </span><span class=c1>// macro naming example only—macro not recommended for such a feature
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>enum</span> <span class=nc>TintColor</span> <span class=p>{</span>    <span class=c1>// enum type name in UpperCamelCase, values in ALL CAPS, underscore-connected
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>RED</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>DARK_RED</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>GREEN</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>LIGHT_GREEN</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>Func</span><span class=p>(...)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>bufferSize</span> <span class=o>=</span> <span class=mi>100</span><span class=p>;</span>    <span class=c1>// local constant
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>char</span> <span class=o>*</span><span class=n>p</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>char</span><span class=p>[</span><span class=n>bufferSize</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>Utils</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>DEFAULT_FILE_SIZE_KB</span> <span class=o>=</span> <span class=mi>200</span><span class=p>;</span>        <span class=c1>// global constant
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h1 id=3-format><a name=c3></a>3 Format</h1><h2 id=line-length><a name=c3-1></a>Line Length</h2><h3 id=rule-311-do-not-exceed-120-characters-per-line><a name=r3-1-1></a>Rule 3.1.1 Do not exceed 120 characters per line</h3><p>We recommend keeping each line under 120 characters. If 120 characters are exceeded, choose a reasonable wrapping method.</p><p>Exceptions:</p><ul><li>Lines containing commands or URLs in comments may remain on one line for copy/paste / grep convenience, even above 120 chars.</li><li>#include statements with long paths may exceed 120 chars but should be avoided when possible.</li><li>Preprocessor error messages may span one line for readability, even above 120 chars.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#ifndef XXX_YYY_ZZZ
</span></span></span><span class=line><span class=cl><span class=cp>#error Header aaaa/bbbb/cccc/abc.h must only be included after xxxx/yyyy/zzzz/xyz.h, because xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
</span></span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span></code></pre></div><h2 id=indentation><a name=c3-2></a>Indentation</h2><h3 id=rule-321-use-spaces-for-indentation4-spaces-per-level><a name=r3-2-1></a>Rule 3.2.1 Use spaces for indentation—4 spaces per level</h3><p>Only use spaces for indentation (4 spaces per level). Do not use tab characters.<br>Almost all modern IDEs can be configured to automatically expand tabs to 4 spaces—please configure yours accordingly.</p><h2 id=braces><a name=c3-3></a>Braces</h2><h3 id=rule-331-use-kr-indentation-style><a name=r3-3-1></a>Rule 3.3.1 Use K&amp;R indentation style</h3><p><strong>K&amp;R Style</strong><br>For functions (excluding lambda expressions), place the left brace on a new line at the beginning of the line, alone; for other cases, the left brace should follow statements and stay at the end of the line.<br>Right braces are always on their own line, unless additional parts of the same statement follow—e.g., while in do-while, else/else-if of an if-statement, comma, or semicolon.</p><p>Examples:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>MyType</span> <span class=p>{</span>     <span class=c1>// brace follows statement with one preceding space
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>Foo</span><span class=p>(</span><span class=kt>int</span> <span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>                   <span class=c1>// function left brace on a new line, alone
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(...)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Reason for recommending this style:</p><ul><li>Code is more compact.</li><li>Continuation improves reading rhythm compared to new-line placement.</li><li>Aligns with later language conventions and industry mainstream practice.</li><li>Modern IDEs provide alignment aids so the end-of-line brace does not hinder scoping comprehension.</li></ul><p>For empty function bodies, the braces may be placed on the same line:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>MyClass</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>MyClass</span><span class=p>()</span> <span class=o>:</span> <span class=n>value_</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>   
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>value_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h2 id=function-declarations-and-definitions><a name=c3-4></a>Function Declarations and Definitions</h2><h3 id=rule-341-both-return-type-and-function-name-must-be-on-the-same-line-break-and-align-parameters-reasonably-when-line-limit-is-exceeded><a name=r3-4-1></a>Rule 3.4.1 Both return type and function name must be on the same line; break and align parameters reasonably when line limit is exceeded</h3><p>When declaring or defining functions, the return type and function name must appear on the same line; if permitted by the column limit, place parameters on the same line as well—otherwise break parameters onto the next line with proper alignment.<br>The left parenthesis always stays on the same line as the function name; placing it on its own line is prohibited. The right parenthesis always follows the last parameter.</p><p>Examples:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>ReturnType</span> <span class=nf>FunctionName</span><span class=p>(</span><span class=n>ArgType</span> <span class=n>paramName1</span><span class=p>,</span> <span class=n>ArgType</span> <span class=n>paramName2</span><span class=p>)</span>   <span class=c1>// Good: all on one line
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ReturnType</span> <span class=nf>VeryVeryVeryLongFunctionName</span><span class=p>(</span><span class=n>ArgType</span> <span class=n>paramName1</span><span class=p>,</span>     <span class=c1>// line limit exceeded, break
</span></span></span><span class=line><span class=cl><span class=c1></span>                                        <span class=n>ArgType</span> <span class=n>paramName2</span><span class=p>,</span>     <span class=c1>// Good: align with previous
</span></span></span><span class=line><span class=cl><span class=c1></span>                                        <span class=n>ArgType</span> <span class=n>paramName3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ReturnType</span> <span class=nf>LongFunctionName</span><span class=p>(</span><span class=n>ArgType</span> <span class=n>paramName1</span><span class=p>,</span> <span class=n>ArgType</span> <span class=n>paramName2</span><span class=p>,</span> <span class=c1>// line limit exceeded
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>ArgType</span> <span class=n>paramName3</span><span class=p>,</span> <span class=n>ArgType</span> <span class=n>paramName4</span><span class=p>,</span> <span class=n>ArgType</span> <span class=n>paramName5</span><span class=p>)</span>    <span class=c1>// Good: 4-space indent after break
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ReturnType</span> <span class=nf>ReallyReallyReallyReallyLongFunctionName</span><span class=p>(</span>            <span class=c1>// will not fit first parameter, break immediately
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>ArgType</span> <span class=n>paramName1</span><span class=p>,</span> <span class=n>ArgType</span> <span class=n>paramName2</span><span class=p>,</span> <span class=n>ArgType</span> <span class=n>paramName3</span><span class=p>)</span> <span class=c1>// Good: 4-space indent after break
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=function-calls><a name=c3-5></a>Function Calls</h2><h3 id=rule-351-keep-function-argument-lists-on-one-line-if-line-limit-is-exceeded-align-parameters-correctly-when-wrapping><a name=r3-5-1></a>Rule 3.5.1 Keep function argument lists on one line. If line limit is exceeded, align parameters correctly when wrapping</h3><p>Function calls should have their parameter list on one line—if exceeding the line length, break and align parameters accordingly.<br>Left parenthesis always follows the function name; right parenthesis always follows the last parameter.</p><p>Examples:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>ReturnType</span> <span class=n>result</span> <span class=o>=</span> <span class=n>FunctionName</span><span class=p>(</span><span class=n>paramName1</span><span class=p>,</span> <span class=n>paramName2</span><span class=p>);</span>   <span class=c1>// Good: single line
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>ReturnType</span> <span class=n>result</span> <span class=o>=</span> <span class=n>FunctionName</span><span class=p>(</span><span class=n>paramName1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                 <span class=n>paramName2</span><span class=p>,</span>                <span class=c1>// Good: aligned with param above
</span></span></span><span class=line><span class=cl><span class=c1></span>                                 <span class=n>paramName3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ReturnType</span> <span class=n>result</span> <span class=o>=</span> <span class=n>FunctionName</span><span class=p>(</span><span class=n>paramName1</span><span class=p>,</span> <span class=n>paramName2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>paramName3</span><span class=p>,</span> <span class=n>paramName4</span><span class=p>,</span> <span class=n>paramName5</span><span class=p>);</span>                    <span class=c1>// Good: 4-space indent on break
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>ReturnType</span> <span class=n>result</span> <span class=o>=</span> <span class=n>VeryVeryVeryLongFunctionName</span><span class=p>(</span>           <span class=c1>// cannot fit first param, break immediately
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>paramName1</span><span class=p>,</span> <span class=n>paramName2</span><span class=p>,</span> <span class=n>paramName3</span><span class=p>);</span>                    <span class=c1>// 4-space indent after break
</span></span></span></code></pre></div><p>If parameters are intrinsically related, grouping them for readability may take precedence over strict formatting.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Good: each line represents a group of related parameters
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=n>result</span> <span class=o>=</span> <span class=n>DealWithStructureLikeParams</span><span class=p>(</span><span class=n>left</span><span class=p>.</span><span class=n>x</span><span class=p>,</span> <span class=n>left</span><span class=p>.</span><span class=n>y</span><span class=p>,</span>     <span class=c1>// group 1
</span></span></span><span class=line><span class=cl><span class=c1></span>                                         <span class=n>right</span><span class=p>.</span><span class=n>x</span><span class=p>,</span> <span class=n>right</span><span class=p>.</span><span class=n>y</span><span class=p>);</span>  <span class=c1>// group 2
</span></span></span></code></pre></div><h2 id=if-statements><a name=c3-6></a>if Statements</h2><h3 id=rule-361-if-statements-must-use-braces><a name=r3-6-1></a>Rule 3.6.1 if statements must use braces</h3><p>We require braces for all if statements—even for single-line conditions.</p><p>Rationale:</p><ul><li>Code logic is intuitive and readable.</li><li>Adding new code to an existing conditional is less error-prone.</li><li>Braces protect against macro misbehavior when using functional macros (in case the macro omitted braces).</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>objectIsNotExist</span><span class=p>)</span> <span class=p>{</span>         <span class=c1>// Good: braces for single-line condition
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=nf>CreateNewObject</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=rule-362-prohibit-writing-ifelseelse-if-on-the-same-line><a name=r3-6-2></a>Rule 3.6.2 Prohibit writing if/else/else if on the same line</h3><p>Branches in conditional statements must appear on separate lines.</p><p>Correct:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>someConditions</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DoSomething</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>  <span class=c1>// Good: else on new line
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Incorrect:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>someConditions</span><span class=p>)</span> <span class=p>{</span> <span class=p>...</span> <span class=p>}</span> <span class=k>else</span> <span class=p>{</span> <span class=p>...</span> <span class=p>}</span> <span class=c1>// Bad: else same line as if
</span></span></span></code></pre></div><h2 id=loops><a name=c3-7></a>Loops</h2><h3 id=rule-371-loop-statements-must-use-braces><a name=r3-7-1></a>Rule 3.7.1 Loop statements must use braces</h3><p>Similar to conditions, we require braces for all for/while loops—even if the body is empty or contains only one statement.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>someRange</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>   <span class=c1>// Good: braces used
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DoSomething</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>while</span> <span class=p>(</span><span class=n>condition</span><span class=p>)</span> <span class=p>{</span> <span class=p>}</span>   <span class=c1>// Good: empty body with braces
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>while</span> <span class=p>(</span><span class=n>condition</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>continue</span><span class=p>;</span>           <span class=c1>// Good: continue indicates empty logic, still braces
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p>Bad examples:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>someRange</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>DoSomething</span><span class=p>();</span>      <span class=c1>// Bad: missing braces
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>while</span> <span class=p>(</span><span class=n>condition</span><span class=p>);</span>      <span class=c1>// Bad: semicolon appears part of loop, confusing
</span></span></span></code></pre></div><h2 id=switch-statements><a name=c3-8></a>switch Statements</h2><h3 id=rule-381-indent-casedefault-within-switch-bodies-one-additional-level><a name=r3-8-1></a>Rule 3.8.1 Indent case/default within switch bodies one additional level</h3><p>Indentation for switch statements:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>switch</span> <span class=p>(</span><span class=n>var</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>0</span><span class=o>:</span>             <span class=c1>// Good: indented
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>DoSomething1</span><span class=p>();</span> <span class=c1>// Good: indented
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>1</span><span class=o>:</span> <span class=p>{</span>           <span class=c1>// Good: brace indentation if needed
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>DoSomething2</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Bad:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>switch</span> <span class=p>(</span><span class=n>var</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=mi>0</span><span class=o>:</span>                 <span class=c1>// Bad: case not indented
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DoSomething</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>default</span><span class=o>:</span>                <span class=c1>// Bad: default not indented
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=expressions><a name=c3-9></a>Expressions</h2><h3 id=recommendation-391-consistently-break-long-expressions-at-operators-operators-stranded-at-eol><a name=a3-9-1></a>Recommendation 3.9.1 Consistently break long expressions at operators, operators stranded at EOL</h3><p>When an expression is too long for one line, break at an appropriate operator. Place the operator at the end-of-line, indicating ‘to be continued’.</p><p>Example:<br>// Assume first line exceeds limit</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>if</span> <span class=p>((</span><span class=n>currentValue</span> <span class=o>&gt;</span> <span class=n>threshold</span><span class=p>)</span> <span class=o>&amp;&amp;</span>  <span class=c1>// Good: logical operator at EOL
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>someCondition</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DoSomething</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>result</span> <span class=o>=</span> <span class=n>reallyReallyLongVariableName1</span> <span class=o>+</span>    <span class=c1>// Good
</span></span></span><span class=line><span class=cl><span class=c1></span>             <span class=n>reallyReallyLongVariableName2</span><span class=p>;</span>
</span></span></code></pre></div><p>After wrapping, either align appropriately or indent subsequent lines by 4 spaces.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=n>sum</span> <span class=o>=</span> <span class=n>longVariableName1</span> <span class=o>+</span> <span class=n>longVariableName2</span> <span class=o>+</span> <span class=n>longVariableName3</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>    <span class=n>longVariableName4</span> <span class=o>+</span> <span class=n>longVariableName5</span> <span class=o>+</span> <span class=n>longVariableName6</span><span class=p>;</span>        <span class=c1>// Good: 4-space indent
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>sum</span> <span class=o>=</span> <span class=n>longVariableName1</span> <span class=o>+</span> <span class=n>longVariableName2</span> <span class=o>+</span> <span class=n>longVariableName3</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>          <span class=n>longVariableName4</span> <span class=o>+</span> <span class=n>longVariableName5</span> <span class=o>+</span> <span class=n>longVariableName6</span><span class=p>;</span>  <span class=c1>// Good: aligned
</span></span></span></code></pre></div><h2 id=variable-assignment><a name=c3-10></a>Variable Assignment</h2><h3 id=rule-3101-multiple-variable-declarations-and-initializations-are-forbidden-on-the-same-line><a name=r3-10-1></a>Rule 3.10.1 Multiple variable declarations and initializations are forbidden on the same line</h3><p>One variable initialization per line improves readability and comprehension.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=n>maxCount</span> <span class=o>=</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>isCompleted</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span></code></pre></div><p>Bad examples:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=n>maxCount</span> <span class=o>=</span> <span class=mi>10</span><span class=p>;</span> <span class=kt>bool</span> <span class=n>isCompleted</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span> <span class=c1>// Bad: multiple initializations must span separate lines
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>  <span class=c1>// Bad: multiple declarations must be on separate lines
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>pointX</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>pointY</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=n>pointX</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>pointY</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>  <span class=c1>// Bad: multiple assignments placed on same line
</span></span></span></code></pre></div><p>Exception: for loop headers, if-with-initializer (C++17), structured binding statements (C++17), etc., may declare and initialize multiple variables; forcing separation would hinder scope correctness and clarity.</p><h2 id=initialization><a name=c3-11></a>Initialization</h2><p>Includes initialization for structs, unions, and arrays.</p><h3 id=rule-3111-indent-initialization-lists-when-wrapping-align-elements-properly><a name=r3-11-1></a>Rule 3.11.1 Indent initialization lists when wrapping; align elements properly</h3><p>When breaking struct/array initializers, each continuation is indented 4 spaces. Choose break and alignment points for readability.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>const</span> <span class=kt>int</span> <span class=n>rank</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=mi>16</span><span class=p>,</span> <span class=mi>16</span><span class=p>,</span> <span class=mi>16</span><span class=p>,</span> <span class=mi>16</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h2 id=pointers-and-references><a name=c3-12></a>Pointers and References</h2><h3 id=recommendation-3121-place-the-pointer-star--adjacent-to-the-variable-or-typenever-add-spaces-on-both-sides-or-omit-both><a name=a3-12-1></a>Recommendation 3.12.1 Place the pointer star &lsquo;*&rsquo; adjacent to the variable or type—never add spaces on both sides or omit both</h3><p>Pointer naming: align &lsquo;*&rsquo; to either left (type) or right (variable) but never leave/pad both sides.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span><span class=o>*</span> <span class=n>p</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>  <span class=c1>// Good
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=o>*</span><span class=n>p</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>  <span class=c1>// Good
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span><span class=o>*</span><span class=n>p</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>   <span class=c1>// Bad
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=o>*</span> <span class=n>p</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span> <span class=c1>// Bad
</span></span></span></code></pre></div><p>Exception when const is involved—&rsquo;*&rsquo; cannot trail the variable, so avoid trailing the type:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span> <span class=k>const</span> <span class=n>VERSION</span> <span class=o>=</span> <span class=s>&#34;V100&#34;</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=recommendation-3122-place-the-reference-operator--adjacent-to-the-variable-or-typenever-pad-both-sides-nor-omit-both><a name=a3-12-2></a>Recommendation 3.12.2 Place the reference operator &lsquo;&&rsquo; adjacent to the variable or type—never pad both sides nor omit both</h3><p>Reference naming: & aligned either left (type) or right (variable); never pad both sides or omit spacing.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span><span class=o>&amp;</span> <span class=n>p</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>     <span class=c1>// Good
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=o>&amp;</span><span class=n>p</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>     <span class=c1>// Good
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span><span class=o>*&amp;</span> <span class=n>rp</span> <span class=o>=</span> <span class=n>pi</span><span class=p>;</span>  <span class=c1>// Good: reference to pointer; *&amp; together after type
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=o>*&amp;</span><span class=n>rp</span> <span class=o>=</span> <span class=n>pi</span><span class=p>;</span>  <span class=c1>// Good: reference to pointer; *&amp; together after variable
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span><span class=o>*</span> <span class=o>&amp;</span><span class=n>rp</span> <span class=o>=</span> <span class=n>pi</span><span class=p>;</span>  <span class=c1>// Good: pointer followed by reference—* with type, &amp; with variable
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=o>&amp;</span> <span class=n>p</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>    <span class=c1>// Bad
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span><span class=o>&amp;</span><span class=n>reeeenamespace</span><span class=o>=</span> <span class=n>i</span><span class=p>;</span>  <span class=c1>// Bad—illustrates missing space or doubled up spacing issues
</span></span></span></code></pre></div><h2 id=preprocessor-directives><a name=c3-13></a>Preprocessor Directives</h2><h3 id=rule-3131-place-preprocessing--at-the-start-of-the-line-nested-preprocessor-statements-may-indent--accordingly><a name=r3-13-1></a>Rule 3.13.1 Place preprocessing &lsquo;#&rsquo; at the start of the line; nested preprocessor statements may indent &lsquo;#&rsquo; accordingly</h3><p>Preprocessing directives&rsquo; &lsquo;#&rsquo; must be placed at the beginning of the line—even if inside function bodies.</p><h3 id=rule-3132-avoid-macros-except-where-necessary><a name=r3-13-2></a>Rule 3.13.2 Avoid macros except where necessary</h3><p>Macros ignore scope, type systems, and many rules and are prone to error. Prefer non-macro approaches, and if macros must be used, ensure unique macro names.<br>In C++, many macro use cases can be replaced:</p><ul><li>Use const or enum for intuitive constants</li><li>Use namespaces to prevent name conflicts</li><li>Use inline functions to avoid call overhead</li><li>Use template functions for type abstraction</li></ul><p>Macros may be used for include guards, conditional compilation, and logging where required.</p><h3 id=rule-3133-do-not-use-macros-to-define-constants><a name=r3-13-3></a>Rule 3.13.3 Do not use macros to define constants</h3><p>Macros are simple text substitution completed during pre-processing; typeless, unscoped, and unsafe. Debugging errors display the value, not the macro name.</p><h3 id=rule-3134-do-not-use-function-like-macros><a name=r3-13-4></a>Rule 3.13.4 Do not use function-like macros</h3><p>Before defining a function-like macro, consider if a real function can be used. When alternatives exist, favor functions.<br>Disadvantages of function-like macros:</p><ul><li>Lack type checking vs function calls</li><li>Macro arguments are <em>not</em> evaluated (behaves differently than function calls)</li><li>No scope encapsulation</li><li>Heavily cryptic syntax (macro operator <code>#</code> and eternal parentheses) harms readability</li><li>Extensions needed (e.g., GCC statement expressions) hurt portability</li><li>Compiler sees the macro <em>after</em> pre-processing; multi-line macro expansions collapse into one line, hard to debug or breakpoint</li><li>Repeated expansion of large macros increases code size</li></ul><p>Functions do not suffer the above negatives, although worst-case cost is reduced performance via call overhead (or due to micro-architecture optimization hassles).<br>To mitigate, use <code>inline</code>. Inline functions:</p><ul><li>Perform strict type checking</li><li>Evaluate each argument once</li><li>Expand in place with no call overhead</li><li>May optimize better than macros</li></ul><p>For performance-critical production code, prefer inline functions over macros.</p><p>Exception:<br>logging macros may need to retain <strong>FILE</strong>/<strong>LINE</strong> of the call site.</p><h2 id=whitespaceblank-lines><a name=c3-14></a>Whitespace/Blank Lines</h2><h3 id=rule-3141-horizontal-spaces-should-emphasize-keywords-and-key-information-avoid-excessive-whitespace><a name=r3-14-1></a>Rule 3.14.1 Horizontal spaces should emphasize keywords and key information, avoid excessive whitespace</h3><p>Horizontal spaces should highlight keywords and key info; do <strong>not</strong> pad trailing spaces. General rules:</p><ul><li>Add space after keywords: if, switch, case, do, while, for</li><li>Do not pad inside parentheses both-left-and-right</li><li>Maintain symmetry around braces</li><li>No space after unary operators (& * + - ~ !)</li><li>Add spaces around binary operators (= + - &lt; > * / % | & ^ &lt;= >= == !=)</li><li>Add spaces around ternary operators ( ? : )</li><li>No space between pre/post inc/dec (++, &ndash;) and variable</li><li>No space around struct member access (., ->)</li><li>No space before comma, but space after</li><li>No space between &lt;> and type names as in templates or casts</li><li>No space around scope operator ::</li><li>Colon (:) spaced according to context when needed</li></ul><p>Typical cases:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>void</span> <span class=nf>Foo</span><span class=p>(</span><span class=kt>int</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// Good: space before left brace
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>  <span class=c1>// Good: spaces around =; no space before semicolon
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>buf</span><span class=p>[</span><span class=n>BUF_SIZE</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>};</span>    <span class=c1>// Good: no space after {
</span></span></span></code></pre></div><p>Function definition/call examples:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=n>result</span> <span class=o>=</span> <span class=n>Foo</span><span class=p>(</span><span class=n>arg1</span><span class=p>,</span><span class=n>arg2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>//                      ^    Bad: comma needs trailing space
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>result</span> <span class=o>=</span> <span class=n>Foo</span><span class=p>(</span> <span class=n>arg1</span><span class=p>,</span> <span class=n>arg2</span> <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>//               ^        ^     Bad: no space after ( before args; none before )
</span></span></span></code></pre></div><p>Pointer/address examples:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=o>*</span><span class=n>p</span><span class=p>;</span>     <span class=c1>// Good: no space between * and p
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>p</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>x</span><span class=p>;</span>     <span class=c1>// Good: no space between &amp; and x
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>x</span> <span class=o>=</span> <span class=n>r</span><span class=p>.</span><span class=n>y</span><span class=p>;</span>    <span class=c1>// Good: no space around .
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>x</span> <span class=o>=</span> <span class=n>r</span><span class=o>-&gt;</span><span class=n>y</span><span class=p>;</span>   <span class=c1>// Good: no space around -&gt;
</span></span></span></code></pre></div><p>Operators:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>   <span class=c1>// Good: spaces around =
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>x</span> <span class=o>=</span> <span class=o>-</span><span class=mi>5</span><span class=p>;</span>  <span class=c1>// Good: no space between - and 5
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>++</span><span class=n>x</span><span class=p>;</span>     <span class=c1>// Good: no space between ++ and x
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>x</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>x</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>y</span><span class=p>)</span>  <span class=c1>// Good: spaces around &amp;&amp;, none between ! and y
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>v = w * x + y / z;  // Good: Binary operators are surrounded by spaces.
</span></span><span class=line><span class=cl>v = w * (x + z);    // Good: Expressions inside parentheses are not padded with spaces.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>int a = (x <span class=p>&lt;</span> <span class=nt>y</span><span class=err>)</span> <span class=err>?</span> <span class=na>x</span> <span class=na>:</span> <span class=na>y</span><span class=err>;</span>  <span class=err>//</span> <span class=na>Good:</span> <span class=na>Ternary</span> <span class=na>operators</span> <span class=na>require</span> <span class=na>spaces</span> <span class=na>before</span> <span class=err>?</span> <span class=na>and</span> <span class=na>:</span><span class=err>.</span>
</span></span></code></pre></div><p>Loops and conditional statements:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>condition</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// Good: A space after if, none inside the parentheses
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>           <span class=c1>// Good: A space after else
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=p>(</span><span class=n>condition</span><span class=p>)</span> <span class=p>{}</span>   <span class=c1>// Good: Same rules as if
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>someRange</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// Good: Space after for, after each semicolon
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>switch</span> <span class=p>(</span><span class=n>condition</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// Good: One space between switch and (
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>case</span> <span class=mi>0</span><span class=o>:</span>     <span class=c1>// Good: No space between case label and colon
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>...</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Templates and casts</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Angle brackets (&lt; and &gt;) are never preceded by spaces, nor followed directly by spaces.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>vector</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span> <span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>*&gt;</span><span class=p>(</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// One space between a type and * is acceptable; keep it consistent.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>char</span> <span class=o>*&gt;</span> <span class=n>x</span><span class=p>;</span>
</span></span></code></pre></div><p>Scope resolution operator</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=p>;</span>    <span class=c1>// Good: No spaces around ::
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>MyClass</span><span class=o>::</span><span class=n>GetValue</span><span class=p>()</span> <span class=k>const</span> <span class=p>{}</span>  <span class=c1>// Good: No spaces around ::
</span></span></span></code></pre></div><p>Colons</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// When spaces are required
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Good: Space before colon with class derivation
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>Sub</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Constructor initializer list needs spaces
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>MyClass</span><span class=o>::</span><span class=n>MyClass</span><span class=p>(</span><span class=kt>int</span> <span class=n>var</span><span class=p>)</span> <span class=o>:</span> <span class=n>someVar_</span><span class=p>(</span><span class=n>var</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DoSomething</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Bit field width also gets a space
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>struct</span> <span class=nc>XX</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=nl>a</span> <span class=p>:</span> <span class=mi>4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=nl>b</span> <span class=p>:</span> <span class=mi>5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=nl>c</span> <span class=p>:</span> <span class=mi>4</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// When spaces are NOT required
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Good: No space after public:, private:, etc.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>MyClass</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>MyClass</span><span class=p>(</span><span class=kt>int</span> <span class=n>var</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>someVar_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// No space after case or default in switch statements
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>switch</span> <span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>1</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=n>DoSomething</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Note: Configure your IDE to strip trailing whitespace.</p><h3 id=advice-3141-arrange-blank-lines-to-keep-code-compact><a name=a3-14-1></a>Advice 3.14.1 Arrange blank lines to keep code compact</h3><p>Avoid needless blank lines to display more code on screen and improve readability. Observe these guidelines:</p><ul><li>Insert blank lines based on logical sections, not on automatic habits.</li><li>Do not use consecutive blank lines inside functions, type definitions, macros, or initializer lists.</li><li>Never use three or more consecutive blank lines.</li><li>Do not leave blank lines right after a brace that opens a block or right before the closing brace; the only exception is within namespace scopes.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=nf>Foo</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>Bar</span><span class=p>()</span>  <span class=c1>// Bad: more than two consecutive blank lines.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(...)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Bad: blank line immediately after opening brace
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>...</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Bad: blank line immediately before closing brace
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>Foo</span><span class=p>(...)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Bad: blank line at start of function body
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=classes><a name=c3-15></a>Classes</h2><h3 id=rule-3151-order-class-access-specifiers-as-public-protected-private-at-the-same-indentation-level-as-class><a name=r3-15-1></a>Rule 3.15.1 Order class access specifiers as public:, protected:, private: at the same indentation level as class</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>MyClass</span> <span class=o>:</span> <span class=k>public</span> <span class=n>BaseClass</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>      <span class=c1>// Note: no extra indentation
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>MyClass</span><span class=p>();</span>  <span class=c1>// standard 4-space indent
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>explicit</span> <span class=nf>MyClass</span><span class=p>(</span><span class=kt>int</span> <span class=n>var</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=o>~</span><span class=n>MyClass</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>SomeFunction</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>SomeFunctionThatDoesNothing</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>SetVar</span><span class=p>(</span><span class=kt>int</span> <span class=n>var</span><span class=p>)</span> <span class=p>{</span> <span class=n>someVar_</span> <span class=o>=</span> <span class=n>var</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=nf>GetVar</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>someVar_</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>bool</span> <span class=n>SomeInternalFunction</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>someVar_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>someOtherVar_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>Within each section group similar declarations and order them roughly as follows: type aliases (typedef, using, nested structs / classes), constants, factory functions, constructors, assignment operators, destructor, other member functions, data members.</p><h3 id=rule-3152-constructor-initializer-lists-should-fit-on-one-line-or-be-indented-four-spaces-and-line-wrapped><a name=r3-15-2></a>Rule 3.15.2 Constructor initializer lists should fit on one line or be indented four spaces and line-wrapped</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// If everything fits on one line:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>MyClass</span><span class=o>::</span><span class=n>MyClass</span><span class=p>(</span><span class=kt>int</span> <span class=n>var</span><span class=p>)</span> <span class=o>:</span> <span class=n>someVar_</span><span class=p>(</span><span class=n>var</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DoSomething</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Otherwise, place after the colon and indent four spaces
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>MyClass</span><span class=o>::</span><span class=n>MyClass</span><span class=p>(</span><span class=kt>int</span> <span class=n>var</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=n>someVar_</span><span class=p>(</span><span class=n>var</span><span class=p>),</span> <span class=n>someOtherVar_</span><span class=p>(</span><span class=n>var</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>  <span class=c1>// Good: space after comma
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DoSomething</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// If multiple lines are needed, align each initializer
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>MyClass</span><span class=o>::</span><span class=n>MyClass</span><span class=p>(</span><span class=kt>int</span> <span class=n>var</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=n>someVar_</span><span class=p>(</span><span class=n>var</span><span class=p>),</span>            <span class=c1>// indent 4 spaces
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=n>someOtherVar_</span><span class=p>(</span><span class=n>var</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DoSomething</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h1 id=4-comments><a name=c4></a>4 Comments</h1><p>Prefer clear architecture and naming; only add comments when necessary to aid understanding.</p><p>Keep comments concise, accurate, and non-redundant.<br><strong>Comments are as important as code.</strong><br>When you change code, update all relevant comments—leaving old comments is destructive.</p><p>Use English for all comments.</p><h2 id=comment-style><a name=c3-1></a>Comment style</h2><p>Both <code>/* */</code> and <code>//</code> are acceptable.<br>Choose one consistent style for each comment category (file header, function header, inline, etc.).</p><p>Note: samples in this document frequently use trailing <code>//</code> merely for explanation—do not treat it as an endorsed style.</p><h2 id=file-header><a name=c4-2></a>File header</h2><h3 id=rule-31-file-headers-must-contain-a-valid-license-notice><a name=r3-1></a>Rule 3.1 File headers must contain a valid license notice</h3><p>/*</p><ul><li>Copyright (c) 2020 XXX</li><li>Licensed under the Apache License, Version 2.0 (the &ldquo;License&rdquo;);</li><li>you may not use this file except in compliance with the License.</li><li>You may obtain a copy of the License at</li><li></li><li><pre><code>http://www.apache.org/licenses/LICENSE-2.0
</code></pre></li><li></li><li>Unless required by applicable law or agreed to in writing, software</li><li>distributed under the License is distributed on an &ldquo;AS IS&rdquo; BASIS,</li><li>WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</li><li>See the License for the specific language governing permissions and</li><li>limitations under the License.
*/</li></ul><h2 id=function-header-comments><a name=c4-3></a>Function header comments</h2><h3 id=rule-431-provide-headers-for-public-functions><a name=r4-3-1></a>Rule 4.3.1 Provide headers for public functions</h3><p>Callers need to know behavior, parameter ranges, return values, side effects, ownership, etc.—and the function signature alone cannot express everything.</p><h3 id=rule-432-never-leave-noisy-or-empty-function-headers><a name=r4-3-2></a>Rule 4.3.2 Never leave noisy or empty function headers</h3><p>Not every function needs a comment.<br>Only add a header when the signature is insufficient.</p><p>Headers appear above the declaration/definition using one of the following styles:
With <code>//</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// One-line function header
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=nf>Func1</span><span class=p>(</span><span class=kt>void</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Multi-line function header
</span></span></span><span class=line><span class=cl><span class=c1>// Second line
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=nf>Func2</span><span class=p>(</span><span class=kt>void</span><span class=p>);</span>
</span></span></code></pre></div><p>With <code>/* */</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cm>/* Single-line function header */</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>Func1</span><span class=p>(</span><span class=kt>void</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> * Alternative single-line style
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>Func2</span><span class=p>(</span><span class=kt>void</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> * Multi-line header
</span></span></span><span class=line><span class=cl><span class=cm> * Second line
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>Func3</span><span class=p>(</span><span class=kt>void</span><span class=p>);</span>
</span></span></code></pre></div><p>Cover: purpose, return value, performance hints, usage notes, memory ownership, re-entrancy etc.</p><p>Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> * Returns bytes actually written, -1 on failure.
</span></span></span><span class=line><span class=cl><span class=cm> * Caller owns the buffer buf.
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>WriteString</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>buf</span><span class=p>,</span> <span class=kt>int</span> <span class=n>len</span><span class=p>);</span>
</span></span></code></pre></div><p>Bad:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> * Function name: WriteString
</span></span></span><span class=line><span class=cl><span class=cm> * Purpose: write string
</span></span></span><span class=line><span class=cl><span class=cm> * Parameters:
</span></span></span><span class=line><span class=cl><span class=cm> * Return:
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>WriteString</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>buf</span><span class=p>,</span> <span class=kt>int</span> <span class=n>len</span><span class=p>);</span>
</span></span></code></pre></div><p>Problems:‐ parameters/return empty, function name redundant, unclear ownership.</p><h2 id=inline-code-comments><a name=c4-4></a>Inline code comments</h2><h3 id=rule-441-place-comments-directly-above-or-to-the-right-of-the-code><a name=r4-4-1></a>Rule 4.4.1 Place comments directly above or to the right of the code</h3><h3 id=rule-442-put-one-space-after-the-comment-token-right-side-comments-need--1-space><a name=r4-4-2></a>Rule 4.4.2 Put one space after the comment token; right-side comments need ≥ 1 space</h3><p>Above code: indent comment same as code.<br>Pick one consistent style.</p><p>With <code>//</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Single-line comment
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>DoSomething</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Multi-line
</span></span></span><span class=line><span class=cl><span class=c1>// comment
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>DoSomething</span><span class=p>();</span>
</span></span></code></pre></div><p>With <code>/* */</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cm>/* Single-line comment */</span>
</span></span><span class=line><span class=cl><span class=n>DoSomething</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> * Alternative multi-line comment
</span></span></span><span class=line><span class=cl><span class=cm> * second line
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=n>DoSomething</span><span class=p>();</span>
</span></span></code></pre></div><p>Right-of-code style: 1–4 spaces between code and token.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=n>foo</span> <span class=o>=</span> <span class=mi>100</span><span class=p>;</span>  <span class=c1>// Right-side comment
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=n>bar</span> <span class=o>=</span> <span class=mi>200</span><span class=p>;</span>  <span class=cm>/* Right-side comment */</span>
</span></span></code></pre></div><p>Aligning right-side comments is acceptable when cluster is tall:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>const</span> <span class=kt>int</span> <span class=n>A_CONST</span> <span class=o>=</span> <span class=mi>100</span><span class=p>;</span>         <span class=cm>/* comments may align */</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>int</span> <span class=n>ANOTHER_CONST</span> <span class=o>=</span> <span class=mi>200</span><span class=p>;</span>   <span class=cm>/* keep uniform gap */</span>
</span></span></code></pre></div><p>If the right-side comment would exceed the line limit, move it to the previous standalone line.</p><h3 id=rule-443-delete-unused-code-do-not-comment-it-out><a name=r4-4-3></a>Rule 4.4.3 Delete unused code, do not comment it out</h3><p>Commented-out code cannot be maintained; resurrecting it later risks bugs.<br>When you no longer need code, remove it. Recoveries use version control.</p><p>This applies to /* */, //, #if 0, #ifdef NEVER_DEFINED, etc.</p><h1 id=5-headers><a name=c5></a>5 Headers</h1><h2 id=responsibilities><a name=c5-1></a>Responsibilities</h2><p>Headers list a module’s public interface; design is reflected mostly here.<br>Keep implementation out of headers (inline functions are OK).<br>Headers should be single-minded; complexity and excessive dependencies hurt compile time.</p><h3 id=advice-511-every-cpp-file-should-have-a-matching-h-file-for-the-interface-it-provides><a name=a5-1-1></a>Advice 5.1.1 Every .cpp file should have a matching .h file for the interface it provides</h3><p>A .h file declares what the .cpp decides to expose.<br>If a .cpp publishes nothing to other TUs, it shouldn’t exist—except: program entry point, test code, or DLL edge cases.</p><p>Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Foo.h
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#ifndef FOO_H
</span></span></span><span class=line><span class=cl><span class=cp>#define FOO_H
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Foo</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>Fun</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>value_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Foo.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#include</span> <span class=cpf>&#34;Foo.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=p>{</span> <span class=c1>// Good: internal helper declared in .cpp, hidden by unnamed namespace or static
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>void</span> <span class=nf>Bar</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>Foo</span><span class=o>::</span><span class=n>Fun</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Bar</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=header-dependencies><a name=c5-2></a>Header dependencies</h2><h3 id=rule-521-forbid-circular-includes><a name=r5-2-1></a>Rule 5.2.1 Forbid circular #includes</h3><p>a.h → b.h → c.h → a.h causes full rebuild on any change.<br>Refactor architecture to break cycles.</p><h3 id=rule-522-every-header-must-have-an-include-guard-define><a name=r5-2-4></a>Rule 5.2.2 Every header must have an include guard #define</h3><p>Do not use #pragma once.</p><p>Guidelines:</p><ol><li>Use a unique macro per file.</li><li>No code/comments except the header license between #ifndef/#define and the matching #endif.</li></ol><p>Example: For timer/include/timer.h:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#ifndef TIMER_INCLUDE_TIMER_H
</span></span></span><span class=line><span class=cl><span class=cp>#define TIMER_INCLUDE_TIMER_H
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span></code></pre></div><h3 id=rule-523-forbid-extern-declarations-of-external-functionsvariables><a name=r5-2-5></a>Rule 5.2.3 Forbid extern declarations of external functions/variables</h3><p>Always <code>#include</code> the proper header instead of duplicating signatures with extern.<br>Inconsistencies may appear when the real signature changes; also encourages architectural decay.</p><p>Bad:
// a.cpp</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>extern</span> <span class=kt>int</span> <span class=nf>Fun</span><span class=p>();</span>   <span class=c1>// Bad
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>Bar</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>Fun</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>// b.cpp</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=nf>Fun</span><span class=p>()</span> <span class=p>{</span> <span class=p>...</span> <span class=p>}</span>
</span></span></code></pre></div><p>Good:
// a.cpp</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;b.h&#34;</span><span class=cp>   </span><span class=c1>// Good
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>...</span>
</span></span></code></pre></div><p>// b.h</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=nf>Fun</span><span class=p>();</span>
</span></span></code></pre></div><p>// b.cpp</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=nf>Fun</span><span class=p>()</span> <span class=p>{</span> <span class=p>...</span> <span class=p>}</span>
</span></span></code></pre></div><p>Exception: testing private members, stubs, or patches may use extern when the header itself cannot be augmented.</p><h3 id=rule-524-do-not-include-inside-extern-c><a name=r5-2-6></a>Rule 5.2.4 Do not #include inside extern &ldquo;C&rdquo;</h3><p>Such includes may nest extern &ldquo;C&rdquo; blocks, and some compilers have limited nesting.<br>Likewise, C/C++ inter-op headers may silently change linkage specifiers.</p><p>Example—files a.h / b.h:</p><p>// a.h</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=cp>#ifdef __cplusplus
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>void</span> <span class=n>Foo</span><span class=p>(</span><span class=kt>int</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>#define A(value) Foo(value)
</span></span></span><span class=line><span class=cl><span class=cp>#else
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>void</span> <span class=n>A</span><span class=p>(</span><span class=kt>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span></code></pre></div><p>// b.h</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#ifdef __cplusplus
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>extern</span> <span class=s>&#34;C&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;a.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>void</span> <span class=nf>B</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=cp>#ifdef __cplusplus
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span></code></pre></div><p>After preprocessing b.h in C++:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>extern</span> <span class=s>&#34;C&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>Foo</span><span class=p>(</span><span class=kt>int</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>B</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Foo now gets C linkage although author wanted C++ linkage.</p><p>Exception: including a pure C header lacking <code>extern "C"</code> inside <code>extern "C"</code> is acceptable when non-intrusive.</p><h3 id=advice-521-prefer-include-over-forward-declarations><a name=a5-2-1></a>Advice 5.2.1 Prefer #include over forward declarations</h3><p>Forward declaration quick wins:</p><ol><li>Saves compile time by reducing header bloat.</li><li>Breaks needless rebuilds on unrelated header edits.</li></ol><p>Drawbacks:</p><ol><li>Hides real dependencies—changes in the header may not trigger recompilation.</li><li>Subsequent library changes can break your declaration.</li><li>Forward declaring std:: names is undefined by C++11.</li><li>Many declarations are longer than a single #include.</li><li>Refactoring code just to support forward declaration often hurts performance (pointer members) and clarity.</li><li>It is hard to decide when it is truly safe.</li></ol><p>Hence, prefer <code>#include</code> to keep dependencies explicit.</p><h1 id=6-scope><a name=c6></a>6 Scope</h1><h2 id=namespaces><a name=c6-1></a>Namespaces</h2><h3 id=advice-611-use-anonymous-namespaces-or-static-to-hide-file-local-symbols><a name=a6-1-1></a>Advice 6.1.1 Use anonymous namespaces or static to hide file-local symbols</h3><p>In C++03 static globals/funcs are deprecated, so unnamed namespaces are preferred.</p><p>Reasons:</p><ol><li>static already means too many things.</li><li>namespace can also encapture types.</li><li>Encourage uniform namespace usage.</li><li>static functions cannot instantiate templates—namespaces can.</li></ol><p>Never use anonymous namespace or static in a .h file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Foo.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>namespace</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=kt>int</span> <span class=n>MAX_COUNT</span> <span class=o>=</span> <span class=mi>20</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>InternalFun</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>Foo</span><span class=o>::</span><span class=n>Fun</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>MAX_COUNT</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>InternalFun</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=rule-611-never-use-using-namespace-in-headers-or-before-includes><a name=r6-1-1></a>Rule 6.1.1 Never use <code>using namespace</code> in headers or before #includes</h3><p>Doing so pollutes every translation unit that includes it.<br>Example:</p><p>// a.h</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>NamespaceA</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=nf>Fun</span><span class=p>(</span><span class=kt>int</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>// b.h</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>NamespaceB</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=nf>Fun</span><span class=p>(</span><span class=kt>int</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>NamespaceB</span><span class=p>;</span>  <span class=c1>// Bad
</span></span></span></code></pre></div><p>// a.cpp</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;a.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=k>namespace</span> <span class=n>NamespaceA</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;b.h&#34;</span><span class=cp>         </span><span class=c1>// ambiguity: NamespaceA::Fun vs NamespaceB::Fun
</span></span></span></code></pre></div><p>Allowed: bringing in single symbols or aliases inside a custom module namespace in headers:</p><p>// foo.h</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;fancy/string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=n>fancy</span><span class=o>::</span><span class=n>string</span><span class=p>;</span>                        <span class=c1>// Bad in global namespace
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>namespace</span> <span class=n>Foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>using</span> <span class=n>fancy</span><span class=o>::</span><span class=n>string</span><span class=p>;</span>                    <span class=c1>// Good
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>using</span> <span class=n>MyVector</span> <span class=o>=</span> <span class=n>fancy</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>;</span>    <span class=c1>// C++11 type alias OK
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h2 id=global-and-static-member-functions><a name=c6-2></a>Global and static member functions</h2><h3 id=advice-621-prefer-namespaces-for-free-functions-use-static-members-only-when-tightly-coupled-to-a-class><a name=a6-2-1></a>Advice 6.2.1 Prefer namespaces for free functions; use static members only when tightly coupled to a class</h3><p>Namespace usage avoids global namespace pollution. Only when a free function is intrinsically related to a specific class should it live as a static member.</p><p>Helper logic needed only by a single .cpp belongs in an anonymous namespace.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MyNamespace</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=nf>Add</span><span class=p>(</span><span class=kt>int</span> <span class=n>a</span><span class=p>,</span> <span class=kt>int</span> <span class=n>b</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>File</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=n>File</span> <span class=n>CreateTempFile</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span> <span class=n>fileName</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h2 id=global-and-static-member-constants><a name=c6-3></a>Global and static member constants</h2><h3 id=advice-631-use-namespaces-to-hold-constants-use-static-members-only-when-tied-to-a-class><a name=a6-3-1></a>Advice 6.3.1 Use namespaces to hold constants; use static members only when tied to a class</h3><p>Namespaces guard against global namespace clutter. Only when the constant is logically owned by a specific class should it be a static member.</p><p>Implementation-only constants belong in an anonymous namespace.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>MyNamespace</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=kt>int</span> <span class=n>MAX_SIZE</span> <span class=o>=</span> <span class=mi>100</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>File</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>SEPARATOR</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h2 id=global-variables><a name=c6-4></a>Global variables</h2><h3 id=advice-641-minimize-global-variables-use-a-singleton-instead><a name=a6-4-1></a>Advice 6.4.1 Minimize global variables; use a singleton instead</h3><p>Mutable globals create tight, invisible coupling across TUs:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=n>g_counter</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// a.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>g_counter</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// b.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>g_counter</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// c.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>g_counter</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span></code></pre></div><p>Singleton pattern (global unique object):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Counter</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=n>Counter</span><span class=o>&amp;</span> <span class=n>GetInstance</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>static</span> <span class=n>Counter</span> <span class=n>counter</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>counter</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>Increase</span><span class=p>()</span>   <span class=p>{</span> <span class=n>value_</span><span class=o>++</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>Print</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>value_</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Counter</span><span class=p>()</span> <span class=o>:</span> <span class=n>value_</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>value_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// a.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Counter</span><span class=o>::</span><span class=n>GetInstance</span><span class=p>().</span><span class=n>Increase</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// b.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Counter</span><span class=o>::</span><span class=n>GetInstance</span><span class=p>().</span><span class=n>Increase</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// c.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Counter</span><span class=o>::</span><span class=n>GetInstance</span><span class=p>().</span><span class=n>Print</span><span class=p>();</span>
</span></span></code></pre></div><p>This keeps state shared globally but with better encapsulation.</p><p>Exception: if the variable is module-local (each DLL/so or executable instance carries its own), you cannot use a singleton.</p><h1 id=7-classes><a name=c7></a>7 Classes</h1><h2 id=constructors-copy-move-assignment-and-destructors><a name=c7-1></a>Constructors, copy, move, assignment, and destructors</h2><p>These special members manage object lifetime:</p><ul><li>Constructor: <code>X()</code></li><li>Copy constructor: <code>X(const X&)</code></li><li>Copy assignment operator: <code>operator=(const X&)</code></li><li>Move constructor: <code>X(X&&)</code> <em>available since C++11</em></li><li>Move assignment operator: <code>operator=(X&&)</code> <em>available since C++11</em></li><li>Destructor: <code>~X()</code></li></ul><h3 id=rule-711-all-member-variables-of-a-class-must-be-explicitly-initialized><a name=r7-1-1></a>Rule 7.1.1 All member variables of a class must be explicitly initialized</h3><p>Rationale: If a class has member variables, does not define any constructors, and lacks a default constructor, the compiler will implicitly generate one, but that generated constructor will not initialize the member variables, leaving the object in an indeterminate state.</p><p>Exceptions:</p><ul><li>If the member variable has a default constructor, explicit initialization is not required.</li></ul><p>Example: The following code lacks a constructor, so the private data members are uninitialized:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Message</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=n>ProcessOutMsg</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//…
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>msgID_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>msgLength_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>char</span><span class=o>*</span> <span class=n>msgBuffer_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>someIdentifier_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Message</span> <span class=n>message</span><span class=p>;</span>   <span class=c1>// message members are not initialized
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>message</span><span class=p>.</span><span class=n>ProcessOutMsg</span><span class=p>();</span>   <span class=c1>// subsequent use is dangerous
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Therefore, providing a default constructor is necessary, as follows:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>Message</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Message</span><span class=p>()</span> <span class=o>:</span> <span class=n>msgID_</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span> <span class=n>msgLength_</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span> <span class=n>msgBuffer_</span><span class=p>(</span><span class=k>nullptr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>ProcessOutMsg</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// …
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>msgID_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>msgLength_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>char</span><span class=o>*</span> <span class=n>msgBuffer_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>someIdentifier_</span><span class=p>;</span> <span class=c1>// has a default constructor, no explicit initialization needed
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span></code></pre></div><h3 id=advice-711-prefer-in-class-member-initialization-c11-and-constructor-initializer-lists><a name=a7-1-1></a>Advice 7.1.1 Prefer in-class member initialization (C++11) and constructor initializer lists</h3><p>Rationale: C++11 in-class initialization makes the default member value obvious at a glance and should be preferred. If initialization depends on constructor parameters or C++11 is unavailable, prefer the initializer list. Compared with assigning inside the constructor body, the initializer list is more concise, performs better, and can initialize <code>const</code> members and references.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Message</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Message</span><span class=p>()</span> <span class=o>:</span> <span class=n>msgLength_</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>  <span class=c1>// Good: prefer initializer list
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>msgBuffer_</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>  <span class=c1>// Bad: avoid assignment in constructor body
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>   
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>msgID_</span><span class=p>{</span><span class=mi>0</span><span class=p>};</span>  <span class=c1>// Good: use C++11 in-class initialization
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>msgLength_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>char</span><span class=o>*</span> <span class=n>msgBuffer_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h3 id=rule-712-declare-single-argument-constructors-explicit-to-prevent-implicit-conversions><a name=r7-1-2></a>Rule 7.1.2 Declare single-argument constructors <code>explicit</code> to prevent implicit conversions</h3><p>Rationale: A single-argument constructor not declared <code>explicit</code> acts as an implicit conversion function.<br>Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>explicit</span> <span class=n>Foo</span><span class=p>(</span><span class=k>const</span> <span class=n>string</span><span class=o>&amp;</span> <span class=n>name</span><span class=p>)</span><span class=o>:</span> <span class=n>name_</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>string</span> <span class=n>name_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ProcessFoo</span><span class=p>(</span><span class=k>const</span> <span class=n>Foo</span><span class=o>&amp;</span> <span class=n>foo</span><span class=p>){}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>test</span> <span class=o>=</span> <span class=s>&#34;test&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>ProcessFoo</span><span class=p>(</span><span class=n>test</span><span class=p>);</span>  <span class=c1>// compile fails
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Compilation fails because <code>ProcessFoo</code> expects a <code>Foo</code>, but a <code>std::string</code> is supplied.</p><p>If <code>explicit</code> were removed, the <code>std::string</code> would implicitly convert into a temporary <code>Foo</code> object. Such silent conversions are confusing and may hide bugs. Hence single-argument constructors must be declared <code>explicit</code>.</p><h3 id=rule-713-explicitly-prohibit-copymove-constructsassignment-when-not-needed><a name=r7-1-3></a>Rule 7.1.3 Explicitly prohibit copy/move constructs/assignment when not needed</h3><p>Rationale: Unless the user defines them, the compiler will generate copy constructor, copy assignment operator, move constructor and move assignment operator (move semantics are C++11+).<br>If the class should not support copying/moving, forbid them explicitly:</p><ol><li>Make the copy/move ctor or assignment operator <code>private</code> and leave it undefined:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Foo</span><span class=p>(</span><span class=k>const</span> <span class=n>Foo</span><span class=o>&amp;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Foo</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=k>const</span> <span class=n>Foo</span><span class=o>&amp;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><ol start=2><li><p>Use <code>= delete</code> from C++11, see the Modern C++ section.</p></li><li><p>Prefer inheriting from <code>NoCopyable</code>, <code>NoMovable</code>; disallow macros such as <code>DISALLOW_COPY_AND_MOVE</code>, <code>DISALLOW_COPY</code>, <code>DISALLOW_MOVE</code>.</p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Foo</span> <span class=o>:</span> <span class=k>public</span> <span class=n>NoCopyable</span><span class=p>,</span> <span class=k>public</span> <span class=n>NoMovable</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>Implementation of <code>NoCopyable</code> and <code>NoMovable</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>NoCopyable</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>NoCopyable</span><span class=p>()</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>NoCopyable</span><span class=p>(</span><span class=k>const</span> <span class=n>NoCopyable</span><span class=o>&amp;</span><span class=p>)</span> <span class=o>=</span> <span class=k>delete</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>NoCopyable</span><span class=o>&amp;</span> <span class=k>operator</span> <span class=o>=</span> <span class=p>(</span><span class=n>NoCopyable</span><span class=o>&amp;</span><span class=p>)</span> <span class=o>=</span> <span class=k>delete</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>NoMovable</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>NoMovable</span><span class=p>()</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>NoMovable</span><span class=p>(</span><span class=n>NoMovable</span><span class=o>&amp;&amp;</span><span class=p>)</span> <span class=k>noexcept</span> <span class=o>=</span> <span class=k>delete</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>NoMovable</span><span class=o>&amp;</span> <span class=k>operator</span> <span class=o>=</span> <span class=p>(</span><span class=n>NoMovable</span><span class=o>&amp;&amp;</span><span class=p>)</span> <span class=k>noexcept</span> <span class=o>=</span> <span class=k>delete</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h3 id=rule-714-provide-or-prohibit-both-copy-constructor-and-copy-assignment-together><a name=r7-1-4></a>Rule 7.1.4 Provide or prohibit both copy constructor and copy assignment together</h3><p>Since both operations have copy semantics, allow or forbid them in pairs.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Both provided
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>Foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=n>Foo</span><span class=p>(</span><span class=k>const</span> <span class=n>Foo</span><span class=o>&amp;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Foo</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=k>const</span> <span class=n>Foo</span><span class=o>&amp;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Both defaulted (C++11)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>Foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Foo</span><span class=p>(</span><span class=k>const</span> <span class=n>Foo</span><span class=o>&amp;</span><span class=p>)</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Foo</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=k>const</span> <span class=n>Foo</span><span class=o>&amp;</span><span class=p>)</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Both prohibited; in C++11 use `delete`
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>Foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Foo</span><span class=p>(</span><span class=k>const</span> <span class=n>Foo</span><span class=o>&amp;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Foo</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=k>const</span> <span class=n>Foo</span><span class=o>&amp;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h3 id=rule-715-provide-or-prohibit-both-move-constructor-and-move-assignment-together><a name=r7-1-5></a>Rule 7.1.5 Provide or prohibit both move constructor and move assignment together</h3><p>Move semantics were added in C++11. If a class needs to support moving, both move constructor and move assignment must be present or both deleted.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Both provided
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>Foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=n>Foo</span><span class=p>(</span><span class=n>Foo</span><span class=o>&amp;&amp;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Foo</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=n>Foo</span><span class=o>&amp;&amp;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Both defaulted
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>Foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Foo</span><span class=p>(</span><span class=n>Foo</span><span class=o>&amp;&amp;</span><span class=p>)</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Foo</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=n>Foo</span><span class=o>&amp;&amp;</span><span class=p>)</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Both deleted
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>Foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Foo</span><span class=p>(</span><span class=n>Foo</span><span class=o>&amp;&amp;</span><span class=p>)</span> <span class=o>=</span> <span class=k>delete</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Foo</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=n>Foo</span><span class=o>&amp;&amp;</span><span class=p>)</span> <span class=o>=</span> <span class=k>delete</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h3 id=rule-716-never-call-virtual-functions-in-constructors-or-destructors><a name=r7-1-6></a>Rule 7.1.6 Never call virtual functions in constructors or destructors</h3><p>Rationale: Calling a virtual function on the object under construction/destruction prevents the intended polymorphic behavior.<br>In C++, a base class is only building one sub-object at a time.</p><p>Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Base</span> <span class=p>{</span>                      
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>               
</span></span><span class=line><span class=cl>    <span class=n>Base</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>Log</span><span class=p>()</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>    <span class=c1>// Derived classes use different log files
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Base</span><span class=o>::</span><span class=n>Base</span><span class=p>()</span>         <span class=c1>// base constructor
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Log</span><span class=p>();</span>           <span class=c1>// virtual call inside ctor
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>                                                 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Sub</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Base</span> <span class=p>{</span>      
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=n>Log</span><span class=p>();</span>         
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>When executing <code>Sub sub;</code>, <code>Sub</code>&rsquo;s ctor runs first but calls <code>Base()</code> first; during <code>Base()</code>, the virtual call to <code>Log</code> binds to <code>Base::Log</code>, not <code>Sub::Log</code>. The same applies in destructors.</p><h3 id=rule-717-copymove-constructsassignment-of-polymorphic-bases-must-be-non-public-or-deleted><a name=r7-1-7></a>Rule 7.1.7 Copy/move constructs/assignment of polymorphic bases must be non-public or deleted</h3><p>Assigning a derived object to a base object causes slicing: only the base part is copied/moved, breaking polymorphism.<br>Negative Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Base</span> <span class=p>{</span>                      
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>               
</span></span><span class=line><span class=cl>    <span class=n>Base</span><span class=p>()</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=o>~</span><span class=n>Base</span><span class=p>()</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=n>Fun</span><span class=p>()</span> <span class=p>{</span> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Base&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Derived</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=n>Fun</span><span class=p>()</span> <span class=k>override</span> <span class=p>{</span> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Derived&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>Foo</span><span class=p>(</span><span class=k>const</span> <span class=n>Base</span> <span class=o>&amp;</span><span class=n>base</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Base</span> <span class=n>other</span> <span class=o>=</span> <span class=n>base</span><span class=p>;</span> <span class=c1>// slicing occurs
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>other</span><span class=p>.</span><span class=n>Fun</span><span class=p>();</span> <span class=c1>// calls Base::Fun
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>Derived</span> <span class=n>d</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>Foo</span><span class=p>(</span><span class=n>d</span><span class=p>);</span> <span class=c1>// derived passed in
</span></span></span></code></pre></div><p>Declare copy/move operations <code>delete</code> or <code>private</code> so the compiler rejects such assignments.</p><h2 id=inheritance><a name=c7-2></a>Inheritance</h2><h3 id=rule-721-base-class-destructors-must-be-virtual-classes-not-intended-for-inheritance-should-be-marked-final><a name=r7-2-1></a>Rule 7.2.1 Base class destructors must be <code>virtual</code>; classes not intended for inheritance should be marked <code>final</code></h3><p>Rationale: A base destructor must be virtual to ensure derived destructors run when the object is deleted via a base pointer.</p><p>Example: A base destructor missing <code>virtual</code> causes memory leaks.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>getVersion</span><span class=p>()</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   
</span></span><span class=line><span class=cl>    <span class=o>~</span><span class=n>Base</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;~Base&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Sub</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Sub</span><span class=p>()</span> <span class=o>:</span> <span class=n>numbers_</span><span class=p>(</span><span class=k>nullptr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>   
</span></span><span class=line><span class=cl>    <span class=o>~</span><span class=n>Sub</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>delete</span><span class=p>[]</span> <span class=n>numbers_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;~Sub&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>   
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=nf>Init</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>const</span> <span class=n>size_t</span> <span class=n>numberCount</span> <span class=o>=</span> <span class=mi>100</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>numbers_</span> <span class=o>=</span> <span class=k>new</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>nothrow</span><span class=p>)</span> <span class=kt>int</span><span class=p>[</span><span class=n>numberCount</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>numbers_</span> <span class=o>==</span> <span class=k>nullptr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>       
</span></span><span class=line><span class=cl>        <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>getVersion</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>(</span><span class=s>&#34;hello!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span><span class=o>*</span> <span class=n>numbers_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span><span class=o>*</span> <span class=n>args</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Base</span><span class=o>*</span> <span class=n>b</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Sub</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>delete</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Because <code>Base::~Base</code> is not virtual, only its destructor is invoked; <code>Sub::~Sub</code> is skipped and <code>numbers_</code> leaks.<br>Exceptions: Marker classes like <code>NoCopyable</code>, <code>NoMovable</code> need neither virtual destructors nor <code>final</code>.</p><h3 id=rule-722-virtual-functions-must-not-have-default-arguments><a name=r7-2-2></a>Rule 7.2.2 Virtual functions must not have default arguments</h3><p>Rationale: In C++, virtual dispatch happens at runtime but default arguments are bound at compile time. The selected function body is from the derived class while its default parameter values come from the base, causing surprising behavior.</p><p>Example: the program emits “Base!” instead of the expected “Sub!”</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=n>Display</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span> <span class=n>text</span> <span class=o>=</span> <span class=s>&#34;Base!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>text</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>   
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=o>~</span><span class=n>Base</span><span class=p>(){}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Sub</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=n>Display</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span> <span class=n>text</span>  <span class=o>=</span> <span class=s>&#34;Sub!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>text</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>   
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=o>~</span><span class=n>Sub</span><span class=p>(){}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Base</span><span class=o>*</span> <span class=n>base</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Sub</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>Sub</span><span class=o>*</span> <span class=n>sub</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Sub</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>   
</span></span><span class=line><span class=cl>    <span class=n>base</span><span class=o>-&gt;</span><span class=n>Display</span><span class=p>();</span>  <span class=c1>// prints: Base!
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>sub</span><span class=o>-&gt;</span><span class=n>Display</span><span class=p>();</span>   <span class=c1>// prints: Sub!
</span></span></span><span class=line><span class=cl><span class=c1></span>   
</span></span><span class=line><span class=cl>    <span class=k>delete</span> <span class=n>base</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>delete</span> <span class=n>sub</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h3 id=rule-723-do-not-override-an-inherited-non-virtual-function><a name=r7-2-3></a>Rule 7.2.3 Do not override an inherited non-virtual function</h3><p>Non-virtual functions are bound statically; only virtual functions provide dynamic dispatch.</p><p>Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=n>Fun</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Sub</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=n>Fun</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Sub</span><span class=o>*</span> <span class=n>sub</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Sub</span><span class=p>();</span>                    
</span></span><span class=line><span class=cl><span class=n>Base</span><span class=o>*</span> <span class=n>base</span> <span class=o>=</span> <span class=n>sub</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sub</span><span class=o>-&gt;</span><span class=n>Fun</span><span class=p>();</span>    <span class=c1>// calls Sub::Fun               
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>base</span><span class=o>-&gt;</span><span class=n>Fun</span><span class=p>();</span>   <span class=c1>// calls Base::Fun
</span></span></span><span class=line><span class=cl><span class=c1>//...
</span></span></span></code></pre></div><h2 id=multiple-inheritance><a name=c7-3></a>Multiple Inheritance</h2><p>Real-world use of multiple inheritance in our code base is rare because it brings several typical problems:</p><ol><li>The diamond inheritance issue causes data duplication and name ambiguity; C++ introduces virtual inheritance to address it.</li><li>Even without diamond inheritance, name clashes between different bases can create ambiguity.</li><li>When a subclass needs to extend/override methods in multiple bases, its responsibilities become unclear, leading to confusing semantics.</li><li>Inheritance is white-box reuse: subclasses have access to parents’ <code>protected</code> members, creating stronger coupling. Multiple inheritance compounds the coupling.</li></ol><p>Benefits:<br>Multiple inheritance offers a simpler way to assemble interfaces and behaviors.</p><p>Hence multiple inheritance is allowed only in the following cases.</p><h3 id=advice-731-use-multiple-inheritance-for-interface-segregation-and-multi-role-composition><a name=a7-3-1></a>Advice 7.3.1 Use multiple inheritance for interface segregation and multi-role composition</h3><p>If a class must implement several unrelated interfaces, inherit from separate base classes that represent those roles—similar to Scala traits.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Role1</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Role2</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Role3</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Object1</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Role1</span><span class=p>,</span> <span class=k>public</span> <span class=n>Role2</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Object2</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Role2</span><span class=p>,</span> <span class=k>public</span> <span class=n>Role3</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span></code></pre></div><p>The C++ standard library also demonstrates this pattern:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>basic_istream</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>basic_ostream</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>basic_iostream</span> <span class=o>:</span> <span class=k>public</span> <span class=n>basic_istream</span><span class=p>,</span> <span class=k>public</span> <span class=n>basic_ostream</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h2 id=overloading><a name=c7-4></a>Overloading</h2><p>Overload operators only with good reason and without altering their intuitive semantics; e.g., never use ‘+’ for subtraction.<br>Operator overloading makes code intuitive, but also has drawbacks:</p><ul><li>It can mislead readers into assuming built-in efficiency and overlook potential slowdowns;</li><li>Debugging is harder—finding a function name is easier than locating operator usage.</li><li>Non-intuitive behaviour (e.g., ‘+’ subtracting) obfuscates code.</li><li>Implicit conversions triggered by assignment operator overloads can hide deep bugs. Prefer functions like <code>Equals()</code>, <code>CopyFrom()</code> instead of overloading <code>==</code>, <code>=</code>.</li></ul><h1 id=8-functions><a name=c8></a>8 Functions</h1><h2 id=function-design><a name=c8-1></a>Function Design</h2><h3 id=rule-811-keep-functions-short-no-more-than-50-non-blank-non-comment-lines><a name=r8-1-1></a>Rule 8.1.1 Keep functions short; no more than 50 non-blank non-comment lines</h3><p>A function should fit on one screen (≤ 50 lines), do one thing, and do it well.<br>Long functions often indicate mixed concerns, excessive complexity, or missing abstractions.</p><p>Exceptions: Algorithmic routines that are inherently cohesive and complete might exceed 50 lines.</p><p>Even if the current version works well, future changes may introduce subtle bugs. Splitting into smaller, focused functions eases readability and maintenance.</p><h2 id=inline-functions><a name=c8-2></a>Inline Functions</h2><h3 id=advice-821-inline-functions-should-be-no-more-than-10-lines-non-blank-non-comment><a name=a8-2-1></a>Advice 8.2.1 Inline functions should be no more than 10 lines (non-blank non-comment)</h3><p>Inline functions retain the usual semantics; they just expand in place. Ordinary functions incur call/return overhead; inline functions substitute the body directly.</p><p>Inlining only makes sense for very small functions (1–10 lines). For large functions the call-cost is negligible, and compilers usually fall back to normal calls.<br>Complex control flow (loops, <code>switch</code>, <code>try-catch</code>) normally precludes inlining.</p><p><strong>Virtual functions and recursive functions cannot be inlined.</strong></p><h2 id=function-parameters><a name=c8-3></a>Function Parameters</h2><h3 id=advice-831-prefer-references-over-pointers-for-parameters><a name=a8-3-1></a>Advice 8.3.1 Prefer references over pointers for parameters</h3><p>References are safer: they cannot be null and cannot be reseated after binding; no null pointer checks required.<br>On legacy platforms follow existing conventions.<br>Use <code>const</code> to enforce immutability and document the intent, enhancing readability.</p><p>Exception: when passing run-time sized arrays, pointers may be used.</p><h3 id=advice-832-use-strong-typing-avoid-void><a name=a8-3-2></a>Advice 8.3.2 Use strong typing; avoid <code>void*</code></h3><p>C/C++ is strongly typed; keep the style consistent. Strong type checking allows the compiler to detect mismatches early.</p><p>Using strong types prevents defects. Watch the poorly typed <code>FooListAddNode</code> below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>FooNode</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=nc>List</span> <span class=n>link</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>foo</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>BarNode</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=nc>List</span> <span class=n>link</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>bar</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>FooListAddNode</span><span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>node</span><span class=p>)</span> <span class=c1>// Bad: using `void *`
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>FooNode</span> <span class=o>*</span><span class=n>foo</span> <span class=o>=</span> <span class=p>(</span><span class=n>FooNode</span> <span class=o>*</span><span class=p>)</span><span class=n>node</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>ListAppend</span><span class=p>(</span><span class=o>&amp;</span><span class=n>g_FooList</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>foo</span><span class=o>-&gt;</span><span class=n>link</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>MakeTheList</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>FooNode</span> <span class=o>*</span><span class=n>foo</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>BarNode</span> <span class=o>*</span><span class=n>bar</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>FooListAddNode</span><span class=p>(</span><span class=n>bar</span><span class=p>);</span>        <span class=c1>// Wrong: meant `foo`, compiles anyway
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><ol><li>Use template functions for variant parameter types.</li><li>Prefer polymorphic base-class pointers/ references.</li></ol><h3 id=advice-833-functions-shall-have-no-more-than-5-parameters><a name=a8-3-3></a>Advice 8.3.3 Functions shall have no more than 5 parameters</h3><p>Too many parameters increase coupling to callers and complicate testing.</p><p>If you exceed this:</p><ul><li>Consider splitting the function.</li><li>Group related parameters into a single struct.</li></ul><h1 id=9-additional-c-features><a name=c9></a>9 Additional C++ Features</h1><h2 id=constants-and-initialization><a name=c9-1></a>Constants and Initialization</h2><p>Immutable values are easier to understand, trace and analyze; default to <code>const</code> for any definition.</p><h3 id=rule-911-do-not-use-macros-to-define-constants><a name=r9-1-1></a>Rule 9.1.1 Do not use macros to define constants</h3><p>Macros perform simple textual substitution at preprocessing time; error traces and debuggers show raw values instead of names.<br>Macros lack type checking and scope.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#define MAX_MSISDN_LEN 20    </span><span class=c1>// bad
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// use C++ const
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>const</span> <span class=kt>int</span> <span class=n>MAX_MSISDN_LEN</span> <span class=o>=</span> <span class=mi>20</span><span class=p>;</span> <span class=c1>// good
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// for C++11+, prefer constexpr
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>constexpr</span> <span class=kt>int</span> <span class=n>MAX_MSISDN_LEN</span> <span class=o>=</span> <span class=mi>20</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=advice-911-group-related-integer-constants-using-enums><a name=a9-1-1></a>Advice 9.1.1 Group related integer constants using enums</h3><p>Enums are safer than <code>#define</code> or <code>const int</code>; the compiler validates values.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// good:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>enum</span> <span class=nc>Week</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>SUNDAY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>MONDAY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>TUESDAY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>WEDNESDAY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>THURSDAY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>FRIDAY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>SATURDAY</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>enum</span> <span class=nc>Color</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>RED</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>BLACK</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>BLUE</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ColorizeCalendar</span><span class=p>(</span><span class=n>Week</span> <span class=n>today</span><span class=p>,</span> <span class=n>Color</span> <span class=n>color</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ColorizeCalendar</span><span class=p>(</span><span class=n>BLUE</span><span class=p>,</span> <span class=n>SUNDAY</span><span class=p>);</span> <span class=c1>// compile-time error: type mismatch
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// poor:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>const</span> <span class=kt>int</span> <span class=n>SUNDAY</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>int</span> <span class=n>MONDAY</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>int</span> <span class=n>BLACK</span>  <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>int</span> <span class=n>BLUE</span>   <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>ColorizeCalendar</span><span class=p>(</span><span class=kt>int</span> <span class=n>today</span><span class=p>,</span> <span class=kt>int</span> <span class=n>color</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>ColorizeCalendar</span><span class=p>(</span><span class=n>BLUE</span><span class=p>,</span> <span class=n>SUNDAY</span><span class=p>);</span> <span class=c1>// compiles fine
</span></span></span></code></pre></div><p>When enum values map to specific constants, assign them explicitly; otherwise omit assignments to avoid redundancy.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// good: device types per protocol S
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>enum</span> <span class=nc>DeviceType</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DEV_UNKNOWN</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>DEV_DSMP</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>DEV_ISMG</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>DEV_WAPPORTAL</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>Internal enums used only for categorization should not have explicit values.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// good: session states
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>enum</span> <span class=nc>SessionState</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>INIT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>CLOSED</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>WAITING_FOR_RESPONSE</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>Avoid duplicate values; if unavoidable, qualify them:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>enum</span> <span class=nc>RTCPType</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>RTCP_SR</span> <span class=o>=</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>RTCP_MIN_TYPE</span> <span class=o>=</span> <span class=n>RTCP_SR</span><span class=p>,</span>       
</span></span><span class=line><span class=cl>    <span class=n>RTCP_RR</span>    <span class=o>=</span> <span class=mi>201</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>RTCP_SDES</span>  <span class=o>=</span> <span class=mi>202</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>RTCP_BYE</span>   <span class=o>=</span> <span class=mi>203</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>RTCP_APP</span>   <span class=o>=</span> <span class=mi>204</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>RTCP_RTPFB</span> <span class=o>=</span> <span class=mi>205</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>RTCP_PSFB</span>  <span class=o>=</span> <span class=mi>206</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>RTCP_XR</span>  <span class=o>=</span> <span class=mi>207</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>RTCP_RSI</span> <span class=o>=</span> <span class=mi>208</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>RTCP_PUBPORTS</span> <span class=o>=</span> <span class=mi>209</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>RTCP_MAX_TYPE</span> <span class=o>=</span> <span class=n>RTCP_PUBPORTS</span> 
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h3 id=rule-912-forbid-magic-numbers><a name=r9-1-2></a>Rule 9.1.2 Forbid magic numbers</h3><p>“Magic numbers” are literals whose meaning is opaque or unclear.<br>Clarity is contextual: <code>type = 12</code> is unclear, whereas <code>monthsCount = yearsCount * 12</code> is understandable.<br>Even <code>0</code> can be cryptic, e.g., <code>status = 0</code>.</p><p>Solution:<br>Comment locally used literals, or create named <code>const</code> for widely used ones.</p><p>Prohibited practices:</p><ul><li>Names just map a macro to the literal, e.g., <code>const int ZERO = 0</code></li><li>Names hard-code limits, e.g., <code>const int XX_TIMER_INTERVAL_300MS = 300</code>; use <code>XX_TIMER_INTERVAL_MS</code>.</li></ul><h3 id=rule-913-each-constant-shall-have-a-single-responsibility><a name=r9-1-3></a>Rule 9.1.3 Each constant shall have a single responsibility</h3><p>A constant must express only one concept; avoid reuse for unrelated purposes.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// good: for two protocols that both allow 20-digit MSISDNs
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>const</span> <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>A_MAX_MSISDN_LEN</span> <span class=o>=</span> <span class=mi>20</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>B_MAX_MSISDN_LEN</span> <span class=o>=</span> <span class=mi>20</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// or use distinct namespaces
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>namespace</span> <span class=n>Namespace1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>MAX_MSISDN_LEN</span> <span class=o>=</span> <span class=mi>20</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>Namespace2</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>MAX_MSISDN_LEN</span> <span class=o>=</span> <span class=mi>20</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=rule-914-do-not-use-memcpy_s-memset_s-to-initialize-non-pod-objects><a name=r9-1-4></a>Rule 9.1.4 Do not use <code>memcpy_s</code>, <code>memset_s</code> to initialize non-POD objects</h3><p>POD (“Plain Old Data”) includes primitive types, aggregates, etc., without non-trivial default constructors, virtual functions, or base classes.<br>Non-POD objects (e.g., classes with virtual functions) have uncertain layouts defined by the ABI; misusing memory routines leads to undefined behavior. Even for aggregates, raw memory manipulation violates information hiding and should be avoided.</p><p>See the appendix for detailed POD specifications.</p><h3 id=advice-912-declare-variables-at-point-of-first-use-and-initialize-them><a name=a9-1-2></a>Advice 9.1.2 Declare variables at point of first use and initialize them</h3><p>Using un-initialized variables is a common bug. Defining variables as late as possible and initializing immediately avoids such errors.</p><p>Declaring all variables up front leads to:</p><ul><li>Poor readability and maintenance: definition sites are far from usage sites.</li><li>Variables are hard to initialize appropriately: at the beginning of a function, we often lack enough information to initialize them, so we initialize them with some empty default (e.g., zero). That is usually a waste and can also lead to errors if the variable is used before it is assigned a valid value.</li></ul><p>Following the principle of minimizing variable scope and declaring variables as close as possible to their first use makes code easier to read and clarifies the type and initial value of every variable. In particular, initialization should be used instead of declaration followed by assignment.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Bad: declaration and initialization are separated
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>string</span> <span class=n>name</span><span class=p>;</span>        <span class=c1>// default-constructed at declaration
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>name</span> <span class=o>=</span> <span class=s>&#34;zhangsan&#34;</span><span class=p>;</span>  <span class=c1>// assignment operator called; definition far from declaration, harder to understand
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Good: declaration and initialization are combined, easier to understand
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>string</span> <span class=nf>name</span><span class=p>(</span><span class=s>&#34;zhangsan&#34;</span><span class=p>);</span>  <span class=c1>// constructor called directly
</span></span></span></code></pre></div><h2 id=expressions-1><a name=c9-2></a>Expressions</h2><h3 id=rule-921-do-not-reference-a-variable-again-inside-the-same-expression-that-increments-or-decrements-it><a name=r9-2-1></a>Rule 9.2.1 Do not reference a variable again inside the same expression that increments or decrements it</h3><p>C++ makes no guarantee about the order of evaluation when a variable that undergoes pre/post increment or decrement is referenced again within the same expression. Different compilers—or even different versions of the same compiler—may behave differently.<br>For portable code, never rely on such unspecified sequencing.</p><p>Notice that adding parentheses does not solve the problem, because this is a sequencing issue, not a precedence issue.</p><p>Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=n>i</span><span class=o>++</span><span class=p>;</span> <span class=c1>// Bad: the order of evaluating b[i] and i++ is unspecified.
</span></span></span></code></pre></div><p>Write the increment/decrement on its own line:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>i</span><span class=o>++</span><span class=p>;</span>            <span class=c1>// Good: on its own line
</span></span></span></code></pre></div><p>Function arguments</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>Func</span><span class=p>(</span><span class=n>i</span><span class=o>++</span><span class=p>,</span> <span class=n>i</span><span class=p>);</span>   <span class=c1>// Bad: cannot tell whether the increment has happened when passing the second argument
</span></span></span></code></pre></div><p>Correct:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>i</span><span class=o>++</span><span class=p>;</span>            <span class=c1>// Good: on its own line
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>x</span> <span class=o>=</span> <span class=n>Func</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>i</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=rule-922-provide-a-default-branch-in-every-switch-statement><a name=r9-2-2></a>Rule 9.2.2 Provide a default branch in every switch statement</h3><p>In most cases, a switch statement must contain a default branch so that unlisted cases have well-defined behavior.</p><p>Exception:
If the control variable is of an enum type and all enumerators are covered by explicit case labels, a default branch is superfluous.<br>Modern compilers issue a warning when an enumerator in an enum is missing from the switch.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>enum</span> <span class=nc>Color</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>RED</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>BLUE</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Because the switch variable is an enum and all enumerators are covered, we can omit default
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>switch</span> <span class=p>(</span><span class=n>color</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nl>RED</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>DoRedThing</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nl>BLUE</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>DoBlueThing</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=suggestion-921-when-writing-comparisons-put-the-variable-on-the-left-and-the-constant-on-the-right><a name=a9-2-1></a>Suggestion 9.2.1 When writing comparisons, put the variable on the left and the constant on the right</h3><p>It is unnatural to read <code>if (MAX == v)</code> or even harder <code>if (MAX > v)</code>.<br>Write the more readable form:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>value</span> <span class=o>==</span> <span class=n>MAX</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>value</span> <span class=o>&lt;</span> <span class=n>MAX</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>One exception is range checks: <code>if (MIN &lt; value && value &lt; MAX)</code>, where the left boundary is a constant.</p><p>Do not worry about accidentally typing <code>=</code> instead of <code>==</code>; compilers and static-analysis tools will warn about <code>if (value = MAX)</code>. Leave typos to the tools; the code must be clear to humans.</p><h3 id=suggestion-922-use-parentheses-to-clarify-operator-precedence><a name=a9-2-2></a>Suggestion 9.2.2 Use parentheses to clarify operator precedence</h3><p>Parentheses make the intended precedence explicit, preventing bugs caused by mismatching the default precedence rules, while simultaneously improving readability. Excessive parentheses, however, can clutter the code. Some guidance:</p><ul><li>If an expression contains two or more <em>different</em> binary operators, parenthesize it.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>a</span> <span class=o>+</span> <span class=n>b</span> <span class=o>+</span> <span class=n>c</span><span class=p>;</span>         <span class=cm>/* same operators, parentheses optional */</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>Foo</span><span class=p>(</span><span class=n>a</span> <span class=o>+</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>);</span>     <span class=cm>/* comma operator, no need for extra parentheses */</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=p>(</span><span class=mi>2</span> <span class=o>+</span> <span class=mi>3</span><span class=p>);</span>      <span class=cm>/* different operators, parentheses needed */</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>a</span> <span class=o>+</span> <span class=p>(</span><span class=n>b</span> <span class=o>/</span> <span class=mi>5</span><span class=p>);</span>       <span class=cm>/* different operators, parentheses needed */</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=p>(</span><span class=n>a</span> <span class=o>==</span> <span class=n>b</span><span class=p>)</span> <span class=o>?</span> <span class=nl>a</span> <span class=p>:</span> <span class=p>(</span><span class=n>a</span> <span class=err>–</span> <span class=n>b</span><span class=p>);</span>    <span class=cm>/* different operators, parentheses needed */</span>
</span></span></code></pre></div><h2 id=type-casting><a name=c9-3></a>Type Casting</h2><p>Never customize behavior through type branching: that style is error-prone and a clear sign of writing C code in C++. It is inflexible; when a new type is added, every branch must be changed—and the compiler will not remind you. Use templates or virtual functions to let each type determine its behavior, rather than letting the calling code do it.</p><p>Avoid type casting; design types that clearly express what kind of object they represent without the need for casting. When designing a numeric type, decide:</p><ul><li>signed or unsigned</li><li>float vs double</li><li>int8, int16, int32, or int64</li></ul><p>Inevitably, some casts remain; C++ is close to the machine and talks to APIs whose type designs are not ideal. Still, keep them to a minimum.</p><p>Exception: if a function’s return value is intentionally ignored, first reconsider the design. If ignoring it is really appropriate, cast it to <code>(void)</code>.</p><h3 id=rule-931-use-the-c-style-casts-never-c-style-casts><a name=r9-3-1></a>Rule 9.3.1 Use the C++-style casts; never C-style casts</h3><p>C++ casts are more specific, more readable, and safer. The C++ casts are:</p><ul><li><p>For type conversions</p><ol><li><code>dynamic_cast</code> — down-cast in an inheritance hierarchy and provides run-time type checking. Avoid it by improving base/derived design instead.</li><li><code>static_cast</code> — like C-style but safer. Used for value conversions or up-casting, and resolving multiple-inheritance ambiguities. Prefer brace-init for pure arithmetic.</li><li><code>reinterpret_cast</code> — reinterprets one type as another. Undefined behaviour potential, use sparingly.</li><li><code>const_cast</code> — removes const or volatile. Suppresses immutability, leading to UB if misused.</li></ol></li><li><p>Numeric conversions (C++11 onwards)<br>Use brace-init for converting between numeric types without loss.</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl>  <span class=kt>double</span> <span class=n>d</span><span class=p>{</span> <span class=n>someFloat</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=kt>int64_t</span> <span class=n>i</span><span class=p>{</span> <span class=n>someInt32</span> <span class=p>};</span>
</span></span></code></pre></div><h3 id=suggestion-931-avoid-dynamic_cast><a name=a9-3-1></a>Suggestion 9.3.1 Avoid <code>dynamic_cast</code></h3><ol><li><code>dynamic_cast</code> depends on RTTI, letting programs discover an object’s concrete type at run time.</li><li>Its necessity usually signals a flaw in the class hierarchy; prefer redesigning classes instead.</li></ol><h3 id=suggestion-932-avoid-reinterpret_cast><a name=a9-3-2></a>Suggestion 9.3.2 Avoid <code>reinterpret_cast</code></h3><p><code>reinterpret_cast</code> performs low-level re-interpretations of memory layouts and is inherently unsafe. Avoid crossing unrelated type boundaries.</p><h3 id=suggestion-933-avoid-const_cast><a name=a9-3-3></a>Suggestion 9.3.3 Avoid <code>const_cast</code></h3><p><code>const_cast</code> strips the <code>const</code> and <code>volatile</code> qualifiers off an object. Modifying a formerly const variable via such a cast yields Undefined Behaviour.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Bad
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>const</span> <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1024</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span><span class=o>*</span> <span class=n>p</span> <span class=o>=</span> <span class=k>const_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>*&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=o>*</span><span class=n>p</span> <span class=o>=</span> <span class=mi>2048</span><span class=p>;</span>      <span class=c1>// Undefined Behaviour
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Bad
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>Foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Foo</span><span class=p>()</span> <span class=o>:</span> <span class=n>i</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>Fun</span><span class=p>(</span><span class=kt>int</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span> <span class=n>i</span> <span class=o>=</span> <span class=n>v</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=n>Foo</span> <span class=n>f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Foo</span><span class=o>*</span> <span class=n>p</span> <span class=o>=</span> <span class=k>const_cast</span><span class=o>&lt;</span><span class=n>Foo</span><span class=o>*&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=n>f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>-&gt;</span><span class=n>Fun</span><span class=p>(</span><span class=mi>8</span><span class=p>);</span>  <span class=c1>// Undefined Behaviour
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h2 id=resource-acquisition-and-release><a name=c9-4></a>Resource Acquisition and Release</h2><h3 id=rule-941-use-delete-for-single-objects-and-delete-for-arrays><a name=r9-4-1></a>Rule 9.4.1 Use delete for single objects and delete[] for arrays</h3><ul><li><em>single object</em>: <code>new</code> allocates and constructs exactly one object ⇒ dispose with <code>delete</code>.</li><li><em>array</em>: <code>new[]</code> allocates space for (n) objects and constructs them ⇒ dispose with <code>delete[]</code>.</li></ul><p>Mismatching <code>new</code>/<code>new[]</code> with the wrong form of <code>delete</code> yields UB.</p><p>Wrong:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>const</span> <span class=kt>int</span> <span class=n>MAX_ARRAY_SIZE</span> <span class=o>=</span> <span class=mi>100</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span><span class=o>*</span> <span class=n>numberArray</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>int</span><span class=p>[</span><span class=n>MAX_ARRAY_SIZE</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=k>delete</span> <span class=n>numberArray</span><span class=p>;</span>        <span class=c1>// ← wrong
</span></span></span></code></pre></div><p>Right:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>const</span> <span class=kt>int</span> <span class=n>MAX_ARRAY_SIZE</span> <span class=o>=</span> <span class=mi>100</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span><span class=o>*</span> <span class=n>numberArray</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>int</span><span class=p>[</span><span class=n>MAX_ARRAY_SIZE</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=k>delete</span><span class=p>[]</span> <span class=n>numberArray</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=suggestion-941-use-raii-to-track-dynamic-resources><a name=a9-4-1></a>Suggestion 9.4.1 Use RAII to track dynamic resources</h3><p>RAII = Resource Acquisition Is Initialization. Acquire a resource in a constructor; the destructor releases it. Benefits:</p><ul><li>No manual cleanup.</li><li>The resource remains valid for the scope’s lifetime.</li></ul><p>Example: mutex guard</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>LockGuard</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>LockGuard</span><span class=p>(</span><span class=k>const</span> <span class=n>LockType</span><span class=o>&amp;</span> <span class=n>lock</span><span class=p>)</span> <span class=o>:</span> <span class=n>lock_</span><span class=p>(</span><span class=n>lock</span><span class=p>)</span> <span class=p>{</span> <span class=n>lock_</span><span class=p>.</span><span class=n>Acquire</span><span class=p>();</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=o>~</span><span class=n>LockGuard</span><span class=p>()</span> <span class=p>{</span> <span class=n>lock_</span><span class=p>.</span><span class=n>Release</span><span class=p>();</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>LockType</span> <span class=n>lock_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>Update</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>LockGuard</span> <span class=n>g</span><span class=p>(</span><span class=n>mutex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=standard-library><a name=c9-5></a>Standard Library</h2><p>STL usage varies between products; basic rules below.</p><h3 id=rule-951-never-store-the-pointer-returned-by-stdstringc_str><a name=r9-5-1></a>Rule 9.5.1 Never store the pointer returned by std::string::c_str()</h3><p><code>string::c_str()</code> is not guaranteed to point at stable memory. A specific implementation may return memory that is released soon after the call. Therefore, call <code>string::c_str()</code> at point of use; do <strong>not</strong> store the pointer.</p><p>Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>void</span> <span class=nf>Fun1</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>name</span> <span class=o>=</span> <span class=s>&#34;demo&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>text</span> <span class=o>=</span> <span class=n>name</span><span class=p>.</span><span class=n>c_str</span><span class=p>();</span>   <span class=c1>// still valid here
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>name</span> <span class=o>=</span> <span class=s>&#34;test&#34;</span><span class=p>;</span>                     <span class=c1>// may invalidate text
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Exception: in extremely performance-critical code it is acceptable to store the pointer, provided the <code>std::string</code> is guaranteed to outlive the pointer <strong>and</strong> remain unmodified while the pointer is used.</p><h3 id=suggestion-951-prefer-stdstring-over-char><a name=a9-5-1></a>Suggestion 9.5.1 Prefer std::string over char*</h3><p>Advantages:</p><ul><li>no manual null-termination</li><li>built-in operators (<code>+</code>, <code>=</code>, <code>==</code>)</li><li>automatic memory management</li></ul><p>Be aware: some legacy STL implementations use Copy-On-Write (COW) strings. COW is not thread-safe and can cause crashes. Passing COW strings across DLL boundaries can leave dangling references. Choose a modern, non-COW STL when possible.</p><p>Exception: APIs that require <code>'char*'</code> get it from <code>std::string::c_str()</code>. Stack buffers should be plain char arrays, not <code>std::string</code> or <code>std::vector&lt;char></code>.</p><h3 id=rule-952-do-not-use-auto_ptr><a name=r9-5-2></a>Rule 9.5.2 Do not use auto_ptr</h3><p><code>std::auto_ptr</code> performs implicit (and surprising) ownership transfer:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>auto_ptr</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>p1</span><span class=p>(</span><span class=k>new</span> <span class=n>T</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>auto_ptr</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>p2</span> <span class=o>=</span> <span class=n>p1</span><span class=p>;</span>   <span class=c1>// p1 becomes nullptr
</span></span></span></code></pre></div><p>Therefore it is forbidden.<br>Use <code>std::unique_ptr</code> for exclusive ownership, <code>std::shared_ptr</code> for shared ownership.</p><h3 id=suggestion-952-prefer-canonical-c-headers><a name=a9-5-2></a>Suggestion 9.5.2 Prefer canonical C++ headers</h3><p>Use <code>&lt;cstdlib></code> instead of <code>&lt;stdlib.h></code>, etc.</p><h2 id=const-qualifier><a name=c9-6></a>const Qualifier</h2><p>Add <code>const</code> to variables and parameters whose values must not change. Mark member functions <code>const</code> if they do not modify the observable state.</p><h3 id=rule-961-use-const-for-pointerreference-parameters-that-are-read-only><a name=r9-6-1></a>Rule 9.6.1 Use const for pointer/reference parameters that are read-only</h3><p>Write:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>void</span> <span class=nf>PrintFoo</span><span class=p>(</span><span class=k>const</span> <span class=n>Foo</span><span class=o>&amp;</span> <span class=n>foo</span><span class=p>);</span>
</span></span></code></pre></div><p>instead of <code>Foo&</code>.</p><h3 id=rule-962-mark-member-functions-const-when-they-do-not-modify-the-object><a name=r9-6-2></a>Rule 9.6.2 Mark member functions const when they do not modify the object</h3><p>Accessors should always be const.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>PrintValue</span><span class=p>()</span> <span class=k>const</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=nf>GetValue</span><span class=p>()</span> <span class=k>const</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>value_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h3 id=suggestion-961-declare-member-variables-const-when-they-never-change-after-initialization><a name=a9-6-1></a>Suggestion 9.6.1 Declare member variables const when they never change after initialization</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Foo</span><span class=p>(</span><span class=kt>int</span> <span class=n>length</span><span class=p>)</span> <span class=o>:</span> <span class=n>dataLength_</span><span class=p>(</span><span class=n>length</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=kt>int</span> <span class=n>dataLength_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h2 id=exceptions-1><a name=c9-7></a>Exceptions</h2><h3 id=suggestion-971-mark-functions-that-never-throw-as-noexcept-c11><a name=a9-7-1></a>Suggestion 9.7.1 Mark functions that never throw as noexcept (C++11)</h3><p>Benefits:</p><ol><li>Enables better code generation.</li><li>Standard containers only use move-construction when a move operator is noexcept. Without <code>noexcept</code> they fall back to (slower) copy-construction.</li></ol><p>Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>extern</span> <span class=s>&#34;C&#34;</span> <span class=kt>double</span> <span class=n>sqrt</span><span class=p>(</span><span class=kt>double</span><span class=p>)</span> <span class=k>noexcept</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>Compute</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&amp;</span> <span class=n>v</span><span class=p>)</span> <span class=k>noexcept</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Destructor, default constructors, <code>swap</code>, and move operations must never throw.</p><h2 id=templates--generic-programming><a name=c9-8></a>Templates & Generic Programming</h2><h3 id=rule-981-prohibit-generic-programming-in-the-openharmony-project><a name=a9-8-1></a>Rule 9.8.1 Prohibit generic programming in the OpenHarmony project</h3><p>Generic programming, templates, and OOP are driven by entirely different ideas and techniques. OpenHarmony is mainly based on OOP.</p><p>Avoid templates because:</p><ol><li>Inexperienced developers tend to produce bloated, confusing code.</li><li>Template code is hard to read and debug.</li><li>Error messages are notoriously cryptic.</li><li>Templates may generate excessive code size.</li><li>Refactoring template code is difficult because its instantiations are spread across the codebase.</li></ol><p>OpenHarmony forbids template programming in <em>most</em> modules.<br>Exception: STL adaptation layers may still use templates.</p><h2 id=macros><a name=c9-9></a>Macros</h2><p>Avoid complex macros. Instead:</p><ul><li>Use <code>const</code> or enums for constants.</li><li>Replace macro functions with inline or template functions.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Bad
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#define SQUARE(a, b) ((a) * (b))
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1>// Prefer
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>T</span> <span class=n>Square</span><span class=p>(</span><span class=n>T</span> <span class=n>a</span><span class=p>,</span> <span class=n>T</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>a</span> <span class=o>*</span> <span class=n>b</span><span class=p>;</span> <span class=p>}</span>
</span></span></code></pre></div><h1 id=10-modern-c-features><a name=c10></a>10 Modern C++ Features</h1><p>ISO standardized C++11 in 2011 and C++17 in March 2017. These standards add countless improvements. This chapter highlights best practices for using them effectively.</p><h2 id=brevity--safety><a name=c10-1></a>Brevity & Safety</h2><h3 id=suggestion-1011-use-auto-judiciously><a name=a10-1-1></a>Suggestion 10.1.1 Use auto judiciously</h3><ul><li>Eliminates long type names, guarantees initialization.</li><li>Deduction rules are subtle—understand them.</li><li>Prefer explicit types if clarity improves. Use <code>auto</code> only for local variables.</li></ul><p>Examples:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>auto</span> <span class=n>iter</span> <span class=o>=</span> <span class=n>m</span><span class=p>.</span><span class=n>find</span><span class=p>(</span><span class=n>val</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>p</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Foo</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>x</span><span class=p>;</span>    <span class=c1>// uninitialized
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>auto</span> <span class=n>x</span><span class=p>;</span>   <span class=c1>// compile-time error—uninitialized
</span></span></span></code></pre></div><p>Beware deduced types:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span> <span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>s1</span> <span class=o>=</span> <span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>   <span class=c1>// std::string, makes a copy
</span></span></span></code></pre></div><h3 id=rule-1011-override-virtual-functions-with-override-or-final><a name=r10-1-1></a>Rule 10.1.1 Override virtual functions with override or final</h3><p>They ensure correctness: the compiler rejects overrides whose signatures do not match the base declaration.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>Foo</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Derived</span> <span class=o>:</span> <span class=k>public</span> <span class=n>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>Foo</span><span class=p>()</span> <span class=k>override</span><span class=p>;</span>  <span class=c1>// OK
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>void</span> <span class=nf>Foo</span><span class=p>()</span> <span class=k>const</span> <span class=k>override</span><span class=p>;</span> <span class=c1>// Error: signature differs
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span></code></pre></div><h3 id=rule-1012-delete-functions-with-the-delete-keyword><a name=r10-1-2></a>Rule 10.1.2 Delete functions with the delete keyword</h3><p>Clearer and broader than making members private and undefined.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>Foo</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>=</span><span class=p>(</span><span class=k>const</span> <span class=n>Foo</span><span class=o>&amp;</span><span class=p>)</span> <span class=o>=</span> <span class=k>delete</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=rule-1013-prefer-nullptr-to-null-or-0><a name=r10-1-3></a>Rule 10.1.3 Prefer nullptr to NULL or 0</h3><p><code>nullptr</code> has its own type (<code>std::nullptr_t</code>) and unambiguous behaviour; 0/NULL cannot.
Or, when a null pointer is required, directly using <code>0</code> can introduce another problem: the code becomes unclear—especially when <code>auto</code> is used:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>auto</span> <span class=n>result</span> <span class=o>=</span> <span class=n>Find</span><span class=p>(</span><span class=n>id</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>result</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// Does Find() return a pointer or an integer?
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// do something
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p>Literally, <code>0</code> is of type <code>int</code> (<code>0L</code> is <code>long</code>), so neither <code>NULL</code> nor <code>0</code> is of a pointer type.<br>When a function is overloaded for both pointer and integer types, passing <code>NULL</code> or <code>0</code> will invoke the integer overload:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>void</span> <span class=nf>F</span><span class=p>(</span><span class=kt>int</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>F</span><span class=p>(</span><span class=kt>int</span><span class=o>*</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>F</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>      <span class=c1>// Calls F(int), not F(int*)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>F</span><span class=p>(</span><span class=nb>NULL</span><span class=p>);</span>   <span class=c1>// Calls F(int), not F(int*)
</span></span></span></code></pre></div><p>Moreover, <code>sizeof(NULL) == sizeof(void*)</code> is not necessarily true, which is another potential pitfall.</p><p>Summary: directly using <code>0</code> or <code>0L</code> makes the code unclear and type-unsafe; using <code>NULL</code> is no better than <code>0</code> because it is also type-unsafe. All of them involve potential risks.</p><p>The advantage of <code>nullptr</code> is not just being a literal representation of the null pointer that clarifies the code, but also that it is definitively not an integer type.</p><p><code>nullptr</code> is of type <code>std::nullptr_t</code>, and <code>std::nullptr_t</code> can be implicitly converted to any raw pointer type, so <code>nullptr</code> can act as the null pointer for any type.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>void</span> <span class=nf>F</span><span class=p>(</span><span class=kt>int</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>F</span><span class=p>(</span><span class=kt>int</span><span class=o>*</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>F</span><span class=p>(</span><span class=k>nullptr</span><span class=p>);</span>   <span class=c1>// Calls F(int*)
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>result</span> <span class=o>=</span> <span class=n>Find</span><span class=p>(</span><span class=n>id</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>result</span> <span class=o>==</span> <span class=k>nullptr</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// Find() returns a pointer
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// do something
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h3 id=rule-1014-prefer-using-over-typedef><a name=r10-1-4></a>Rule 10.1.4: Prefer <code>using</code> over <code>typedef</code></h3><p>Prior to C++11, you could define type aliases with <code>typedef</code>; nobody wants to repeatedly type <code>std::map&lt;uint32_t, std::vector&lt;int>></code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>typedef</span> <span class=n>std</span><span class=o>::</span><span class=n>map</span><span class=o>&lt;</span><span class=kt>uint32_t</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;</span> <span class=n>SomeType</span><span class=p>;</span>
</span></span></code></pre></div><p>An alias is essentially an encapsulation of the real type. This encapsulation makes code clearer and prevents shotgun surgery when the underlying type changes.</p><p>Since C++11, <code>using</code> provides alias declarations:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>using</span> <span class=n>SomeType</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>map</span><span class=o>&lt;</span><span class=kt>uint32_t</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&gt;</span><span class=p>;</span>
</span></span></code></pre></div><p>Compare their syntaxes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>typedef</span> <span class=n>Type</span> <span class=n>Alias</span><span class=p>;</span>   <span class=c1>// Is Type first or Alias first?
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>using</span> <span class=n>Alias</span> <span class=o>=</span> <span class=n>Type</span><span class=p>;</span>   <span class=c1>// Reads like assignment—intuitive and error-proof
</span></span></span></code></pre></div><p>If that alone isn’t enough to adopt <code>using</code>, look at alias templates:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Alias template definition—one line
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span><span class=o>&lt;</span><span class=k>class</span> <span class=nc>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>MyAllocatorVector</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>MyAllocator</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>MyAllocatorVector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>data</span><span class=p>;</span>       <span class=c1>// Using the alias
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>class</span> <span class=nc>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MyClass</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>MyAllocatorVector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>data_</span><span class=p>;</span>   <span class=c1>// Alias usable inside a template
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span></code></pre></div><p><code>typedef</code> does not support template parameters in aliases; workarounds are required:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Need to wrap typedef in a template struct
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span><span class=o>&lt;</span><span class=k>class</span> <span class=nc>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>MyAllocatorVector</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>typedef</span> <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>MyAllocator</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&gt;</span> <span class=n>type</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>MyAllocatorVector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;::</span><span class=n>type</span> <span class=n>data</span><span class=p>;</span>  <span class=c1>// Using typedef—must append ::type
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>class</span> <span class=nc>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MyClass</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>typename</span> <span class=n>MyAllocatorVector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;::</span><span class=n>type</span> <span class=n>data_</span><span class=p>;</span>  <span class=c1>// Need typename too
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span></code></pre></div><h3 id=rule-1015-do-not-apply-stdmove-to-const-objects><a name=r10-1-5></a>Rule 10.1.5: Do not apply <code>std::move</code> to const objects</h3><p>Semantically, <code>std::move</code> is about <em>moving</em> an object. A const object cannot be modified and is therefore immovable, so applying <code>std::move</code> confuses readers.</p><p>Functionally, <code>std::move</code> yields an rvalue reference; for const objects this becomes <code>const&&</code>. Very few types provide move constructors or move-assignment operators taking <code>const&&</code>, so the operation usually degrades to a copy, harming performance.</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>g_string</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span> <span class=n>g_stringList</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>func</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>myString</span> <span class=o>=</span> <span class=s>&#34;String content&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>g_string</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>myString</span><span class=p>);</span> <span class=c1>// Bad: copies, does not move
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>anotherString</span> <span class=o>=</span> <span class=s>&#34;Another string content&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>g_stringList</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>anotherString</span><span class=p>));</span> <span class=c1>// Bad: also copies
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><hr><h2 id=smart-pointers><a name=c10-2></a>Smart Pointers</h2><h3 id=rule-1021-prefer-raw-pointers-for-singletons-data-members-etc-whose-ownership-is-never-shared><a name=r10-2-1></a>Rule 10.2.1: Prefer raw pointers for singletons, data members, etc., whose ownership is never shared</h3><p><strong>Rationale</strong><br>Smart pointers prevent leaks by automatically releasing resources but add overhead—code bloat, extra construction/destruction cost, increased memory footprint, etc.</p><p>For objects whose ownership is never transferred (singletons, data members), simply deleting them in the destructor is sufficient; avoid the extra smart-pointer overhead.</p><p><strong>Example</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Foo</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Base</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Base</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=o>~</span><span class=n>Base</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>delete</span> <span class=n>foo_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Foo</span><span class=o>*</span> <span class=n>foo_</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p><strong>Exceptions</strong></p><ol><li>When returning newly created objects that need custom deleters, smart pointers are acceptable.</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>User</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Foo</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>User</span><span class=p>,</span> <span class=kt>void</span><span class=p>(</span><span class=n>User</span> <span class=o>*</span><span class=p>)</span><span class=o>&gt;</span> <span class=n>CreateUniqueUser</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>sptr</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span> <span class=n>ipcUser</span> <span class=o>=</span> <span class=n>iface_cast</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=p>(</span><span class=n>remoter</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>User</span><span class=p>,</span> <span class=kt>void</span><span class=p>(</span><span class=n>User</span> <span class=o>*</span><span class=p>)</span><span class=o>&gt;</span><span class=p>(</span><span class=o>::</span><span class=k>new</span> <span class=n>User</span><span class=p>(</span><span class=n>ipcUser</span><span class=p>),</span> <span class=p>[](</span><span class=n>User</span> <span class=o>*</span><span class=n>user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>user</span><span class=o>-&gt;</span><span class=n>Close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=o>::</span><span class=k>delete</span> <span class=n>user</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span> <span class=n>CreateSharedUser</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>sptr</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span> <span class=n>ipcUser</span> <span class=o>=</span> <span class=n>iface_cast</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=p>(</span><span class=n>remoter</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=p>(</span><span class=n>ipcUser</span><span class=p>.</span><span class=n>GetRefPtr</span><span class=p>(),</span> <span class=p>[</span><span class=n>ipcUser</span><span class=p>](</span><span class=n>User</span> <span class=o>*</span><span class=n>user</span><span class=p>)</span> <span class=k>mutable</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>ipcUser</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><ol start=2><li>Use <code>shared_ptr</code> when returning a newly created object that can have multiple owners.</li></ol><h3 id=rule-1022-use-stdmake_unique-not-new-to-create-a-unique_ptr><a name=r10-2-2></a>Rule 10.2.2: Use <code>std::make_unique</code>, not <code>new</code>, to create a <code>unique_ptr</code></h3><p><strong>Rationale</strong></p><ol><li><code>make_unique</code> is more concise.</li><li>It provides exception safety in complex expressions.</li></ol><p><strong>Example</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Bad: type appears twice—possible inconsistency
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>MyClass</span><span class=o>&gt;</span> <span class=n>ptr</span><span class=p>(</span><span class=k>new</span> <span class=n>MyClass</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=c1>// Good: type appears only once
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>auto</span> <span class=n>ptr</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>MyClass</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span></code></pre></div><p>Repetition can cause subtle bugs:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Compiles, but mismatched new[] and delete
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=kt>uint8_t</span><span class=o>&gt;</span> <span class=n>ptr</span><span class=p>(</span><span class=k>new</span> <span class=kt>uint8_t</span><span class=p>[</span><span class=mi>10</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=kt>uint8_t</span><span class=p>[]</span><span class=o>&gt;</span> <span class=n>ptr</span><span class=p>(</span><span class=k>new</span> <span class=kt>uint8_t</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Not exception-safe: evaluation order may be
</span></span></span><span class=line><span class=cl><span class=c1>// 1. allocate Foo
</span></span></span><span class=line><span class=cl><span class=c1>// 2. construct Foo
</span></span></span><span class=line><span class=cl><span class=c1>// 3. call Bar
</span></span></span><span class=line><span class=cl><span class=c1>// 4. construct unique_ptr&lt;Foo&gt;
</span></span></span><span class=line><span class=cl><span class=c1>// If Bar throws, Foo leaks.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>F</span><span class=p>(</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Foo</span><span class=o>&gt;</span><span class=p>(</span><span class=k>new</span> <span class=n>Foo</span><span class=p>()),</span> <span class=n>Bar</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Exception-safe: no interleaving
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>F</span><span class=p>(</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Foo</span><span class=o>&gt;</span><span class=p>(),</span> <span class=n>Bar</span><span class=p>());</span>
</span></span></code></pre></div><p><strong>Exception</strong><br><code>std::make_unique</code> does not support custom deleters.<br>Fall back to <code>new</code> only when a custom deleter is required.</p><h3 id=rule-1024-use-stdmake_shared-not-new-to-create-a-shared_ptr><a name=r10-2-4></a>Rule 10.2.4: Use <code>std::make_shared</code>, not <code>new</code>, to create a <code>shared_ptr</code></h3><p><strong>Rationale</strong><br>Besides the same consistency benefits as <code>make_unique</code>, <code>make_shared</code> offers performance gains.<br>A <code>shared_ptr</code> manages two entities:</p><ul><li>Control block (ref-count, deleter, etc.)</li><li>The owned object</li></ul><p><code>make_shared</code> allocates <em>one</em> heap block for both, whereas<br><code>std::shared_ptr&lt;MyClass>(new MyClass)</code> performs two allocations: one for <code>MyClass</code> and one for the control block, adding overhead.</p><p><strong>Exception</strong><br>Like <code>make_unique</code>, <code>make_shared</code> cannot accept a custom deleter.</p><hr><h2 id=lambda-expressions><a name=c10-3></a>Lambda Expressions</h2><h3 id=advice-1031-prefer-lambda-expressions-when-a-function-cannot-express-what-you-need-capture-locals-local-function><a name=a10-3-1></a>Advice 10.3.1: Prefer lambda expressions when a function cannot express what you need (capture locals, local function)</h3><p><strong>Rationale</strong><br>Functions cannot capture locals nor be declared in local scope. When you need such features, use lambda rather than hand-written functors.<br>Conversely, lambdas and functors can’t be overloaded; overloadable cases favor functions.<br>When both lambdas and functions work, prefer functions—always reach for the simplest tool.</p><p><strong>Example</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Overloads for int and string—natural to choose
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>F</span><span class=p>(</span><span class=kt>int</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>F</span><span class=p>(</span><span class=k>const</span> <span class=n>string</span><span class=o>&amp;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Needed: capture locals or appear inline
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>vector</span><span class=o>&lt;</span><span class=n>Work</span><span class=o>&gt;</span> <span class=n>v</span> <span class=o>=</span> <span class=n>LotsOfWork</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>taskNum</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>taskNum</span> <span class=o>&lt;</span> <span class=n>max</span><span class=p>;</span> <span class=o>++</span><span class=n>taskNum</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>pool</span><span class=p>.</span><span class=n>Run</span><span class=p>([</span><span class=o>=</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v</span><span class=p>]</span> <span class=p>{...});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>pool</span><span class=p>.</span><span class=n>Join</span><span class=p>();</span>
</span></span></code></pre></div><h3 id=rule-1031-return-or-store-lambdas-outside-local-scope-only-by-value-capture-never-by-reference><a name=r10-3-2></a>Rule 10.3.1: Return or store lambdas outside local scope only by value capture; never by reference</h3><p><strong>Rationale</strong><br>A non-local lambda (returned, stored on heap, passed to another thread) must not hold dangling references; avoid capture by reference.</p><p><strong>Example</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Bad
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>Foo</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>local</span> <span class=o>=</span> <span class=mi>42</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Capture by reference; `local` dangles after return
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>threadPool</span><span class=p>.</span><span class=n>QueueWork</span><span class=p>([</span><span class=o>&amp;</span><span class=p>]{</span> <span class=n>Process</span><span class=p>(</span><span class=n>local</span><span class=p>);</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Good
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>Foo</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>local</span> <span class=o>=</span> <span class=mi>42</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Capture by value
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>threadPool</span><span class=p>.</span><span class=n>QueueWork</span><span class=p>([</span><span class=o>=</span><span class=p>]{</span> <span class=n>Process</span><span class=p>(</span><span class=n>local</span><span class=p>);</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=advice-1032-if-you-capture-this-write-all-other-captures-explicitly><a name=a10-3-2></a>Advice 10.3.2: If you capture <code>this</code>, write all other captures explicitly</h3><p><strong>Rationale</strong><br>Inside a member function <code>[=]</code> <em>looks</em> like capture-by-copy, but it implicitly captures <code>this</code> by copy, yielding handles to every data member (i.e., <strong>reference</strong> semantics in disguise). When you really want that, write it explicitly.</p><p><strong>Example</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>MyClass</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=n>Foo</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>auto</span> <span class=n>Lambda</span> <span class=o>=</span> <span class=p>[</span><span class=o>=</span><span class=p>]()</span> <span class=p>{</span> <span class=n>Use</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>data_</span><span class=p>);</span> <span class=p>};</span>   <span class=c1>// Bad: not a true copy of data_
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=n>data_</span> <span class=o>=</span> <span class=mi>42</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Lambda</span><span class=p>();</span>  <span class=c1>// Uses 42
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>data_</span> <span class=o>=</span> <span class=mi>43</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Lambda</span><span class=p>();</span>  <span class=c1>// Uses 43; shows reference semantics
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=k>auto</span> <span class=n>Lambda2</span> <span class=o>=</span> <span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=k>this</span><span class=p>]()</span> <span class=p>{</span> <span class=n>Use</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>data_</span><span class=p>);</span> <span class=p>};</span>   <span class=c1>// Good: explicit, no surprises
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>data_</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h3 id=advice-1033-avoid-default-capture-modes><a name=a10-3-3></a>Advice 10.3.3: Avoid default capture modes</h3><p><strong>Rationale</strong><br>Lambdas support default-by-reference (<code>&</code>) and default-by-value (<code>=</code>).<br>Default-by-reference silently binds every local variable; easy to create dangling refs.</p><p>Default-by-value implicitly captures <code>this</code> and hides which variables are actually used; readers may mistakenly believe static variables are copied too.</p><p>Therefore always list the captures explicitly.</p><p><strong>Bad</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>auto</span> <span class=nf>func</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>addend</span> <span class=o>=</span> <span class=mi>5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=kt>int</span> <span class=n>baseValue</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=o>=</span><span class=p>]()</span> <span class=p>{</span>           <span class=c1>// only copies addend
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>++</span><span class=n>baseValue</span><span class=p>;</span>         <span class=c1>// modifies global
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=n>baseValue</span> <span class=o>+</span> <span class=n>addend</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>auto</span> <span class=nf>func</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>addend</span> <span class=o>=</span> <span class=mi>5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=kt>int</span> <span class=n>baseValue</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=n>addend</span><span class=p>,</span> <span class=n>baseValue</span> <span class=o>=</span> <span class=n>baseValue</span><span class=p>]()</span> <span class=k>mutable</span> <span class=p>{</span>   <span class=c1>// C++14 capture-init
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>++</span><span class=n>baseValue</span><span class=p>;</span>        <span class=c1>// modifies local copy
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=n>baseValue</span> <span class=o>+</span> <span class=n>addend</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Reference: <em>Effective Modern C++</em>, Item 31: Avoid default capture modes.</p><hr><h2 id=interfaces><a name=c10-4></a>Interfaces</h2><h3 id=advice-1041-in-interfaces-not-concerned-with-ownership-pass-t-or-t-not-smart-pointers><a name=a10-4-1></a>Advice 10.4.1: In interfaces not concerned with ownership, pass <code>T*</code> or <code>T&</code>, not smart pointers</h3><p><strong>Rationale</strong></p><ol><li>Smart pointers transfer or share ownership only when needed.</li><li>Requiring smart pointers forces callers to use them (e.g., impossible to pass <code>this</code>).</li><li>Passing shared-ownership smart pointers incurs runtime overhead.</li></ol><p><strong>Example</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Accepts any int*
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>F</span><span class=p>(</span><span class=kt>int</span><span class=o>*</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Accepts only when ownership is to be transferred
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>G</span><span class=p>(</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Accepts only when ownership is to be shared
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>G</span><span class=p>(</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Ownership unchanged, but caller must hold a unique_ptr
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>H</span><span class=p>(</span><span class=k>const</span> <span class=n>unique_ptr</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;&amp;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Accepts any int
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>H</span><span class=p>(</span><span class=kt>int</span><span class=o>&amp;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Bad
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>F</span><span class=p>(</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=n>Widget</span><span class=o>&gt;&amp;</span> <span class=n>w</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Use</span><span class=p>(</span><span class=o>*</span><span class=n>w</span><span class=p>);</span> <span class=c1>// lifetime not relevant
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-a9284f6fd72fa5034776c7b98a6b84ea>linux</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> _index</li></ul></div><div class=td-content><h1 id=pg-1d923d50335234cf99ddbb9a6fc7c721>linux tour</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><p><input disabled type=checkbox> linux tour</p></li><li><p>[<a href=%E5%86%85%E6%A0%B8%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91 title=内核模块开发>内核模块开发</a>]</p></li><li><p>[<a href=linux%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E7%BC%A9%E5%86%99 title=linux源码中的一些缩写>linux源码中的一些缩写</a>]</p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-b2a9b4dd4fed13596e54bf7b1ac65d82>Troubleshooting</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div></div><div class=td-content style=page-break-before:always><h1 id=pg-89cbb2dd0a0a96dbbd79a9ac9a894761>windows</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div></div><div class=td-content><h1 id=pg-e026196632c59be506a0151d656504b5>Windows SSH Remote Login</h1><div class="td-byline mb-4"><time datetime=2025-05-26 class=text-body-secondary>Monday, May 26, 2025</time></div><p>Enabling SSH remote access on Windows typically requires Windows&rsquo; built-in OpenSSH feature. Below are step-by-step instructions:</p><h2 id=check-and-install-openssh>Check and Install OpenSSH</h2><ol><li><p><strong>Check whether OpenSSH is already installed</strong>:</p><ul><li>Open <strong>Settings</strong> > <strong>Apps</strong> > <strong>Apps & features</strong> > <strong>Manage optional features</strong>.</li><li>Look for <strong>OpenSSH Server</strong> in the list. If found, it is already installed.</li></ul></li><li><p><strong>Install OpenSSH</strong>:</p><ul><li>If <strong>OpenSSH Server</strong> is not listed, click <strong>Add a feature</strong>, locate <strong>OpenSSH Server</strong> in the list, click it, then click <strong>Install</strong>.</li></ul></li></ol><h2 id=start-and-configure-the-openssh-service>Start and Configure the OpenSSH Service</h2><ol><li><p><strong>Start the OpenSSH service</strong>:</p><ul><li>After installation, open <strong>Command Prompt</strong> (run as administrator).</li><li>Type <code>net start sshd</code> to start the OpenSSH service. To make it start automatically at boot, run <code>sc config sshd start= auto</code>.</li></ul></li><li><p><strong>Configure the firewall</strong>:</p><ul><li>Ensure the Windows firewall allows SSH connections. Go to <strong>Control Panel</strong> > <strong>System and Security</strong> > <strong>Windows Defender Firewall</strong> > <strong>Advanced settings</strong>, create an inbound rule to allow connections on TCP port 22.</li></ul></li></ol><h2 id=get-the-ip-address-and-test-the-connection>Get the IP Address and Test the Connection</h2><ol><li><p><strong>Get the IP address</strong>:</p><ul><li>To connect from another machine, you’ll need the IP address of the Windows PC where SSH was enabled. Run <code>ipconfig</code> at the command prompt to find it.</li></ul></li><li><p><strong>Connection test</strong>:</p><ul><li>Use an SSH client (e.g., PuTTY, Termius) from another computer or device to connect, using the format <code>ssh username@your_ip_address</code>, where <code>username</code> is the Windows account name and <code>your_ip_address</code> is the address you just obtained.</li></ul></li></ol><h2 id=modify-configuration>Modify Configuration</h2><p>Avoid logging in with passwords—this is a <strong>must-avoid trap</strong>. Always use public keys to log in.<br>We need to disable password login and enable public-key login by adjusting the configuration.</p><p>Because the file is protected, editing it requires special privileges, and its folder and file permissions must be set to specific values. Using a script is strongly recommended.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Check for admin rights</span>
</span></span><span class=line><span class=cl><span class=nv>$elevated</span> <span class=p>=</span> <span class=p>[</span><span class=no>bool</span><span class=p>]([</span><span class=no>System.Security.Principal.WindowsPrincipal</span><span class=p>]::</span><span class=n>new</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=no>System.Security.Principal.WindowsIdentity</span><span class=p>]::</span><span class=n>GetCurrent</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>).</span><span class=n>IsInRole</span><span class=p>([</span><span class=no>System.Security.Principal.WindowsBuiltInRole</span><span class=p>]::</span><span class=n>Administrator</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=nv>$elevated</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Error</span> <span class=s2>&#34;Please run this script with administrator rights&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>exit</span> <span class=mf>1</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 1. Check and install the OpenSSH server if necessary</span>
</span></span><span class=line><span class=cl><span class=nb>Write-Host</span> <span class=s2>&#34;Checking OpenSSH server installation status...&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$capability</span> <span class=p>=</span> <span class=nb>Get-WindowsCapability</span> <span class=n>-Online</span> <span class=n>-Name</span> <span class=n>OpenSSH</span><span class=p>.</span><span class=n>Server</span><span class=p>~~~~</span><span class=mf>0.0</span><span class=p>.</span><span class=py>1</span><span class=p>.</span><span class=py>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$capability</span><span class=p>.</span><span class=py>State</span> <span class=o>-ne</span> <span class=s1>&#39;Installed&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Host</span> <span class=s2>&#34;Installing OpenSSH server...&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>Add-WindowsCapability</span> <span class=n>-Online</span> <span class=n>-Name</span> <span class=n>OpenSSH</span><span class=p>.</span><span class=n>Server</span><span class=p>~~~~</span><span class=mf>0.0</span><span class=p>.</span><span class=py>1</span><span class=p>.</span><span class=py>0</span> <span class=p>|</span> <span class=nb>Out-Null</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 2. Start and set the OpenSSH service to auto-start</span>
</span></span><span class=line><span class=cl><span class=nb>Write-Host</span> <span class=s2>&#34;Configuring SSH service...&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$service</span> <span class=p>=</span> <span class=nb>Get-Service</span> <span class=n>sshd</span> <span class=n>-ErrorAction</span> <span class=n>SilentlyContinue</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=nv>$service</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Error</span> <span class=s2>&#34;OpenSSH service failed to install&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>exit</span> <span class=mf>1</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$service</span><span class=p>.</span><span class=py>Status</span> <span class=o>-ne</span> <span class=s1>&#39;Running&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Start-Service</span> <span class=n>sshd</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nb>Set-Service</span> <span class=n>sshd</span> <span class=n>-StartupType</span> <span class=n>Automatic</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 3. Edit the configuration file</span>
</span></span><span class=line><span class=cl><span class=nv>$configPath</span> <span class=p>=</span> <span class=s2>&#34;C:\ProgramData\ssh\sshd_config&#34;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=nv>$configPath</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Host</span> <span class=s2>&#34;Backing up original configuration file...&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>Copy-Item</span> <span class=nv>$configPath</span> <span class=s2>&#34;</span><span class=nv>$configPath</span><span class=s2>.bak&#34;</span> <span class=n>-Force</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Error</span> <span class=s2>&#34;Configuration file not found: </span><span class=nv>$configPath</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>exit</span> <span class=mf>1</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Write-Host</span> <span class=s2>&#34;Modifying SSH configuration...&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$config</span> <span class=p>=</span> <span class=nb>Get-Content</span> <span class=n>-Path</span> <span class=nv>$configPath</span> <span class=n>-Raw</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Enable pubkey authentication and disable password login</span>
</span></span><span class=line><span class=cl><span class=nv>$config</span> <span class=p>=</span> <span class=nv>$config</span> <span class=o>-replace</span> <span class=s1>&#39;^#?PubkeyAuthentication .*$&#39;</span><span class=p>,</span><span class=s1>&#39;PubkeyAuthentication yes&#39;</span> <span class=p>`</span>
</span></span><span class=line><span class=cl>                  <span class=o>-replace</span> <span class=s1>&#39;^#?PasswordAuthentication .*$&#39;</span><span class=p>,</span><span class=s1>&#39;PasswordAuthentication no&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Ensure necessary configs are present</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$config</span> <span class=o>-notmatch</span> <span class=s1>&#39;PubkeyAuthentication&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$config</span> <span class=p>+=</span> <span class=s2>&#34;</span><span class=se>`n</span><span class=s2>PubkeyAuthentication yes&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$config</span> <span class=o>-notmatch</span> <span class=s1>&#39;PasswordAuthentication&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$config</span> <span class=p>+=</span> <span class=s2>&#34;</span><span class=se>`n</span><span class=s2>PasswordAuthentication no&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Write the new configuration</span>
</span></span><span class=line><span class=cl><span class=nv>$config</span> <span class=p>|</span> <span class=nb>Set-Content</span> <span class=n>-Path</span> <span class=nv>$configPath</span> <span class=n>-Encoding</span> <span class=n>UTF8</span>
</span></span></code></pre></div><h2 id=confirm-authorized_keys-permissions>Confirm authorized_keys Permissions</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># normal user</span>
</span></span><span class=line><span class=cl><span class=nv>$authKeys</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>$env:USERPROFILE</span><span class=s2>\.ssh\authorized_keys&#34;</span>
</span></span><span class=line><span class=cl><span class=n>icacls</span> <span class=nv>$authKeys</span> <span class=p>/</span><span class=n>inheritance</span><span class=err>:</span><span class=nb>r </span><span class=p>/</span><span class=n>grant</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$env:USERNAME</span><span class=p>)</span><span class=s2>:F&#34;</span> <span class=p>/</span><span class=n>grant</span> <span class=s2>&#34;SYSTEM:F&#34;</span>
</span></span><span class=line><span class=cl><span class=n>icacls</span> <span class=s2>&#34;</span><span class=nv>$env:USERPROFILE</span><span class=s2>\.ssh&#34;</span> <span class=p>/</span><span class=n>inheritance</span><span class=err>:</span><span class=nb>r </span><span class=p>/</span><span class=n>grant</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$env:USERNAME</span><span class=p>)</span><span class=s2>:F&#34;</span> <span class=p>/</span><span class=n>grant</span> <span class=s2>&#34;SYSTEM:F&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># administrator</span>
</span></span><span class=line><span class=cl><span class=nv>$adminAuth</span> <span class=p>=</span> <span class=s2>&#34;C:\ProgramData\ssh\administrators_authorized_keys&#34;</span>
</span></span><span class=line><span class=cl><span class=n>icacls</span> <span class=nv>$adminAuth</span> <span class=p>/</span><span class=n>inheritance</span><span class=err>:</span><span class=nb>r </span><span class=p>/</span><span class=n>grant</span> <span class=s2>&#34;Administrators:F&#34;</span> <span class=p>/</span><span class=n>grant</span> <span class=s2>&#34;SYSTEM:F&#34;</span>
</span></span></code></pre></div><h2 id=set-firewall-rules>Set Firewall Rules</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Allow SSH port</span>
</span></span><span class=line><span class=cl><span class=nb>New-NetFirewallRule</span> <span class=n>-DisplayName</span> <span class=s2>&#34;OpenSSH Server (sshd)&#34;</span> <span class=n>-Direction</span> <span class=n>Inbound</span> <span class=n>-Protocol</span> <span class=n>TCP</span> <span class=n>-Action</span> <span class=n>Allow</span> <span class=n>-LocalPort</span> <span class=mf>22</span>
</span></span></code></pre></div><h2 id=add-public-keys>Add Public Keys</h2><h3 id=normal-user>Normal User</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># normal user</span>
</span></span><span class=line><span class=cl><span class=nv>$userProfile</span> <span class=p>=</span> <span class=nv>$env:USERPROFILE</span>
</span></span><span class=line><span class=cl><span class=nv>$sshDir</span> <span class=p>=</span> <span class=nb>Join-Path</span> <span class=nv>$userProfile</span> <span class=s2>&#34;.ssh&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$authorizedKeysPath</span> <span class=p>=</span> <span class=nb>Join-Path</span> <span class=nv>$sshDir</span> <span class=s2>&#34;authorized_keys&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$PublicKeyPath</span> <span class=p>=</span> <span class=s2>&#34;D:\public_keys\id_rsa.pub&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Create .ssh directory</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=nv>$sshDir</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>New-Item</span> <span class=n>-ItemType</span> <span class=n>Directory</span> <span class=n>-Path</span> <span class=nv>$sshDir</span> <span class=p>|</span> <span class=nb>Out-Null</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Set .ssh directory permissions</span>
</span></span><span class=line><span class=cl><span class=nv>$currentUser</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>$env:USERDOMAIN</span><span class=s2>\</span><span class=nv>$env:USERNAME</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$acl</span> <span class=p>=</span> <span class=nb>Get-Acl</span> <span class=nv>$sshDir</span>
</span></span><span class=line><span class=cl><span class=nv>$rule</span> <span class=p>=</span> <span class=nb>New-Object</span> <span class=n>System</span><span class=p>.</span><span class=py>Security</span><span class=p>.</span><span class=py>AccessControl</span><span class=p>.</span><span class=py>FileSystemAccessRule</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nv>$currentUser</span><span class=p>,</span> <span class=s2>&#34;FullControl&#34;</span><span class=p>,</span> <span class=s2>&#34;ContainerInherit,ObjectInherit&#34;</span><span class=p>,</span> <span class=s2>&#34;None&#34;</span><span class=p>,</span> <span class=s2>&#34;Allow&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nv>$acl</span><span class=p>.</span><span class=py>AddAccessRule</span><span class=p>(</span><span class=nv>$rule</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>Set-Acl</span> <span class=nv>$sshDir</span> <span class=nv>$acl</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Add public key</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=nv>$PublicKeyPath</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$pubKey</span> <span class=p>=</span> <span class=nb>Get-Content</span> <span class=n>-Path</span> <span class=nv>$PublicKeyPath</span> <span class=n>-Raw</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nv>$pubKey</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c># Ensure newline at end</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=nv>$pubKey</span><span class=p>.</span><span class=py>EndsWith</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>`n</span><span class=s2>&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$pubKey</span> <span class=p>+=</span> <span class=s2>&#34;</span><span class=se>`n</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c># Append key</span>
</span></span><span class=line><span class=cl>        <span class=nb>Add-Content</span> <span class=n>-Path</span> <span class=nv>$authorizedKeysPath</span> <span class=n>-Value</span> <span class=nv>$pubKey</span> <span class=n>-Encoding</span> <span class=n>UTF8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c># Set file permissions</span>
</span></span><span class=line><span class=cl>        <span class=nv>$acl</span> <span class=p>=</span> <span class=nb>Get-Acl</span> <span class=nv>$authorizedKeysPath</span>
</span></span><span class=line><span class=cl>        <span class=nv>$acl</span><span class=p>.</span><span class=py>SetSecurityDescriptorRule</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=nb>New-Object</span> <span class=n>System</span><span class=p>.</span><span class=py>Security</span><span class=p>.</span><span class=py>AccessControl</span><span class=p>.</span><span class=py>FileSystemAccessRule</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=nv>$currentUser</span><span class=p>,</span> <span class=s2>&#34;FullControl&#34;</span><span class=p>,</span> <span class=s2>&#34;None&#34;</span><span class=p>,</span> <span class=s2>&#34;None&#34;</span><span class=p>,</span> <span class=s2>&#34;Allow&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>Set-Acl</span> <span class=nv>$authorizedKeysPath</span> <span class=nv>$acl</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Error</span> <span class=s2>&#34;Public key file not found: </span><span class=nv>$PublicKeyPath</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>exit</span> <span class=mf>1</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Restart SSH service</span>
</span></span><span class=line><span class=cl><span class=nb>Write-Host</span> <span class=s2>&#34;Restarting SSH service...&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>Restart-Service</span> <span class=n>sshd</span>
</span></span></code></pre></div><h3 id=administrator-user>Administrator User</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># administrator</span>
</span></span><span class=line><span class=cl><span class=nv>$adminSshDir</span> <span class=p>=</span> <span class=s2>&#34;C:\ProgramData\ssh&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$adminAuthKeysPath</span> <span class=p>=</span> <span class=nb>Join-Path</span> <span class=nv>$adminSshDir</span> <span class=s2>&#34;administrators_authorized_keys&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$adminPublicKeyPath</span> <span class=p>=</span> <span class=s2>&#34;D:\public_keys\id_rsa.pub&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Create admin SSH directory</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=nv>$adminSshDir</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>New-Item</span> <span class=n>-ItemType</span> <span class=n>Directory</span> <span class=n>-Path</span> <span class=nv>$adminSshDir</span> <span class=p>|</span> <span class=nb>Out-Null</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Set admin SSH directory permissions</span>
</span></span><span class=line><span class=cl><span class=nv>$adminAcl</span> <span class=p>=</span> <span class=nb>Get-Acl</span> <span class=nv>$adminSshDir</span>
</span></span><span class=line><span class=cl><span class=nv>$adminRule</span> <span class=p>=</span> <span class=nb>New-Object</span> <span class=n>System</span><span class=p>.</span><span class=py>Security</span><span class=p>.</span><span class=py>AccessControl</span><span class=p>.</span><span class=py>FileSystemAccessRule</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Administrators&#34;</span><span class=p>,</span> <span class=s2>&#34;FullControl&#34;</span><span class=p>,</span> <span class=s2>&#34;ContainerInherit,ObjectInherit&#34;</span><span class=p>,</span> <span class=s2>&#34;None&#34;</span><span class=p>,</span> <span class=s2>&#34;Allow&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nv>$adminAcl</span><span class=p>.</span><span class=py>AddAccessRule</span><span class=p>(</span><span class=nv>$adminRule</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>Set-Acl</span> <span class=nv>$adminSshDir</span> <span class=nv>$adminAcl</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Add admin public key</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=nv>$adminPublicKeyPath</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$adminPubKey</span> <span class=p>=</span> <span class=nb>Get-Content</span> <span class=n>-Path</span> <span class=nv>$adminPublicKeyPath</span> <span class=n>-Raw</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nv>$adminPubKey</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c># Ensure newline at end</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=nv>$adminPubKey</span><span class=p>.</span><span class=py>EndsWith</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>`n</span><span class=s2>&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$adminPubKey</span> <span class=p>+=</span> <span class=s2>&#34;</span><span class=se>`n</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c># Append key</span>
</span></span><span class=line><span class=cl>        <span class=nb>Add-Content</span> <span class=n>-Path</span> <span class=nv>$adminAuthKeysPath</span> <span class=n>-Value</span> <span class=nv>$adminPubKey</span> <span class=n>-Encoding</span> <span class=n>UTF8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c># Set file permissions</span>
</span></span><span class=line><span class=cl>        <span class=nv>$adminAcl</span> <span class=p>=</span> <span class=nb>Get-Acl</span> <span class=nv>$adminAuthKeysPath</span>
</span></span><span class=line><span class=cl>        <span class=nv>$adminAcl</span><span class=p>.</span><span class=py>SetSecurityDescriptorRule</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=nb>New-Object</span> <span class=n>System</span><span class=p>.</span><span class=py>Security</span><span class=p>.</span><span class=py>AccessControl</span><span class=p>.</span><span class=py>FileSystemAccessRule</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Administrators&#34;</span><span class=p>,</span> <span class=s2>&#34;FullControl&#34;</span><span class=p>,</span> <span class=s2>&#34;None&#34;</span><span class=p>,</span> <span class=s2>&#34;None&#34;</span><span class=p>,</span> <span class=s2>&#34;Allow&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>Set-Acl</span> <span class=nv>$adminAuthKeysPath</span> <span class=nv>$adminAcl</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Error</span> <span class=s2>&#34;Admin public key file not found: </span><span class=nv>$adminPublicKeyPath</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>exit</span> <span class=mf>1</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Restart SSH service</span>
</span></span><span class=line><span class=cl><span class=nb>Write-Host</span> <span class=s2>&#34;Restarting SSH service...&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>Restart-Service</span> <span class=n>sshd</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-195482425345048d2f23cc6e5a3f36fa>Understanding Windows Networking_WFP</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Understanding Windows Networking_WFP</li></ul><h1 id=understanding-windows-networking>Understanding Windows Networking</h1><ul><li><input disabled type=checkbox> Understanding Windows Networking</li></ul><h2 id=wfp>WFP</h2><h3 id=terminology>Terminology</h3><p><a href=https://learn.microsoft.com/en-us/windows/win32/fwp/object-model>https://learn.microsoft.com/en-us/windows/win32/fwp/object-model</a><br><a href=https://learn.microsoft.com/en-us/windows/win32/fwp/basic-operation>https://learn.microsoft.com/en-us/windows/win32/fwp/basic-operation</a><br><a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/network>https://learn.microsoft.com/en-us/windows-hardware/drivers/network</a></p><p><a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/network/callout>callout</a>: A callout provides functionality that extends the capabilities of the Windows Filtering Platform. A callout consists of a set of callout functions and a GUID key that uniquely identifies the callout.<br><a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/network/callout-driver>callout driver</a>: A callout driver is a driver that registers callouts with the Windows Filtering Platform. A callout driver is a type of filter driver.<br><a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/network/callout-function>callout function</a>: A callout function is a function that is called by the Windows Filtering Platform to perform a specific task. A callout function is associated with a callout.<br><a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/network/filter>filter</a>: A filter is a set of functions that are called by the Windows Filtering Platform to perform filtering operations. A filter consists of a set of filter functions and a GUID key that uniquely identifies the filter.<br><a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/network/filter-engine>filter engine</a>: The filter engine is the component of the Windows Filtering Platform that performs filtering operations. The filter engine is responsible for calling the filter functions that are registered with the Windows Filtering Platform.<br><a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/network/filter-layer>filter layer</a>: A filter layer is a set of functions that are called by the Windows Filtering Platform to perform filtering operations. A filter layer consists of a set of filter layer functions and a GUID key that uniquely identifies the filter layer.</p><p>The dispatcher queue triggers callbacks as soon as possible without waiting for the queue to fill, thus satisfying real-time requirements.<br>When the user callback is slow, blocked packets are inserted into the next queue whenever possible, up to a queue limit of 256. Any additional blocked packets are buffered by the system. Rough testing shows a buffer capacity of around 16,500; this system cache size can vary with machine performance and configuration.</p><p>When the user callback processes a packet, there are two packet entities:</p><ul><li><strong>Kernel packet</strong>: Released in bulk after the callback finishes processing the queue. Therefore, when the callback is slow, one callback execution can lock up to 256 system packet buffers.</li><li><strong>Copy in callback</strong>: Released immediately after the individual packet is processed.</li></ul><p>Copying and assembling packets in <code>FwppNetEvent1Callback</code> does not touch the original packets, so business operations remain unaffected.</p><p>Subscribing with template filters can reduce the number of packets that need processing:</p><p><a href=https://learn.microsoft.com/en-us/windows/win32/api/fwpmtypes/ns-fwpmtypes-fwpm_net_event_enum_template0>https://learn.microsoft.com/en-us/windows/win32/api/fwpmtypes/ns-fwpmtypes-fwpm_net_event_enum_template0</a></p><p><strong>filterCondition</strong></p><p>An array of <code>FWPM_FILTER_CONDITION0</code> structures containing distinct filter conditions (duplicate filter conditions will produce an error). All conditions must be true for the action to occur; in other words, the conditions are AND’ed together. If no conditions are provided, the action is always performed.</p><ul><li><strong>Identical filters cannot be used.</strong></li><li><strong>The relationship among all filters is logical AND—all must be satisfied.</strong></li><li>Microsoft documentation lists eight supported filters, but in practice many more are supported.</li></ul><p><strong>FWPM_CONDITION_IP_PROTOCOL</strong><br>The IP protocol number, as specified in RFC 1700.</p><p><strong>FWPM_CONDITION_IP_LOCAL_ADDRESS</strong><br>The local IP address.</p><p><strong>FWPM_CONDITION_IP_REMOTE_ADDRESS</strong><br>The remote IP address.</p><p><strong>FWPM_CONDITION_IP_LOCAL_PORT</strong><br>The local transport protocol port number. For ICMP, this is the message type.</p><p><strong>FWPM_CONDITION_IP_REMOTE_PORT</strong><br>The remote transport protocol port number. For ICMP, this is the message code.</p><p><strong>FWPM_CONDITION_SCOPE_ID</strong><br>The interface IPv6 scope identifier; reserved for internal use.</p><p><strong>FWPM_CONDITION_ALE_APP_ID</strong><br>The full path of the application.</p><p><strong>FWPM_CONDITION_ALE_USER_ID</strong><br>The identification of the local user.</p><p>Enumerating registered subscriptions shows two existing ones. Their <code>sessionKey</code> GUIDs provide no clues about the registering identity. Analysis shows each implements:</p><ul><li>Subscription to all <code>FWPM_NET_EVENT_TYPE_CLASSIFY_DROP</code> packets to collect statistics on dropped packets.</li><li>Subscription to all <code>FWPM_NET_EVENT_TYPE_CLASSIFY_ALLOW</code> packets for traffic accounting.</li></ul><p>Both subscriptions use the condition filter <code>FWPM_CONDITION_NET_EVENT_TYPE</code> (206e9996-490e-40cf-b831-b38641eb6fcb), confirming that more filters can be applied than the eight listed in Microsoft’s documentation.</p><p>Further investigation indicates that the user-mode API can only capture drop events. Non-drop events must be obtained via kernel mode, so a micro-segmentation solution cannot use <code>FWPM_CONDITION_NET_EVENT_TYPE</code> to gather events.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-63cc6d36463add07c363c19e9d6357d2>Understanding Windows Event Tracing (ETW)</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Understanding Windows Event Tracing (ETW)</li></ul><h1 id=understanding-etw>Understanding ETW</h1><p>Some unnecessary information has been filtered out; see the complete documentation at: <a href=https://docs.microsoft.com/en-us/windows/win32/etw/event-tracing-portal>https://docs.microsoft.com/en-us/windows/win32/etw/event-tracing-portal</a></p><h2 id=understanding-the-basics>Understanding the Basics</h2><p><a href=https://learn.microsoft.com/en-us/windows/win32/etw/about-event-tracing>https://learn.microsoft.com/en-us/windows/win32/etw/about-event-tracing</a></p><p><img src=https://learn.microsoft.com/en-us/windows/win32/etw/images/etdiag2.png alt=Architecture></p><h2 id=session>Session</h2><p>There are four kinds of sessions:</p><table><thead><tr><th>Session Type</th><th>Usage</th><th>Limitations</th><th>Characteristics</th></tr></thead><tbody><tr><td><a href=https://learn.microsoft.com/en-us/windows/win32/etw/configuring-and-starting-an-event-tracing-session>Event Tracing Session</a>(Standard ETW)</td><td>1. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/ns-evntrace-event_trace_properties>EVENT_TRACE_PROPERTIES</a><br>2. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-starttracea>StartTrace</a>: create a session<br>3. EnableTrace<br>1. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-enabletrace>EnableTrace</a> for classic providers<br>2. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-enabletraceex>EnableTraceEx</a> for manifest-based providers<br>4. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-controltracea>ControlTrace</a> stop the session</td><td>- A manifest-based provider can deliver events to at most 8 sessions.<br>- A classic provider can only serve one session.<br>- The last session to enable a provider supersedes any earlier sessions.</td><td>Standard ETW.</td></tr><tr><td><a href=https://learn.microsoft.com/en-us/windows/win32/etw/configuring-and-starting-a-systemtraceprovider-session>SystemTraceProvider Session</a></td><td>1. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/ns-evntrace-event_trace_properties>EVENT_TRACE_PROPERTIES</a> → <strong>EnableFlags</strong><br>2. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-starttracea>StartTrace</a><br>3. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-controltracea>ControlTrace</a> to stop the session</td><td>- <strong>SystemTraceProvider</strong> is a kernel-mode provider that supplies a set of <a href=https://learn.microsoft.com/en-us/windows/win32/etw/nt-kernel-logger-constants>predefined kernel events</a>.<br>- The <strong><a href=https://learn.microsoft.com/en-us/windows/win32/etw/configuring-and-starting-the-nt-kernel-logger-session>NT Kernel Logger session</a></strong> is a predefined system session that records a specified set of kernel events.<br>- <strong>Windows 7/Windows Server 2008 R2</strong> only the NT Kernel Logger session may use SystemTraceProvider.<br>- <strong>Windows 8/Windows Server 2012</strong> SystemTraceProvider can feed <strong>8 logger sessions</strong>, two of which are reserved for NT Kernel Logger and Circular Kernel Context Logger.<br>- <strong>Windows 10 20348 and later</strong>, individual System providers can be controlled separately.</td><td>Obtain kernel predefined events.</td></tr><tr><td><a href=https://learn.microsoft.com/en-us/windows/win32/etw/configuring-and-starting-an-autologger-session>AutoLogger Session</a></td><td>1. Edit the registry<br>2. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-enabletraceex>EnableTraceEx</a><br>3. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-controltracea>ControlTrace</a> to stop the session</td><td>- The <strong><a href=https://learn.microsoft.com/en-us/windows/win32/etw/configuring-and-starting-the-global-logger-session>Global Logger Session</a></strong> is a special, standalone session that records events during system boot.<br>- Ordinary AutoLogger sessions must explicitly enable providers; Global Logger does not.<br>- AutoLogger does not support NT Kernel Logger events; only Global Logger does.<br>- Impacts boot time—use sparingly.</td><td>Record OS boot-time events.</td></tr><tr><td><a href=https://learn.microsoft.com/en-us/windows/win32/etw/configuring-and-starting-a-private-logger-session>Private Logger Session</a></td><td>—</td><td>- User-mode ETW<br>- Used only within a process<br>- Not counted toward the 64-session concurrency limit.</td><td>Per-process only.</td></tr></tbody></table><h2 id=tools>Tools</h2><ul><li><a href=https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/logman>logman</a></li><li><a href=https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/wevtutil>wevtutil</a><ul><li>XPath query example: <code>wevtutil qe Security /c:2 /q:"*[System[EventID=5157]]" /f:text</code></li></ul></li><li><a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/devtest/tracelog>tracelog</a><ul><li>To use the Visual Studio <code>tracelog</code> tool, you can dynamically add and remove ETW Providers and ETW Sessions at runtime.</li></ul></li><li><a href=https://learn.microsoft.com/en-us/windows/win32/wes/message-compiler--mc-exe->mc</a></li><li><a href=https://github.com/repnz/etw-providers-docs>etw-providers-docs</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-a3673aba36ec41cb0458b4256f8be612>wireguard configuration</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> wireguard configuration</li></ul><h1 id=wireguard-configuration>wireguard Configuration</h1><h2 id=firewall-configuration>Firewall Configuration</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>wireguard</span> <span class=p>/</span><span class=n>installtunnelservice</span> <span class=p>&lt;</span><span class=n>wg_conf_path</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>wg</span> <span class=n>show</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetConnectionProfile</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetAdapter</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetFirewallProfile</span>
</span></span><span class=line><span class=cl><span class=nb>Set-NetFirewallProfile</span> <span class=n>-Profile</span> <span class=n>domain</span><span class=p>,</span><span class=n>public</span><span class=p>,</span><span class=n>private</span> <span class=n>-DisabledInterfaceAliases</span> <span class=p>&lt;</span><span class=n>wg_config_name</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nb>Set-NetIPInterface</span> <span class=n>-ifindex</span> <span class=p>&lt;</span><span class=n>interface</span> <span class=n>index</span><span class=p>&gt;</span> <span class=n>-Forwarding</span> <span class=n>Enabled</span>
</span></span><span class=line><span class=cl><span class=nb>New-NetFirewallRule</span> <span class=n>-DisplayName</span> <span class=s2>&#34;@wg1&#34;</span> <span class=n>-Direction</span> <span class=n>Inbound</span>  <span class=n>-RemoteAddress</span> <span class=mf>10.66</span><span class=p>.</span><span class=py>66</span><span class=p>.</span><span class=mf>1</span><span class=p>/</span><span class=mf>24</span> <span class=n>-Action</span> <span class=n>Allow</span>
</span></span><span class=line><span class=cl><span class=nb>New-NetFirewallRule</span> <span class=n>-DisplayName</span> <span class=s2>&#34;@wg1&#34;</span> <span class=n>-Direction</span> <span class=n>Outbound</span> <span class=n>-RemoteAddress</span> <span class=mf>10.66</span><span class=p>.</span><span class=py>66</span><span class=p>.</span><span class=mf>1</span><span class=p>/</span><span class=mf>24</span> <span class=n>-Action</span> <span class=n>Allow</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Locate the blocking cause</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=nb>set </span><span class=p>/</span><span class=n>subcategory</span><span class=err>:</span><span class=s2>&#34;{0CCE9225-69AE-11D9-BED3-505054503030}&#34;</span> <span class=p>/</span><span class=n>success</span><span class=err>:</span><span class=n>disable</span> <span class=p>/</span><span class=n>failure</span><span class=err>:</span><span class=n>enable</span>
</span></span><span class=line><span class=cl><span class=n>wevtutil</span> <span class=n>qe</span> <span class=n>Security</span> <span class=p>/</span><span class=n>q:</span><span class=s2>&#34;*[System/EventID=5152]&#34;</span> <span class=p>/</span><span class=n>c:</span><span class=mf>5</span> <span class=p>/</span><span class=n>rd</span><span class=err>:</span><span class=n>true</span> <span class=p>/</span><span class=n>f:text</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=nb>set </span><span class=p>/</span><span class=n>subcategory</span><span class=err>:</span><span class=s2>&#34;{0CCE9225-69AE-11D9-BED3-505054503030}&#34;</span> <span class=p>/</span><span class=n>success</span><span class=err>:</span><span class=n>disable</span> <span class=p>/</span><span class=n>failure</span><span class=err>:</span><span class=n>disable</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-7b6314989d253d9fadbc558b8fb75b3d>Windows Blocking Network Traffic Capture</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Windows Blocking Network Traffic Capture</li></ul><h1 id=windows-blocking-network-traffic-capture>Windows Blocking Network Traffic Capture</h1><ul><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-windows-blocking-network-traffic-capture->Windows Blocking Network Traffic Capture</a><ul><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-setting-up-a-test-project->Setting Up a Test Project</a></li><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-capturing-block-events-via-auditing->Capturing Block Events via Auditing</a><ul><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-obtaining-provider-information->Obtaining Provider Information</a></li><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-triggering-a-block-event->Triggering a Block Event</a></li></ul></li><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-monitoring-network-eventsnet_event->Monitoring Network Events (NET_EVENT)</a></li><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-monitoring-network-connectionsnetconnection->Monitoring Network Connections (NetConnection)</a></li><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-application-layer-enforcementale-introduction->Application Layer Enforcement (ALE) Introduction</a></li><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-coding->Coding</a></li><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-conclusion->Conclusion</a></li><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-appendix->Appendix</a><ul><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-wfp-architecture->WFP Architecture</a></li><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-data-flow->Data Flow</a></li><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-reference-links->Reference Links</a></li></ul></li></ul></li></ul><ul><li>Need to identify blocked traffic, including outbound and inbound.</li><li>Two ways of blocking: by connection or by packet. Packet drops occur frequently and the reason must be audited; connection‐oriented blocks align better with real-world monitoring.</li><li>Many normally processed packets may also be dropped, so we must distinguish drops from actual blocks—we focus on blocks.</li></ul><h2 id=setting-up-a-test-project>Setting Up a Test Project</h2><p>WFP mainly runs in user mode and partly in kernel mode, exposed as drivers. The test setup is complex.<br>Recommended: run a separate physical machine for testing, compile on the dev box, then copy and remotely debug on the test machine.<br>For those with limited resources, local debugging on the same machine is also possible.</p><ul><li><a href=https://github.com/microsoft/Windows-driver-samples>Microsoft WFP Sample Project</a><ul><li>Focus only on: Windows-driver-samples\network\trans\WFPSampler</li></ul></li><li><a href=https://docs.microsoft.com/zh-cn/samples/microsoft/windows-driver-samples/windows-filtering-platform-sample/>WFPSampler Guide</a></li></ul><p>Build Issues:</p><ul><li><a href=https://github.com/microsoft/Windows-driver-samples/pull/538>Missing api-ms-win-net-isolation-l1-1-0</a></li><li><a href=https://stackoverflow.com/questions/44837612/wfpsampler-compilation-issue-wfpcalloutsclassreg-not-found>wfpcalloutsclassreg-not-found</a></li></ul><p>Other Issues:</p><ul><li><a href=https://answers.microsoft.com/en-us/protect/forum/all/your-organization-used-windows-defender/ef12b7be-41f5-4b71-a73c-e4f99ba944f7>Driver Does Not Run</a></li><li><a href=https://stackoverflow.com/questions/84847/how-do-i-create-a-self-signed-certificate-for-code-signing-on-windows>How to Sign</a></li><li><a href=https://docs.microsoft.com/zh-cn/windows-hardware/drivers/develop/preparing-a-computer-for-manual-driver-deployment>Preparing a Target Machine for Manual Driver Deployment</a></li></ul><h2 id=capturing-block-events-via-auditing>Capturing Block Events via Auditing</h2><ul><li><a href=https://docs.microsoft.com/en-us/windows/win32/fwp/auditing-and-logging>Auditing Docs</a></li><li><a href=https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/auditpol>auditpol Docs</a></li></ul><p>By default, auditing for WFP is off.</p><ul><li>Audit can be enabled by category (via Group Policy Object Editor MMC, Local Security Policy MMC, or auditpol.exe).</li><li>Audit can also be enabled by subcategory with auditpol.exe.</li><li>Always use GUIDs—otherwise localized display strings break cross-language systems.</li><li>Audit uses circular logs of 128 KB—low resource impact.</li></ul><p>Categories <a href=https://docs.microsoft.com/en-us/windows/win32/secauthz/auditing-constants>https://docs.microsoft.com/en-us/windows/win32/secauthz/auditing-constants</a></p><table><thead><tr><th>Category/Subcategory</th><th>GUID</th></tr></thead><tbody><tr><td>&mldr;</td><td>&mldr;</td></tr><tr><td><strong>Object Access</strong></td><td>{6997984A-797A-11D9-BED3-505054503030}</td></tr><tr><td><strong>Policy Change</strong></td><td>{6997984D-797A-11D9-BED3-505054503030}</td></tr><tr><td>&mldr;</td><td>&mldr;</td></tr></tbody></table><p><strong>Object Access</strong> subcategories and their GUIDs <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-gpac/77878370-0712-47cd-997d-b07053429f6d>https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-gpac/77878370-0712-47cd-997d-b07053429f6d</a></p><table><thead><tr><th>Object Access Subcategory</th><th>Subcategory GUID</th><th>Inclusion Setting</th></tr></thead><tbody><tr><td>&mldr;</td><td>&mldr;</td><td>&mldr;</td></tr><tr><td><strong>Filtering Platform Packet Drop</strong></td><td>{0CCE9225-69AE-11D9-BED3-505054503030}</td><td>No Auditing</td></tr><tr><td><strong>Filtering Platform Connection</strong></td><td>{0CCE9226-69AE-11D9-BED3-505054503030}</td><td>No Auditing</td></tr><tr><td><strong>Other Object Access Events</strong></td><td>{0CCE9227-69AE-11D9-BED3-505054503030}</td><td>No Auditing</td></tr><tr><td>&mldr;</td><td>&mldr;</td><td>&mldr;</td></tr></tbody></table><p><strong>Policy Change</strong> subcategories and GUIDs:</p><table><thead><tr><th>Policy Change Subcategory</th><th>Subcategory GUID</th></tr></thead><tbody><tr><td><strong>Audit Policy Change</strong></td><td>{0CCE922F-69AE-11D9-BED3-505054503030}</td></tr><tr><td>Authentication Policy Change</td><td>{0CCE9230-69AE-11D9-BED3-505054503030}</td></tr><tr><td>Authorization Policy Change</td><td>{0CCE9231-69AE-11D9-BED3-505054503030}</td></tr><tr><td>MPSSVC Rule-Level Policy Change</td><td>{0CCE9232-69AE-11D9-BED3-505054503030}</td></tr><tr><td><strong>Filtering Platform Policy Change</strong></td><td>{0CCE9233-69AE-11D9-BED3-505054503030}</td></tr><tr><td>Other Policy Change Events</td><td>{0CCE9234-69AE-11D9-BED3-505054503030}</td></tr></tbody></table><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># auditpol reference: https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/auditpol</span>
</span></span><span class=line><span class=cl><span class=c># This section focuses on the &#39;Object Access&#39; category</span>
</span></span><span class=line><span class=cl><span class=c># List available fields</span>
</span></span><span class=line><span class=cl><span class=c># -v shows GUID, -r produces CSV report</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>list</span> <span class=p>/</span><span class=n>category</span> <span class=p>/</span><span class=n>v</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>list</span> <span class=p>/</span><span class=n>subcategory</span><span class=err>:</span><span class=p>*</span> <span class=p>/</span><span class=n>v</span>
</span></span><span class=line><span class=cl><span class=c># Get audit settings for a subcategory</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>get</span> <span class=p>/</span><span class=n>category</span><span class=err>:</span><span class=s1>&#39;Object Access&#39;</span> <span class=p>/</span><span class=nb>r </span><span class=p>|</span> <span class=nb>ConvertFrom-Csv</span> <span class=p>|</span> <span class=nb>Get-Member</span>
</span></span><span class=line><span class=cl><span class=c># Query subcategory GUID</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>get</span> <span class=p>/</span><span class=n>category</span><span class=err>:</span><span class=s1>&#39;Object Access&#39;</span> <span class=p>/</span><span class=nb>r </span><span class=p>|</span> <span class=nb>ConvertFrom-Csv</span> <span class=p>|</span> <span class=nb>Format-Table</span> <span class=n>Subcategory</span><span class=p>,</span><span class=s1>&#39;Subcategory GUID&#39;</span><span class=p>,</span><span class=s1>&#39;Inclusion Setting&#39;</span>
</span></span><span class=line><span class=cl><span class=c># Lookup subcategory</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>list</span> <span class=p>/</span><span class=n>subcategory</span><span class=err>:</span><span class=s2>&#34;Object Access&#34;</span><span class=p>,</span><span class=s2>&#34;Policy Change&#34;</span> <span class=n>-v</span>
</span></span><span class=line><span class=cl><span class=c># Backup</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>backup</span> <span class=p>/</span><span class=n>file</span><span class=err>:</span><span class=n>d:</span><span class=p>\</span><span class=n>audit</span><span class=p>.</span><span class=py>bak</span>
</span></span><span class=line><span class=cl><span class=c># Restore</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>restore</span> <span class=p>/</span><span class=n>file</span><span class=err>:</span><span class=n>d:</span><span class=p>\</span><span class=n>audit</span><span class=p>.</span><span class=py>bak</span>
</span></span><span class=line><span class=cl><span class=c># Modify Policy</span>
</span></span><span class=line><span class=cl><span class=c># **Policy Change**    | {6997984D-797A-11D9-BED3-505054503030}</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=nb>set </span><span class=p>/</span><span class=n>category</span><span class=err>:</span><span class=s2>&#34;{6997984D-797A-11D9-BED3-505054503030}&#34;</span> <span class=p>/</span><span class=n>success</span><span class=err>:</span><span class=n>disable</span> <span class=p>/</span><span class=n>failure</span><span class=err>:</span><span class=n>disable</span>
</span></span><span class=line><span class=cl><span class=c># Filtering Platform Policy Change | {0CCE9233-69AE-11D9-BED3-505054503030}</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=nb>set </span><span class=p>/</span><span class=n>subcategory</span><span class=err>:</span><span class=s2>&#34;{0CCE9233-69AE-11D9-BED3-505054503030}&#34;</span> <span class=p>/</span><span class=n>success</span><span class=err>:</span><span class=n>enable</span> <span class=p>/</span><span class=n>failure</span><span class=err>:</span><span class=n>enable</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># **Object Access**    | {6997984A-797A-11D9-BED3-505054503030}</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>get</span> <span class=p>/</span><span class=n>category</span><span class=err>:</span><span class=s2>&#34;{6997984A-797A-11D9-BED3-505054503030}&#34;</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=nb>set </span><span class=p>/</span><span class=n>category</span><span class=err>:</span><span class=s2>&#34;{6997984A-797A-11D9-BED3-505054503030}&#34;</span> <span class=p>/</span><span class=n>success</span><span class=err>:</span><span class=n>disable</span> <span class=p>/</span><span class=n>failure</span><span class=err>:</span><span class=n>disable</span>
</span></span><span class=line><span class=cl><span class=c># Filtering Platform Packet Drop | {0CCE9225-69AE-11D9-BED3-505054503030}</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=nb>set </span><span class=p>/</span><span class=n>subcategory</span><span class=err>:</span><span class=s2>&#34;{0CCE9225-69AE-11D9-BED3-505054503030}&#34;</span> <span class=p>/</span><span class=n>success</span><span class=err>:</span><span class=n>disable</span> <span class=p>/</span><span class=n>failure</span><span class=err>:</span><span class=n>enable</span>
</span></span><span class=line><span class=cl><span class=c># Filtering Platform Connection  | {0CCE9226-69AE-11D9-BED3-505054503030}</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=nb>set </span><span class=p>/</span><span class=n>subcategory</span><span class=err>:</span><span class=s2>&#34;{0CCE9226-69AE-11D9-BED3-505054503030}&#34;</span> <span class=p>/</span><span class=n>success</span><span class=err>:</span><span class=n>disable</span> <span class=p>/</span><span class=n>failure</span><span class=err>:</span><span class=n>enable</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># Read audit logs</span>
</span></span><span class=line><span class=cl><span class=nv>$Events</span> <span class=p>=</span> <span class=nb>Get-WinEvent</span> <span class=n>-LogName</span> <span class=s1>&#39;Security&#39;</span>
</span></span><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=nv>$event</span> <span class=k>in</span> <span class=nv>$Events</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>ForEach</span> <span class=p>(</span><span class=nv>$line</span> <span class=k>in</span> <span class=vm>$</span><span class=p>(</span><span class=nv>$event</span><span class=p>.</span><span class=py>Message</span> <span class=n>-split</span> <span class=s2>&#34;</span><span class=se>`r`n</span><span class=s2>&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>Write-Host</span> <span class=nv>$event</span><span class=p>.</span><span class=py>RecordId</span> <span class=s1>&#39;:&#39;</span> <span class=nv>$Line</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Event Details:</p><table><thead><tr><th>Event ID</th><th>Explanation</th></tr></thead><tbody><tr><td>5031(F)</td><td>The Windows Firewall Service <strong>blocked</strong> an application from accepting incoming connections on the network.</td></tr><tr><td>5150(-)</td><td>The Windows Filtering Platform <strong>blocked</strong> a <strong>packet</strong>.</td></tr><tr><td>5151(-)</td><td>A more restrictive Windows Filtering Platform filter has <strong>blocked</strong> a <strong>packet</strong>.</td></tr><tr><td>5152(F)</td><td>The Windows Filtering Platform <strong>blocked</strong> a <strong>packet</strong>.</td></tr><tr><td>5153(S)</td><td>A more restrictive Windows Filtering Platform filter has <strong>blocked</strong> a <strong>packet</strong>.</td></tr><tr><td>5154(S)</td><td>The Windows Filtering Platform has permitted an application or service to listen on a port for incoming connections.</td></tr><tr><td>5155(F)</td><td>The Windows Filtering Platform has <strong>blocked</strong> an application or service from listening on a port for incoming connections.</td></tr><tr><td>5156(S)</td><td>The Windows Filtering Platform has permitted a connection.</td></tr><tr><td><strong>5157(F)</strong></td><td>The Windows Filtering Platform has <strong>blocked</strong> a connection.</td></tr><tr><td>5158(S)</td><td>The Windows Filtering Platform has permitted a bind to a local port.</td></tr><tr><td>5159(F)</td><td>The Windows Filtering Platform has <strong>blocked</strong> a bind to a local port.</td></tr></tbody></table><p>Events to Focus On:</p><ul><li><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/audit-filtering-platform-packet-drop>Audit Filtering Platform Packet Drop</a><ul><li><p>These events generate huge volumes; focus on <strong>5157</strong>, which records almost the same data but per-connection rather than per-packet.</p></li><li><p>Failure volume is typically very high for this subcategory and mainly useful for troubleshooting. To monitor blocked connections, <strong>5157(F): The Windows Filtering Platform has blocked a connection</strong> is recommended since it contains nearly identical information and generates per-connection instead of per-packet.
<img src=https://s2.loli.net/2023/05/06/gaoLAnlNu1QT3zf.png alt="recommend 5157"></p></li><li><p><del><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5152>5152</a></del></p></li><li><p><del><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5153>5153</a></del></p></li></ul></li><li><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/audit-filtering-platform-connection>Audit Filtering Platform Connection</a><ul><li>It is best to monitor only failure events such as blocked connections; track allowed connections only when necessary.</li><li><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5031>5031</a><ul><li>If there are no firewall rules (Allow or Deny) for a specific application in Windows Firewall, traffic will be dropped at the WFP layer, which by default denies all inbound connections.</li></ul></li><li><del><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5150>5150</a></del></li><li><del><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5151>5151</a></del></li><li><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5155>5155</a></li><li><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5157>5157</a></li><li><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5159>5159</a></li></ul></li></ul><h3 id=obtaining-provider-information>Obtaining Provider Information</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># List security-related providers</span>
</span></span><span class=line><span class=cl><span class=nb>Get-WinEvent</span> <span class=n>-ListProvider</span> <span class=s2>&#34;*Security*&#34;</span> <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>ProviderName</span><span class=p>,</span><span class=n>Id</span>
</span></span><span class=line><span class=cl><span class=c># Microsoft-Windows-Security-Auditing                             54849625-5478-4994-a5ba-3e3b0328c30d</span>
</span></span><span class=line><span class=cl><span class=c># Show tasks for a provider</span>
</span></span><span class=line><span class=cl><span class=nb>Get-WinEvent</span> <span class=n>-ListProvider</span> <span class=s2>&#34;Microsoft-Windows-Security-Auditing&#34;</span> <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>-ExpandProperty</span> <span class=n>tasks</span>
</span></span><span class=line><span class=cl><span class=c># SE_ADT_OBJECTACCESS_FIREWALLCONNECTION       12810 Filtering Platform Connection          00000000-0000-0000-0000-000000000000</span>
</span></span></code></pre></div><table><thead><tr><th>ProviderName</th><th>Id</th></tr></thead><tbody><tr><td>Security Account Manager</td><td>00000000-0000-0000-0000-000000000000</td></tr><tr><td>Security</td><td>00000000-0000-0000-0000-000000000000</td></tr><tr><td>SecurityCenter</td><td>00000000-0000-0000-0000-000000000000</td></tr><tr><td>Microsoft-Windows-Security-SPP-UX-GenuineCenter-Logging</td><td>fb829150-cd7d-44c3-af5b-711a3c31cedc</td></tr><tr><td>Microsoft-Windows-Security-Mitigations</td><td>fae10392-f0af-4ac0-b8ff-9f4d920c3cdf</td></tr><tr><td>Microsoft-Windows-VerifyHardwareSecurity</td><td>f3f53c76-b06d-4f15-b412-61164a0d2b73</td></tr><tr><td>Microsoft-Windows-SecurityMitigationsBroker</td><td>ea8cd8a5-78ff-4418-b292-aadc6a7181df</td></tr><tr><td>Microsoft-Windows-Security-Adminless</td><td>ea216962-877b-5b73-f7c5-8aef5375959e</td></tr><tr><td>Microsoft-Windows-Security-Vault</td><td>e6c92fb8-89d7-4d1f-be46-d56e59804783</td></tr><tr><td>Microsoft-Windows-Security-Netlogon</td><td>e5ba83f6-07d0-46b1-8bc7-7e669a1d31dc</td></tr><tr><td>Microsoft-Windows-Security-SPP</td><td>e23b33b0-c8c9-472c-a5f9-f2bdfea0f156</td></tr><tr><td>Microsoft-Windows-Windows Firewall With Advanced Security</td><td>d1bc9aff-2abf-4d71-9146-ecb2a986eb85</td></tr><tr><td>Microsoft-Windows-Security-SPP-UX-Notifications</td><td>c4efc9bb-2570-4821-8923-1bad317d2d4b</td></tr><tr><td>Microsoft-Windows-Security-SPP-UX-GC</td><td>bbbdd6a3-f35e-449b-a471-4d830c8eda1f</td></tr><tr><td>Microsoft-Windows-Security-Kerberos</td><td>98e6cfcb-ee0a-41e0-a57b-622d4e1b30b1</td></tr><tr><td>Microsoft-Windows-Security-ExchangeActiveSyncProvisioning</td><td>9249d0d0-f034-402f-a29b-92fa8853d9f3</td></tr><tr><td>Microsoft-Windows-NetworkSecurity</td><td>7b702970-90bc-4584-8b20-c0799086ee5a</td></tr><tr><td>Microsoft-Windows-Security-SPP-UX</td><td>6bdadc96-673e-468c-9f5b-f382f95b2832</td></tr><tr><td>Microsoft-Windows-Security-Auditing</td><td>54849625-5478-4994-a5ba-3e3b0328c30d</td></tr><tr><td>Microsoft-Windows-Security-LessPrivilegedAppContainer</td><td>45eec9e5-4a1b-5446-7ad8-a4ab1313c437</td></tr><tr><td>Microsoft-Windows-Security-UserConsentVerifier</td><td>40783728-8921-45d0-b231-919037b4b4fd</td></tr><tr><td>Microsoft-Windows-Security-IdentityListener</td><td>3c6c422b-019b-4f48-b67b-f79a3fa8b4ed</td></tr><tr><td>Microsoft-Windows-Security-EnterpriseData-FileRevocationManager</td><td>2cd58181-0bb6-463e-828a-056ff837f966</td></tr><tr><td>Microsoft-Windows-Security-Audit-Configuration-Client</td><td>08466062-aed4-4834-8b04-cddb414504e5</td></tr><tr><td>Microsoft-Windows-Security-IdentityStore</td><td>00b7e1df-b469-4c69-9c41-53a6576e3dad</td></tr></tbody></table><h3 id=triggering-a-block-event>Triggering a Block Event</h3><p><strong>Warning: Creating block filters affects other software on the host!</strong><br>You can immediately clean up with <code>.\WFPSampler.exe -clean</code>.</p><p>Steps:</p><ol><li><p>Enable auditing for Filtering Platform Connection:<br><code>auditpol /set /subcategory:"{0CCE9226-69AE-11D9-BED3-505054503030}" /success:enable /failure:enable</code></p></li><li><p>Open Event Viewer, create a Custom View/filter for IDs <strong>5155, 5157, 5159</strong>.
<img src=https://s2.loli.net/2023/05/06/TjfMkws8pu4NZRW.png alt="filter example"></p></li><li><p>Add a WFP filter using <strong>WFPSampler.exe</strong> to block listening on <strong>port 80</strong>:<br><code>.\WFPSampler.exe -s BASIC_ACTION_BLOCK -l FWPM_LAYER_ALE_AUTH_LISTEN_V4 -iplp 80</code></p></li><li><p>Run a third-party (non-IIS) HTTP server—here we use nginx on port 80. Starting it triggers event 5155.
<img src=https://s2.loli.net/2023/05/06/V6vlyFZ4bQa5G9Y.png alt="audit event demo"></p></li><li><p>Clean up the filter:<br><code>.\WFPSampler.exe -clean</code></p></li><li><p>Disable auditing:<br><code>auditpol /set /category:"{0CCE9226-69AE-11D9-BED3-505054503030}" /success:disable /failure:disable</code></p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># 5155: an application or service was blocked from listening on a port</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>WFPSampler</span><span class=p>.</span><span class=py>exe</span> <span class=n>-s</span> <span class=n>BASIC_ACTION_BLOCK</span> <span class=n>-l</span> <span class=n>FWPM_LAYER_ALE_AUTH_LISTEN_V4</span>
</span></span><span class=line><span class=cl><span class=c># 5157: a connection was blocked</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>WFPSampler</span><span class=p>.</span><span class=py>exe</span> <span class=n>-s</span> <span class=n>BASIC_ACTION_BLOCK</span> <span class=n>-l</span> <span class=n>FWPM_LAYER_ALE_AUTH_RECV_ACCEPT_V4</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>WFPSampler</span><span class=p>.</span><span class=py>exe</span> <span class=n>-s</span> <span class=n>BASIC_ACTION_BLOCK</span> <span class=n>-l</span> <span class=n>FWPM_LAYER_ALE_AUTH_CONNECT_V4</span>
</span></span><span class=line><span class=cl><span class=c># 5159: binding to a local port was blocked</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>WFPSampler</span><span class=p>.</span><span class=py>exe</span> <span class=n>-s</span> <span class=n>BASIC_ACTION_BLOCK</span> <span class=n>-l</span> <span class=n>FWPM_LAYER_ALE_RESOURCE_ASSIGNMENT_V4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Other</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>WFPSampler</span><span class=p>.</span><span class=py>exe</span> <span class=n>-s</span> <span class=n>BASIC_ACTION_BLOCK</span> <span class=n>-l</span> <span class=n>FWPM_LAYER_ALE_RESOURCE_ASSIGNMENT_V4_DISCARD</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>WFPSampler</span><span class=p>.</span><span class=py>exe</span> <span class=n>-s</span> <span class=n>BASIC_ACTION_BLOCK</span> <span class=n>-l</span> <span class=n>FWPM_LAYER_ALE_AUTH_RECV_ACCEPT_V4_DISCARD</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>WFPSampler</span><span class=p>.</span><span class=py>exe</span> <span class=n>-s</span> <span class=n>BASIC_ACTION_BLOCK</span> <span class=n>-l</span> <span class=n>FWPM_LAYER_ALE_AUTH_CONNECT_V4_DISCARD</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># List a WFP filter by ID:</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>wfp</span> <span class=n>show</span> <span class=kd>filter</span><span class=nb>s</span>
</span></span><span class=line><span class=cl><span class=c># Get layer IDs:</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>wfp</span> <span class=n>show</span> <span class=n>state</span>
</span></span></code></pre></div><h2 id=monitoring-network-events-net_event>Monitoring Network Events (NET_EVENT)</h2><ul><li>Events support both enumeration and subscription.</li><li>Enumeration allows filter criteria, querying events within a time window.</li><li>Subscriptions inject a callback to deliver events in real time.</li></ul><p>Supported event types:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>typedef</span> <span class=k>enum</span> <span class=n>FWPM_NET_EVENT_TYPE_</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_IKEEXT_MM_FAILURE</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_IKEEXT_QM_FAILURE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_IKEEXT_EM_FAILURE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_CLASSIFY_DROP</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_IPSEC_KERNEL_DROP</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_IPSEC_DOSP_DROP</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_CLASSIFY_ALLOW</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_CAPABILITY_DROP</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_CAPABILITY_ALLOW</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_CLASSIFY_DROP_MAC</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_LPM_PACKET_ARRIVAL</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_MAX</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=n>FWPM_NET_EVENT_TYPE</span><span class=p>;</span>
</span></span></code></pre></div><p>Enumeration filter fields (FWPM_NET_EVENT_ENUM_TEMPLATE):</p><table><thead><tr><th>Value</th><th>Meaning</th></tr></thead><tbody><tr><td>FWPM_CONDITION_IP_PROTOCOL</td><td>The IP protocol number, as specified in RFC 1700.</td></tr><tr><td>FWPM_CONDITION_IP_LOCAL_ADDRESS</td><td>The local IP address.</td></tr><tr><td>FWPM_CONDITION_IP_REMOTE_ADDRESS</td><td>The remote IP address.</td></tr><tr><td>FWPM_CONDITION_IP_LOCAL_PORT</td><td>The local transport protocol port number. For ICMP, the message type.</td></tr><tr><td>FWPM_CONDITION_IP_REMOTE_PORT</td><td>The remote transport protocol port number. For ICMP, the message code.</td></tr><tr><td>FWPM_CONDITION_SCOPE_ID</td><td>The interface IPv6 scope identifier. Reserved for internal use.</td></tr><tr><td>FWPM_CONDITION_ALE_APP_ID</td><td>The full path of the application.</td></tr><tr><td>FWPM_CONDITION_ALE_USER_ID</td><td>The identification of the local user.</td></tr></tbody></table><p>Outside of drivers, only basic drop events are returned.</p><h2 id=monitoring-network-connections-netconnection>Monitoring Network Connections (NetConnection)</h2><p>Compared to monitoring network events, monitoring connections requires higher privileges.<br><a href=https://docs.microsoft.com/en-us/windows/win32/api/fwpmu/nf-fwpmu-fwpmconnectionsubscribe0>callback approach</a></p><blockquote><p>The caller needs FWPM_ACTRL_ENUM access to the connection objects&rsquo; containers and FWPM_ACTRL_READ access to the connection objects. See Access Control for more information.</p></blockquote><p><strong>Monitoring network connections has not yet succeeded.</strong></p><p>I found a similar issue: <a href=https://stackoverflow.com/questions/63038046/receiving-in-out-traffic-stats-using-wfp-user-mode-api>Receiving in/out traffic stats using WFP user-mode API</a>. It matches the behavior I observed—none of the subscribing functions receive any notifications, giving no events and no errors. Neither enabling auditing nor elevating privileges helped. Some noted that non-kernel mode can only receive drop events, which is insufficient for obtaining block events.</p><p>Example of adding a security descriptor: <a href=https://docs.microsoft.com/en-us/windows/win32/fwp/reserving-ports>https://docs.microsoft.com/en-us/windows/win32/fwp/reserving-ports</a></p><h2 id=application-layer-enforcement-ale-introduction>Application Layer Enforcement (ALE) Introduction</h2><ul><li>ALE comprises a set of kernel-mode filters that support stateful filtering.</li><li>Filters at the ALE layer can authorize connection creation, port allocation, socket management, raw socket creation, and promiscuous-mode reception.</li><li>Classification of ALE-layer filters is based on the <strong>connection</strong> or <strong>socket</strong>; filters in other layers can only classify based on individual <strong>packets</strong>.</li><li>ALE filter reference: <a href=https://docs.microsoft.com/en-us/windows/win32/fwp/ale-layers>ale-layers</a><ul><li>More filter reference: <a href=https://docs.microsoft.com/en-us/windows/win32/fwp/management-filtering-layer-identifiers->filtering-layer-identifiers</a></li></ul></li></ul><h2 id=coding-notes>Coding Notes</h2><p>Most WFP functions can be invoked from either user mode or kernel mode. However, user-mode functions return a <strong>DWORD</strong> representing a Win32 error code, whereas kernel-mode functions return an <strong>NTSTATUS</strong> representing an NT status code.<br>Therefore, functions share the same names and semantics across modes but have differing signatures. Separate user-mode and kernel-mode headers are required: user-mode header file names end with “<strong>u</strong>”, and kernel-mode ones end with “<strong>k</strong>”.</p><h2 id=conclusion>Conclusion</h2><p>Our requirement is merely to know when events occur; real-time handling is unnecessary, and developing a kernel driver would introduce greater risk. Consequently, we’ll rely on <strong>event auditing</strong> and monitor <strong>event log generation</strong> to acquire block events.<br>A dedicated thread will use <a href=https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-notifychangeeventlog>NotifyChangeEventLog</a> to watch for new log records.</p><h2 id=appendix>Appendix</h2><h3 id=wfp-architecture>WFP Architecture</h3><p>WFP (Windows Filter Platform) <img src=https://docs.microsoft.com/en-us/windows/win32/fwp/images/wfp-architecture.png alt="Basic Architecture of the Windows Filtering Platform"></p><h3 id=data-flow>Data Flow</h3><p>Data flow:</p><ol><li>A packet enters the network stack.</li><li>The network stack finds and invokes a shim.</li><li>The shim initiates classification at a particular layer.</li><li>During classification, filters are matched, and the resulting action is applied. (See Filter Arbitration.)</li><li>If any callout filters match, their corresponding callouts are invoked.</li><li>The shim enforces the final filtering decision (e.g., drop the packet).</li></ol><h3 id=reference-links>Reference Links</h3><ul><li><a href=https://docs.microsoft.com/en-us/windows/win32/fwp/management-filtering-layer-identifiers->Filter types</a></li><li><a href=https://docs.microsoft.com/en-us/windows/win32/fwp/filtering-conditions-available-at-each-filtering-layer>Available filtering conditions per layer</a></li><li><a href=https://docs.microsoft.com/en-us/windows/win32/debug/system-error-codes--0-499->System error codes</a></li><li><a href=https://docs.microsoft.com/en-us/windows/win32/fwp/wfp-error-codes>WFP error codes</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-a7f54bb02ebc7bbb8cc0b4a2de5f0784>Windows Firewall Management – netsh</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Windows Firewall Management – netsh</li></ul><h1 id=windows-firewall-management--netsh>Windows Firewall Management – netsh</h1><h2 id=management-tools>Management Tools</h2><h2 id=netsh-advfirewall>netsh advfirewall</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># Export firewall rules</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=n>export</span> <span class=n>advfirewallpolicy</span><span class=p>.</span><span class=py>wfw</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Import firewall rules</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=n>import</span> <span class=n>advfirewallpolicy</span><span class=p>.</span><span class=py>wfw</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># View firewall state</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=n>show</span> <span class=n>allprofiles</span> <span class=n>state</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># View firewall default policy</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=n>show</span> <span class=n>allprofiles</span> <span class=n>firewallpolicy</span>
</span></span><span class=line><span class=cl><span class=c># netsh advfirewall set allprofiles firewallpolicy blockinbound,allowoutbound</span>
</span></span><span class=line><span class=cl><span class=c># netsh advfirewall set allprofiles firewallpolicy blockinbound,blockoutbound</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># View firewall settings</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=n>show</span> <span class=n>allprofiles</span> <span class=n>settings</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Enable firewall</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=nb>set </span><span class=n>allprofiles</span> <span class=n>state</span> <span class=n>on</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Disable firewall</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=nb>set </span><span class=n>allprofiles</span> <span class=n>state</span> <span class=n>off</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Display firewall rules</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=n>firewall</span> <span class=n>show</span> <span class=n>rule</span> <span class=n>name</span><span class=p>=</span><span class=n>all</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># View firewall status</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=n>monitor</span> <span class=n>show</span> <span class=n>firewall</span>
</span></span></code></pre></div><h2 id=netsh-firewall-deprecated>netsh firewall (deprecated)</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># Display firewall state</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>firewall</span> <span class=n>show</span> <span class=n>state</span>
</span></span></code></pre></div><h2 id=netsh-mbn-mobile-broadband-network>netsh mbn (Mobile Broadband network)</h2><h2 id=netsh-wfp>netsh wfp</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># Display firewall state</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>wfp</span> <span class=n>show</span> <span class=n>state</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Display firewall filters</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>wfp</span> <span class=n>show</span> <span class=kd>filter</span><span class=nb>s</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-7154e5da447955abfe28de976ea980e6>Windows Resources</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Windows Resources</li></ul><h1 id=windows-resources-collection>Windows Resources Collection</h1><ul><li><a href=/en-us/blog/2024/06/28/windows-resources/#windows-resources-collection>Windows Resources Collection</a><ul><li><a href=/en-us/blog/2024/06/28/windows-resources/#tools>Tools</a><ul><li><a href=/en-us/blog/2024/06/28/windows-resources/#monitoring--analysis>Monitoring & Analysis</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#antirootkit-tools>AntiRootkit Tools</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#pe-tools>PE Tools</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#reverse--debug>Reverse & Debug</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#injection-tools>Injection Tools</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#network>Network</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#stress-testing-tools>Stress Testing Tools</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#others>Others</a></li></ul></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#code>Code</a><ul><li><a href=/en-us/blog/2024/06/28/windows-resources/#operating-system>Operating System</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#kernel-examples>Kernel Examples</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#vt-technology>VT Technology</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#miscellaneous>Miscellaneous</a></li></ul></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#ctf-resources>CTF Resources</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#penetration-testing>Penetration Testing</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#free-patent-search>Free Patent Search</a></li></ul></li></ul><p>This section lists only some common Windows tools for debugging, troubleshooting, and testing. Tools for packing/unpacking, encryption/decryption, file editors, and programming tools are omitted for brevity.</p><h2 id=tools>Tools</h2><h3 id=monitoring--analysis>Monitoring & Analysis</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>DebugView</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/zh-cn/sysinternals/downloads/debugview>https://docs.microsoft.com/zh-cn/sysinternals/downloads/debugview</a></td><td style=text-align:left>A Sysinternals utility for capturing and controlling kernel and user-mode debug output.</td></tr><tr><td style=text-align:left><strong>Process Monitor</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/zh-cn/sysinternals/downloads/procmon>https://docs.microsoft.com/zh-cn/sysinternals/downloads/procmon</a></td><td style=text-align:left>A real-time Sysinternals tool that monitors file system, registry, process, thread, and DLL activity to help troubleshoot issues.</td></tr><tr><td style=text-align:left><strong>Process Explorer</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/zh-cn/sysinternals/downloads/process-explorer>https://docs.microsoft.com/zh-cn/sysinternals/downloads/process-explorer</a></td><td style=text-align:left>A Sysinternals process viewer that inspects loaded DLLs, call stacks, and which processes have opened a file.</td></tr><tr><td style=text-align:left><strong>WinObj</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/zh-cn/sysinternals/downloads/winobj>https://docs.microsoft.com/zh-cn/sysinternals/downloads/winobj</a></td><td style=text-align:left>A Sysinternals viewer for the Object Manager namespace; it uses native APIs without loading drivers—see WinObjEx64 for an open-source implementation on GitHub.</td></tr><tr><td style=text-align:left><strong>WinObjEx64</strong></td><td style=text-align:left><a href=https://github.com/hfiref0x/WinObjEx64>https://github.com/hfiref0x/WinObjEx64</a></td><td style=text-align:left>An open-source, advanced Object Manager namespace viewer.</td></tr><tr><td style=text-align:left><strong>Handle</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/zh-cn/sysinternals/downloads/handle>https://docs.microsoft.com/zh-cn/sysinternals/downloads/handle</a></td><td style=text-align:left>A Sysinternals utility showing which file or directory is held by a running process.</td></tr><tr><td style=text-align:left><strong>Sysinternals Suite</strong></td><td style=text-align:left><a href=https://live.sysinternals.com/>https://live.sysinternals.com/</a></td><td style=text-align:left>The complete suite of Sysinternals utilities—only the most frequently used are listed here to avoid clutter.</td></tr><tr><td style=text-align:left><strong>CPU-Z</strong></td><td style=text-align:left><a href=https://www.cpuid.com/softwares/cpu-z.html>https://www.cpuid.com/softwares/cpu-z.html</a></td><td style=text-align:left>Real-time CPU monitoring tool.</td></tr><tr><td style=text-align:left><strong>ProcMonX</strong></td><td style=text-align:left><a href=https://github.com/zodiacon/ProcMonX>https://github.com/zodiacon/ProcMonX</a></td><td style=text-align:left>An open-source C# implementation using ETW to provide functionality similar to Process Monitor.</td></tr><tr><td style=text-align:left><strong>ProcMonXv2</strong></td><td style=text-align:left><a href=https://github.com/zodiacon/ProcMonXv2>https://github.com/zodiacon/ProcMonXv2</a></td><td style=text-align:left>The second open-source C# ETW-based alternative to Process Monitor.</td></tr><tr><td style=text-align:left><strong>Process Hacker</strong></td><td style=text-align:left><a href=https://github.com/processhacker/processhacker>https://github.com/processhacker/processhacker</a></td><td style=text-align:left>An open-source Process Explorer-like tool with GPU information support.</td></tr><tr><td style=text-align:left><strong>API Monitor</strong></td><td style=text-align:left><a href=http://www.rohitab.com/apimonitor>http://www.rohitab.com/apimonitor</a></td><td style=text-align:left>Traces API calls to show how applications/services interact, helps detect bugs, and can modify input/output parameters.</td></tr><tr><td style=text-align:left><strong>Dependency Walker</strong></td><td style=text-align:left><a href=http://www.dependencywalker.com/>http://www.dependencywalker.com/</a></td><td style=text-align:left>Scans any 32- or 64-bit Windows module and lists all exported functions.</td></tr><tr><td style=text-align:left><strong>DeviceTree</strong></td><td style=text-align:left><a href="http://www.osronline.com/article.cfm%5earticle=97.htm">http://www.osronline.com/article.cfm%5earticle=97.htm</a></td><td style=text-align:left>Displays all driver objects and device stack information in the system.</td></tr><tr><td style=text-align:left><strong>Unlocker</strong></td><td style=text-align:left><a href=https://www.softpedia.com/get/System/System-Miscellaneous/Unlocker.shtml>https://www.softpedia.com/get/System/System-Miscellaneous/Unlocker.shtml</a></td><td style=text-align:left>Unlocks files held by running processes—many similar open-source tools are available.</td></tr><tr><td style=text-align:left><strong>RpcView</strong></td><td style=text-align:left><a href=https://github.com/silverf0x/RpcView>https://github.com/silverf0x/RpcView</a></td><td style=text-align:left>Shows and decompiles live RPC interfaces on the system—useful when analyzing RPC services.</td></tr><tr><td style=text-align:left><strong>RequestTrace</strong></td><td style=text-align:left><a href=https://the-sz.com/products/rt/>https://the-sz.com/products/rt/</a></td><td style=text-align:left>Displays IRPs, SRBs, URBs, and related buffers on Windows; mostly redundant as WinDbg covers the same traces but handy without a debugger.</td></tr><tr><td style=text-align:left><strong>IRPMon</strong></td><td style=text-align:left><a href=https://github.com/MartinDrab/IRPMon>https://github.com/MartinDrab/IRPMon</a></td><td style=text-align:left>Hooks driver objects to monitor IRP traffic and other driver requests, similar to RequestTrace and IrpTracker.</td></tr><tr><td style=text-align:left><strong>IRPTrace</strong></td><td style=text-align:left><a href=https://github.com/haidragon/drivertools>https://github.com/haidragon/drivertools</a></td><td style=text-align:left>Contains a collection of additional tools.</td></tr></tbody></table><h3 id=antirootkit-tools>AntiRootkit Tools</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>PcHunter</strong></td><td style=text-align:left><a href=https://www.anxinsec.com/view/antirootkit/>https://www.anxinsec.com/view/antirootkit/</a></td><td style=text-align:left>Security analysis tool that bypasses rootkits via direct disk, registry, network, etc., showing detailed info on threads, processes, and kernel modules.</td></tr><tr><td style=text-align:left><strong>Windows-Kernel-Explorer</strong></td><td style=text-align:left><a href=https://github.com/AxtMueller/Windows-Kernel-Explorer>https://github.com/AxtMueller/Windows-Kernel-Explorer</a></td><td style=text-align:left>Closed-source alternative to PcHunter, useful when newer OS support is missing.</td></tr><tr><td style=text-align:left><strong>PowerTool</strong></td><td style=text-align:left></td><td style=text-align:left>Rarely updated. Developed by a colleague of a friend; reportedly messy codebase.</td></tr><tr><td style=text-align:left><strong>py</strong></td><td style=text-align:left><a href=https://github.com/antiwar3/py>https://github.com/antiwar3/py</a></td><td style=text-align:left>PiaoYun ARK—open-source rootkit scanner.</td></tr></tbody></table><h3 id=pe-tools>PE Tools</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>CFF Explorer</strong></td><td style=text-align:left><a href="https://ntcore.com/?page_id=388">https://ntcore.com/?page_id=388</a></td><td style=text-align:left>A nice PE explorer.</td></tr><tr><td style=text-align:left><strong>ExeinfoPe</strong></td><td style=text-align:left><a href=http://www.exeinfo.xn.pl/>http://www.exeinfo.xn.pl/</a></td><td style=text-align:left>–</td></tr></tbody></table><h3 id=reverse--debug>Reverse & Debug</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th><th style=text-align:left></th></tr></thead><tbody><tr><td style=text-align:left><strong>Ghidra</strong></td><td style=text-align:left><a href=https://www.nsa.gov/resources/everyone/ghidra/>https://www.nsa.gov/resources/everyone/ghidra/</a></td><td style=text-align:left>A software reverse-engineering (SRE) suite created by the NSA Research Directorate to support cybersecurity missions.</td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>IDA</strong></td><td style=text-align:left><a href=https://down.52pojie.cn/>https://down.52pojie.cn/</a></td><td style=text-align:left>Famous but closed-source interactive disassembler—latest cracks (v7.5) on 52pojie forum.</td><td></td></tr><tr><td style=text-align:left><strong>dnSpy</strong></td><td style=text-align:left><a href=https://github.com/dnSpy/dnSpy>https://github.com/dnSpy/dnSpy</a></td><td style=text-align:left>.NET decompiler; effectively provides source code for unobfuscated .NET binaries if the framework is familiar to you.</td><td></td></tr><tr><td style=text-align:left><strong>OllyDbg</strong></td><td style=text-align:left><a href=https://down.52pojie.cn/Tools/Debuggers//>https://down.52pojie.cn/Tools/Debuggers//</a></td><td style=text-align:left>Popular debugger with many plugins; closed-source and only for 32-bit binaries.</td><td></td></tr><tr><td style=text-align:left><strong>x64dbg</strong></td><td style=text-align:left><a href=https://x64dbg.com/>https://x64dbg.com/</a></td><td style=text-align:left>Open-source debugger for x86/x64 binaries—more convenient than WinDbg yet similar plugin support; recommended over OllyDbg.</td><td></td></tr><tr><td style=text-align:left><strong>Cheat Engine</strong></td><td style=text-align:left><a href=https://www.cheatengine.org/>https://www.cheatengine.org/</a></td><td style=text-align:left>Memory-search & manipulation Swiss-army knife; offers many advanced reverse-engineering features.</td><td></td></tr><tr><td style=text-align:left><strong>VirtualKD-Redux</strong></td><td style=text-align:left><a href=https://github.com/4d61726b/VirtualKD-Redux/releases>https://github.com/4d61726b/VirtualKD-Redux/releases</a></td><td style=text-align:left>Fully-automated WinDbg virtual-machine debugging without env vars; supports latest VMware.</td><td></td></tr><tr><td style=text-align:left><strong>Driver Loader</strong></td><td style=text-align:left><a href="http://www.osronline.com/article.cfm%5Earticle=157.htm">http://www.osronline.com/article.cfm%5Earticle=157.htm</a></td><td style=text-align:left>OSR tool for installing, loading, and unloading drivers.</td><td style=text-align:left></td></tr><tr><td style=text-align:left>reverse-engineering</td><td style=text-align:left><a href=https://github.com/wtsxDev/reverse-engineering>https://github.com/wtsxDev/reverse-engineering</a></td><td style=text-align:left>A curated list of almost every tool you need for reverse engineering.</td><td></td></tr></tbody></table><h3 id=injection-tools>Injection Tools</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th><th></th></tr></thead><tbody><tr><td style=text-align:left><strong>yapi</strong></td><td style=text-align:left><a href=https://github.com/ez8-co/yapi>https://github.com/ez8-co/yapi</a></td><td style=text-align:left>Simple open-source DLL injector for x64/x86 processes—good for learning from the source; supports cross-bit-width injection from 32-bit to 64-bit.</td><td></td></tr><tr><td style=text-align:left><strong>Xenos</strong></td><td style=text-align:left><a href=https://github.com/DarthTon/Xenos>https://github.com/DarthTon/Xenos</a></td><td style=text-align:left>Open-source injector using the famous Blackbone library; supports kernel-level injection.</td><td></td></tr><tr><td style=text-align:left><strong>ExtremeInjector</strong></td><td style=text-align:left><a href=https://github.com/master131/ExtremeInjector>https://github.com/master131/ExtremeInjector</a></td><td style=text-align:left>Easy-to-use application-layer injector featuring cross-bit-width injection from 32-bit to 64-bit.</td><td></td></tr></tbody></table><h3 id=network>Network</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>Fiddler</strong></td><td style=text-align:left><a href=https://www.telerik.com/fiddler>https://www.telerik.com/fiddler</a></td><td style=text-align:left>Powerful HTTPS man-in-the-middle proxy without a certificate hassle; scriptable; ships with an SDK.</td></tr><tr><td style=text-align:left><strong>Wireshark</strong></td><td style=text-align:left><a href=https://www.wireshark.org/download.html>https://www.wireshark.org/download.html</a></td><td style=text-align:left>No introduction needed.</td></tr><tr><td style=text-align:left><strong>Burp Suite</strong></td><td style=text-align:left><a href=https://portswigger.net/burp>https://portswigger.net/burp</a></td><td style=text-align:left>The go-to web proxy for pentesters. Requires JDK; cracked versions available on 52pojie.</td></tr></tbody></table><h3 id=stress-testing-tools>Stress Testing Tools</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>Driver Verifier</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/driver-verifier>https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/driver-verifier</a></td><td style=text-align:left>Built-in driver stability and stress tester.</td></tr><tr><td style=text-align:left><strong>Application Verifier</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/application-verifier>https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/application-verifier</a></td><td style=text-align:left>Built-in application-layer stress tester.</td></tr><tr><td style=text-align:left><strong>CPUStress</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/en-us/sysinternals/downloads/cpustres>https://docs.microsoft.com/en-us/sysinternals/downloads/cpustres</a></td><td style=text-align:left>Pushes CPU to full load to test application stability and responsiveness under extreme conditions.</td></tr></tbody></table><h3 id=others>Others</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>game-hacking</strong></td><td style=text-align:left><a href=https://github.com/dsasmblr/game-hacking>https://github.com/dsasmblr/game-hacking</a></td><td style=text-align:left>–</td></tr><tr><td style=text-align:left><strong>awesome-malware-analysis</strong></td><td style=text-align:left><a href=https://github.com/rootkiter/awesome-malware-analysis>https://github.com/rootkiter/awesome-malware-analysis</a></td><td style=text-align:left>Curated list of malware-analysis tools</td></tr><tr><td style=text-align:left><strong>drawio</strong></td><td style=text-align:left><a href=https://github.com/jgraph/drawio-desktop>https://github.com/jgraph/drawio-desktop</a></td><td style=text-align:left>The ultimate diagramming tool</td></tr><tr><td style=text-align:left><strong>RazorSQL</strong></td><td style=text-align:left><a href=https://www.razorsql.com/>https://www.razorsql.com/</a></td><td style=text-align:left>GUI for SQLite3 databases</td></tr><tr><td style=text-align:left>Git Learning Notes</td><td style=text-align:left><a href=https://github.com/No-Github/1earn/blob/master/1earn/Develop/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/Git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.md>https://github.com/No-Github/1earn/blob/master/1earn/Develop/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/Git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.md</a></td><td style=text-align:left>Version management with Git</td></tr><tr><td style=text-align:left>Markdown Syntax Learning</td><td style=text-align:left><a href=https://github.com/No-Github/1earn/blob/master/1earn/Develop/%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80/Markdown/Markdown%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0.md>https://github.com/No-Github/1earn/blob/master/1earn/Develop/%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80/Markdown/Markdown%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0.md</a></td><td style=text-align:left>Markdown reference</td></tr></tbody></table><h2 id=code>Code</h2><h3 id=operating-system>Operating System</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>ReactOS</strong></td><td style=text-align:left><a href=https://github.com/reactos/reactos>https://github.com/reactos/reactos</a></td><td style=text-align:left>An open-source OS aiming for Windows 2000 driver binary compatibility.</td></tr><tr><td style=text-align:left><strong>wrk-v1.2</strong></td><td style=text-align:left><a href=https://github.com/jmcjmmcjc/wrk-v1.2>https://github.com/jmcjmmcjc/wrk-v1.2</a></td><td style=text-align:left>Partial Windows NT 5.2 source code.</td></tr><tr><td style=text-align:left><strong>WinNT4</strong></td><td style=text-align:left><a href=https://github.com/ZoloZiak/WinNT4>https://github.com/ZoloZiak/WinNT4</a></td><td style=text-align:left>Windows NT4 kernel source code.</td></tr><tr><td style=text-align:left><strong>whids</strong></td><td style=text-align:left><a href=https://github.com/0xrawsec/whids/tree/a826d87e0d035daac10bfa96b530c5deff6b9915>https://github.com/0xrawsec/whids/tree/a826d87e0d035daac10bfa96b530c5deff6b9915</a></td><td style=text-align:left>Open source EDR for Windows.</td></tr></tbody></table><h3 id=kernel-examples>Kernel Examples</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>CPPHelper</strong></td><td style=text-align:left><a href=https://github.com/Chuyu-Team/CPPHelper>https://github.com/Chuyu-Team/CPPHelper</a></td><td style=text-align:left>Basic C++ helper class library.</td></tr><tr><td style=text-align:left><strong>cpp_component</strong></td><td style=text-align:left><a href=https://github.com/skyformat99/cpp_component>https://github.com/skyformat99/cpp_component</a></td><td style=text-align:left>Encapsulation of common C/C++ features.</td></tr><tr><td style=text-align:left><strong>WinToolsLib</strong></td><td style=text-align:left><a href=https://github.com/deeonis-ru/WinToolsLib>https://github.com/deeonis-ru/WinToolsLib</a></td><td style=text-align:left>Suite of classes for Windows programming.</td></tr><tr><td style=text-align:left><strong>KDU</strong></td><td style=text-align:left><a href=https://github.com/hfiref0x/KDU>https://github.com/hfiref0x/KDU</a></td><td style=text-align:left>–</td></tr><tr><td style=text-align:left><strong>KTL</strong></td><td style=text-align:left><a href=https://github.com/MeeSong/KTL>https://github.com/MeeSong/KTL</a></td><td style=text-align:left>–</td></tr><tr><td style=text-align:left><strong>Kernel-Bridge</strong></td><td style=text-align:left><a href=https://github.com/HoShiMin/Kernel-Bridge>https://github.com/HoShiMin/Kernel-Bridge</a></td><td style=text-align:left>–</td></tr><tr><td style=text-align:left><strong>KernelForge</strong></td><td style=text-align:left><a href=https://github.com/killvxk/KernelForge>https://github.com/killvxk/KernelForge</a></td><td style=text-align:left>–</td></tr><tr><td style=text-align:left><strong>ExecutiveCallbackObjects</strong></td><td style=text-align:left><a href=https://github.com/0xcpu/ExecutiveCallbackObjects>https://github.com/0xcpu/ExecutiveCallbackObjects</a></td><td style=text-align:left>Research on various kernel-mode callbacks.</td></tr><tr><td style=text-align:left><strong>SyscallHook</strong></td><td style=text-align:left><a href=https://github.com/AnzeLesnik/SyscallHook>https://github.com/AnzeLesnik/SyscallHook</a></td><td style=text-align:left>System-call hook for Windows 10 20H1.</td></tr><tr><td style=text-align:left><strong>Antivirus_R3_bypass_demo</strong></td><td style=text-align:left><a href=https://github.com/huoji120/Antivirus_R3_bypass_demo>https://github.com/huoji120/Antivirus_R3_bypass_demo</a></td><td style=text-align:left>Eliminates AV via both R3 0-day and R0 0-day.</td></tr><tr><td style=text-align:left><strong>KernelHiddenExecute</strong></td><td style=text-align:left><a href=https://github.com/zouxianyu/KernelHiddenExecute>https://github.com/zouxianyu/KernelHiddenExecute</a></td><td style=text-align:left>Hide code/data in kernel address space.</td></tr><tr><td style=text-align:left><strong>DriverInjectDll</strong></td><td style=text-align:left><a href=https://github.com/strivexjun/DriverInjectDll>https://github.com/strivexjun/DriverInjectDll</a></td><td style=text-align:left>Kernel-mode global and memory-based injection for Win7–Win10.</td></tr><tr><td style=text-align:left><strong>zwhawk</strong></td><td style=text-align:left><a href=https://github.com/eLoopWoo/zwhawk>https://github.com/eLoopWoo/zwhawk</a></td><td style=text-align:left>Kernel rootkit providing remote command/control.</td></tr><tr><td style=text-align:left><strong>ZeroBank-ring0-bundle</strong></td><td style=text-align:left><a href=https://github.com/Trietptm-on-Coding-Algorithms/ZeroBank-ring0-bundle>https://github.com/Trietptm-on-Coding-Algorithms/ZeroBank-ring0-bundle</a></td><td style=text-align:left>Kernel-mode rootkit for remote server communication.</td></tr><tr><td style=text-align:left><strong>kdmapper</strong></td><td style=text-align:left><a href=https://github.com/z175/kdmapper>https://github.com/z175/kdmapper</a></td><td style=text-align:left>Manual driver mapper (educational/outdated).</td></tr><tr><td style=text-align:left><strong>antispy</strong></td><td style=text-align:left><a href=https://github.com/mohuihui/antispy>https://github.com/mohuihui/antispy</a></td><td style=text-align:left>Free but powerful AV & rootkit detection toolkit.</td></tr><tr><td style=text-align:left><strong>windows_kernel_resources</strong></td><td style=text-align:left><a href=https://github.com/sam-b/windows_kernel_resources>https://github.com/sam-b/windows_kernel_resources</a></td><td style=text-align:left>–</td></tr><tr><td style=text-align:left><strong>HookLib</strong></td><td style=text-align:left><a href=https://github.com/HoShiMin/HookLib>https://github.com/HoShiMin/HookLib</a></td><td style=text-align:left>User- and kernel-mode hooking library.</td></tr><tr><td style=text-align:left><strong>Kernel-Whisperer</strong></td><td style=text-align:left><a href=https://github.com/BrunoMCBraga/Kernel-Whisperer>https://github.com/BrunoMCBraga/Kernel-Whisperer</a></td><td style=text-align:left>Kernel module utilities.</td></tr><tr><td style=text-align:left><strong>SQLiteCpp</strong></td><td style=text-align:left><a href=https://github.com/SRombauts/SQLiteCpp>https://github.com/SRombauts/SQLiteCpp</a></td><td style=text-align:left>Smart, easy-to-use C++ SQLite3 wrapper.</td></tr><tr><td style=text-align:left>awesome-windows-kernel-security-development</td><td style=text-align:left><a href=https://github.com/ExpLife0011/awesome-windows-kernel-security-development>https://github.com/ExpLife0011/awesome-windows-kernel-security-development</a></td><td style=text-align:left>Curated collection of Windows kernel security projects.</td></tr></tbody></table><h3 id=vt-technology>VT Technology</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>hvpp</strong></td><td style=text-align:left><a href=https://github.com/wbenny/hvpp>https://github.com/wbenny/hvpp</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>HyperBone</strong></td><td style=text-align:left><a href=https://github.com/DarthTon/HyperBone>https://github.com/DarthTon/HyperBone</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>HyperWin</strong></td><td style=text-align:left><a href=https://github.com/amiryeshurun/HyperWin>https://github.com/amiryeshurun/HyperWin</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>Hypervisor</strong></td><td style=text-align:left><a href=https://github.com/Bareflank/hypervisor>https://github.com/Bareflank/hypervisor</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>HyperPlatform</strong></td><td style=text-align:left><a href=https://github.com/tandasat/HyperPlatform>https://github.com/tandasat/HyperPlatform</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>Hyper-V-Internals</strong></td><td style=text-align:left><a href=https://github.com/gerhart01/Hyper-V-Internals>https://github.com/gerhart01/Hyper-V-Internals</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>Hypervisor-From-Scratch</strong></td><td style=text-align:left><a href=https://github.com/SinaKarvandi/Hypervisor-From-Scratch>https://github.com/SinaKarvandi/Hypervisor-From-Scratch</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>KasperskyHook</strong></td><td style=text-align:left><a href=https://github.com/iPower/KasperskyHook>https://github.com/iPower/KasperskyHook</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>awesome-virtualization</strong></td><td style=text-align:left><a href=https://github.com/Wenzel/awesome-virtualization>https://github.com/Wenzel/awesome-virtualization</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>ransomware_begone</strong></td><td style=text-align:left><a href=https://github.com/ofercas/ransomware_begone>https://github.com/ofercas/ransomware_begone</a></td><td style=text-align:left></td></tr></tbody></table><h3 id=miscellaneous>Miscellaneous</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>Divert</strong></td><td style=text-align:left><a href=https://github.com/basil00/Divert>https://github.com/basil00/Divert</a></td><td style=text-align:left>Redirect network traffic to user-mode applications for modification/dropping.</td></tr><tr><td style=text-align:left><strong>Blackbone</strong></td><td style=text-align:left><a href=https://github.com/DarthTon/Blackbone>https://github.com/DarthTon/Blackbone</a></td><td style=text-align:left>Kernel-mode injection techniques, including kernel memory injection.</td></tr><tr><td style=text-align:left><strong>NetWatch</strong></td><td style=text-align:left><a href=https://github.com/huoji120/NetWatch>https://github.com/huoji120/NetWatch</a></td><td style=text-align:left>Threat-traffic detection platform; supports virtual memory patching.</td></tr><tr><td style=text-align:left><strong>x64_AOB_Search</strong></td><td style=text-align:left><a href=https://github.com/wanttobeno/x64_AOB_Search>https://github.com/wanttobeno/x64_AOB_Search</a></td><td style=text-align:left>Enterprise-grade high-speed memory scanner (supports wildcards).</td></tr><tr><td style=text-align:left><strong>DuckMemoryScan</strong></td><td style=text-align:left><a href=https://github.com/huoji120/DuckMemoryScan>https://github.com/huoji120/DuckMemoryScan</a></td><td style=text-align:left>Detects most so-called memory-only AV evasion shells.</td></tr><tr><td style=text-align:left><strong>FSDefender</strong></td><td style=text-align:left><a href=https://github.com/Randomize163/FSDefender>https://github.com/Randomize163/FSDefender</a></td><td style=text-align:left>File-system monitoring combined with cloud-backed backups.</td></tr><tr><td style=text-align:left><strong>AntiRansomware</strong></td><td style=text-align:left><a href=https://github.com/clavis0x/AntiRansomware>https://github.com/clavis0x/AntiRansomware</a></td><td style=text-align:left>Write-scanning anti-ransomware solution—prevents overwriting of files.</td></tr><tr><td style=text-align:left><strong>Lazy</strong></td><td style=text-align:left><a href=https://github.com/moonAgirl/Lazy>https://github.com/moonAgirl/Lazy</a></td><td style=text-align:left>(Malicious) ransomware terminator.</td></tr><tr><td style=text-align:left>awesome-cheatsheets</td><td style=text-align:left><a href=https://github.com/skywind3000/awesome-cheatsheets/blob/master/tools/git.txt>https://github.com/skywind3000/awesome-cheatsheets/blob/master/tools/git.txt</a></td><td style=text-align:left>Handy references for Python, Git, etc.</td></tr></tbody></table><h2 id=ctf-resources>CTF Resources</h2><table><thead><tr><th style=text-align:left>Repository Name</th><th style=text-align:left>Repository Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>CTF-All-In-One</strong></td><td style=text-align:left><a href=https://github.com/firmianay/CTF-All-In-One>https://github.com/firmianay/CTF-All-In-One</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>ctf-book</strong></td><td style=text-align:left><a href=https://github.com/firmianay/ctf-book>https://github.com/firmianay/ctf-book</a></td><td style=text-align:left>Companion resources for the CTF Competition Guide (Pwn Edition).</td></tr></tbody></table><h2 id=penetration-testing>Penetration Testing</h2><table><thead><tr><th style=text-align:left>Repository Name</th><th style=text-align:left>Repository Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>Web-Security-Learning</strong></td><td style=text-align:left><a href=https://github.com/CHYbeta/Web-Security-Learning>https://github.com/CHYbeta/Web-Security-Learning</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>pentest</strong></td><td style=text-align:left><a href=https://github.com/r0eXpeR/pentest>https://github.com/r0eXpeR/pentest</a></td><td style=text-align:left>Tools and project reference for pivoting inside intranets.</td></tr><tr><td style=text-align:left><strong>K8tools</strong></td><td style=text-align:left><a href=http://k8gege.org/p/72f1fea6.html>http://k8gege.org/p/72f1fea6.html</a></td><td style=text-align:left>Collection of K8tools.</td></tr><tr><td style=text-align:left><strong>Awesome-Red-Teaming</strong></td><td style=text-align:left><a href=https://github.com/yeyintminthuhtut/Awesome-Red-Teaming>https://github.com/yeyintminthuhtut/Awesome-Red-Teaming</a></td><td style=text-align:left>List of Awesome Red-Teaming Resources.</td></tr><tr><td style=text-align:left><strong>Awesome-Hacking</strong></td><td style=text-align:left><a href=https://github.com/Hack-with-Github/Awesome-Hacking>https://github.com/Hack-with-Github/Awesome-Hacking</a></td><td style=text-align:left>Curated lists for hackers.</td></tr><tr><td style=text-align:left>awesome-web-hacking</td><td style=text-align:left><a href=https://github.com/infoslack/awesome-web-hacking>https://github.com/infoslack/awesome-web-hacking</a></td><td style=text-align:left>Penetration-testing knowledge base.</td></tr></tbody></table><h2 id=free-patent-search>Free Patent Search</h2><table><thead><tr><th style=text-align:left>Repository Name</th><th style=text-align:left>Repository Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>Patent Information Service Platform</strong></td><td style=text-align:left><a href=http://search.cnipr.com/>http://search.cnipr.com/</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>patents</strong></td><td style=text-align:left>&lt;www.google.com/patents></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>incopat</strong></td><td style=text-align:left>&lt;www.incopat.com></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>Baiten</strong></td><td style=text-align:left><a href=https://www.baiten.cn/>https://www.baiten.cn/</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>rainpat</strong></td><td style=text-align:left><a href=https://www.rainpat.com/>https://www.rainpat.com/</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>Duyan</strong></td><td style=text-align:left><a href=https://www.uyanip.com/>https://www.uyanip.com/</a></td><td style=text-align:left></td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-dc08d8c63151ed8a0f9692c0720a0e3c>Windows Guide</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Windows Guide</li></ul><h1 id=windows>Windows</h1><ul><li>[<a href=/en-us/blog/2024/06/28/win-to-go/ title=Win-to-go>Win-to-go</a>]</li><li>[<a href=%E7%90%86%E8%A7%A3Windows%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F title="Understanding Windows File System">Understanding Windows File System</a>]</li><li>[<a href=%E7%90%86%E8%A7%A3Windows%E8%BF%9B%E7%A8%8B title="Understanding Windows Processes">Understanding Windows Processes</a>]</li><li>[<a href=Windows%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90 title="Windows Related Resources">Windows Related Resources</a>]</li><li>[<a href=Windows%E7%AE%A1%E7%90%86%E8%BF%9B%E9%98%B6 title="Advanced Windows Management">Advanced Windows Management</a>]</li><li>[<a href=Windows%E9%98%B2%E7%81%AB%E5%A2%99%E7%AE%A1%E7%90%86-netsh title="Windows Firewall Management - netsh">Windows Firewall Management - netsh</a>]</li><li>[<a href=Windows%E9%98%BB%E6%96%AD%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E8%8E%B7%E5%8F%96 title="Blocking Windows Network Traffic Acquisition">Blocking Windows Network Traffic Acquisition</a>]</li><li>[<a href=../../../%E7%96%91%E9%9A%BE%E6%9D%82%E7%97%87/Windows%E9%BA%BB%E7%83%A6%E9%97%AE%E9%A2%98 title="Windows Troublesome Issues">Windows Troublesome Issues</a>]</li><li>[<a href=%E7%90%86%E8%A7%A3Windows%E4%BA%8B%E4%BB%B6%E8%B7%9F%E8%B8%AA_ETW title="Understanding Windows Event Tracing (ETW)">Understanding Windows Event Tracing (ETW)</a>]</li><li>[<a href=%E7%90%86%E8%A7%A3Windows%E7%BD%91%E7%BB%9C_WFP title="Understanding Windows Networking (WFP)">Understanding Windows Networking (WFP)</a>]</li><li>[<a href=windows-ipv6%E7%AE%A1%E7%90%86 title=windows-ipv6-management>windows-ipv6-management</a>]</li><li>[<a href=../../../%E7%96%91%E9%9A%BE%E6%9D%82%E7%97%87/Windows%E6%A1%A5%E6%8E%A5%E6%97%B6%E7%9A%84IPv6%E9%97%AE%E9%A2%98 title="IPv6 Issues When Bridging Windows">IPv6 Issues When Bridging Windows</a>]</li><li>[<a href=wireguard%E9%85%8D%E7%BD%AE title="wireguard configuration">wireguard configuration</a>]</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-61abe4532313c2fd9d4e7585b6edf0d9>window-message</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> window-message</li></ul><h1 id=windows-message>windows-message</h1><ul><li><a href=https://gist.github.com/amgine/2395987>All windows messages as C# enum (github.com)</a></li><li><a href=https://wiki.winehq.org/List_Of_Windows_Messages>List Of Windows Messages - WineHQ Wiki</a></li><li><a href=http://www.pinvoke.net/default.aspx/Constants/WM.html>pinvoke.net: WM (Constants)</a></li><li><a href=http://www.pinvoke.net/default.aspx/Enums/WindowsMessages>pinvoke.net: WindowsMessages (Enums)</a></li><li><a href=https://learn.microsoft.com/en-us/windows/win32/winmsg/window-notifications>Window Notifications</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-6c9144bf4bbbb75884f99fcddaa67574>Win-to-go</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><p>===</p><p>Windows To Go is convenient for portability, but several traditional Windows features are restricted.</p><ul><li><a href=/en-us/blog/2024/06/28/win-to-go/#preface>Preface</a></li><li><a href=/en-us/blog/2024/06/28/win-to-go/#windows-to-go-overview>Windows To Go Overview</a></li><li><a href=/en-us/blog/2024/06/28/win-to-go/#differences-between-windows-to-go-and-traditional-windows-installation>Differences between Windows To Go and traditional Windows installation</a></li><li><a href=/en-us/blog/2024/06/28/win-to-go/#using-windows-to-go-for-mobile-work>Using Windows To Go for mobile work</a></li><li><a href=/en-us/blog/2024/06/28/win-to-go/#preparing-to-install-windows-to-go>Preparing to install Windows To Go</a></li><li><a href=/en-us/blog/2024/06/28/win-to-go/#hardware-requirements>Hardware requirements</a></li><li><a href=/en-us/blog/2024/06/28/win-to-go/#usb-hard-drive-or-flash-drive>USB hard drive or flash drive</a></li><li><a href=/en-us/blog/2024/06/28/win-to-go/#host-computer>Host computer</a></li><li><a href=/en-us/blog/2024/06/28/win-to-go/#checking-architecture-compatibility-between-host-pc-and-windows-to-go-drive>Checking architecture compatibility between host PC and Windows To Go drive</a></li><li><a href=/en-us/blog/2024/06/28/win-to-go/#common-windows-to-go-questions>Common Windows To Go questions</a></li></ul><h2 id=preface>Preface</h2><p>Windows To Go has existed for many years, yet there are so few Chinese-language resources on it—one can’t help but worry about the state of domestic IT documentation. The author has limited experience but is exposed to plenty of English development docs and hopes to lay some groundwork for future readers; any mistakes pointed out will be welcomed. For those comfortable reading English, comprehensive official documentation is available at the links below:</p><ul><li><a href=https://docs.microsoft.com/en-us/windows/deployment/planning/windows-to-go-overview>Windows To Go Overview</a></li><li><a href=https://docs.microsoft.com/en-us/windows/deployment/planning/best-practice-recommendations-for-windows-to-go>Best practice recommendations for Windows To Go</a></li><li><a href=https://docs.microsoft.com/en-us/windows/deployment/planning/deployment-considerations-for-windows-to-go>Deployment considerations for Windows To Go</a></li><li><a href=https://docs.microsoft.com/en-us/windows/deployment/planning/prepare-your-organization-for-windows-to-go>Prepare your organization for Windows To Go</a></li><li><a href=https://docs.microsoft.com/en-us/windows/deployment/planning/security-and-data-protection-considerations-for-windows-to-go>Security and data protection considerations for Windows To Go</a></li><li><a href=https://docs.microsoft.com/en-us/windows/deployment/planning/windows-to-go-frequently-asked-questions>Windows To Go: frequently asked questions</a></li></ul><p>This post covers the overview and some common questions—mostly translations with the occasional author note (indicated by [J] until the next full stop) to prevent misinformation.</p><h2 id=windows-to-go-overview>Windows To Go Overview</h2><p>Windows To Go is a feature of Windows Enterprise and Education editions; it is not available in the Home edition used by most general consumers. It allows you to create a portable Windows system on a USB drive or hard disk. Windows To Go is not intended to replace traditional installation methods; its main purpose is to let people who frequently switch workspaces do so more efficiently. Before using Windows To Go, you need to be aware of the following:</p><ul><li>Differences between Windows To Go and traditional Windows installation</li><li>Using Windows To Go for mobile work</li><li>Preparing to install Windows To Go</li><li>Hardware requirements</li></ul><h2 id=differences-between-windows-to-go-and-traditional-windows-installation>Differences between Windows To Go and traditional Windows installation</h2><p>Windows To Go behaves almost like a normal Windows environment except for these differences:</p><ul><li>All internal drives except the USB device you’re running from are offline by default—invisible in File Explorer—to safeguard data. [J]You still have ways to bring those drives online and change their files.</li><li>The Trusted Platform Module (TPM) is unavailable. TPM is tied to an individual PC to protect business data. [J]Most consumer machines don’t have it, but if your corporate laptop is domain-joined, it’s best not to use Windows To Go on it; otherwise, freshen up your résumé first.</li><li>Hibernation is disabled by default in Windows To Go but can be re-enabled via Group Policy. [J]Many machines break USB connections during hibernation and cannot resume—Microsoft anticipated this and disabled it; there’s usually no reason to change that setting.</li><li>Windows Restore is disabled. If the OS breaks, you’ll need to reinstall.</li><li>Factory reset and Windows Reset are unavailable.</li><li>In-place upgrades are not supported. The OS stays at whatever version it was installed as—you cannot go from Windows 7 to 8 or from Windows 10 RS1 to RS2.</li></ul><h2 id=using-windows-to-go-for-mobile-work>Using Windows To Go for mobile work</h2><p>Windows To Go can boot on multiple machines; the OS will automatically determine the needed drivers. Apps tightly coupled to specific hardware may fail to run. [J]ThinkPad track-pad control apps or fingerprint utilities, for example.</p><h2 id=preparing-to-install-windows-to-go>Preparing to install Windows To Go</h2><p>You can use <strong>System Center Configuration Manager</strong> or standard Windows deployment tools such as <strong>DiskPart</strong> and <strong>Deployment Image Servicing and Management (DISM)</strong>. Consider:</p><ul><li>Do you need to inject any drivers into the Windows To Go image?</li><li>How will you store and sync data when switching between machines?</li><li>32-bit or 64-bit? [J]All new hardware supports 64-bit; 64-bit CPUs can run 32-bit OSes, but 32-bit CPUs cannot run 64-bit OSes. 64-bit systems also consume more disk and memory. If any target machine has a 32-bit CPU or less than 4 GB RAM, stick with 32-bit.</li><li>What resolution should you use when remoting in from external networks?</li></ul><h2 id=hardware-requirements>Hardware requirements</h2><h3 id=usb-hard-drive-or-flash-drive>USB hard drive or flash drive</h3><p>Windows To Go is specifically optimized for certified devices:</p><ul><li>Optimizes USB devices for high random read/write, ensuring smooth daily use.</li><li>Can boot Windows 7 and later from certified devices.</li><li>Continues to enjoy OEM warranty support even while running Windows To Go. [J]The host PC’s warranty wasn’t mentioned.</li></ul><p>Uncertified USB devices are not supported. [J]Try it and you’ll learn quickly why—it just won’t work. [J]Non-standard hacks (e.g., spoofing device IDs) are out there but outside scope.</p><h3 id=host-computer-host-computer>Host computer (Host computer)</h3><ul><li>Certified for Windows 7 and later.</li><li>Windows RT systems are unsupported.</li><li>Apple Macs are unsupported. [J]Even though the web is full of success stories on using Windows To Go on a Mac, the official stance is clear: no support.</li></ul><p>Minimum specs for a host computer:</p><table><thead><tr><th>Item</th><th>Requirement</th></tr></thead><tbody><tr><td>Boot capability</td><td>Must support USB boot</td></tr><tr><td>Firmware</td><td>USB-boot option enabled</td></tr><tr><td>Processor architecture</td><td>Must match supported Windows To Go requirements</td></tr><tr><td>External USB hub</td><td>Not supported. The Windows To Go device must be plugged directly into the host</td></tr><tr><td>Processor</td><td>1 GHz or faster</td></tr><tr><td>RAM</td><td>2 GB or more</td></tr><tr><td>Graphics</td><td>DirectX 9 or later with WDDM 1.2</td></tr><tr><td>USB port</td><td>USB 2.0 or later</td></tr></tbody></table><h3 id=checking-architecture-compatibility-between-host-pc-and-windows-to-go-drive>Checking architecture compatibility between host PC and Windows To Go drive</h3><table><thead><tr><th>Host PC Firmware Type</th><th>Host PC Processor Architecture</th><th>Compatible Windows To Go Image Architecture</th></tr></thead><tbody><tr><td>Legacy BIOS</td><td>32-bit</td><td>32-bit only</td></tr><tr><td>Legacy BIOS</td><td>64-bit</td><td>32-bit and 64-bit</td></tr><tr><td>UEFI BIOS</td><td>32-bit</td><td>32-bit only</td></tr><tr><td>UEFI BIOS</td><td>64-bit</td><td>64-bit only</td></tr></tbody></table><h2 id=common-windows-to-go-questions>Common Windows To Go questions</h2><p><a href=https://docs.microsoft.com/en-us/windows/deployment/planning/windows-to-go-frequently-asked-questions>Windows To Go: frequently asked questions</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-fdca4b70fcac0969d3f6f11c73bd982f>environment</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div></div><div class=td-content><h1 id=pg-c3eced6fd7bfa18bd259b226e3eaae74>Windows Subsystem Linux(WSL)</h1><div class="td-byline mb-4"><time datetime=2025-06-25 class=text-body-secondary>Wednesday, June 25, 2025</time></div><ul><li><input disabled type=checkbox> _index</li></ul></div><div class=td-content><h1 id=pg-0d5ef95054bbbb5dee5b9075089dd8c0>WSL Mirrored Network Mode Configuration Guide</h1><div class=lead>WSL 2.6.0 networking upgrade configuration guide</div><div class="td-byline mb-4"><time datetime=2025-06-25 class=text-body-secondary>Wednesday, June 25, 2025</time></div><h2 id=version-requirements>Version Requirements</h2><p>Current version status:</p><ul><li>Latest stable: 2.5.9 (known networking issues)</li><li>Recommended version: 2.6.0 preview (full mirrored mode support)</li></ul><h2 id=mode-comparison-analysis>Mode Comparison Analysis</h2><table><thead><tr><th>Feature</th><th>bridge mode (deprecated)</th><th>mirrored mode (recommended)</th></tr></thead><tbody><tr><td>Protocol architecture</td><td>Dual-stack</td><td>Shared stack</td></tr><tr><td>IP address allocation</td><td>Independent IP (Windows + WSL)</td><td>Shared host IP</td></tr><tr><td>Port resources</td><td>Separate</td><td>Shared ports (conflict-avoidance required)</td></tr><tr><td>Network performance</td><td>Relatively heavy</td><td>Lightweight & efficient</td></tr><tr><td>Configuration complexity</td><td>Simple</td><td>Requires deep firewall policy setup</td></tr></tbody></table><h2 id=standard-configuration-steps>Standard Configuration Steps</h2><h3 id=1-network-mode-settings>1. Network Mode Settings</h3><p>Configure the base mode via <strong>WSL Settings</strong> app:</p><ol><li>Open the Settings app</li><li>Select the <strong>Network</strong> tab</li><li>Set network mode to <strong>Mirrored</strong></li><li>Apply the configuration and restart WSL</li></ol><p><img src=https://img1.techfetch.dev/blog/202506261151336.png alt></p><h3 id=2-firewall-policy-configuration>2. Firewall Policy Configuration</h3><p>Run the complete policy configuration via PowerShell:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Define the WSL VM GUID</span>
</span></span><span class=line><span class=cl><span class=nv>$wslGuid</span> <span class=p>=</span> <span class=s1>&#39;{40E0AC32-46A5-438A-A0B2-2B479E8F2E90}&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Configure firewall policies (execute in order)</span>
</span></span><span class=line><span class=cl><span class=nb>Set-NetFirewallHyperVVMSetting</span> <span class=n>-Name</span> <span class=nv>$wslGuid</span> <span class=n>-Enabled</span> <span class=n>True</span>
</span></span><span class=line><span class=cl><span class=nb>Set-NetFirewallHyperVVMSetting</span> <span class=n>-Name</span> <span class=nv>$wslGuid</span> <span class=n>-DefaultInboundAction</span> <span class=n>Allow</span>
</span></span><span class=line><span class=cl><span class=nb>Set-NetFirewallHyperVVMSetting</span> <span class=n>-Name</span> <span class=nv>$wslGuid</span> <span class=n>-DefaultOutboundAction</span> <span class=n>Allow</span>
</span></span><span class=line><span class=cl><span class=nb>Set-NetFirewallHyperVVMSetting</span> <span class=n>-Name</span> <span class=nv>$wslGuid</span> <span class=n>-LoopbackEnabled</span> <span class=n>True</span>
</span></span><span class=line><span class=cl><span class=nb>Set-NetFirewallHyperVVMSetting</span> <span class=n>-Name</span> <span class=nv>$wslGuid</span> <span class=n>-AllowHostPolicyMerge</span> <span class=n>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Verify configuration results</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetFirewallHyperVVMSetting</span> <span class=n>-Name</span> <span class=nv>$wslGuid</span>
</span></span></code></pre></div><h3 id=3-port-mapping-validation>3. Port Mapping Validation</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Example: Check port 80 usage</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetTCPConnection</span> <span class=n>-LocalPort</span> <span class=mf>80</span>
</span></span></code></pre></div><h2 id=common-issue-troubleshooting>Common Issue Troubleshooting</h2><h3 id=issue-1-external-connections-fail>Issue 1: External Connections Fail</h3><ul><li>Check step: All fields returned by <code>Get-NetFirewallHyperVVMSetting</code> should be True/Allow</li><li>Solution: Re-run the firewall policy configuration commands in order</li></ul><h3 id=issue-2-port-conflicts>Issue 2: Port Conflicts</h3><ul><li>Check method: Use <code>netstat -ano</code> to view port usage</li><li>Handling advice: Prefer to release ports occupied by Windows, or change the listening port in the WSL service</li></ul><h2 id=validation-steps>Validation Steps</h2><ol><li>Start your WSL service (e.g., Nginx/Apache)</li><li>Access from Windows host: <code>http://localhost:&lt;port></code></li><li>Access from LAN devices: <code>http://&lt;host-ip>:&lt;port></code></li></ol><h2 id=references>References</h2><ol><li><a href=https://learn.microsoft.com/en-us/windows/wsl/networking>WSL Official Networking Docs</a></li><li><a href=https://github.com/microsoft/WSL/releases/tag/2.6.0>WSL 2.6.0 Release Notes</a></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-8c275cc52eb0aeccde59940d54b04590>wsl</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><h1 id=configure-wsl>Configure wsl</h1><ul><li><a href=/en-us/blog/2024/06/28/wsl/#configure-wsl>Configure wsl</a><ul><li><a href=/en-us/blog/2024/06/28/wsl/#remote-access-ssh>Remote access ssh</a></li><li><a href=/en-us/blog/2024/06/28/wsl/#configure-wsl-1>Configure wsl</a></li></ul></li></ul><h2 id=remote-access-ssh>Remote access ssh</h2><p><strong>wsl</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo apt install openssh-server
</span></span><span class=line><span class=cl>sudo nano /etc/ssh/sshd_config
</span></span><span class=line><span class=cl>/etc/ssh/sshd_config
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...STUFF ABOVE THIS...
</span></span><span class=line><span class=cl>Port <span class=m>2222</span>
</span></span><span class=line><span class=cl><span class=c1>#AddressFamily any</span>
</span></span><span class=line><span class=cl>ListenAddress 0.0.0.0
</span></span><span class=line><span class=cl><span class=c1>#ListenAddress ::</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...STUFF BELOW  THIS...
</span></span></code></pre></div><p><strong>windows</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=n>service</span> <span class=n>ssh</span> <span class=nb>start
</span></span></span><span class=line><span class=cl><span class=nb></span><span class=n>netsh</span> <span class=n>interface</span> <span class=n>portproxy</span> <span class=n>add</span> <span class=n>v4tov4</span> <span class=n>listenaddress</span><span class=p>=</span><span class=mf>0.0</span><span class=p>.</span><span class=py>0</span><span class=p>.</span><span class=py>0</span> <span class=n>listenport</span><span class=p>=</span><span class=mf>2222</span> <span class=n>connectaddress</span><span class=p>=</span><span class=mf>172.23</span><span class=p>.</span><span class=py>129</span><span class=p>.</span><span class=py>80</span> <span class=n>connectport</span><span class=p>=</span><span class=mf>2222</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=n>firewall</span> <span class=n>add</span> <span class=n>rule</span> <span class=n>name</span><span class=p>=</span><span class=s2>&#34;Open Port 2222 for WSL2&#34;</span> <span class=n>dir</span><span class=p>=</span><span class=k>in</span> <span class=n>action</span><span class=p>=</span><span class=n>allow</span> <span class=n>protocol</span><span class=p>=</span><span class=n>TCP</span> <span class=n>localport</span><span class=p>=</span><span class=mf>2222</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>interface</span> <span class=n>portproxy</span> <span class=n>show</span> <span class=n>v4tov4</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>int</span> <span class=n>portproxy</span> <span class=n>reset</span> <span class=n>all</span>
</span></span></code></pre></div><h2 id=configure-wsl-1>Configure wsl</h2><p><a href=https://docs.microsoft.com/en-us/windows/wsl/wsl-config#configuration-setting-for-wslconfig>https://docs.microsoft.com/en-us/windows/wsl/wsl-config#configuration-setting-for-wslconfig</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=nb>Set-Content</span> <span class=n>-Path</span> <span class=s2>&#34;</span><span class=nv>$env:userprofile</span><span class=s2>\\.wslconfig&#34;</span> <span class=n>-Value</span> <span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2># Settings apply across all Linux distros running on WSL 2
</span></span></span><span class=line><span class=cl><span class=s2>[wsl2]
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2># Limits VM memory to use no more than 4 GB, this can be set as whole numbers using GB or MB
</span></span></span><span class=line><span class=cl><span class=s2>memory=2GB
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2># Sets the VM to use two virtual processors
</span></span></span><span class=line><span class=cl><span class=s2>processors=2
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2># Specify a custom Linux kernel to use with your installed distros. The default kernel used can be found at https://github.com/microsoft/WSL2-Linux-Kernel
</span></span></span><span class=line><span class=cl><span class=s2># kernel=C:\\temp\\myCustomKernel
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2># Sets additional kernel parameters, in this case enabling older Linux base images such as Centos 6
</span></span></span><span class=line><span class=cl><span class=s2># kernelCommandLine = vsyscall=emulate
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2># Sets amount of swap storage space to 8GB, default is 25% of available RAM
</span></span></span><span class=line><span class=cl><span class=s2>swap=1GB
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2># Sets swapfile path location, default is %USERPROFILE%\AppData\Local\Temp\swap.vhdx
</span></span></span><span class=line><span class=cl><span class=s2>swapfile=C:\\temp\\wsl-swap.vhdx
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2># Disable page reporting so WSL retains all allocated memory claimed from Windows and releases none back when free
</span></span></span><span class=line><span class=cl><span class=s2>pageReporting=false
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2># Turn off default connection to bind WSL 2 localhost to Windows localhost
</span></span></span><span class=line><span class=cl><span class=s2>localhostforwarding=true
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2># Disables nested virtualization
</span></span></span><span class=line><span class=cl><span class=s2>nestedVirtualization=false
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2># Turns on output console showing contents of dmesg when opening a WSL 2 distro for debugging
</span></span></span><span class=line><span class=cl><span class=s2>debugConsole=true
</span></span></span><span class=line><span class=cl><span class=s2>&#34;</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-9aae4a903852faf9a0f472a446cdffc6>Virtual Memory Disk Setup</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Virtual Memory Disk Setup</li></ul><h1 id=virtual-memory-disk-setup>Virtual Memory Disk Setup</h1><h2 id=redirect-browser-cache-to-virtual-disk>Redirect Browser Cache to Virtual Disk</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bat data-lang=bat><span class=line><span class=cl># Use ImDisk to create a virtual disk
</span></span><span class=line><span class=cl># The following command creates a 4 GB virtual disk and mounts it as M: drive
</span></span><span class=line><span class=cl>imdisk -a -s 4G -m M: -p <span class=s2>&#34;/fs:ntfs /q /y&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>rd</span> /q /s <span class=s2>&#34;C:\Users\Administrator\AppData\Local\Microsoft\Edge\User Data\Default\Cache&#34;</span>
</span></span><span class=line><span class=cl><span class=k>rd</span> /q /s <span class=s2>&#34;C:\Users\Administrator\AppData\Local\Microsoft\Edge\User Data\Default\Code Cache&#34;</span>
</span></span><span class=line><span class=cl><span class=k>md</span> M:\Edge_Cache\
</span></span><span class=line><span class=cl><span class=k>md</span> M:\Edge_CodeCache\
</span></span><span class=line><span class=cl><span class=k>mklink</span> /D <span class=s2>&#34;C:\Users\Administrator\AppData\Local\Microsoft\Edge\User Data\Default\Cache&#34;</span> <span class=s2>&#34;M:\Edge_Cache\&#34;</span>
</span></span><span class=line><span class=cl><span class=k>mklink</span> /D <span class=s2>&#34;C:\Users\Administrator\AppData\Local\Microsoft\Edge\User Data\Default\Code Cache&#34;</span> <span class=s2>&#34;M:\Edge_CodeCache\&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Restore browser cache to default location
</span></span><span class=line><span class=cl><span class=k>rd</span> <span class=s2>&#34;C:\Users\Administrator\AppData\Local\Microsoft\Edge\User Data\Default\Cache&#34;</span>
</span></span><span class=line><span class=cl><span class=k>rd</span> <span class=s2>&#34;C:\Users\Administrator\AppData\Local\Microsoft\Edge\User Data\Default\Code Cache&#34;</span>
</span></span><span class=line><span class=cl><span class=k>md</span> <span class=s2>&#34;C:\Users\Administrator\AppData\Local\Microsoft\Edge\User Data\Default\Cache&#34;</span>
</span></span><span class=line><span class=cl><span class=k>md</span> <span class=s2>&#34;C:\Users\Administrator\AppData\Local\Microsoft\Edge\User Data\Default\Code Cache&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Unmount the virtual disk
</span></span><span class=line><span class=cl># To remove the virtual disk, use the following command
</span></span><span class=line><span class=cl>imdisk -D -m M:
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-0bfa54d6f8df04d6a03555efc9df6b4b>vs-remote-debug</h1><div class="td-byline mb-4"><time datetime=2022-11-13 class=text-body-secondary>Sunday, November 13, 2022</time></div><h1 id=remote-debug-with-visual-studio>remote debug with visual studio</h1><p>Remote debugging C++:
<a href="https://docs.microsoft.com/en-us/visualstudio/debugger/remote-debugging-cpp?view=vs-2019">https://docs.microsoft.com/en-us/visualstudio/debugger/remote-debugging-cpp?view=vs-2019</a></p><p>Attach debugging:
<a href="https://docs.microsoft.com/en-us/visualstudio/debugger/attach-to-running-processes-with-the-visual-studio-debugger?view=vs-2019">https://docs.microsoft.com/en-us/visualstudio/debugger/attach-to-running-processes-with-the-visual-studio-debugger?view=vs-2019</a></p><p>Configure co-debugging program as a service:
<a href="https://docs.microsoft.com/en-us/visualstudio/debugger/remote-debugging?view=vs-2019#bkmk_configureService">https://docs.microsoft.com/en-us/visualstudio/debugger/remote-debugging?view=vs-2019#bkmk_configureService</a></p><p>How to configure launch parameters:
<a href=https://stackoverflow.com/questions/6740422/visual-studio-remote-debugging-a-service>https://stackoverflow.com/questions/6740422/visual-studio-remote-debugging-a-service</a></p><p>Available parameters:
<a href="https://social.msdn.microsoft.com/Forums/vstudio/en-US/174c2039-b316-455a-800e-18c0d93b74bc/visual-studio-2010-remote-debugger-settings-dont-persist?forum=vsdebug">https://social.msdn.microsoft.com/Forums/vstudio/en-US/174c2039-b316-455a-800e-18c0d93b74bc/visual-studio-2010-remote-debugger-settings-dont-persist?forum=vsdebug</a></p><p>Add your own task</p><p><code>"C:\Program Files\Microsoft Visual Studio 16.0\Common7\IDE\Remote Debugger\x64\msvsmon.exe"</code></p><p>Launch parameters</p><p><code>/noauth /anyuser /port:4045 /nosecuritywarn /timeout 360000</code></p><p>Dev machine connect: <code>test0.example.com:4045</code></p><p>Remote access (developer mode must be enabled first): <code>http://test0.example.com:50080/</code></p></div><div class=td-content style=page-break-before:always><h1 id=pg-483d9b8533f77c210a385fd1ae507e54>How Many Principles of Design Patterns Are There?</h1><div class="td-byline mb-4"><time datetime=2024-05-16 class=text-body-secondary>Thursday, May 16, 2024</time></div><p>最早总结的设计模式只有 5 个, 即<code>SOLID</code>:</p><ul><li><code>单一职责原则 (Single Responsibility Principle, SRP)</code>：a class should have only one reason to change—i.e., only one responsibility.</li><li><code>开闭原则 (Open/Closed Principle, OCP)</code>：software entities (classes, modules, functions, etc.) should be open for extension but closed for modification; in other words, change should be achieved by extension rather than by modifying existing code.</li><li><code>里氏替换原则 (Liskov Substitution Principle, LSP)</code>：subtypes must be substitutable for their base types—i.e., derived classes must be able to replace their base classes without affecting program correctness.</li><li><code>接口隔离原则 (Interface Segregation Principle, ISP)</code>：clients should not be forced to depend on interfaces they do not use. Large interfaces should be split into smaller, more specific ones so clients only need to know the methods they actually use.</li><li><code>依赖倒置原则 (Dependency Inversion Principle, DIP)</code>：high-level modules should not depend on low-level modules; both should depend on abstractions. Abstractions should not depend on details; details should depend on abstractions.</li></ul><p>后来增加了两个规则, 这些后加的规则相较来说更具体, 更有指导性. 我们从原则解释中可以看到<code>SOLID</code>描述<code>应该怎么做</code>, 后加的规则描述<code>优先/最好怎么做</code>.</p><ul><li><code>合成/聚合复用原则 (Composition/Aggregation Reuse Principle, CARP)</code>：preference should be given to composition/aggregation over inheritance for reusing code.</li><li><code>迪米特法则 (Law of Demeter, LoD)</code>：an object should have minimal knowledge of other objects—i.e., it should know as little as possible about their internal structure and implementation details.</li></ul><p>除了上述提到的常见设计原则外，还有一些其他的设计原则，虽然不如前面提到的那些广为人知，但同样对软件设计和架构有重要的指导作用。
后续提出的这些规则, 有点画蛇添足, 至少我认为它们不反直觉, 不需要深入思考.</p><ul><li><code>最少知识原则 (Principle of Least Knowledge, PoLK)</code>：also regarded as an extension of the Law of Demeter, it asserts that an object should acquire as little knowledge as possible about other objects. The concept originates from the 1987 “Law of Least Communication” proposed by Patricia Lago and Koos Visser.</li><li><code>稳定依赖原则 (Stable Dependencies Principle, SDP)</code>：this principle holds that a design should ensure stable components do not depend on unstable ones—i.e., components with higher stability should depend less on lower-stability components. The idea stems from in-depth studies of relationships among components in software systems.</li><li><code>稳定抽象原则 (Stable Abstraction Principle, SAP)</code>：in line with the Stable Dependencies Principle, this guideline aligns abstraction with stability: stable components should be abstract, while unstable components should be concrete. It helps maintain both stability and flexibility in the software system.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-3127fe4f549e713432b986a2279f07a3>Cross-Platform Content Publishing Tool — A Review of "蚁小二"</h1><div class="td-byline mb-4"><time datetime=2024-05-09 class=text-body-secondary>Thursday, May 09, 2024</time></div><h2 id=foreword>Foreword</h2><p>Lately, I’ve wanted to write a bit to diversify my income, so I scouted around the various creator platforms, hoping to earn something—if not cash, then at least some coins.</p><p>Putting aside the platforms themselves, writing requires a bit of brainpower, and crafting articles isn’t easy. Naturally, I don’t want to send each piece to only one outlet. When you publish on multiple platforms, however, you run into one very annoying problem: repeating the same task over and over again.</p><p>If every platform supported external links and Markdown, a simple copy-and-paste wouldn’t be painful. In reality, though, most don’t let you import Markdown—and all the more welcome news is that they do accept Word files. You can convert .md to .docx and then upload the .docx.</p><p>Another pain point is that each platform has you go through its own publishing page. I’d prefer to handle everything in batch. During my search, I came across a tool called “蚁小二.” Don’t worry—this isn’t a sales pitch. If the tool were genuinely indispensable, I’d be slow and stingy to share. The fact I’m sharing means I remain skeptical about its real value.</p><h2 id=supported-platforms>Supported Platforms</h2><p><img src=https://s2.loli.net/2024/06/20/NGdJbYPmKFsu6MX.png alt></p><p>It claims one-click publishing to many platforms. The free tier I’m using allows five accounts—plenty for pure writing. For video creators this cap might be a lifesaver.</p><h2 id=experience-with-text-based-creator-platforms>Experience with Text-Based Creator Platforms</h2><p>Since I don’t produce videos at all, I’ll skip that part and focus solely on what it’s like for text creators.</p><p><img src=https://s2.loli.net/2024/06/20/unKh5tRUSXyCDsx.png alt></p><ul><li>The editor resembles a familiar word processor: paragraphs, boldface, block quotes, underlines, strikethrough, italics, page breaks, indentation, and images.</li><li>Hyperlinks are not supported.</li><li>Tables are not supported.</li><li>There’s no Markdown. You can work around this by copying from VS Code’s Markdown preview to retain some formatting.</li><li>A loose abstraction for “many” platforms.</li><li>A loose abstraction for “multiple accounts on one platform.”</li></ul><p>One-click publishing is, admittedly, rather smooth. Still, when I want to check feedback, I still have to visit each platform.</p><p><img src=https://s2.loli.net/2024/06/20/H2ARnQ6FCwNYLjS.png alt></p><p>I don’t normally browse these self-media sites—overall quality isn’t stellar—but the barrier to entry is lower than I expected. In the future I’ll post there as well; stay tuned.</p><p>This was my first time using the tool. I’m by no means an expert, clueless about what topics earn money or what the payouts look like. If any seasoned creators could point me in the right direction, I’d be deeply grateful.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-175e4c3dd63eb7bb326bb484aea4a3d6>Jianshu Writing Experience</h1><div class="td-byline mb-4"><time datetime=2024-05-09 class=text-body-secondary>Thursday, May 09, 2024</time></div><p>Jianshu&rsquo;s writing experience is only slightly better than Notepad.</p><h2 id=minimalist-note-management>Minimalist Note Management</h2><p>This is the article-editing page, with only two levels of abstraction:</p><ul><li>notebook list</li><li>note list</li><li>editor</li></ul><p><img src=https://s2.loli.net/2024/05/09/QaCNwOghDi6b7xu.png alt></p><p>Fewer levels are both advantageous and problematic. Simple operations reduce cognitive load, yet they will eventually increase an author&rsquo;s overhead in managing articles.</p><h2 id=difficult-image-uploading>Difficult Image Uploading</h2><p><strong>For eight whole years, Jianshu has still not solved the external-image upload issue.</strong></p><p><img src=https://s2.loli.net/2024/05/09/nxkTBGpo3KDjtsh.png alt=https://www.jianshu.com/p/acb660ddc619></p><p>External linking only fails sometimes, and many image hosts allow empty or any referer—Jianshu doesn&rsquo;t even try, claiming local upload is the &ldquo;correct&rdquo; way. One wonders if the operators have ever tried writing on other platforms.</p><p>It&rsquo;s hard to believe any writer would stay on just one platform. If a platform can&rsquo;t let creators copy and paste easily, it can only remain niche.</p><h2 id=no-review-process>No Review Process</h2><p>Jianshu doesn&rsquo;t seem to review content; I&rsquo;ve never seen any review status—you publish, and the post is instantly available. If a platform barely reviews its content, perhaps we could do this and that&mldr;</p><h2 id=random-ip-geolocation>Random IP Geolocation</h2><p>Jianshu hasn’t actually implemented IP geolocation; the IP address refreshes with a random update every time.</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="User mailing list" aria-label="User mailing list"><a target=_blank rel=noopener href=https://groups.google.com/forum/#!forum/jqknono aria-label="User mailing list"><i class=envelope></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/jqknono aria-label=Telegram><i class="fab fa-telegram"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/jqknono aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="User mailing list" aria-label="User mailing list"><a target=_blank rel=noopener href=https://groups.google.com/forum/#!forum/jqknono aria-label="User mailing list"><i class=envelope></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2015&ndash;2025
<span class=td-footer__authors>jqknono</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><style>.markmap>svg{width:100%;height:300px}</style><script>window.markmap={autoLoader:{manual:!0,onReady(){const{autoLoader:e,builtInPlugins:t}=window.markmap;e.transformPlugins=t.filter(e=>e.name!=="prism")}}}</script><script src=https://cdn.jsdelivr.net/npm/markmap-autoloader></script><script src=/js/deflate.js></script><script src=/js/main.min.ef02deeaa00500a3225379b19170d5b9d432263216df8955d03c6c7e12b892e4.js integrity="sha256-7wLe6qAFAKMiU3mxkXDVudQyJjIW34lV0DxsfhK4kuQ=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>