<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en-us class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://blog.jqknono.com/en-us/blog/programmer/os/windows/><link rel=alternate type=application/rss+xml href=https://blog.jqknono.com/en-us/blog/programmer/os/windows/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>windows | Nono Blogs</title><meta name=description content="jqknono's Blogs"><meta property="og:url" content="https://blog.jqknono.com/en-us/blog/programmer/os/windows/"><meta property="og:site_name" content="Nono Blogs"><meta property="og:title" content="windows"><meta property="og:description" content="jqknono's Blogs"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta itemprop=name content="windows"><meta itemprop=description content="jqknono's Blogs"><meta itemprop=datePublished content="2024-06-28T17:09:22+08:00"><meta itemprop=dateModified content="2024-06-28T17:09:22+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="windows"><meta name=twitter:description content="jqknono's Blogs"><link rel=preload href=/scss/main.min.82eab66f7dbf8584ac0249d2368c4a868f71d3dc29e923e1cf723cdc1816c00b.css as=style integrity="sha256-guq2b32/hYSsAknSNoxKho9x09wp6SPhz3I83BgWwAs=" crossorigin=anonymous><link href=/scss/main.min.82eab66f7dbf8584ac0249d2368c4a868f71d3dc29e923e1cf723cdc1816c00b.css rel=stylesheet integrity="sha256-guq2b32/hYSsAknSNoxKho9x09wp6SPhz3I83BgWwAs=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9457787069079604" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-F3FFTG72NE"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F3FFTG72NE")}</script></head><body class="td-section td-blog"><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/en-us/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Nono Blogs</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><ul class=dropdown-menu><li><a class=dropdown-item href=/blog/programmer/os/windows/>简体中文</a></li></ul></div></li><li class="td-light-dark-menu nav-item dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown data-bs-display=static aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=bd-theme-text><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.c8ab4185f27a13c691a104dda70cf8d8.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/en-us/blog/programmer/os/windows/>Return to the regular view of this page</a>.</p></div><h1 class=title>windows</h1><ul><li><a href=#pg-e026196632c59be506a0151d656504b5>Windows SSH Remote Login</a></li><li><a href=#pg-195482425345048d2f23cc6e5a3f36fa>Understanding Windows Networking_WFP</a></li><li><a href=#pg-63cc6d36463add07c363c19e9d6357d2>Understanding Windows Event Tracing (ETW)</a></li><li><a href=#pg-a3673aba36ec41cb0458b4256f8be612>wireguard configuration</a></li><li><a href=#pg-7b6314989d253d9fadbc558b8fb75b3d>Windows Blocking Network Traffic Capture</a></li><li><a href=#pg-a7f54bb02ebc7bbb8cc0b4a2de5f0784>Windows Firewall Management – netsh</a></li><li><a href=#pg-7154e5da447955abfe28de976ea980e6>Windows Resources</a></li><li><a href=#pg-dc08d8c63151ed8a0f9692c0720a0e3c>Windows Guide</a></li><li><a href=#pg-61abe4532313c2fd9d4e7585b6edf0d9>window-message</a></li><li><a href=#pg-6c9144bf4bbbb75884f99fcddaa67574>Win-to-go</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-e026196632c59be506a0151d656504b5>Windows SSH Remote Login</h1><div class="td-byline mb-4"><time datetime=2025-05-26 class=text-body-secondary>Monday, May 26, 2025</time></div><p>Enabling SSH remote access on Windows typically requires Windows&rsquo; built-in OpenSSH feature. Below are step-by-step instructions:</p><h2 id=check-and-install-openssh>Check and Install OpenSSH</h2><ol><li><p><strong>Check whether OpenSSH is already installed</strong>:</p><ul><li>Open <strong>Settings</strong> > <strong>Apps</strong> > <strong>Apps & features</strong> > <strong>Manage optional features</strong>.</li><li>Look for <strong>OpenSSH Server</strong> in the list. If found, it is already installed.</li></ul></li><li><p><strong>Install OpenSSH</strong>:</p><ul><li>If <strong>OpenSSH Server</strong> is not listed, click <strong>Add a feature</strong>, locate <strong>OpenSSH Server</strong> in the list, click it, then click <strong>Install</strong>.</li></ul></li></ol><h2 id=start-and-configure-the-openssh-service>Start and Configure the OpenSSH Service</h2><ol><li><p><strong>Start the OpenSSH service</strong>:</p><ul><li>After installation, open <strong>Command Prompt</strong> (run as administrator).</li><li>Type <code>net start sshd</code> to start the OpenSSH service. To make it start automatically at boot, run <code>sc config sshd start= auto</code>.</li></ul></li><li><p><strong>Configure the firewall</strong>:</p><ul><li>Ensure the Windows firewall allows SSH connections. Go to <strong>Control Panel</strong> > <strong>System and Security</strong> > <strong>Windows Defender Firewall</strong> > <strong>Advanced settings</strong>, create an inbound rule to allow connections on TCP port 22.</li></ul></li></ol><h2 id=get-the-ip-address-and-test-the-connection>Get the IP Address and Test the Connection</h2><ol><li><p><strong>Get the IP address</strong>:</p><ul><li>To connect from another machine, you’ll need the IP address of the Windows PC where SSH was enabled. Run <code>ipconfig</code> at the command prompt to find it.</li></ul></li><li><p><strong>Connection test</strong>:</p><ul><li>Use an SSH client (e.g., PuTTY, Termius) from another computer or device to connect, using the format <code>ssh username@your_ip_address</code>, where <code>username</code> is the Windows account name and <code>your_ip_address</code> is the address you just obtained.</li></ul></li></ol><h2 id=modify-configuration>Modify Configuration</h2><p>Avoid logging in with passwords—this is a <strong>must-avoid trap</strong>. Always use public keys to log in.<br>We need to disable password login and enable public-key login by adjusting the configuration.</p><p>Because the file is protected, editing it requires special privileges, and its folder and file permissions must be set to specific values. Using a script is strongly recommended.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Check for admin rights</span>
</span></span><span class=line><span class=cl><span class=nv>$elevated</span> <span class=p>=</span> <span class=p>[</span><span class=no>bool</span><span class=p>]([</span><span class=no>System.Security.Principal.WindowsPrincipal</span><span class=p>]::</span><span class=n>new</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=no>System.Security.Principal.WindowsIdentity</span><span class=p>]::</span><span class=n>GetCurrent</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>).</span><span class=n>IsInRole</span><span class=p>([</span><span class=no>System.Security.Principal.WindowsBuiltInRole</span><span class=p>]::</span><span class=n>Administrator</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=nv>$elevated</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Error</span> <span class=s2>&#34;Please run this script with administrator rights&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>exit</span> <span class=mf>1</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 1. Check and install the OpenSSH server if necessary</span>
</span></span><span class=line><span class=cl><span class=nb>Write-Host</span> <span class=s2>&#34;Checking OpenSSH server installation status...&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$capability</span> <span class=p>=</span> <span class=nb>Get-WindowsCapability</span> <span class=n>-Online</span> <span class=n>-Name</span> <span class=n>OpenSSH</span><span class=p>.</span><span class=n>Server</span><span class=p>~~~~</span><span class=mf>0.0</span><span class=p>.</span><span class=py>1</span><span class=p>.</span><span class=py>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$capability</span><span class=p>.</span><span class=py>State</span> <span class=o>-ne</span> <span class=s1>&#39;Installed&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Host</span> <span class=s2>&#34;Installing OpenSSH server...&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>Add-WindowsCapability</span> <span class=n>-Online</span> <span class=n>-Name</span> <span class=n>OpenSSH</span><span class=p>.</span><span class=n>Server</span><span class=p>~~~~</span><span class=mf>0.0</span><span class=p>.</span><span class=py>1</span><span class=p>.</span><span class=py>0</span> <span class=p>|</span> <span class=nb>Out-Null</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 2. Start and set the OpenSSH service to auto-start</span>
</span></span><span class=line><span class=cl><span class=nb>Write-Host</span> <span class=s2>&#34;Configuring SSH service...&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$service</span> <span class=p>=</span> <span class=nb>Get-Service</span> <span class=n>sshd</span> <span class=n>-ErrorAction</span> <span class=n>SilentlyContinue</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=nv>$service</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Error</span> <span class=s2>&#34;OpenSSH service failed to install&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>exit</span> <span class=mf>1</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$service</span><span class=p>.</span><span class=py>Status</span> <span class=o>-ne</span> <span class=s1>&#39;Running&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Start-Service</span> <span class=n>sshd</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nb>Set-Service</span> <span class=n>sshd</span> <span class=n>-StartupType</span> <span class=n>Automatic</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 3. Edit the configuration file</span>
</span></span><span class=line><span class=cl><span class=nv>$configPath</span> <span class=p>=</span> <span class=s2>&#34;C:\ProgramData\ssh\sshd_config&#34;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=nv>$configPath</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Host</span> <span class=s2>&#34;Backing up original configuration file...&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>Copy-Item</span> <span class=nv>$configPath</span> <span class=s2>&#34;</span><span class=nv>$configPath</span><span class=s2>.bak&#34;</span> <span class=n>-Force</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Error</span> <span class=s2>&#34;Configuration file not found: </span><span class=nv>$configPath</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>exit</span> <span class=mf>1</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Write-Host</span> <span class=s2>&#34;Modifying SSH configuration...&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$config</span> <span class=p>=</span> <span class=nb>Get-Content</span> <span class=n>-Path</span> <span class=nv>$configPath</span> <span class=n>-Raw</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Enable pubkey authentication and disable password login</span>
</span></span><span class=line><span class=cl><span class=nv>$config</span> <span class=p>=</span> <span class=nv>$config</span> <span class=o>-replace</span> <span class=s1>&#39;^#?PubkeyAuthentication .*$&#39;</span><span class=p>,</span><span class=s1>&#39;PubkeyAuthentication yes&#39;</span> <span class=p>`</span>
</span></span><span class=line><span class=cl>                  <span class=o>-replace</span> <span class=s1>&#39;^#?PasswordAuthentication .*$&#39;</span><span class=p>,</span><span class=s1>&#39;PasswordAuthentication no&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Ensure necessary configs are present</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$config</span> <span class=o>-notmatch</span> <span class=s1>&#39;PubkeyAuthentication&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$config</span> <span class=p>+=</span> <span class=s2>&#34;</span><span class=se>`n</span><span class=s2>PubkeyAuthentication yes&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$config</span> <span class=o>-notmatch</span> <span class=s1>&#39;PasswordAuthentication&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$config</span> <span class=p>+=</span> <span class=s2>&#34;</span><span class=se>`n</span><span class=s2>PasswordAuthentication no&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Write the new configuration</span>
</span></span><span class=line><span class=cl><span class=nv>$config</span> <span class=p>|</span> <span class=nb>Set-Content</span> <span class=n>-Path</span> <span class=nv>$configPath</span> <span class=n>-Encoding</span> <span class=n>UTF8</span>
</span></span></code></pre></div><h2 id=confirm-authorized_keys-permissions>Confirm authorized_keys Permissions</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># normal user</span>
</span></span><span class=line><span class=cl><span class=nv>$authKeys</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>$env:USERPROFILE</span><span class=s2>\.ssh\authorized_keys&#34;</span>
</span></span><span class=line><span class=cl><span class=n>icacls</span> <span class=nv>$authKeys</span> <span class=p>/</span><span class=n>inheritance</span><span class=err>:</span><span class=nb>r </span><span class=p>/</span><span class=n>grant</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$env:USERNAME</span><span class=p>)</span><span class=s2>:F&#34;</span> <span class=p>/</span><span class=n>grant</span> <span class=s2>&#34;SYSTEM:F&#34;</span>
</span></span><span class=line><span class=cl><span class=n>icacls</span> <span class=s2>&#34;</span><span class=nv>$env:USERPROFILE</span><span class=s2>\.ssh&#34;</span> <span class=p>/</span><span class=n>inheritance</span><span class=err>:</span><span class=nb>r </span><span class=p>/</span><span class=n>grant</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$env:USERNAME</span><span class=p>)</span><span class=s2>:F&#34;</span> <span class=p>/</span><span class=n>grant</span> <span class=s2>&#34;SYSTEM:F&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># administrator</span>
</span></span><span class=line><span class=cl><span class=nv>$adminAuth</span> <span class=p>=</span> <span class=s2>&#34;C:\ProgramData\ssh\administrators_authorized_keys&#34;</span>
</span></span><span class=line><span class=cl><span class=n>icacls</span> <span class=nv>$adminAuth</span> <span class=p>/</span><span class=n>inheritance</span><span class=err>:</span><span class=nb>r </span><span class=p>/</span><span class=n>grant</span> <span class=s2>&#34;Administrators:F&#34;</span> <span class=p>/</span><span class=n>grant</span> <span class=s2>&#34;SYSTEM:F&#34;</span>
</span></span></code></pre></div><h2 id=set-firewall-rules>Set Firewall Rules</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Allow SSH port</span>
</span></span><span class=line><span class=cl><span class=nb>New-NetFirewallRule</span> <span class=n>-DisplayName</span> <span class=s2>&#34;OpenSSH Server (sshd)&#34;</span> <span class=n>-Direction</span> <span class=n>Inbound</span> <span class=n>-Protocol</span> <span class=n>TCP</span> <span class=n>-Action</span> <span class=n>Allow</span> <span class=n>-LocalPort</span> <span class=mf>22</span>
</span></span></code></pre></div><h2 id=add-public-keys>Add Public Keys</h2><h3 id=normal-user>Normal User</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># normal user</span>
</span></span><span class=line><span class=cl><span class=nv>$userProfile</span> <span class=p>=</span> <span class=nv>$env:USERPROFILE</span>
</span></span><span class=line><span class=cl><span class=nv>$sshDir</span> <span class=p>=</span> <span class=nb>Join-Path</span> <span class=nv>$userProfile</span> <span class=s2>&#34;.ssh&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$authorizedKeysPath</span> <span class=p>=</span> <span class=nb>Join-Path</span> <span class=nv>$sshDir</span> <span class=s2>&#34;authorized_keys&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$PublicKeyPath</span> <span class=p>=</span> <span class=s2>&#34;D:\public_keys\id_rsa.pub&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Create .ssh directory</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=nv>$sshDir</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>New-Item</span> <span class=n>-ItemType</span> <span class=n>Directory</span> <span class=n>-Path</span> <span class=nv>$sshDir</span> <span class=p>|</span> <span class=nb>Out-Null</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Set .ssh directory permissions</span>
</span></span><span class=line><span class=cl><span class=nv>$currentUser</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>$env:USERDOMAIN</span><span class=s2>\</span><span class=nv>$env:USERNAME</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$acl</span> <span class=p>=</span> <span class=nb>Get-Acl</span> <span class=nv>$sshDir</span>
</span></span><span class=line><span class=cl><span class=nv>$rule</span> <span class=p>=</span> <span class=nb>New-Object</span> <span class=n>System</span><span class=p>.</span><span class=py>Security</span><span class=p>.</span><span class=py>AccessControl</span><span class=p>.</span><span class=py>FileSystemAccessRule</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nv>$currentUser</span><span class=p>,</span> <span class=s2>&#34;FullControl&#34;</span><span class=p>,</span> <span class=s2>&#34;ContainerInherit,ObjectInherit&#34;</span><span class=p>,</span> <span class=s2>&#34;None&#34;</span><span class=p>,</span> <span class=s2>&#34;Allow&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nv>$acl</span><span class=p>.</span><span class=py>AddAccessRule</span><span class=p>(</span><span class=nv>$rule</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>Set-Acl</span> <span class=nv>$sshDir</span> <span class=nv>$acl</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Add public key</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=nv>$PublicKeyPath</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$pubKey</span> <span class=p>=</span> <span class=nb>Get-Content</span> <span class=n>-Path</span> <span class=nv>$PublicKeyPath</span> <span class=n>-Raw</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nv>$pubKey</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c># Ensure newline at end</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=nv>$pubKey</span><span class=p>.</span><span class=py>EndsWith</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>`n</span><span class=s2>&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$pubKey</span> <span class=p>+=</span> <span class=s2>&#34;</span><span class=se>`n</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c># Append key</span>
</span></span><span class=line><span class=cl>        <span class=nb>Add-Content</span> <span class=n>-Path</span> <span class=nv>$authorizedKeysPath</span> <span class=n>-Value</span> <span class=nv>$pubKey</span> <span class=n>-Encoding</span> <span class=n>UTF8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c># Set file permissions</span>
</span></span><span class=line><span class=cl>        <span class=nv>$acl</span> <span class=p>=</span> <span class=nb>Get-Acl</span> <span class=nv>$authorizedKeysPath</span>
</span></span><span class=line><span class=cl>        <span class=nv>$acl</span><span class=p>.</span><span class=py>SetSecurityDescriptorRule</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=nb>New-Object</span> <span class=n>System</span><span class=p>.</span><span class=py>Security</span><span class=p>.</span><span class=py>AccessControl</span><span class=p>.</span><span class=py>FileSystemAccessRule</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=nv>$currentUser</span><span class=p>,</span> <span class=s2>&#34;FullControl&#34;</span><span class=p>,</span> <span class=s2>&#34;None&#34;</span><span class=p>,</span> <span class=s2>&#34;None&#34;</span><span class=p>,</span> <span class=s2>&#34;Allow&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>Set-Acl</span> <span class=nv>$authorizedKeysPath</span> <span class=nv>$acl</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Error</span> <span class=s2>&#34;Public key file not found: </span><span class=nv>$PublicKeyPath</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>exit</span> <span class=mf>1</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Restart SSH service</span>
</span></span><span class=line><span class=cl><span class=nb>Write-Host</span> <span class=s2>&#34;Restarting SSH service...&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>Restart-Service</span> <span class=n>sshd</span>
</span></span></code></pre></div><h3 id=administrator-user>Administrator User</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># administrator</span>
</span></span><span class=line><span class=cl><span class=nv>$adminSshDir</span> <span class=p>=</span> <span class=s2>&#34;C:\ProgramData\ssh&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$adminAuthKeysPath</span> <span class=p>=</span> <span class=nb>Join-Path</span> <span class=nv>$adminSshDir</span> <span class=s2>&#34;administrators_authorized_keys&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$adminPublicKeyPath</span> <span class=p>=</span> <span class=s2>&#34;D:\public_keys\id_rsa.pub&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Create admin SSH directory</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=nv>$adminSshDir</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>New-Item</span> <span class=n>-ItemType</span> <span class=n>Directory</span> <span class=n>-Path</span> <span class=nv>$adminSshDir</span> <span class=p>|</span> <span class=nb>Out-Null</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Set admin SSH directory permissions</span>
</span></span><span class=line><span class=cl><span class=nv>$adminAcl</span> <span class=p>=</span> <span class=nb>Get-Acl</span> <span class=nv>$adminSshDir</span>
</span></span><span class=line><span class=cl><span class=nv>$adminRule</span> <span class=p>=</span> <span class=nb>New-Object</span> <span class=n>System</span><span class=p>.</span><span class=py>Security</span><span class=p>.</span><span class=py>AccessControl</span><span class=p>.</span><span class=py>FileSystemAccessRule</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Administrators&#34;</span><span class=p>,</span> <span class=s2>&#34;FullControl&#34;</span><span class=p>,</span> <span class=s2>&#34;ContainerInherit,ObjectInherit&#34;</span><span class=p>,</span> <span class=s2>&#34;None&#34;</span><span class=p>,</span> <span class=s2>&#34;Allow&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nv>$adminAcl</span><span class=p>.</span><span class=py>AddAccessRule</span><span class=p>(</span><span class=nv>$adminRule</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>Set-Acl</span> <span class=nv>$adminSshDir</span> <span class=nv>$adminAcl</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Add admin public key</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nb>Test-Path</span> <span class=nv>$adminPublicKeyPath</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$adminPubKey</span> <span class=p>=</span> <span class=nb>Get-Content</span> <span class=n>-Path</span> <span class=nv>$adminPublicKeyPath</span> <span class=n>-Raw</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nv>$adminPubKey</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c># Ensure newline at end</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>-not</span> <span class=nv>$adminPubKey</span><span class=p>.</span><span class=py>EndsWith</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>`n</span><span class=s2>&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$adminPubKey</span> <span class=p>+=</span> <span class=s2>&#34;</span><span class=se>`n</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c># Append key</span>
</span></span><span class=line><span class=cl>        <span class=nb>Add-Content</span> <span class=n>-Path</span> <span class=nv>$adminAuthKeysPath</span> <span class=n>-Value</span> <span class=nv>$adminPubKey</span> <span class=n>-Encoding</span> <span class=n>UTF8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c># Set file permissions</span>
</span></span><span class=line><span class=cl>        <span class=nv>$adminAcl</span> <span class=p>=</span> <span class=nb>Get-Acl</span> <span class=nv>$adminAuthKeysPath</span>
</span></span><span class=line><span class=cl>        <span class=nv>$adminAcl</span><span class=p>.</span><span class=py>SetSecurityDescriptorRule</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=nb>New-Object</span> <span class=n>System</span><span class=p>.</span><span class=py>Security</span><span class=p>.</span><span class=py>AccessControl</span><span class=p>.</span><span class=py>FileSystemAccessRule</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Administrators&#34;</span><span class=p>,</span> <span class=s2>&#34;FullControl&#34;</span><span class=p>,</span> <span class=s2>&#34;None&#34;</span><span class=p>,</span> <span class=s2>&#34;None&#34;</span><span class=p>,</span> <span class=s2>&#34;Allow&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>Set-Acl</span> <span class=nv>$adminAuthKeysPath</span> <span class=nv>$adminAcl</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>Write-Error</span> <span class=s2>&#34;Admin public key file not found: </span><span class=nv>$adminPublicKeyPath</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>exit</span> <span class=mf>1</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Restart SSH service</span>
</span></span><span class=line><span class=cl><span class=nb>Write-Host</span> <span class=s2>&#34;Restarting SSH service...&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>Restart-Service</span> <span class=n>sshd</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-195482425345048d2f23cc6e5a3f36fa>Understanding Windows Networking_WFP</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Understanding Windows Networking_WFP</li></ul><h1 id=understanding-windows-networking>Understanding Windows Networking</h1><ul><li><input disabled type=checkbox> Understanding Windows Networking</li></ul><h2 id=wfp>WFP</h2><h3 id=terminology>Terminology</h3><p><a href=https://learn.microsoft.com/en-us/windows/win32/fwp/object-model>https://learn.microsoft.com/en-us/windows/win32/fwp/object-model</a><br><a href=https://learn.microsoft.com/en-us/windows/win32/fwp/basic-operation>https://learn.microsoft.com/en-us/windows/win32/fwp/basic-operation</a><br><a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/network>https://learn.microsoft.com/en-us/windows-hardware/drivers/network</a></p><p><a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/network/callout>callout</a>: A callout provides functionality that extends the capabilities of the Windows Filtering Platform. A callout consists of a set of callout functions and a GUID key that uniquely identifies the callout.<br><a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/network/callout-driver>callout driver</a>: A callout driver is a driver that registers callouts with the Windows Filtering Platform. A callout driver is a type of filter driver.<br><a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/network/callout-function>callout function</a>: A callout function is a function that is called by the Windows Filtering Platform to perform a specific task. A callout function is associated with a callout.<br><a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/network/filter>filter</a>: A filter is a set of functions that are called by the Windows Filtering Platform to perform filtering operations. A filter consists of a set of filter functions and a GUID key that uniquely identifies the filter.<br><a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/network/filter-engine>filter engine</a>: The filter engine is the component of the Windows Filtering Platform that performs filtering operations. The filter engine is responsible for calling the filter functions that are registered with the Windows Filtering Platform.<br><a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/network/filter-layer>filter layer</a>: A filter layer is a set of functions that are called by the Windows Filtering Platform to perform filtering operations. A filter layer consists of a set of filter layer functions and a GUID key that uniquely identifies the filter layer.</p><p>The dispatcher queue triggers callbacks as soon as possible without waiting for the queue to fill, thus satisfying real-time requirements.<br>When the user callback is slow, blocked packets are inserted into the next queue whenever possible, up to a queue limit of 256. Any additional blocked packets are buffered by the system. Rough testing shows a buffer capacity of around 16,500; this system cache size can vary with machine performance and configuration.</p><p>When the user callback processes a packet, there are two packet entities:</p><ul><li><strong>Kernel packet</strong>: Released in bulk after the callback finishes processing the queue. Therefore, when the callback is slow, one callback execution can lock up to 256 system packet buffers.</li><li><strong>Copy in callback</strong>: Released immediately after the individual packet is processed.</li></ul><p>Copying and assembling packets in <code>FwppNetEvent1Callback</code> does not touch the original packets, so business operations remain unaffected.</p><p>Subscribing with template filters can reduce the number of packets that need processing:</p><p><a href=https://learn.microsoft.com/en-us/windows/win32/api/fwpmtypes/ns-fwpmtypes-fwpm_net_event_enum_template0>https://learn.microsoft.com/en-us/windows/win32/api/fwpmtypes/ns-fwpmtypes-fwpm_net_event_enum_template0</a></p><p><strong>filterCondition</strong></p><p>An array of <code>FWPM_FILTER_CONDITION0</code> structures containing distinct filter conditions (duplicate filter conditions will produce an error). All conditions must be true for the action to occur; in other words, the conditions are AND’ed together. If no conditions are provided, the action is always performed.</p><ul><li><strong>Identical filters cannot be used.</strong></li><li><strong>The relationship among all filters is logical AND—all must be satisfied.</strong></li><li>Microsoft documentation lists eight supported filters, but in practice many more are supported.</li></ul><p><strong>FWPM_CONDITION_IP_PROTOCOL</strong><br>The IP protocol number, as specified in RFC 1700.</p><p><strong>FWPM_CONDITION_IP_LOCAL_ADDRESS</strong><br>The local IP address.</p><p><strong>FWPM_CONDITION_IP_REMOTE_ADDRESS</strong><br>The remote IP address.</p><p><strong>FWPM_CONDITION_IP_LOCAL_PORT</strong><br>The local transport protocol port number. For ICMP, this is the message type.</p><p><strong>FWPM_CONDITION_IP_REMOTE_PORT</strong><br>The remote transport protocol port number. For ICMP, this is the message code.</p><p><strong>FWPM_CONDITION_SCOPE_ID</strong><br>The interface IPv6 scope identifier; reserved for internal use.</p><p><strong>FWPM_CONDITION_ALE_APP_ID</strong><br>The full path of the application.</p><p><strong>FWPM_CONDITION_ALE_USER_ID</strong><br>The identification of the local user.</p><p>Enumerating registered subscriptions shows two existing ones. Their <code>sessionKey</code> GUIDs provide no clues about the registering identity. Analysis shows each implements:</p><ul><li>Subscription to all <code>FWPM_NET_EVENT_TYPE_CLASSIFY_DROP</code> packets to collect statistics on dropped packets.</li><li>Subscription to all <code>FWPM_NET_EVENT_TYPE_CLASSIFY_ALLOW</code> packets for traffic accounting.</li></ul><p>Both subscriptions use the condition filter <code>FWPM_CONDITION_NET_EVENT_TYPE</code> (206e9996-490e-40cf-b831-b38641eb6fcb), confirming that more filters can be applied than the eight listed in Microsoft’s documentation.</p><p>Further investigation indicates that the user-mode API can only capture drop events. Non-drop events must be obtained via kernel mode, so a micro-segmentation solution cannot use <code>FWPM_CONDITION_NET_EVENT_TYPE</code> to gather events.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-63cc6d36463add07c363c19e9d6357d2>Understanding Windows Event Tracing (ETW)</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Understanding Windows Event Tracing (ETW)</li></ul><h1 id=understanding-etw>Understanding ETW</h1><p>Some unnecessary information has been filtered out; see the complete documentation at: <a href=https://docs.microsoft.com/en-us/windows/win32/etw/event-tracing-portal>https://docs.microsoft.com/en-us/windows/win32/etw/event-tracing-portal</a></p><h2 id=understanding-the-basics>Understanding the Basics</h2><p><a href=https://learn.microsoft.com/en-us/windows/win32/etw/about-event-tracing>https://learn.microsoft.com/en-us/windows/win32/etw/about-event-tracing</a></p><p><img src=https://learn.microsoft.com/en-us/windows/win32/etw/images/etdiag2.png alt=Architecture></p><h2 id=session>Session</h2><p>There are four kinds of sessions:</p><table><thead><tr><th>Session Type</th><th>Usage</th><th>Limitations</th><th>Characteristics</th></tr></thead><tbody><tr><td><a href=https://learn.microsoft.com/en-us/windows/win32/etw/configuring-and-starting-an-event-tracing-session>Event Tracing Session</a>(Standard ETW)</td><td>1. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/ns-evntrace-event_trace_properties>EVENT_TRACE_PROPERTIES</a><br>2. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-starttracea>StartTrace</a>: create a session<br>3. EnableTrace<br>1. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-enabletrace>EnableTrace</a> for classic providers<br>2. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-enabletraceex>EnableTraceEx</a> for manifest-based providers<br>4. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-controltracea>ControlTrace</a> stop the session</td><td>- A manifest-based provider can deliver events to at most 8 sessions.<br>- A classic provider can only serve one session.<br>- The last session to enable a provider supersedes any earlier sessions.</td><td>Standard ETW.</td></tr><tr><td><a href=https://learn.microsoft.com/en-us/windows/win32/etw/configuring-and-starting-a-systemtraceprovider-session>SystemTraceProvider Session</a></td><td>1. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/ns-evntrace-event_trace_properties>EVENT_TRACE_PROPERTIES</a> → <strong>EnableFlags</strong><br>2. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-starttracea>StartTrace</a><br>3. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-controltracea>ControlTrace</a> to stop the session</td><td>- <strong>SystemTraceProvider</strong> is a kernel-mode provider that supplies a set of <a href=https://learn.microsoft.com/en-us/windows/win32/etw/nt-kernel-logger-constants>predefined kernel events</a>.<br>- The <strong><a href=https://learn.microsoft.com/en-us/windows/win32/etw/configuring-and-starting-the-nt-kernel-logger-session>NT Kernel Logger session</a></strong> is a predefined system session that records a specified set of kernel events.<br>- <strong>Windows 7/Windows Server 2008 R2</strong> only the NT Kernel Logger session may use SystemTraceProvider.<br>- <strong>Windows 8/Windows Server 2012</strong> SystemTraceProvider can feed <strong>8 logger sessions</strong>, two of which are reserved for NT Kernel Logger and Circular Kernel Context Logger.<br>- <strong>Windows 10 20348 and later</strong>, individual System providers can be controlled separately.</td><td>Obtain kernel predefined events.</td></tr><tr><td><a href=https://learn.microsoft.com/en-us/windows/win32/etw/configuring-and-starting-an-autologger-session>AutoLogger Session</a></td><td>1. Edit the registry<br>2. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-enabletraceex>EnableTraceEx</a><br>3. <a href=https://learn.microsoft.com/en-us/windows/win32/api/evntrace/nf-evntrace-controltracea>ControlTrace</a> to stop the session</td><td>- The <strong><a href=https://learn.microsoft.com/en-us/windows/win32/etw/configuring-and-starting-the-global-logger-session>Global Logger Session</a></strong> is a special, standalone session that records events during system boot.<br>- Ordinary AutoLogger sessions must explicitly enable providers; Global Logger does not.<br>- AutoLogger does not support NT Kernel Logger events; only Global Logger does.<br>- Impacts boot time—use sparingly.</td><td>Record OS boot-time events.</td></tr><tr><td><a href=https://learn.microsoft.com/en-us/windows/win32/etw/configuring-and-starting-a-private-logger-session>Private Logger Session</a></td><td>—</td><td>- User-mode ETW<br>- Used only within a process<br>- Not counted toward the 64-session concurrency limit.</td><td>Per-process only.</td></tr></tbody></table><h2 id=tools>Tools</h2><ul><li><a href=https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/logman>logman</a></li><li><a href=https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/wevtutil>wevtutil</a><ul><li>XPath query example: <code>wevtutil qe Security /c:2 /q:"*[System[EventID=5157]]" /f:text</code></li></ul></li><li><a href=https://learn.microsoft.com/en-us/windows-hardware/drivers/devtest/tracelog>tracelog</a><ul><li>To use the Visual Studio <code>tracelog</code> tool, you can dynamically add and remove ETW Providers and ETW Sessions at runtime.</li></ul></li><li><a href=https://learn.microsoft.com/en-us/windows/win32/wes/message-compiler--mc-exe->mc</a></li><li><a href=https://github.com/repnz/etw-providers-docs>etw-providers-docs</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-a3673aba36ec41cb0458b4256f8be612>wireguard configuration</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> wireguard configuration</li></ul><h1 id=wireguard-configuration>wireguard Configuration</h1><h2 id=firewall-configuration>Firewall Configuration</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>wireguard</span> <span class=p>/</span><span class=n>installtunnelservice</span> <span class=p>&lt;</span><span class=n>wg_conf_path</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>wg</span> <span class=n>show</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetConnectionProfile</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetAdapter</span>
</span></span><span class=line><span class=cl><span class=nb>Get-NetFirewallProfile</span>
</span></span><span class=line><span class=cl><span class=nb>Set-NetFirewallProfile</span> <span class=n>-Profile</span> <span class=n>domain</span><span class=p>,</span><span class=n>public</span><span class=p>,</span><span class=n>private</span> <span class=n>-DisabledInterfaceAliases</span> <span class=p>&lt;</span><span class=n>wg_config_name</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nb>Set-NetIPInterface</span> <span class=n>-ifindex</span> <span class=p>&lt;</span><span class=n>interface</span> <span class=n>index</span><span class=p>&gt;</span> <span class=n>-Forwarding</span> <span class=n>Enabled</span>
</span></span><span class=line><span class=cl><span class=nb>New-NetFirewallRule</span> <span class=n>-DisplayName</span> <span class=s2>&#34;@wg1&#34;</span> <span class=n>-Direction</span> <span class=n>Inbound</span>  <span class=n>-RemoteAddress</span> <span class=mf>10.66</span><span class=p>.</span><span class=py>66</span><span class=p>.</span><span class=mf>1</span><span class=p>/</span><span class=mf>24</span> <span class=n>-Action</span> <span class=n>Allow</span>
</span></span><span class=line><span class=cl><span class=nb>New-NetFirewallRule</span> <span class=n>-DisplayName</span> <span class=s2>&#34;@wg1&#34;</span> <span class=n>-Direction</span> <span class=n>Outbound</span> <span class=n>-RemoteAddress</span> <span class=mf>10.66</span><span class=p>.</span><span class=py>66</span><span class=p>.</span><span class=mf>1</span><span class=p>/</span><span class=mf>24</span> <span class=n>-Action</span> <span class=n>Allow</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=c># Locate the blocking cause</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=nb>set </span><span class=p>/</span><span class=n>subcategory</span><span class=err>:</span><span class=s2>&#34;{0CCE9225-69AE-11D9-BED3-505054503030}&#34;</span> <span class=p>/</span><span class=n>success</span><span class=err>:</span><span class=n>disable</span> <span class=p>/</span><span class=n>failure</span><span class=err>:</span><span class=n>enable</span>
</span></span><span class=line><span class=cl><span class=n>wevtutil</span> <span class=n>qe</span> <span class=n>Security</span> <span class=p>/</span><span class=n>q:</span><span class=s2>&#34;*[System/EventID=5152]&#34;</span> <span class=p>/</span><span class=n>c:</span><span class=mf>5</span> <span class=p>/</span><span class=n>rd</span><span class=err>:</span><span class=n>true</span> <span class=p>/</span><span class=n>f:text</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=nb>set </span><span class=p>/</span><span class=n>subcategory</span><span class=err>:</span><span class=s2>&#34;{0CCE9225-69AE-11D9-BED3-505054503030}&#34;</span> <span class=p>/</span><span class=n>success</span><span class=err>:</span><span class=n>disable</span> <span class=p>/</span><span class=n>failure</span><span class=err>:</span><span class=n>disable</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-7b6314989d253d9fadbc558b8fb75b3d>Windows Blocking Network Traffic Capture</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Windows Blocking Network Traffic Capture</li></ul><h1 id=windows-blocking-network-traffic-capture>Windows Blocking Network Traffic Capture</h1><ul><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-windows-blocking-network-traffic-capture->Windows Blocking Network Traffic Capture</a><ul><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-setting-up-a-test-project->Setting Up a Test Project</a></li><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-capturing-block-events-via-auditing->Capturing Block Events via Auditing</a><ul><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-obtaining-provider-information->Obtaining Provider Information</a></li><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-triggering-a-block-event->Triggering a Block Event</a></li></ul></li><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-monitoring-network-eventsnet_event->Monitoring Network Events (NET_EVENT)</a></li><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-monitoring-network-connectionsnetconnection->Monitoring Network Connections (NetConnection)</a></li><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-application-layer-enforcementale-introduction->Application Layer Enforcement (ALE) Introduction</a></li><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-coding->Coding</a></li><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-conclusion->Conclusion</a></li><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-appendix->Appendix</a><ul><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-wfp-architecture->WFP Architecture</a></li><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-data-flow->Data Flow</a></li><li><a href=/en-us/blog/2024/06/28/windows-blocking-network-traffic-capture/#-reference-links->Reference Links</a></li></ul></li></ul></li></ul><ul><li>Need to identify blocked traffic, including outbound and inbound.</li><li>Two ways of blocking: by connection or by packet. Packet drops occur frequently and the reason must be audited; connection‐oriented blocks align better with real-world monitoring.</li><li>Many normally processed packets may also be dropped, so we must distinguish drops from actual blocks—we focus on blocks.</li></ul><h2 id=setting-up-a-test-project>Setting Up a Test Project</h2><p>WFP mainly runs in user mode and partly in kernel mode, exposed as drivers. The test setup is complex.<br>Recommended: run a separate physical machine for testing, compile on the dev box, then copy and remotely debug on the test machine.<br>For those with limited resources, local debugging on the same machine is also possible.</p><ul><li><a href=https://github.com/microsoft/Windows-driver-samples>Microsoft WFP Sample Project</a><ul><li>Focus only on: Windows-driver-samples\network\trans\WFPSampler</li></ul></li><li><a href=https://docs.microsoft.com/zh-cn/samples/microsoft/windows-driver-samples/windows-filtering-platform-sample/>WFPSampler Guide</a></li></ul><p>Build Issues:</p><ul><li><a href=https://github.com/microsoft/Windows-driver-samples/pull/538>Missing api-ms-win-net-isolation-l1-1-0</a></li><li><a href=https://stackoverflow.com/questions/44837612/wfpsampler-compilation-issue-wfpcalloutsclassreg-not-found>wfpcalloutsclassreg-not-found</a></li></ul><p>Other Issues:</p><ul><li><a href=https://answers.microsoft.com/en-us/protect/forum/all/your-organization-used-windows-defender/ef12b7be-41f5-4b71-a73c-e4f99ba944f7>Driver Does Not Run</a></li><li><a href=https://stackoverflow.com/questions/84847/how-do-i-create-a-self-signed-certificate-for-code-signing-on-windows>How to Sign</a></li><li><a href=https://docs.microsoft.com/zh-cn/windows-hardware/drivers/develop/preparing-a-computer-for-manual-driver-deployment>Preparing a Target Machine for Manual Driver Deployment</a></li></ul><h2 id=capturing-block-events-via-auditing>Capturing Block Events via Auditing</h2><ul><li><a href=https://docs.microsoft.com/en-us/windows/win32/fwp/auditing-and-logging>Auditing Docs</a></li><li><a href=https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/auditpol>auditpol Docs</a></li></ul><p>By default, auditing for WFP is off.</p><ul><li>Audit can be enabled by category (via Group Policy Object Editor MMC, Local Security Policy MMC, or auditpol.exe).</li><li>Audit can also be enabled by subcategory with auditpol.exe.</li><li>Always use GUIDs—otherwise localized display strings break cross-language systems.</li><li>Audit uses circular logs of 128 KB—low resource impact.</li></ul><p>Categories <a href=https://docs.microsoft.com/en-us/windows/win32/secauthz/auditing-constants>https://docs.microsoft.com/en-us/windows/win32/secauthz/auditing-constants</a></p><table><thead><tr><th>Category/Subcategory</th><th>GUID</th></tr></thead><tbody><tr><td>&mldr;</td><td>&mldr;</td></tr><tr><td><strong>Object Access</strong></td><td>{6997984A-797A-11D9-BED3-505054503030}</td></tr><tr><td><strong>Policy Change</strong></td><td>{6997984D-797A-11D9-BED3-505054503030}</td></tr><tr><td>&mldr;</td><td>&mldr;</td></tr></tbody></table><p><strong>Object Access</strong> subcategories and their GUIDs <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-gpac/77878370-0712-47cd-997d-b07053429f6d>https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-gpac/77878370-0712-47cd-997d-b07053429f6d</a></p><table><thead><tr><th>Object Access Subcategory</th><th>Subcategory GUID</th><th>Inclusion Setting</th></tr></thead><tbody><tr><td>&mldr;</td><td>&mldr;</td><td>&mldr;</td></tr><tr><td><strong>Filtering Platform Packet Drop</strong></td><td>{0CCE9225-69AE-11D9-BED3-505054503030}</td><td>No Auditing</td></tr><tr><td><strong>Filtering Platform Connection</strong></td><td>{0CCE9226-69AE-11D9-BED3-505054503030}</td><td>No Auditing</td></tr><tr><td><strong>Other Object Access Events</strong></td><td>{0CCE9227-69AE-11D9-BED3-505054503030}</td><td>No Auditing</td></tr><tr><td>&mldr;</td><td>&mldr;</td><td>&mldr;</td></tr></tbody></table><p><strong>Policy Change</strong> subcategories and GUIDs:</p><table><thead><tr><th>Policy Change Subcategory</th><th>Subcategory GUID</th></tr></thead><tbody><tr><td><strong>Audit Policy Change</strong></td><td>{0CCE922F-69AE-11D9-BED3-505054503030}</td></tr><tr><td>Authentication Policy Change</td><td>{0CCE9230-69AE-11D9-BED3-505054503030}</td></tr><tr><td>Authorization Policy Change</td><td>{0CCE9231-69AE-11D9-BED3-505054503030}</td></tr><tr><td>MPSSVC Rule-Level Policy Change</td><td>{0CCE9232-69AE-11D9-BED3-505054503030}</td></tr><tr><td><strong>Filtering Platform Policy Change</strong></td><td>{0CCE9233-69AE-11D9-BED3-505054503030}</td></tr><tr><td>Other Policy Change Events</td><td>{0CCE9234-69AE-11D9-BED3-505054503030}</td></tr></tbody></table><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># auditpol reference: https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/auditpol</span>
</span></span><span class=line><span class=cl><span class=c># This section focuses on the &#39;Object Access&#39; category</span>
</span></span><span class=line><span class=cl><span class=c># List available fields</span>
</span></span><span class=line><span class=cl><span class=c># -v shows GUID, -r produces CSV report</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>list</span> <span class=p>/</span><span class=n>category</span> <span class=p>/</span><span class=n>v</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>list</span> <span class=p>/</span><span class=n>subcategory</span><span class=err>:</span><span class=p>*</span> <span class=p>/</span><span class=n>v</span>
</span></span><span class=line><span class=cl><span class=c># Get audit settings for a subcategory</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>get</span> <span class=p>/</span><span class=n>category</span><span class=err>:</span><span class=s1>&#39;Object Access&#39;</span> <span class=p>/</span><span class=nb>r </span><span class=p>|</span> <span class=nb>ConvertFrom-Csv</span> <span class=p>|</span> <span class=nb>Get-Member</span>
</span></span><span class=line><span class=cl><span class=c># Query subcategory GUID</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>get</span> <span class=p>/</span><span class=n>category</span><span class=err>:</span><span class=s1>&#39;Object Access&#39;</span> <span class=p>/</span><span class=nb>r </span><span class=p>|</span> <span class=nb>ConvertFrom-Csv</span> <span class=p>|</span> <span class=nb>Format-Table</span> <span class=n>Subcategory</span><span class=p>,</span><span class=s1>&#39;Subcategory GUID&#39;</span><span class=p>,</span><span class=s1>&#39;Inclusion Setting&#39;</span>
</span></span><span class=line><span class=cl><span class=c># Lookup subcategory</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>list</span> <span class=p>/</span><span class=n>subcategory</span><span class=err>:</span><span class=s2>&#34;Object Access&#34;</span><span class=p>,</span><span class=s2>&#34;Policy Change&#34;</span> <span class=n>-v</span>
</span></span><span class=line><span class=cl><span class=c># Backup</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>backup</span> <span class=p>/</span><span class=n>file</span><span class=err>:</span><span class=n>d:</span><span class=p>\</span><span class=n>audit</span><span class=p>.</span><span class=py>bak</span>
</span></span><span class=line><span class=cl><span class=c># Restore</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>restore</span> <span class=p>/</span><span class=n>file</span><span class=err>:</span><span class=n>d:</span><span class=p>\</span><span class=n>audit</span><span class=p>.</span><span class=py>bak</span>
</span></span><span class=line><span class=cl><span class=c># Modify Policy</span>
</span></span><span class=line><span class=cl><span class=c># **Policy Change**    | {6997984D-797A-11D9-BED3-505054503030}</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=nb>set </span><span class=p>/</span><span class=n>category</span><span class=err>:</span><span class=s2>&#34;{6997984D-797A-11D9-BED3-505054503030}&#34;</span> <span class=p>/</span><span class=n>success</span><span class=err>:</span><span class=n>disable</span> <span class=p>/</span><span class=n>failure</span><span class=err>:</span><span class=n>disable</span>
</span></span><span class=line><span class=cl><span class=c># Filtering Platform Policy Change | {0CCE9233-69AE-11D9-BED3-505054503030}</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=nb>set </span><span class=p>/</span><span class=n>subcategory</span><span class=err>:</span><span class=s2>&#34;{0CCE9233-69AE-11D9-BED3-505054503030}&#34;</span> <span class=p>/</span><span class=n>success</span><span class=err>:</span><span class=n>enable</span> <span class=p>/</span><span class=n>failure</span><span class=err>:</span><span class=n>enable</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># **Object Access**    | {6997984A-797A-11D9-BED3-505054503030}</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=n>get</span> <span class=p>/</span><span class=n>category</span><span class=err>:</span><span class=s2>&#34;{6997984A-797A-11D9-BED3-505054503030}&#34;</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=nb>set </span><span class=p>/</span><span class=n>category</span><span class=err>:</span><span class=s2>&#34;{6997984A-797A-11D9-BED3-505054503030}&#34;</span> <span class=p>/</span><span class=n>success</span><span class=err>:</span><span class=n>disable</span> <span class=p>/</span><span class=n>failure</span><span class=err>:</span><span class=n>disable</span>
</span></span><span class=line><span class=cl><span class=c># Filtering Platform Packet Drop | {0CCE9225-69AE-11D9-BED3-505054503030}</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=nb>set </span><span class=p>/</span><span class=n>subcategory</span><span class=err>:</span><span class=s2>&#34;{0CCE9225-69AE-11D9-BED3-505054503030}&#34;</span> <span class=p>/</span><span class=n>success</span><span class=err>:</span><span class=n>disable</span> <span class=p>/</span><span class=n>failure</span><span class=err>:</span><span class=n>enable</span>
</span></span><span class=line><span class=cl><span class=c># Filtering Platform Connection  | {0CCE9226-69AE-11D9-BED3-505054503030}</span>
</span></span><span class=line><span class=cl><span class=n>auditpol</span> <span class=p>/</span><span class=nb>set </span><span class=p>/</span><span class=n>subcategory</span><span class=err>:</span><span class=s2>&#34;{0CCE9226-69AE-11D9-BED3-505054503030}&#34;</span> <span class=p>/</span><span class=n>success</span><span class=err>:</span><span class=n>disable</span> <span class=p>/</span><span class=n>failure</span><span class=err>:</span><span class=n>enable</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># Read audit logs</span>
</span></span><span class=line><span class=cl><span class=nv>$Events</span> <span class=p>=</span> <span class=nb>Get-WinEvent</span> <span class=n>-LogName</span> <span class=s1>&#39;Security&#39;</span>
</span></span><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=nv>$event</span> <span class=k>in</span> <span class=nv>$Events</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>ForEach</span> <span class=p>(</span><span class=nv>$line</span> <span class=k>in</span> <span class=vm>$</span><span class=p>(</span><span class=nv>$event</span><span class=p>.</span><span class=py>Message</span> <span class=n>-split</span> <span class=s2>&#34;</span><span class=se>`r`n</span><span class=s2>&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>Write-Host</span> <span class=nv>$event</span><span class=p>.</span><span class=py>RecordId</span> <span class=s1>&#39;:&#39;</span> <span class=nv>$Line</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Event Details:</p><table><thead><tr><th>Event ID</th><th>Explanation</th></tr></thead><tbody><tr><td>5031(F)</td><td>The Windows Firewall Service <strong>blocked</strong> an application from accepting incoming connections on the network.</td></tr><tr><td>5150(-)</td><td>The Windows Filtering Platform <strong>blocked</strong> a <strong>packet</strong>.</td></tr><tr><td>5151(-)</td><td>A more restrictive Windows Filtering Platform filter has <strong>blocked</strong> a <strong>packet</strong>.</td></tr><tr><td>5152(F)</td><td>The Windows Filtering Platform <strong>blocked</strong> a <strong>packet</strong>.</td></tr><tr><td>5153(S)</td><td>A more restrictive Windows Filtering Platform filter has <strong>blocked</strong> a <strong>packet</strong>.</td></tr><tr><td>5154(S)</td><td>The Windows Filtering Platform has permitted an application or service to listen on a port for incoming connections.</td></tr><tr><td>5155(F)</td><td>The Windows Filtering Platform has <strong>blocked</strong> an application or service from listening on a port for incoming connections.</td></tr><tr><td>5156(S)</td><td>The Windows Filtering Platform has permitted a connection.</td></tr><tr><td><strong>5157(F)</strong></td><td>The Windows Filtering Platform has <strong>blocked</strong> a connection.</td></tr><tr><td>5158(S)</td><td>The Windows Filtering Platform has permitted a bind to a local port.</td></tr><tr><td>5159(F)</td><td>The Windows Filtering Platform has <strong>blocked</strong> a bind to a local port.</td></tr></tbody></table><p>Events to Focus On:</p><ul><li><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/audit-filtering-platform-packet-drop>Audit Filtering Platform Packet Drop</a><ul><li><p>These events generate huge volumes; focus on <strong>5157</strong>, which records almost the same data but per-connection rather than per-packet.</p></li><li><p>Failure volume is typically very high for this subcategory and mainly useful for troubleshooting. To monitor blocked connections, <strong>5157(F): The Windows Filtering Platform has blocked a connection</strong> is recommended since it contains nearly identical information and generates per-connection instead of per-packet.
<img src=https://s2.loli.net/2023/05/06/gaoLAnlNu1QT3zf.png alt="recommend 5157"></p></li><li><p><del><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5152>5152</a></del></p></li><li><p><del><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5153>5153</a></del></p></li></ul></li><li><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/audit-filtering-platform-connection>Audit Filtering Platform Connection</a><ul><li>It is best to monitor only failure events such as blocked connections; track allowed connections only when necessary.</li><li><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5031>5031</a><ul><li>If there are no firewall rules (Allow or Deny) for a specific application in Windows Firewall, traffic will be dropped at the WFP layer, which by default denies all inbound connections.</li></ul></li><li><del><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5150>5150</a></del></li><li><del><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5151>5151</a></del></li><li><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5155>5155</a></li><li><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5157>5157</a></li><li><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5159>5159</a></li></ul></li></ul><h3 id=obtaining-provider-information>Obtaining Provider Information</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># List security-related providers</span>
</span></span><span class=line><span class=cl><span class=nb>Get-WinEvent</span> <span class=n>-ListProvider</span> <span class=s2>&#34;*Security*&#34;</span> <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>ProviderName</span><span class=p>,</span><span class=n>Id</span>
</span></span><span class=line><span class=cl><span class=c># Microsoft-Windows-Security-Auditing                             54849625-5478-4994-a5ba-3e3b0328c30d</span>
</span></span><span class=line><span class=cl><span class=c># Show tasks for a provider</span>
</span></span><span class=line><span class=cl><span class=nb>Get-WinEvent</span> <span class=n>-ListProvider</span> <span class=s2>&#34;Microsoft-Windows-Security-Auditing&#34;</span> <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>-ExpandProperty</span> <span class=n>tasks</span>
</span></span><span class=line><span class=cl><span class=c># SE_ADT_OBJECTACCESS_FIREWALLCONNECTION       12810 Filtering Platform Connection          00000000-0000-0000-0000-000000000000</span>
</span></span></code></pre></div><table><thead><tr><th>ProviderName</th><th>Id</th></tr></thead><tbody><tr><td>Security Account Manager</td><td>00000000-0000-0000-0000-000000000000</td></tr><tr><td>Security</td><td>00000000-0000-0000-0000-000000000000</td></tr><tr><td>SecurityCenter</td><td>00000000-0000-0000-0000-000000000000</td></tr><tr><td>Microsoft-Windows-Security-SPP-UX-GenuineCenter-Logging</td><td>fb829150-cd7d-44c3-af5b-711a3c31cedc</td></tr><tr><td>Microsoft-Windows-Security-Mitigations</td><td>fae10392-f0af-4ac0-b8ff-9f4d920c3cdf</td></tr><tr><td>Microsoft-Windows-VerifyHardwareSecurity</td><td>f3f53c76-b06d-4f15-b412-61164a0d2b73</td></tr><tr><td>Microsoft-Windows-SecurityMitigationsBroker</td><td>ea8cd8a5-78ff-4418-b292-aadc6a7181df</td></tr><tr><td>Microsoft-Windows-Security-Adminless</td><td>ea216962-877b-5b73-f7c5-8aef5375959e</td></tr><tr><td>Microsoft-Windows-Security-Vault</td><td>e6c92fb8-89d7-4d1f-be46-d56e59804783</td></tr><tr><td>Microsoft-Windows-Security-Netlogon</td><td>e5ba83f6-07d0-46b1-8bc7-7e669a1d31dc</td></tr><tr><td>Microsoft-Windows-Security-SPP</td><td>e23b33b0-c8c9-472c-a5f9-f2bdfea0f156</td></tr><tr><td>Microsoft-Windows-Windows Firewall With Advanced Security</td><td>d1bc9aff-2abf-4d71-9146-ecb2a986eb85</td></tr><tr><td>Microsoft-Windows-Security-SPP-UX-Notifications</td><td>c4efc9bb-2570-4821-8923-1bad317d2d4b</td></tr><tr><td>Microsoft-Windows-Security-SPP-UX-GC</td><td>bbbdd6a3-f35e-449b-a471-4d830c8eda1f</td></tr><tr><td>Microsoft-Windows-Security-Kerberos</td><td>98e6cfcb-ee0a-41e0-a57b-622d4e1b30b1</td></tr><tr><td>Microsoft-Windows-Security-ExchangeActiveSyncProvisioning</td><td>9249d0d0-f034-402f-a29b-92fa8853d9f3</td></tr><tr><td>Microsoft-Windows-NetworkSecurity</td><td>7b702970-90bc-4584-8b20-c0799086ee5a</td></tr><tr><td>Microsoft-Windows-Security-SPP-UX</td><td>6bdadc96-673e-468c-9f5b-f382f95b2832</td></tr><tr><td>Microsoft-Windows-Security-Auditing</td><td>54849625-5478-4994-a5ba-3e3b0328c30d</td></tr><tr><td>Microsoft-Windows-Security-LessPrivilegedAppContainer</td><td>45eec9e5-4a1b-5446-7ad8-a4ab1313c437</td></tr><tr><td>Microsoft-Windows-Security-UserConsentVerifier</td><td>40783728-8921-45d0-b231-919037b4b4fd</td></tr><tr><td>Microsoft-Windows-Security-IdentityListener</td><td>3c6c422b-019b-4f48-b67b-f79a3fa8b4ed</td></tr><tr><td>Microsoft-Windows-Security-EnterpriseData-FileRevocationManager</td><td>2cd58181-0bb6-463e-828a-056ff837f966</td></tr><tr><td>Microsoft-Windows-Security-Audit-Configuration-Client</td><td>08466062-aed4-4834-8b04-cddb414504e5</td></tr><tr><td>Microsoft-Windows-Security-IdentityStore</td><td>00b7e1df-b469-4c69-9c41-53a6576e3dad</td></tr></tbody></table><h3 id=triggering-a-block-event>Triggering a Block Event</h3><p><strong>Warning: Creating block filters affects other software on the host!</strong><br>You can immediately clean up with <code>.\WFPSampler.exe -clean</code>.</p><p>Steps:</p><ol><li><p>Enable auditing for Filtering Platform Connection:<br><code>auditpol /set /subcategory:"{0CCE9226-69AE-11D9-BED3-505054503030}" /success:enable /failure:enable</code></p></li><li><p>Open Event Viewer, create a Custom View/filter for IDs <strong>5155, 5157, 5159</strong>.
<img src=https://s2.loli.net/2023/05/06/TjfMkws8pu4NZRW.png alt="filter example"></p></li><li><p>Add a WFP filter using <strong>WFPSampler.exe</strong> to block listening on <strong>port 80</strong>:<br><code>.\WFPSampler.exe -s BASIC_ACTION_BLOCK -l FWPM_LAYER_ALE_AUTH_LISTEN_V4 -iplp 80</code></p></li><li><p>Run a third-party (non-IIS) HTTP server—here we use nginx on port 80. Starting it triggers event 5155.
<img src=https://s2.loli.net/2023/05/06/V6vlyFZ4bQa5G9Y.png alt="audit event demo"></p></li><li><p>Clean up the filter:<br><code>.\WFPSampler.exe -clean</code></p></li><li><p>Disable auditing:<br><code>auditpol /set /category:"{0CCE9226-69AE-11D9-BED3-505054503030}" /success:disable /failure:disable</code></p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># 5155: an application or service was blocked from listening on a port</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>WFPSampler</span><span class=p>.</span><span class=py>exe</span> <span class=n>-s</span> <span class=n>BASIC_ACTION_BLOCK</span> <span class=n>-l</span> <span class=n>FWPM_LAYER_ALE_AUTH_LISTEN_V4</span>
</span></span><span class=line><span class=cl><span class=c># 5157: a connection was blocked</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>WFPSampler</span><span class=p>.</span><span class=py>exe</span> <span class=n>-s</span> <span class=n>BASIC_ACTION_BLOCK</span> <span class=n>-l</span> <span class=n>FWPM_LAYER_ALE_AUTH_RECV_ACCEPT_V4</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>WFPSampler</span><span class=p>.</span><span class=py>exe</span> <span class=n>-s</span> <span class=n>BASIC_ACTION_BLOCK</span> <span class=n>-l</span> <span class=n>FWPM_LAYER_ALE_AUTH_CONNECT_V4</span>
</span></span><span class=line><span class=cl><span class=c># 5159: binding to a local port was blocked</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>WFPSampler</span><span class=p>.</span><span class=py>exe</span> <span class=n>-s</span> <span class=n>BASIC_ACTION_BLOCK</span> <span class=n>-l</span> <span class=n>FWPM_LAYER_ALE_RESOURCE_ASSIGNMENT_V4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Other</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>WFPSampler</span><span class=p>.</span><span class=py>exe</span> <span class=n>-s</span> <span class=n>BASIC_ACTION_BLOCK</span> <span class=n>-l</span> <span class=n>FWPM_LAYER_ALE_RESOURCE_ASSIGNMENT_V4_DISCARD</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>WFPSampler</span><span class=p>.</span><span class=py>exe</span> <span class=n>-s</span> <span class=n>BASIC_ACTION_BLOCK</span> <span class=n>-l</span> <span class=n>FWPM_LAYER_ALE_AUTH_RECV_ACCEPT_V4_DISCARD</span>
</span></span><span class=line><span class=cl><span class=p>.\</span><span class=n>WFPSampler</span><span class=p>.</span><span class=py>exe</span> <span class=n>-s</span> <span class=n>BASIC_ACTION_BLOCK</span> <span class=n>-l</span> <span class=n>FWPM_LAYER_ALE_AUTH_CONNECT_V4_DISCARD</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># List a WFP filter by ID:</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>wfp</span> <span class=n>show</span> <span class=kd>filter</span><span class=nb>s</span>
</span></span><span class=line><span class=cl><span class=c># Get layer IDs:</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>wfp</span> <span class=n>show</span> <span class=n>state</span>
</span></span></code></pre></div><h2 id=monitoring-network-events-net_event>Monitoring Network Events (NET_EVENT)</h2><ul><li>Events support both enumeration and subscription.</li><li>Enumeration allows filter criteria, querying events within a time window.</li><li>Subscriptions inject a callback to deliver events in real time.</li></ul><p>Supported event types:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>typedef</span> <span class=k>enum</span> <span class=n>FWPM_NET_EVENT_TYPE_</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_IKEEXT_MM_FAILURE</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_IKEEXT_QM_FAILURE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_IKEEXT_EM_FAILURE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_CLASSIFY_DROP</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_IPSEC_KERNEL_DROP</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_IPSEC_DOSP_DROP</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_CLASSIFY_ALLOW</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_CAPABILITY_DROP</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_CAPABILITY_ALLOW</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_CLASSIFY_DROP_MAC</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_LPM_PACKET_ARRIVAL</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>FWPM_NET_EVENT_TYPE_MAX</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=n>FWPM_NET_EVENT_TYPE</span><span class=p>;</span>
</span></span></code></pre></div><p>Enumeration filter fields (FWPM_NET_EVENT_ENUM_TEMPLATE):</p><table><thead><tr><th>Value</th><th>Meaning</th></tr></thead><tbody><tr><td>FWPM_CONDITION_IP_PROTOCOL</td><td>The IP protocol number, as specified in RFC 1700.</td></tr><tr><td>FWPM_CONDITION_IP_LOCAL_ADDRESS</td><td>The local IP address.</td></tr><tr><td>FWPM_CONDITION_IP_REMOTE_ADDRESS</td><td>The remote IP address.</td></tr><tr><td>FWPM_CONDITION_IP_LOCAL_PORT</td><td>The local transport protocol port number. For ICMP, the message type.</td></tr><tr><td>FWPM_CONDITION_IP_REMOTE_PORT</td><td>The remote transport protocol port number. For ICMP, the message code.</td></tr><tr><td>FWPM_CONDITION_SCOPE_ID</td><td>The interface IPv6 scope identifier. Reserved for internal use.</td></tr><tr><td>FWPM_CONDITION_ALE_APP_ID</td><td>The full path of the application.</td></tr><tr><td>FWPM_CONDITION_ALE_USER_ID</td><td>The identification of the local user.</td></tr></tbody></table><p>Outside of drivers, only basic drop events are returned.</p><h2 id=monitoring-network-connections-netconnection>Monitoring Network Connections (NetConnection)</h2><p>Compared to monitoring network events, monitoring connections requires higher privileges.<br><a href=https://docs.microsoft.com/en-us/windows/win32/api/fwpmu/nf-fwpmu-fwpmconnectionsubscribe0>callback approach</a></p><blockquote><p>The caller needs FWPM_ACTRL_ENUM access to the connection objects&rsquo; containers and FWPM_ACTRL_READ access to the connection objects. See Access Control for more information.</p></blockquote><p><strong>Monitoring network connections has not yet succeeded.</strong></p><p>I found a similar issue: <a href=https://stackoverflow.com/questions/63038046/receiving-in-out-traffic-stats-using-wfp-user-mode-api>Receiving in/out traffic stats using WFP user-mode API</a>. It matches the behavior I observed—none of the subscribing functions receive any notifications, giving no events and no errors. Neither enabling auditing nor elevating privileges helped. Some noted that non-kernel mode can only receive drop events, which is insufficient for obtaining block events.</p><p>Example of adding a security descriptor: <a href=https://docs.microsoft.com/en-us/windows/win32/fwp/reserving-ports>https://docs.microsoft.com/en-us/windows/win32/fwp/reserving-ports</a></p><h2 id=application-layer-enforcement-ale-introduction>Application Layer Enforcement (ALE) Introduction</h2><ul><li>ALE comprises a set of kernel-mode filters that support stateful filtering.</li><li>Filters at the ALE layer can authorize connection creation, port allocation, socket management, raw socket creation, and promiscuous-mode reception.</li><li>Classification of ALE-layer filters is based on the <strong>connection</strong> or <strong>socket</strong>; filters in other layers can only classify based on individual <strong>packets</strong>.</li><li>ALE filter reference: <a href=https://docs.microsoft.com/en-us/windows/win32/fwp/ale-layers>ale-layers</a><ul><li>More filter reference: <a href=https://docs.microsoft.com/en-us/windows/win32/fwp/management-filtering-layer-identifiers->filtering-layer-identifiers</a></li></ul></li></ul><h2 id=coding-notes>Coding Notes</h2><p>Most WFP functions can be invoked from either user mode or kernel mode. However, user-mode functions return a <strong>DWORD</strong> representing a Win32 error code, whereas kernel-mode functions return an <strong>NTSTATUS</strong> representing an NT status code.<br>Therefore, functions share the same names and semantics across modes but have differing signatures. Separate user-mode and kernel-mode headers are required: user-mode header file names end with “<strong>u</strong>”, and kernel-mode ones end with “<strong>k</strong>”.</p><h2 id=conclusion>Conclusion</h2><p>Our requirement is merely to know when events occur; real-time handling is unnecessary, and developing a kernel driver would introduce greater risk. Consequently, we’ll rely on <strong>event auditing</strong> and monitor <strong>event log generation</strong> to acquire block events.<br>A dedicated thread will use <a href=https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-notifychangeeventlog>NotifyChangeEventLog</a> to watch for new log records.</p><h2 id=appendix>Appendix</h2><h3 id=wfp-architecture>WFP Architecture</h3><p>WFP (Windows Filter Platform) <img src=https://docs.microsoft.com/en-us/windows/win32/fwp/images/wfp-architecture.png alt="Basic Architecture of the Windows Filtering Platform"></p><h3 id=data-flow>Data Flow</h3><p>Data flow:</p><ol><li>A packet enters the network stack.</li><li>The network stack finds and invokes a shim.</li><li>The shim initiates classification at a particular layer.</li><li>During classification, filters are matched, and the resulting action is applied. (See Filter Arbitration.)</li><li>If any callout filters match, their corresponding callouts are invoked.</li><li>The shim enforces the final filtering decision (e.g., drop the packet).</li></ol><h3 id=reference-links>Reference Links</h3><ul><li><a href=https://docs.microsoft.com/en-us/windows/win32/fwp/management-filtering-layer-identifiers->Filter types</a></li><li><a href=https://docs.microsoft.com/en-us/windows/win32/fwp/filtering-conditions-available-at-each-filtering-layer>Available filtering conditions per layer</a></li><li><a href=https://docs.microsoft.com/en-us/windows/win32/debug/system-error-codes--0-499->System error codes</a></li><li><a href=https://docs.microsoft.com/en-us/windows/win32/fwp/wfp-error-codes>WFP error codes</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-a7f54bb02ebc7bbb8cc0b4a2de5f0784>Windows Firewall Management – netsh</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Windows Firewall Management – netsh</li></ul><h1 id=windows-firewall-management--netsh>Windows Firewall Management – netsh</h1><h2 id=management-tools>Management Tools</h2><h2 id=netsh-advfirewall>netsh advfirewall</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># Export firewall rules</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=n>export</span> <span class=n>advfirewallpolicy</span><span class=p>.</span><span class=py>wfw</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Import firewall rules</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=n>import</span> <span class=n>advfirewallpolicy</span><span class=p>.</span><span class=py>wfw</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># View firewall state</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=n>show</span> <span class=n>allprofiles</span> <span class=n>state</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># View firewall default policy</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=n>show</span> <span class=n>allprofiles</span> <span class=n>firewallpolicy</span>
</span></span><span class=line><span class=cl><span class=c># netsh advfirewall set allprofiles firewallpolicy blockinbound,allowoutbound</span>
</span></span><span class=line><span class=cl><span class=c># netsh advfirewall set allprofiles firewallpolicy blockinbound,blockoutbound</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># View firewall settings</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=n>show</span> <span class=n>allprofiles</span> <span class=n>settings</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Enable firewall</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=nb>set </span><span class=n>allprofiles</span> <span class=n>state</span> <span class=n>on</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Disable firewall</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=nb>set </span><span class=n>allprofiles</span> <span class=n>state</span> <span class=n>off</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Display firewall rules</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=n>firewall</span> <span class=n>show</span> <span class=n>rule</span> <span class=n>name</span><span class=p>=</span><span class=n>all</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># View firewall status</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>advfirewall</span> <span class=n>monitor</span> <span class=n>show</span> <span class=n>firewall</span>
</span></span></code></pre></div><h2 id=netsh-firewall-deprecated>netsh firewall (deprecated)</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># Display firewall state</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>firewall</span> <span class=n>show</span> <span class=n>state</span>
</span></span></code></pre></div><h2 id=netsh-mbn-mobile-broadband-network>netsh mbn (Mobile Broadband network)</h2><h2 id=netsh-wfp>netsh wfp</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># Display firewall state</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>wfp</span> <span class=n>show</span> <span class=n>state</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Display firewall filters</span>
</span></span><span class=line><span class=cl><span class=n>netsh</span> <span class=n>wfp</span> <span class=n>show</span> <span class=kd>filter</span><span class=nb>s</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-7154e5da447955abfe28de976ea980e6>Windows Resources</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Windows Resources</li></ul><h1 id=windows-resources-collection>Windows Resources Collection</h1><ul><li><a href=/en-us/blog/2024/06/28/windows-resources/#windows-resources-collection>Windows Resources Collection</a><ul><li><a href=/en-us/blog/2024/06/28/windows-resources/#tools>Tools</a><ul><li><a href=/en-us/blog/2024/06/28/windows-resources/#monitoring--analysis>Monitoring & Analysis</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#antirootkit-tools>AntiRootkit Tools</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#pe-tools>PE Tools</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#reverse--debug>Reverse & Debug</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#injection-tools>Injection Tools</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#network>Network</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#stress-testing-tools>Stress Testing Tools</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#others>Others</a></li></ul></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#code>Code</a><ul><li><a href=/en-us/blog/2024/06/28/windows-resources/#operating-system>Operating System</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#kernel-examples>Kernel Examples</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#vt-technology>VT Technology</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#miscellaneous>Miscellaneous</a></li></ul></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#ctf-resources>CTF Resources</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#penetration-testing>Penetration Testing</a></li><li><a href=/en-us/blog/2024/06/28/windows-resources/#free-patent-search>Free Patent Search</a></li></ul></li></ul><p>This section lists only some common Windows tools for debugging, troubleshooting, and testing. Tools for packing/unpacking, encryption/decryption, file editors, and programming tools are omitted for brevity.</p><h2 id=tools>Tools</h2><h3 id=monitoring--analysis>Monitoring & Analysis</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>DebugView</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/zh-cn/sysinternals/downloads/debugview>https://docs.microsoft.com/zh-cn/sysinternals/downloads/debugview</a></td><td style=text-align:left>A Sysinternals utility for capturing and controlling kernel and user-mode debug output.</td></tr><tr><td style=text-align:left><strong>Process Monitor</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/zh-cn/sysinternals/downloads/procmon>https://docs.microsoft.com/zh-cn/sysinternals/downloads/procmon</a></td><td style=text-align:left>A real-time Sysinternals tool that monitors file system, registry, process, thread, and DLL activity to help troubleshoot issues.</td></tr><tr><td style=text-align:left><strong>Process Explorer</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/zh-cn/sysinternals/downloads/process-explorer>https://docs.microsoft.com/zh-cn/sysinternals/downloads/process-explorer</a></td><td style=text-align:left>A Sysinternals process viewer that inspects loaded DLLs, call stacks, and which processes have opened a file.</td></tr><tr><td style=text-align:left><strong>WinObj</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/zh-cn/sysinternals/downloads/winobj>https://docs.microsoft.com/zh-cn/sysinternals/downloads/winobj</a></td><td style=text-align:left>A Sysinternals viewer for the Object Manager namespace; it uses native APIs without loading drivers—see WinObjEx64 for an open-source implementation on GitHub.</td></tr><tr><td style=text-align:left><strong>WinObjEx64</strong></td><td style=text-align:left><a href=https://github.com/hfiref0x/WinObjEx64>https://github.com/hfiref0x/WinObjEx64</a></td><td style=text-align:left>An open-source, advanced Object Manager namespace viewer.</td></tr><tr><td style=text-align:left><strong>Handle</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/zh-cn/sysinternals/downloads/handle>https://docs.microsoft.com/zh-cn/sysinternals/downloads/handle</a></td><td style=text-align:left>A Sysinternals utility showing which file or directory is held by a running process.</td></tr><tr><td style=text-align:left><strong>Sysinternals Suite</strong></td><td style=text-align:left><a href=https://live.sysinternals.com/>https://live.sysinternals.com/</a></td><td style=text-align:left>The complete suite of Sysinternals utilities—only the most frequently used are listed here to avoid clutter.</td></tr><tr><td style=text-align:left><strong>CPU-Z</strong></td><td style=text-align:left><a href=https://www.cpuid.com/softwares/cpu-z.html>https://www.cpuid.com/softwares/cpu-z.html</a></td><td style=text-align:left>Real-time CPU monitoring tool.</td></tr><tr><td style=text-align:left><strong>ProcMonX</strong></td><td style=text-align:left><a href=https://github.com/zodiacon/ProcMonX>https://github.com/zodiacon/ProcMonX</a></td><td style=text-align:left>An open-source C# implementation using ETW to provide functionality similar to Process Monitor.</td></tr><tr><td style=text-align:left><strong>ProcMonXv2</strong></td><td style=text-align:left><a href=https://github.com/zodiacon/ProcMonXv2>https://github.com/zodiacon/ProcMonXv2</a></td><td style=text-align:left>The second open-source C# ETW-based alternative to Process Monitor.</td></tr><tr><td style=text-align:left><strong>Process Hacker</strong></td><td style=text-align:left><a href=https://github.com/processhacker/processhacker>https://github.com/processhacker/processhacker</a></td><td style=text-align:left>An open-source Process Explorer-like tool with GPU information support.</td></tr><tr><td style=text-align:left><strong>API Monitor</strong></td><td style=text-align:left><a href=http://www.rohitab.com/apimonitor>http://www.rohitab.com/apimonitor</a></td><td style=text-align:left>Traces API calls to show how applications/services interact, helps detect bugs, and can modify input/output parameters.</td></tr><tr><td style=text-align:left><strong>Dependency Walker</strong></td><td style=text-align:left><a href=http://www.dependencywalker.com/>http://www.dependencywalker.com/</a></td><td style=text-align:left>Scans any 32- or 64-bit Windows module and lists all exported functions.</td></tr><tr><td style=text-align:left><strong>DeviceTree</strong></td><td style=text-align:left><a href="http://www.osronline.com/article.cfm%5earticle=97.htm">http://www.osronline.com/article.cfm%5earticle=97.htm</a></td><td style=text-align:left>Displays all driver objects and device stack information in the system.</td></tr><tr><td style=text-align:left><strong>Unlocker</strong></td><td style=text-align:left><a href=https://www.softpedia.com/get/System/System-Miscellaneous/Unlocker.shtml>https://www.softpedia.com/get/System/System-Miscellaneous/Unlocker.shtml</a></td><td style=text-align:left>Unlocks files held by running processes—many similar open-source tools are available.</td></tr><tr><td style=text-align:left><strong>RpcView</strong></td><td style=text-align:left><a href=https://github.com/silverf0x/RpcView>https://github.com/silverf0x/RpcView</a></td><td style=text-align:left>Shows and decompiles live RPC interfaces on the system—useful when analyzing RPC services.</td></tr><tr><td style=text-align:left><strong>RequestTrace</strong></td><td style=text-align:left><a href=https://the-sz.com/products/rt/>https://the-sz.com/products/rt/</a></td><td style=text-align:left>Displays IRPs, SRBs, URBs, and related buffers on Windows; mostly redundant as WinDbg covers the same traces but handy without a debugger.</td></tr><tr><td style=text-align:left><strong>IRPMon</strong></td><td style=text-align:left><a href=https://github.com/MartinDrab/IRPMon>https://github.com/MartinDrab/IRPMon</a></td><td style=text-align:left>Hooks driver objects to monitor IRP traffic and other driver requests, similar to RequestTrace and IrpTracker.</td></tr><tr><td style=text-align:left><strong>IRPTrace</strong></td><td style=text-align:left><a href=https://github.com/haidragon/drivertools>https://github.com/haidragon/drivertools</a></td><td style=text-align:left>Contains a collection of additional tools.</td></tr></tbody></table><h3 id=antirootkit-tools>AntiRootkit Tools</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>PcHunter</strong></td><td style=text-align:left><a href=https://www.anxinsec.com/view/antirootkit/>https://www.anxinsec.com/view/antirootkit/</a></td><td style=text-align:left>Security analysis tool that bypasses rootkits via direct disk, registry, network, etc., showing detailed info on threads, processes, and kernel modules.</td></tr><tr><td style=text-align:left><strong>Windows-Kernel-Explorer</strong></td><td style=text-align:left><a href=https://github.com/AxtMueller/Windows-Kernel-Explorer>https://github.com/AxtMueller/Windows-Kernel-Explorer</a></td><td style=text-align:left>Closed-source alternative to PcHunter, useful when newer OS support is missing.</td></tr><tr><td style=text-align:left><strong>PowerTool</strong></td><td style=text-align:left></td><td style=text-align:left>Rarely updated. Developed by a colleague of a friend; reportedly messy codebase.</td></tr><tr><td style=text-align:left><strong>py</strong></td><td style=text-align:left><a href=https://github.com/antiwar3/py>https://github.com/antiwar3/py</a></td><td style=text-align:left>PiaoYun ARK—open-source rootkit scanner.</td></tr></tbody></table><h3 id=pe-tools>PE Tools</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>CFF Explorer</strong></td><td style=text-align:left><a href="https://ntcore.com/?page_id=388">https://ntcore.com/?page_id=388</a></td><td style=text-align:left>A nice PE explorer.</td></tr><tr><td style=text-align:left><strong>ExeinfoPe</strong></td><td style=text-align:left><a href=http://www.exeinfo.xn.pl/>http://www.exeinfo.xn.pl/</a></td><td style=text-align:left>–</td></tr></tbody></table><h3 id=reverse--debug>Reverse & Debug</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th><th style=text-align:left></th></tr></thead><tbody><tr><td style=text-align:left><strong>Ghidra</strong></td><td style=text-align:left><a href=https://www.nsa.gov/resources/everyone/ghidra/>https://www.nsa.gov/resources/everyone/ghidra/</a></td><td style=text-align:left>A software reverse-engineering (SRE) suite created by the NSA Research Directorate to support cybersecurity missions.</td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>IDA</strong></td><td style=text-align:left><a href=https://down.52pojie.cn/>https://down.52pojie.cn/</a></td><td style=text-align:left>Famous but closed-source interactive disassembler—latest cracks (v7.5) on 52pojie forum.</td><td></td></tr><tr><td style=text-align:left><strong>dnSpy</strong></td><td style=text-align:left><a href=https://github.com/dnSpy/dnSpy>https://github.com/dnSpy/dnSpy</a></td><td style=text-align:left>.NET decompiler; effectively provides source code for unobfuscated .NET binaries if the framework is familiar to you.</td><td></td></tr><tr><td style=text-align:left><strong>OllyDbg</strong></td><td style=text-align:left><a href=https://down.52pojie.cn/Tools/Debuggers//>https://down.52pojie.cn/Tools/Debuggers//</a></td><td style=text-align:left>Popular debugger with many plugins; closed-source and only for 32-bit binaries.</td><td></td></tr><tr><td style=text-align:left><strong>x64dbg</strong></td><td style=text-align:left><a href=https://x64dbg.com/>https://x64dbg.com/</a></td><td style=text-align:left>Open-source debugger for x86/x64 binaries—more convenient than WinDbg yet similar plugin support; recommended over OllyDbg.</td><td></td></tr><tr><td style=text-align:left><strong>Cheat Engine</strong></td><td style=text-align:left><a href=https://www.cheatengine.org/>https://www.cheatengine.org/</a></td><td style=text-align:left>Memory-search & manipulation Swiss-army knife; offers many advanced reverse-engineering features.</td><td></td></tr><tr><td style=text-align:left><strong>VirtualKD-Redux</strong></td><td style=text-align:left><a href=https://github.com/4d61726b/VirtualKD-Redux/releases>https://github.com/4d61726b/VirtualKD-Redux/releases</a></td><td style=text-align:left>Fully-automated WinDbg virtual-machine debugging without env vars; supports latest VMware.</td><td></td></tr><tr><td style=text-align:left><strong>Driver Loader</strong></td><td style=text-align:left><a href="http://www.osronline.com/article.cfm%5Earticle=157.htm">http://www.osronline.com/article.cfm%5Earticle=157.htm</a></td><td style=text-align:left>OSR tool for installing, loading, and unloading drivers.</td><td style=text-align:left></td></tr><tr><td style=text-align:left>reverse-engineering</td><td style=text-align:left><a href=https://github.com/wtsxDev/reverse-engineering>https://github.com/wtsxDev/reverse-engineering</a></td><td style=text-align:left>A curated list of almost every tool you need for reverse engineering.</td><td></td></tr></tbody></table><h3 id=injection-tools>Injection Tools</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th><th></th></tr></thead><tbody><tr><td style=text-align:left><strong>yapi</strong></td><td style=text-align:left><a href=https://github.com/ez8-co/yapi>https://github.com/ez8-co/yapi</a></td><td style=text-align:left>Simple open-source DLL injector for x64/x86 processes—good for learning from the source; supports cross-bit-width injection from 32-bit to 64-bit.</td><td></td></tr><tr><td style=text-align:left><strong>Xenos</strong></td><td style=text-align:left><a href=https://github.com/DarthTon/Xenos>https://github.com/DarthTon/Xenos</a></td><td style=text-align:left>Open-source injector using the famous Blackbone library; supports kernel-level injection.</td><td></td></tr><tr><td style=text-align:left><strong>ExtremeInjector</strong></td><td style=text-align:left><a href=https://github.com/master131/ExtremeInjector>https://github.com/master131/ExtremeInjector</a></td><td style=text-align:left>Easy-to-use application-layer injector featuring cross-bit-width injection from 32-bit to 64-bit.</td><td></td></tr></tbody></table><h3 id=network>Network</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>Fiddler</strong></td><td style=text-align:left><a href=https://www.telerik.com/fiddler>https://www.telerik.com/fiddler</a></td><td style=text-align:left>Powerful HTTPS man-in-the-middle proxy without a certificate hassle; scriptable; ships with an SDK.</td></tr><tr><td style=text-align:left><strong>Wireshark</strong></td><td style=text-align:left><a href=https://www.wireshark.org/download.html>https://www.wireshark.org/download.html</a></td><td style=text-align:left>No introduction needed.</td></tr><tr><td style=text-align:left><strong>Burp Suite</strong></td><td style=text-align:left><a href=https://portswigger.net/burp>https://portswigger.net/burp</a></td><td style=text-align:left>The go-to web proxy for pentesters. Requires JDK; cracked versions available on 52pojie.</td></tr></tbody></table><h3 id=stress-testing-tools>Stress Testing Tools</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>Driver Verifier</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/driver-verifier>https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/driver-verifier</a></td><td style=text-align:left>Built-in driver stability and stress tester.</td></tr><tr><td style=text-align:left><strong>Application Verifier</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/application-verifier>https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/application-verifier</a></td><td style=text-align:left>Built-in application-layer stress tester.</td></tr><tr><td style=text-align:left><strong>CPUStress</strong></td><td style=text-align:left><a href=https://docs.microsoft.com/en-us/sysinternals/downloads/cpustres>https://docs.microsoft.com/en-us/sysinternals/downloads/cpustres</a></td><td style=text-align:left>Pushes CPU to full load to test application stability and responsiveness under extreme conditions.</td></tr></tbody></table><h3 id=others>Others</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>game-hacking</strong></td><td style=text-align:left><a href=https://github.com/dsasmblr/game-hacking>https://github.com/dsasmblr/game-hacking</a></td><td style=text-align:left>–</td></tr><tr><td style=text-align:left><strong>awesome-malware-analysis</strong></td><td style=text-align:left><a href=https://github.com/rootkiter/awesome-malware-analysis>https://github.com/rootkiter/awesome-malware-analysis</a></td><td style=text-align:left>Curated list of malware-analysis tools</td></tr><tr><td style=text-align:left><strong>drawio</strong></td><td style=text-align:left><a href=https://github.com/jgraph/drawio-desktop>https://github.com/jgraph/drawio-desktop</a></td><td style=text-align:left>The ultimate diagramming tool</td></tr><tr><td style=text-align:left><strong>RazorSQL</strong></td><td style=text-align:left><a href=https://www.razorsql.com/>https://www.razorsql.com/</a></td><td style=text-align:left>GUI for SQLite3 databases</td></tr><tr><td style=text-align:left>Git Learning Notes</td><td style=text-align:left><a href=https://github.com/No-Github/1earn/blob/master/1earn/Develop/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/Git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.md>https://github.com/No-Github/1earn/blob/master/1earn/Develop/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/Git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.md</a></td><td style=text-align:left>Version management with Git</td></tr><tr><td style=text-align:left>Markdown Syntax Learning</td><td style=text-align:left><a href=https://github.com/No-Github/1earn/blob/master/1earn/Develop/%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80/Markdown/Markdown%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0.md>https://github.com/No-Github/1earn/blob/master/1earn/Develop/%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80/Markdown/Markdown%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0.md</a></td><td style=text-align:left>Markdown reference</td></tr></tbody></table><h2 id=code>Code</h2><h3 id=operating-system>Operating System</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>ReactOS</strong></td><td style=text-align:left><a href=https://github.com/reactos/reactos>https://github.com/reactos/reactos</a></td><td style=text-align:left>An open-source OS aiming for Windows 2000 driver binary compatibility.</td></tr><tr><td style=text-align:left><strong>wrk-v1.2</strong></td><td style=text-align:left><a href=https://github.com/jmcjmmcjc/wrk-v1.2>https://github.com/jmcjmmcjc/wrk-v1.2</a></td><td style=text-align:left>Partial Windows NT 5.2 source code.</td></tr><tr><td style=text-align:left><strong>WinNT4</strong></td><td style=text-align:left><a href=https://github.com/ZoloZiak/WinNT4>https://github.com/ZoloZiak/WinNT4</a></td><td style=text-align:left>Windows NT4 kernel source code.</td></tr><tr><td style=text-align:left><strong>whids</strong></td><td style=text-align:left><a href=https://github.com/0xrawsec/whids/tree/a826d87e0d035daac10bfa96b530c5deff6b9915>https://github.com/0xrawsec/whids/tree/a826d87e0d035daac10bfa96b530c5deff6b9915</a></td><td style=text-align:left>Open source EDR for Windows.</td></tr></tbody></table><h3 id=kernel-examples>Kernel Examples</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>CPPHelper</strong></td><td style=text-align:left><a href=https://github.com/Chuyu-Team/CPPHelper>https://github.com/Chuyu-Team/CPPHelper</a></td><td style=text-align:left>Basic C++ helper class library.</td></tr><tr><td style=text-align:left><strong>cpp_component</strong></td><td style=text-align:left><a href=https://github.com/skyformat99/cpp_component>https://github.com/skyformat99/cpp_component</a></td><td style=text-align:left>Encapsulation of common C/C++ features.</td></tr><tr><td style=text-align:left><strong>WinToolsLib</strong></td><td style=text-align:left><a href=https://github.com/deeonis-ru/WinToolsLib>https://github.com/deeonis-ru/WinToolsLib</a></td><td style=text-align:left>Suite of classes for Windows programming.</td></tr><tr><td style=text-align:left><strong>KDU</strong></td><td style=text-align:left><a href=https://github.com/hfiref0x/KDU>https://github.com/hfiref0x/KDU</a></td><td style=text-align:left>–</td></tr><tr><td style=text-align:left><strong>KTL</strong></td><td style=text-align:left><a href=https://github.com/MeeSong/KTL>https://github.com/MeeSong/KTL</a></td><td style=text-align:left>–</td></tr><tr><td style=text-align:left><strong>Kernel-Bridge</strong></td><td style=text-align:left><a href=https://github.com/HoShiMin/Kernel-Bridge>https://github.com/HoShiMin/Kernel-Bridge</a></td><td style=text-align:left>–</td></tr><tr><td style=text-align:left><strong>KernelForge</strong></td><td style=text-align:left><a href=https://github.com/killvxk/KernelForge>https://github.com/killvxk/KernelForge</a></td><td style=text-align:left>–</td></tr><tr><td style=text-align:left><strong>ExecutiveCallbackObjects</strong></td><td style=text-align:left><a href=https://github.com/0xcpu/ExecutiveCallbackObjects>https://github.com/0xcpu/ExecutiveCallbackObjects</a></td><td style=text-align:left>Research on various kernel-mode callbacks.</td></tr><tr><td style=text-align:left><strong>SyscallHook</strong></td><td style=text-align:left><a href=https://github.com/AnzeLesnik/SyscallHook>https://github.com/AnzeLesnik/SyscallHook</a></td><td style=text-align:left>System-call hook for Windows 10 20H1.</td></tr><tr><td style=text-align:left><strong>Antivirus_R3_bypass_demo</strong></td><td style=text-align:left><a href=https://github.com/huoji120/Antivirus_R3_bypass_demo>https://github.com/huoji120/Antivirus_R3_bypass_demo</a></td><td style=text-align:left>Eliminates AV via both R3 0-day and R0 0-day.</td></tr><tr><td style=text-align:left><strong>KernelHiddenExecute</strong></td><td style=text-align:left><a href=https://github.com/zouxianyu/KernelHiddenExecute>https://github.com/zouxianyu/KernelHiddenExecute</a></td><td style=text-align:left>Hide code/data in kernel address space.</td></tr><tr><td style=text-align:left><strong>DriverInjectDll</strong></td><td style=text-align:left><a href=https://github.com/strivexjun/DriverInjectDll>https://github.com/strivexjun/DriverInjectDll</a></td><td style=text-align:left>Kernel-mode global and memory-based injection for Win7–Win10.</td></tr><tr><td style=text-align:left><strong>zwhawk</strong></td><td style=text-align:left><a href=https://github.com/eLoopWoo/zwhawk>https://github.com/eLoopWoo/zwhawk</a></td><td style=text-align:left>Kernel rootkit providing remote command/control.</td></tr><tr><td style=text-align:left><strong>ZeroBank-ring0-bundle</strong></td><td style=text-align:left><a href=https://github.com/Trietptm-on-Coding-Algorithms/ZeroBank-ring0-bundle>https://github.com/Trietptm-on-Coding-Algorithms/ZeroBank-ring0-bundle</a></td><td style=text-align:left>Kernel-mode rootkit for remote server communication.</td></tr><tr><td style=text-align:left><strong>kdmapper</strong></td><td style=text-align:left><a href=https://github.com/z175/kdmapper>https://github.com/z175/kdmapper</a></td><td style=text-align:left>Manual driver mapper (educational/outdated).</td></tr><tr><td style=text-align:left><strong>antispy</strong></td><td style=text-align:left><a href=https://github.com/mohuihui/antispy>https://github.com/mohuihui/antispy</a></td><td style=text-align:left>Free but powerful AV & rootkit detection toolkit.</td></tr><tr><td style=text-align:left><strong>windows_kernel_resources</strong></td><td style=text-align:left><a href=https://github.com/sam-b/windows_kernel_resources>https://github.com/sam-b/windows_kernel_resources</a></td><td style=text-align:left>–</td></tr><tr><td style=text-align:left><strong>HookLib</strong></td><td style=text-align:left><a href=https://github.com/HoShiMin/HookLib>https://github.com/HoShiMin/HookLib</a></td><td style=text-align:left>User- and kernel-mode hooking library.</td></tr><tr><td style=text-align:left><strong>Kernel-Whisperer</strong></td><td style=text-align:left><a href=https://github.com/BrunoMCBraga/Kernel-Whisperer>https://github.com/BrunoMCBraga/Kernel-Whisperer</a></td><td style=text-align:left>Kernel module utilities.</td></tr><tr><td style=text-align:left><strong>SQLiteCpp</strong></td><td style=text-align:left><a href=https://github.com/SRombauts/SQLiteCpp>https://github.com/SRombauts/SQLiteCpp</a></td><td style=text-align:left>Smart, easy-to-use C++ SQLite3 wrapper.</td></tr><tr><td style=text-align:left>awesome-windows-kernel-security-development</td><td style=text-align:left><a href=https://github.com/ExpLife0011/awesome-windows-kernel-security-development>https://github.com/ExpLife0011/awesome-windows-kernel-security-development</a></td><td style=text-align:left>Curated collection of Windows kernel security projects.</td></tr></tbody></table><h3 id=vt-technology>VT Technology</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>hvpp</strong></td><td style=text-align:left><a href=https://github.com/wbenny/hvpp>https://github.com/wbenny/hvpp</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>HyperBone</strong></td><td style=text-align:left><a href=https://github.com/DarthTon/HyperBone>https://github.com/DarthTon/HyperBone</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>HyperWin</strong></td><td style=text-align:left><a href=https://github.com/amiryeshurun/HyperWin>https://github.com/amiryeshurun/HyperWin</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>Hypervisor</strong></td><td style=text-align:left><a href=https://github.com/Bareflank/hypervisor>https://github.com/Bareflank/hypervisor</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>HyperPlatform</strong></td><td style=text-align:left><a href=https://github.com/tandasat/HyperPlatform>https://github.com/tandasat/HyperPlatform</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>Hyper-V-Internals</strong></td><td style=text-align:left><a href=https://github.com/gerhart01/Hyper-V-Internals>https://github.com/gerhart01/Hyper-V-Internals</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>Hypervisor-From-Scratch</strong></td><td style=text-align:left><a href=https://github.com/SinaKarvandi/Hypervisor-From-Scratch>https://github.com/SinaKarvandi/Hypervisor-From-Scratch</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>KasperskyHook</strong></td><td style=text-align:left><a href=https://github.com/iPower/KasperskyHook>https://github.com/iPower/KasperskyHook</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>awesome-virtualization</strong></td><td style=text-align:left><a href=https://github.com/Wenzel/awesome-virtualization>https://github.com/Wenzel/awesome-virtualization</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>ransomware_begone</strong></td><td style=text-align:left><a href=https://github.com/ofercas/ransomware_begone>https://github.com/ofercas/ransomware_begone</a></td><td style=text-align:left></td></tr></tbody></table><h3 id=miscellaneous>Miscellaneous</h3><table><thead><tr><th style=text-align:left>Tool Name</th><th style=text-align:left>Download Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>Divert</strong></td><td style=text-align:left><a href=https://github.com/basil00/Divert>https://github.com/basil00/Divert</a></td><td style=text-align:left>Redirect network traffic to user-mode applications for modification/dropping.</td></tr><tr><td style=text-align:left><strong>Blackbone</strong></td><td style=text-align:left><a href=https://github.com/DarthTon/Blackbone>https://github.com/DarthTon/Blackbone</a></td><td style=text-align:left>Kernel-mode injection techniques, including kernel memory injection.</td></tr><tr><td style=text-align:left><strong>NetWatch</strong></td><td style=text-align:left><a href=https://github.com/huoji120/NetWatch>https://github.com/huoji120/NetWatch</a></td><td style=text-align:left>Threat-traffic detection platform; supports virtual memory patching.</td></tr><tr><td style=text-align:left><strong>x64_AOB_Search</strong></td><td style=text-align:left><a href=https://github.com/wanttobeno/x64_AOB_Search>https://github.com/wanttobeno/x64_AOB_Search</a></td><td style=text-align:left>Enterprise-grade high-speed memory scanner (supports wildcards).</td></tr><tr><td style=text-align:left><strong>DuckMemoryScan</strong></td><td style=text-align:left><a href=https://github.com/huoji120/DuckMemoryScan>https://github.com/huoji120/DuckMemoryScan</a></td><td style=text-align:left>Detects most so-called memory-only AV evasion shells.</td></tr><tr><td style=text-align:left><strong>FSDefender</strong></td><td style=text-align:left><a href=https://github.com/Randomize163/FSDefender>https://github.com/Randomize163/FSDefender</a></td><td style=text-align:left>File-system monitoring combined with cloud-backed backups.</td></tr><tr><td style=text-align:left><strong>AntiRansomware</strong></td><td style=text-align:left><a href=https://github.com/clavis0x/AntiRansomware>https://github.com/clavis0x/AntiRansomware</a></td><td style=text-align:left>Write-scanning anti-ransomware solution—prevents overwriting of files.</td></tr><tr><td style=text-align:left><strong>Lazy</strong></td><td style=text-align:left><a href=https://github.com/moonAgirl/Lazy>https://github.com/moonAgirl/Lazy</a></td><td style=text-align:left>(Malicious) ransomware terminator.</td></tr><tr><td style=text-align:left>awesome-cheatsheets</td><td style=text-align:left><a href=https://github.com/skywind3000/awesome-cheatsheets/blob/master/tools/git.txt>https://github.com/skywind3000/awesome-cheatsheets/blob/master/tools/git.txt</a></td><td style=text-align:left>Handy references for Python, Git, etc.</td></tr></tbody></table><h2 id=ctf-resources>CTF Resources</h2><table><thead><tr><th style=text-align:left>Repository Name</th><th style=text-align:left>Repository Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>CTF-All-In-One</strong></td><td style=text-align:left><a href=https://github.com/firmianay/CTF-All-In-One>https://github.com/firmianay/CTF-All-In-One</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>ctf-book</strong></td><td style=text-align:left><a href=https://github.com/firmianay/ctf-book>https://github.com/firmianay/ctf-book</a></td><td style=text-align:left>Companion resources for the CTF Competition Guide (Pwn Edition).</td></tr></tbody></table><h2 id=penetration-testing>Penetration Testing</h2><table><thead><tr><th style=text-align:left>Repository Name</th><th style=text-align:left>Repository Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>Web-Security-Learning</strong></td><td style=text-align:left><a href=https://github.com/CHYbeta/Web-Security-Learning>https://github.com/CHYbeta/Web-Security-Learning</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>pentest</strong></td><td style=text-align:left><a href=https://github.com/r0eXpeR/pentest>https://github.com/r0eXpeR/pentest</a></td><td style=text-align:left>Tools and project reference for pivoting inside intranets.</td></tr><tr><td style=text-align:left><strong>K8tools</strong></td><td style=text-align:left><a href=http://k8gege.org/p/72f1fea6.html>http://k8gege.org/p/72f1fea6.html</a></td><td style=text-align:left>Collection of K8tools.</td></tr><tr><td style=text-align:left><strong>Awesome-Red-Teaming</strong></td><td style=text-align:left><a href=https://github.com/yeyintminthuhtut/Awesome-Red-Teaming>https://github.com/yeyintminthuhtut/Awesome-Red-Teaming</a></td><td style=text-align:left>List of Awesome Red-Teaming Resources.</td></tr><tr><td style=text-align:left><strong>Awesome-Hacking</strong></td><td style=text-align:left><a href=https://github.com/Hack-with-Github/Awesome-Hacking>https://github.com/Hack-with-Github/Awesome-Hacking</a></td><td style=text-align:left>Curated lists for hackers.</td></tr><tr><td style=text-align:left>awesome-web-hacking</td><td style=text-align:left><a href=https://github.com/infoslack/awesome-web-hacking>https://github.com/infoslack/awesome-web-hacking</a></td><td style=text-align:left>Penetration-testing knowledge base.</td></tr></tbody></table><h2 id=free-patent-search>Free Patent Search</h2><table><thead><tr><th style=text-align:left>Repository Name</th><th style=text-align:left>Repository Link</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>Patent Information Service Platform</strong></td><td style=text-align:left><a href=http://search.cnipr.com/>http://search.cnipr.com/</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>patents</strong></td><td style=text-align:left>&lt;www.google.com/patents></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>incopat</strong></td><td style=text-align:left>&lt;www.incopat.com></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>Baiten</strong></td><td style=text-align:left><a href=https://www.baiten.cn/>https://www.baiten.cn/</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>rainpat</strong></td><td style=text-align:left><a href=https://www.rainpat.com/>https://www.rainpat.com/</a></td><td style=text-align:left></td></tr><tr><td style=text-align:left><strong>Duyan</strong></td><td style=text-align:left><a href=https://www.uyanip.com/>https://www.uyanip.com/</a></td><td style=text-align:left></td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-dc08d8c63151ed8a0f9692c0720a0e3c>Windows Guide</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> Windows Guide</li></ul><h1 id=windows>Windows</h1><ul><li>[<a href=/en-us/blog/2024/06/28/win-to-go/ title=Win-to-go>Win-to-go</a>]</li><li>[<a href=%E7%90%86%E8%A7%A3Windows%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F title="Understanding Windows File System">Understanding Windows File System</a>]</li><li>[<a href=%E7%90%86%E8%A7%A3Windows%E8%BF%9B%E7%A8%8B title="Understanding Windows Processes">Understanding Windows Processes</a>]</li><li>[<a href=Windows%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90 title="Windows Related Resources">Windows Related Resources</a>]</li><li>[<a href=Windows%E7%AE%A1%E7%90%86%E8%BF%9B%E9%98%B6 title="Advanced Windows Management">Advanced Windows Management</a>]</li><li>[<a href=Windows%E9%98%B2%E7%81%AB%E5%A2%99%E7%AE%A1%E7%90%86-netsh title="Windows Firewall Management - netsh">Windows Firewall Management - netsh</a>]</li><li>[<a href=Windows%E9%98%BB%E6%96%AD%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E8%8E%B7%E5%8F%96 title="Blocking Windows Network Traffic Acquisition">Blocking Windows Network Traffic Acquisition</a>]</li><li>[<a href=../../../%E7%96%91%E9%9A%BE%E6%9D%82%E7%97%87/Windows%E9%BA%BB%E7%83%A6%E9%97%AE%E9%A2%98 title="Windows Troublesome Issues">Windows Troublesome Issues</a>]</li><li>[<a href=%E7%90%86%E8%A7%A3Windows%E4%BA%8B%E4%BB%B6%E8%B7%9F%E8%B8%AA_ETW title="Understanding Windows Event Tracing (ETW)">Understanding Windows Event Tracing (ETW)</a>]</li><li>[<a href=%E7%90%86%E8%A7%A3Windows%E7%BD%91%E7%BB%9C_WFP title="Understanding Windows Networking (WFP)">Understanding Windows Networking (WFP)</a>]</li><li>[<a href=windows-ipv6%E7%AE%A1%E7%90%86 title=windows-ipv6-management>windows-ipv6-management</a>]</li><li>[<a href=../../../%E7%96%91%E9%9A%BE%E6%9D%82%E7%97%87/Windows%E6%A1%A5%E6%8E%A5%E6%97%B6%E7%9A%84IPv6%E9%97%AE%E9%A2%98 title="IPv6 Issues When Bridging Windows">IPv6 Issues When Bridging Windows</a>]</li><li>[<a href=wireguard%E9%85%8D%E7%BD%AE title="wireguard configuration">wireguard configuration</a>]</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-61abe4532313c2fd9d4e7585b6edf0d9>window-message</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><ul><li><input disabled type=checkbox> window-message</li></ul><h1 id=windows-message>windows-message</h1><ul><li><a href=https://gist.github.com/amgine/2395987>All windows messages as C# enum (github.com)</a></li><li><a href=https://wiki.winehq.org/List_Of_Windows_Messages>List Of Windows Messages - WineHQ Wiki</a></li><li><a href=http://www.pinvoke.net/default.aspx/Constants/WM.html>pinvoke.net: WM (Constants)</a></li><li><a href=http://www.pinvoke.net/default.aspx/Enums/WindowsMessages>pinvoke.net: WindowsMessages (Enums)</a></li><li><a href=https://learn.microsoft.com/en-us/windows/win32/winmsg/window-notifications>Window Notifications</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-6c9144bf4bbbb75884f99fcddaa67574>Win-to-go</h1><div class="td-byline mb-4"><time datetime=2024-06-28 class=text-body-secondary>Friday, June 28, 2024</time></div><p>===</p><p>Windows To Go is convenient for portability, but several traditional Windows features are restricted.</p><ul><li><a href=/en-us/blog/2024/06/28/win-to-go/#preface>Preface</a></li><li><a href=/en-us/blog/2024/06/28/win-to-go/#windows-to-go-overview>Windows To Go Overview</a></li><li><a href=/en-us/blog/2024/06/28/win-to-go/#differences-between-windows-to-go-and-traditional-windows-installation>Differences between Windows To Go and traditional Windows installation</a></li><li><a href=/en-us/blog/2024/06/28/win-to-go/#using-windows-to-go-for-mobile-work>Using Windows To Go for mobile work</a></li><li><a href=/en-us/blog/2024/06/28/win-to-go/#preparing-to-install-windows-to-go>Preparing to install Windows To Go</a></li><li><a href=/en-us/blog/2024/06/28/win-to-go/#hardware-requirements>Hardware requirements</a></li><li><a href=/en-us/blog/2024/06/28/win-to-go/#usb-hard-drive-or-flash-drive>USB hard drive or flash drive</a></li><li><a href=/en-us/blog/2024/06/28/win-to-go/#host-computer>Host computer</a></li><li><a href=/en-us/blog/2024/06/28/win-to-go/#checking-architecture-compatibility-between-host-pc-and-windows-to-go-drive>Checking architecture compatibility between host PC and Windows To Go drive</a></li><li><a href=/en-us/blog/2024/06/28/win-to-go/#common-windows-to-go-questions>Common Windows To Go questions</a></li></ul><h2 id=preface>Preface</h2><p>Windows To Go has existed for many years, yet there are so few Chinese-language resources on it—one can’t help but worry about the state of domestic IT documentation. The author has limited experience but is exposed to plenty of English development docs and hopes to lay some groundwork for future readers; any mistakes pointed out will be welcomed. For those comfortable reading English, comprehensive official documentation is available at the links below:</p><ul><li><a href=https://docs.microsoft.com/en-us/windows/deployment/planning/windows-to-go-overview>Windows To Go Overview</a></li><li><a href=https://docs.microsoft.com/en-us/windows/deployment/planning/best-practice-recommendations-for-windows-to-go>Best practice recommendations for Windows To Go</a></li><li><a href=https://docs.microsoft.com/en-us/windows/deployment/planning/deployment-considerations-for-windows-to-go>Deployment considerations for Windows To Go</a></li><li><a href=https://docs.microsoft.com/en-us/windows/deployment/planning/prepare-your-organization-for-windows-to-go>Prepare your organization for Windows To Go</a></li><li><a href=https://docs.microsoft.com/en-us/windows/deployment/planning/security-and-data-protection-considerations-for-windows-to-go>Security and data protection considerations for Windows To Go</a></li><li><a href=https://docs.microsoft.com/en-us/windows/deployment/planning/windows-to-go-frequently-asked-questions>Windows To Go: frequently asked questions</a></li></ul><p>This post covers the overview and some common questions—mostly translations with the occasional author note (indicated by [J] until the next full stop) to prevent misinformation.</p><h2 id=windows-to-go-overview>Windows To Go Overview</h2><p>Windows To Go is a feature of Windows Enterprise and Education editions; it is not available in the Home edition used by most general consumers. It allows you to create a portable Windows system on a USB drive or hard disk. Windows To Go is not intended to replace traditional installation methods; its main purpose is to let people who frequently switch workspaces do so more efficiently. Before using Windows To Go, you need to be aware of the following:</p><ul><li>Differences between Windows To Go and traditional Windows installation</li><li>Using Windows To Go for mobile work</li><li>Preparing to install Windows To Go</li><li>Hardware requirements</li></ul><h2 id=differences-between-windows-to-go-and-traditional-windows-installation>Differences between Windows To Go and traditional Windows installation</h2><p>Windows To Go behaves almost like a normal Windows environment except for these differences:</p><ul><li>All internal drives except the USB device you’re running from are offline by default—invisible in File Explorer—to safeguard data. [J]You still have ways to bring those drives online and change their files.</li><li>The Trusted Platform Module (TPM) is unavailable. TPM is tied to an individual PC to protect business data. [J]Most consumer machines don’t have it, but if your corporate laptop is domain-joined, it’s best not to use Windows To Go on it; otherwise, freshen up your résumé first.</li><li>Hibernation is disabled by default in Windows To Go but can be re-enabled via Group Policy. [J]Many machines break USB connections during hibernation and cannot resume—Microsoft anticipated this and disabled it; there’s usually no reason to change that setting.</li><li>Windows Restore is disabled. If the OS breaks, you’ll need to reinstall.</li><li>Factory reset and Windows Reset are unavailable.</li><li>In-place upgrades are not supported. The OS stays at whatever version it was installed as—you cannot go from Windows 7 to 8 or from Windows 10 RS1 to RS2.</li></ul><h2 id=using-windows-to-go-for-mobile-work>Using Windows To Go for mobile work</h2><p>Windows To Go can boot on multiple machines; the OS will automatically determine the needed drivers. Apps tightly coupled to specific hardware may fail to run. [J]ThinkPad track-pad control apps or fingerprint utilities, for example.</p><h2 id=preparing-to-install-windows-to-go>Preparing to install Windows To Go</h2><p>You can use <strong>System Center Configuration Manager</strong> or standard Windows deployment tools such as <strong>DiskPart</strong> and <strong>Deployment Image Servicing and Management (DISM)</strong>. Consider:</p><ul><li>Do you need to inject any drivers into the Windows To Go image?</li><li>How will you store and sync data when switching between machines?</li><li>32-bit or 64-bit? [J]All new hardware supports 64-bit; 64-bit CPUs can run 32-bit OSes, but 32-bit CPUs cannot run 64-bit OSes. 64-bit systems also consume more disk and memory. If any target machine has a 32-bit CPU or less than 4 GB RAM, stick with 32-bit.</li><li>What resolution should you use when remoting in from external networks?</li></ul><h2 id=hardware-requirements>Hardware requirements</h2><h3 id=usb-hard-drive-or-flash-drive>USB hard drive or flash drive</h3><p>Windows To Go is specifically optimized for certified devices:</p><ul><li>Optimizes USB devices for high random read/write, ensuring smooth daily use.</li><li>Can boot Windows 7 and later from certified devices.</li><li>Continues to enjoy OEM warranty support even while running Windows To Go. [J]The host PC’s warranty wasn’t mentioned.</li></ul><p>Uncertified USB devices are not supported. [J]Try it and you’ll learn quickly why—it just won’t work. [J]Non-standard hacks (e.g., spoofing device IDs) are out there but outside scope.</p><h3 id=host-computer-host-computer>Host computer (Host computer)</h3><ul><li>Certified for Windows 7 and later.</li><li>Windows RT systems are unsupported.</li><li>Apple Macs are unsupported. [J]Even though the web is full of success stories on using Windows To Go on a Mac, the official stance is clear: no support.</li></ul><p>Minimum specs for a host computer:</p><table><thead><tr><th>Item</th><th>Requirement</th></tr></thead><tbody><tr><td>Boot capability</td><td>Must support USB boot</td></tr><tr><td>Firmware</td><td>USB-boot option enabled</td></tr><tr><td>Processor architecture</td><td>Must match supported Windows To Go requirements</td></tr><tr><td>External USB hub</td><td>Not supported. The Windows To Go device must be plugged directly into the host</td></tr><tr><td>Processor</td><td>1 GHz or faster</td></tr><tr><td>RAM</td><td>2 GB or more</td></tr><tr><td>Graphics</td><td>DirectX 9 or later with WDDM 1.2</td></tr><tr><td>USB port</td><td>USB 2.0 or later</td></tr></tbody></table><h3 id=checking-architecture-compatibility-between-host-pc-and-windows-to-go-drive>Checking architecture compatibility between host PC and Windows To Go drive</h3><table><thead><tr><th>Host PC Firmware Type</th><th>Host PC Processor Architecture</th><th>Compatible Windows To Go Image Architecture</th></tr></thead><tbody><tr><td>Legacy BIOS</td><td>32-bit</td><td>32-bit only</td></tr><tr><td>Legacy BIOS</td><td>64-bit</td><td>32-bit and 64-bit</td></tr><tr><td>UEFI BIOS</td><td>32-bit</td><td>32-bit only</td></tr><tr><td>UEFI BIOS</td><td>64-bit</td><td>64-bit only</td></tr></tbody></table><h2 id=common-windows-to-go-questions>Common Windows To Go questions</h2><p><a href=https://docs.microsoft.com/en-us/windows/deployment/planning/windows-to-go-frequently-asked-questions>Windows To Go: frequently asked questions</a></p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="User mailing list" aria-label="User mailing list"><a target=_blank rel=noopener href=https://groups.google.com/forum/#!forum/jqknono aria-label="User mailing list"><i class=envelope></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/jqknono aria-label=Telegram><i class="fab fa-telegram"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/jqknono aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="User mailing list" aria-label="User mailing list"><a target=_blank rel=noopener href=https://groups.google.com/forum/#!forum/jqknono aria-label="User mailing list"><i class=envelope></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2015&ndash;2025
<span class=td-footer__authors>jqknono</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><style>.markmap>svg{width:100%;height:300px}</style><script>window.markmap={autoLoader:{manual:!0,onReady(){const{autoLoader:e,builtInPlugins:t}=window.markmap;e.transformPlugins=t.filter(e=>e.name!=="prism")}}}</script><script src=https://cdn.jsdelivr.net/npm/markmap-autoloader></script><script src=/js/deflate.js></script><script src=/js/main.min.ef02deeaa00500a3225379b19170d5b9d432263216df8955d03c6c7e12b892e4.js integrity="sha256-7wLe6qAFAKMiU3mxkXDVudQyJjIW34lV0DxsfhK4kuQ=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>